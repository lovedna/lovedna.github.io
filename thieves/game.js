var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(A,O,n){A!=Array.prototype&&A!=Object.prototype&&(A[O]=n.value)};$jscomp.getGlobal=function(A){return"undefined"!=typeof window&&window===A?A:"undefined"!=typeof global&&null!=global?global:A};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(A,O,n,g){if(O){n=$jscomp.global;A=A.split(".");for(g=0;g<A.length-1;g++){var Ya=A[g];Ya in n||(n[Ya]={});n=n[Ya]}A=A[A.length-1];g=n[A];O=O(g);O!=g&&null!=O&&$jscomp.defineProperty(n,A,{configurable:!0,writable:!0,value:O})}};
$jscomp.polyfill("String.fromCodePoint",function(A){return A?A:function(A){for(var n="",g=0;g<arguments.length;g++){var O=Number(arguments[g]);if(0>O||1114111<O||O!==Math.floor(O))throw new RangeError("invalid_code_point "+O);65535>=O?n+=String.fromCharCode(O):(O-=65536,n+=String.fromCharCode(O>>>10&1023|55296),n+=String.fromCharCode(O&1023|56320))}return n}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var A=0;return function(O){return $jscomp.SYMBOL_PREFIX+(O||"")+A++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var A=$jscomp.global.Symbol.iterator;A||(A=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[A]&&$jscomp.defineProperty(Array.prototype,A,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(A){var O=0;return $jscomp.iteratorPrototype(function(){return O<A.length?{done:!1,value:A[O++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(A){$jscomp.initSymbolIterator();A={next:A};A[$jscomp.global.Symbol.iterator]=function(){return this};return A};$jscomp.iteratorFromArray=function(A,O){$jscomp.initSymbolIterator();A instanceof String&&(A+="");var n=0,g={next:function(){if(n<A.length){var Ya=n++;return{value:O(Ya,A[Ya]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill("Array.prototype.keys",function(A){return A?A:function(){return $jscomp.iteratorFromArray(this,function(A){return A})}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(A){return A?A:function(A,n,g){var O=this.length||0;0>n&&(n=Math.max(0,O+n));if(null==g||g>O)g=O;g=Number(g);0>g&&(g=Math.max(0,O+g));for(n=Number(n||0);n<g;n++)this[n]=A;return this}},"es6","es3");
$jscomp.checkStringArgs=function(A,O,n){if(null==A)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(O instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return A+""};
$jscomp.polyfill("String.prototype.endsWith",function(A){return A?A:function(A,n){var g=$jscomp.checkStringArgs(this,A,"endsWith");A+="";void 0===n&&(n=g.length);n=Math.max(0,Math.min(n|0,g.length));for(var O=A.length;0<O&&0<n;)if(g[--n]!=A[--O])return!1;return 0>=O}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(A){return A?A:function(A,n){var g=$jscomp.checkStringArgs(this,A,"startsWith");A+="";var O=g.length,Z=A.length;n=Math.max(0,Math.min(n|0,g.length));for(var Ma=0;Ma<Z&&n<O;)if(g[n++]!=A[Ma++])return!1;return Ma>=Z}},"es6","es3");
(function(A,O){function n(a,b){a=Object.create(a);for(var c in b)a[c]=b[c];b.toString!==Object.prototype.toString&&(a.toString=b.toString);return a}function g(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=O.$haxeUID++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=b.bind(a),a.hx__closures__[b.__id__]=c);return c}A.lovedna=A.lovedna||{};A.lovedna.game=A.lovedna.game||{};var Ya={},Z=function(){return U.__string_rec(this,"")},Ma=Ma||{},M,x=function(){};
x.strDate=function(a){switch(a.length){case 8:a=a.split(":");var b=new Date;b.setTime(0);b.setUTCHours(a[0]);b.setUTCMinutes(a[1]);b.setUTCSeconds(a[2]);return b;case 10:return a=a.split("-"),new Date(a[0],a[1]-1,a[2],0,0,0);case 19:return b=a.split(" "),a=b[0].split("-"),b=b[1].split(":"),new Date(a[0],a[1]-1,a[2],b[0],b[1],b[2]);default:throw new u("Invalid date format : "+a);}};x.cca=function(a,b){a=a.charCodeAt(b);if(a==a)return a};x.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==
b)c=a.length+c;else return"";return a.substr(b,c)};x.remove=function(a,b){b=a.indexOf(b);if(-1==b)return!1;a.splice(b,1);return!0};x.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var ma=function(){};ma.field=function(a,b){try{return a[b]}catch(c){return null}};ma.getProperty=function(a,b){var c;if(null==a)return null;var d=a.__properties__?c=a.__properties__["get_"+b]:!1;return d?a[c]():a[b]};ma.fields=function(a){var b=
[];if(null!=a){var c=Object.prototype.hasOwnProperty,d;for(d in a)"__id__"!=d&&"hx__closures__"!=d&&c.call(a,d)&&b.push(d)}return b};ma.isFunction=function(a){return"function"==typeof a?!(a.__name__||a.__ename__):!1};ma.deleteField=function(a,b){if(!Object.prototype.hasOwnProperty.call(a,b))return!1;delete a[b];return!0};var da=function(){};da.string=function(a){return U.__string_rec(a,"")};da.parseInt=function(a){a=parseInt(a,!a||"0"!=a[0]||"x"!=a[1]&&"X"!=a[1]?10:16);return isNaN(a)?null:a};var Fb=
function(){this.b=""};Fb.prototype={};var ea=function(){};ea.htmlEscape=function(a,b){for(var c="",d=0;d<a.length;){var e=a,f=d++,r=e.charCodeAt(f);55296<=r&&56319>=r&&(r=r-55232<<10|e.charCodeAt(f+1)&1023);e=r;65536<=e&&++d;switch(e){case 34:c=b?c+"&quot;":c+String.fromCodePoint(e);break;case 38:c+="&amp;";break;case 39:c=b?c+"&#039;":c+String.fromCodePoint(e);break;case 60:c+="&lt;";break;case 62:c+="&gt;";break;default:c+=String.fromCodePoint(e)}}return c};ea.startsWith=function(a,b){return a.length>=
b.length?0==a.lastIndexOf(b,0):!1};ea.endsWith=function(a,b){var c=b.length,d=a.length;return d>=c?a.indexOf(b,d-c)==d-c:!1};ea.isSpace=function(a,b){a=x.cca(a,b);return 8<a&&14>a?!0:32==a};ea.ltrim=function(a){for(var b=a.length,c=0;c<b&&ea.isSpace(a,c);)++c;return 0<c?x.substr(a,c,b-c):a};ea.rtrim=function(a){for(var b=a.length,c=0;c<b&&ea.isSpace(a,b-c-1);)++c;return 0<c?x.substr(a,0,b-c):a};ea.trim=function(a){return ea.ltrim(ea.rtrim(a))};ea.replace=function(a,b,c){return a.split(b).join(c)};
ea.hex=function(a,b){for(var c="";c="0123456789ABCDEF".charAt(a&15)+c,a>>>=4,0<a;);if(null!=b)for(;c.length<b;)c="0"+c;return c};var Za=Ma.ValueType={__ename__:"ValueType",__constructs__:"TNull TInt TFloat TBool TObject TFunction TClass TEnum TUnknown".split(" "),TNull:{_hx_index:0,__enum__:"ValueType",toString:Z},TInt:{_hx_index:1,__enum__:"ValueType",toString:Z},TFloat:{_hx_index:2,__enum__:"ValueType",toString:Z},TBool:{_hx_index:3,__enum__:"ValueType",toString:Z},TObject:{_hx_index:4,__enum__:"ValueType",
toString:Z},TFunction:{_hx_index:5,__enum__:"ValueType",toString:Z},TClass:(M=function(a){return{_hx_index:6,c:a,__enum__:"ValueType",toString:Z}},M.__params__=["c"],M),TEnum:(M=function(a){return{_hx_index:7,e:a,__enum__:"ValueType",toString:Z}},M.__params__=["e"],M),TUnknown:{_hx_index:8,__enum__:"ValueType",toString:Z}},wb=function(){};wb.createInstance=function(a,b){return new (Function.prototype.bind.apply(a,[null].concat(b)))};wb.createEnum=function(a,b,c){var d=ma.field(a,b);if(null==d)throw new u("No such constructor "+
b);if(ma.isFunction(d)){if(null==c)throw new u("Constructor "+b+" need parameters");return d.apply(a,c)}if(null!=c&&0!=c.length)throw new u("Constructor "+b+" does not need parameters");return d};wb.typeof=function(a){switch(typeof a){case "boolean":return Za.TBool;case "function":return a.__name__||a.__ename__?Za.TObject:Za.TFunction;case "number":return Math.ceil(a)==a%2147483648?Za.TInt:Za.TFloat;case "object":if(null==a)return Za.TNull;var b=a.__enum__;if(null!=b)return Za.TEnum(Ma[b]);a=U.getClass(a);
return null!=a?Za.TClass(a):Za.TObject;case "string":return Za.TClass(String);case "undefined":return Za.TNull;default:return Za.TUnknown}};wb.enumParameters=function(a){var b=Ma[a.__enum__];b=b[b.__constructs__[a._hx_index]].__params__;if(null!=b){for(var c=[],d=0;d<b.length;){var e=b[d];++d;c.push(a[e])}return c}return[]};var oa={gt:function(a,b){var c=0>a;return c!=0>b?c:a>b},gte:function(a,b){var c=0>a;return c!=0>b?c:a>=b},toFloat:function(a){return 0>a?4294967296+a:a+0}},ca={toString:function(a){switch(a){case 0:return"Element";
case 1:return"PCData";case 2:return"CData";case 3:return"Comment";case 4:return"DocType";case 5:return"ProcessingInstruction";case 6:return"Document"}}},v=function(a){this.nodeType=a;this.children=[];this.attributeMap=new K};v.parse=function(a){return Gb.parse(a)};v.createElement=function(a){var b=new v(v.Element);if(b.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(b.nodeType));b.nodeName=a;return b};v.createPCData=function(a){var b=new v(v.PCData);if(b.nodeType==
v.Document||b.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(b.nodeType));b.nodeValue=a;return b};v.createCData=function(a){var b=new v(v.CData);if(b.nodeType==v.Document||b.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(b.nodeType));b.nodeValue=a;return b};v.createComment=function(a){var b=new v(v.Comment);if(b.nodeType==v.Document||b.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(b.nodeType));b.nodeValue=a;return b};v.createDocType=
function(a){var b=new v(v.DocType);if(b.nodeType==v.Document||b.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(b.nodeType));b.nodeValue=a;return b};v.createProcessingInstruction=function(a){var b=new v(v.ProcessingInstruction);if(b.nodeType==v.Document||b.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(b.nodeType));b.nodeValue=a;return b};v.createDocument=function(){return new v(v.Document)};v.prototype={get:function(a){if(this.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+
ca.toString(this.nodeType));var b=this.attributeMap;return null!=p[a]?b.getReserved(a):b.h[a]},set:function(a,b){if(this.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(this.nodeType));var c=this.attributeMap;null!=p[a]?c.setReserved(a,b):c.h[a]=b},exists:function(a){if(this.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(this.nodeType));var b=this.attributeMap;return null!=p[a]?b.existsReserved(a):b.h.hasOwnProperty(a)},
attributes:function(){if(this.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(this.nodeType));return this.attributeMap.keys()},elements:function(){if(this.nodeType!=v.Document&&this.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+ca.toString(this.nodeType));for(var a=[],b=0,c=this.children;b<c.length;){var d=c[b];++b;d.nodeType==v.Element&&a.push(d)}return x.iter(a)},firstElement:function(){if(this.nodeType!=v.Document&&
this.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+ca.toString(this.nodeType));for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;if(c.nodeType==v.Element)return c}return null},addChild:function(a){if(this.nodeType!=v.Document&&this.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+ca.toString(this.nodeType));null!=a.parent&&a.parent.removeChild(a);this.children.push(a);a.parent=this},removeChild:function(a){if(this.nodeType!=
v.Document&&this.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+ca.toString(this.nodeType));return x.remove(this.children,a)?(a.parent=null,!0):!1},toString:function(){return ld.print(this)}};var fb=function(){this.__constructed=!1;this.__constructed||(this.__constructed=!0,this.instanceID=fb._id++,this.onConstruct())};fb.prototype={getInstanceID:function(){return this.instanceID},onConstruct:function(){}};var H=function(a){fb.call(this);null!=a&&(this.__targetDispatcher=
a)};H.prototype=n(fb.prototype,{dispose:function(){this.__targetDispatcher=null;if(null!=this.__eventMap){var a=this.__eventMap;for(a=new Hb(a,a.arrayKeys());a.hasNext();)for(var b=a.next(),c=0;c<b.length;){var d=b[c];++c;d.dispose()}this.__eventMap=null}},addEventListener:function(a,b,c){null==c&&(c=0);if(null!=b){null==this.__eventMap&&(this.__eventMap=new K);var d=this.__eventMap;if(null!=p[a]?d.existsReserved(a):d.h.hasOwnProperty(a)){d=this.__eventMap;a=null!=p[a]?d.getReserved(a):d.h[a];d=0;
for(var e=a.length;d<e;){var f=d++;if(a[f].callback==b)return}this.__addListenerByPriority(a,new Fd(b,c))}else d=[],d.push(new Fd(b,c)),b=this.__eventMap,null!=p[a]?b.setReserved(a,d):b.h[a]=d}},dispatchEvent:function(a){if(null==this.__eventMap||null==a)return!0;var b=a._type,c=this.__eventMap;if(null!=p[b]?!c.existsReserved(b):!c.h.hasOwnProperty(b))return!1;c=this.__eventMap;c=null!=p[b]?c.getReserved(b):c.h[b];if(null==c)return!0;null==a.target&&(a.target=null!=this.__targetDispatcher?this.__targetDispatcher:
this);b=this.__getTempList();b.fromList(c);c=0;for(var d=b.get_length();c<d;){var e=c++;e=b.getArrayElement(e);null!=e&&null!=e.callback&&(a.currentTarget=this,a.target=this,e.callback(a))}H._temp.push(b);return!0},removeEventListener:function(a,b){if(null!=this.__eventMap&&null!=b){var c=this.__eventMap;c=null!=p[a]?c.getReserved(a):c.h[a];if(null!=c){for(var d=c.length;0<d--;)c[d].callback==b&&c.splice(d,1);0==c.length&&this.__eventMap.remove(a)}}},__addListenerByPriority:function(a,b){for(var c=
a.length,d=c,e=0;e<c;){var f=e++;if(a[f].priority<b.priority){d=f;break}}a.splice(d,0,b)},__getTempList:function(){return 0<H._temp.length?H._temp.pop():new N}});var W=function(){H.call(this);this.glcontext=new de;W.gl=this.glcontext;this.devicePixelRatio=1;this.frameTime=.01639344262295082;this.stencil=this.depth=!0;this._capture={capture:!1,passive:!1};this._initDelay=new aa(g(this,this.init));this._inited=!1;this._focusDelay=new aa(g(this,this.focus1));this._touchManager=new ya(!1);this._touch=
new Va;for(var a=["blur","resize","focus","beforeunload"],b=0;b<a.length;){var c=a[b];++b;window.addEventListener(c,g(this,this.handleWindowEvent),this._capture)}this._keyManager=Vb.getInstance();this._key=new Wa;window.addEventListener("keydown",g(this,this.handleKeyEvent),this._capture);window.addEventListener("keyup",g(this,this.handleKeyEvent),this._capture);a=["ms","moz","webkit","o"];for(b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],
window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];this._frame=0;this._active=!0;this._now=ha._custom();this._setTimeoutMode=null!=window.requestAnimationFrame?!1:!0;this.tick();window.oncontextmenu=function(a){a.preventDefault()};this.requestedFullscreen=this.isFullscreen=!1;this._wheelDelta=new h;this._mouseEventB32=new $a(0);W.frame=0};W.prototype=n(H.prototype,{setup:function(a){if(null!=a){if(pa.exist(a,"canvas")){var b=pa.getValue(a,"canvas");
if(null!=b){this._canvas_webgl=b;this.setupTouchInput(this._canvas_webgl);this.depth=pa.getBool(a,"depth",!0);this.stencil=pa.getBool(a,"stencil",!0);this.devicePixelRatio=pa.getFloat(a,"devicePixelRatio",1);b={alpha:pa.getBool(a,"alpha",!0),antialias:pa.getBool(a,"alpha",!1),depth:this.depth,premultipliedAlpha:pa.getBool(a,"premultipliedAlpha",!0),stencil:this.stencil,preserveDrawingBuffer:pa.getBool(a,"preserveDrawingBuffer",!1)};var c=["webgl","experimental-webgl"];2==pa.getInt(a,"webgl")&&c.unshift("webgl2");
for(var d=null,e=1,f=0,r=c.length;f<r;){d=f++;var h=c[d];d=this._canvas_webgl.getContext(h,b);if(null!=d){"webgl2"==h&&(e=2);break}}null!=d&&(this._inited||aa.add(this._initDelay,.1),this._inited=!0,W.gl.setup(d,e),d.getExtension("OES_standard_derivatives"),d.getExtension("GL_EXT_shader_texture_lod"),d.pixelStorei(37441,1))}}pa.exist(a,"input")&&(a=pa.getValue(a,"input"),this.setupTouchInput(a))}},setFPS:function(a){this.frameTime=0>=a?0:1/a},setFullscreen:function(a){var b=window.document;a?this.requestedFullscreen||
this.isFullscreen||(this.requestedFullscreen=!0,(M=this._inputElement,g(M,M.requestFullscreen))?(b.addEventListener("fullscreenchange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("fullscreenerror",g(this,this.handleFullscreenEvent),this._capture),this._inputElement.requestFullscreen()):this._inputElement.mozRequestFullScreen?(b.addEventListener("mozfullscreenchange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("mozfullscreenerror",g(this,this.handleFullscreenEvent),
this._capture),this._inputElement.mozRequestFullScreen()):this._inputElement.webkitRequestFullscreen?(b.addEventListener("webkitfullscreenchange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("webkitfullscreenerror",g(this,this.handleFullscreenEvent),this._capture),this._inputElement.webkitRequestFullscreen()):this._inputElement.msRequestFullscreen&&(b.addEventListener("MSFullscreenChange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("MSFullscreenError",
g(this,this.handleFullscreenEvent),this._capture),this._inputElement.msRequestFullscreen())):this.isFullscreen&&(this.requestedFullscreen=!1,g(b,b.exitFullscreen)?b.exitFullscreen():b.mozCancelFullScreen?b.mozCancelFullScreen():b.webkitExitFullscreen?b.webkitExitFullscreen():b.msExitFullscreen&&b.msExitFullscreen())},init:function(){W.frame=0;this.width=this._canvas_webgl.width;this.height=this._canvas_webgl.height;this.doResize();ya.focus=!0;this.dispatchEvent(va.init)},setupTouchInput:function(a){null!=
a&&this._inputElement!=a&&(null!=this._inputElement&&this.touchdisconnect(),this._inputElement=a,this.touchconnect())},touchconnect:function(){var a=new gb,b=this._inputElement.id;null==b&&(b=(new md).get()+"");a.addString(b);this._touch.device=a.getCode();a="mousedown mouseenter mouseleave mousemove mouseup wheel".split(" ");for(b=0;b<a.length;){var c=a[b];++b;this._inputElement.addEventListener(c,g(this,this.handleMouseEvent),this._capture)}a=["touchstart","touchmove","touchend","touchcancel"];
for(b=0;b<a.length;)c=a[b],++b,this._inputElement.addEventListener(c,g(this,this.handleTouchEvent),this._capture)},touchdisconnect:function(){for(var a="mousedown mouseenter mouseleave mousemove mouseup wheel".split(" "),b=0;b<a.length;){var c=a[b];++b;this._inputElement.removeEventListener(c,g(this,this.handleMouseEvent))}a=["touchstart","touchmove","touchend","touchcancel"];for(b=0;b<a.length;)c=a[b],++b,this._inputElement.removeEventListener(c,g(this,this.handleTouchEvent))},handleMouseEvent:function(a){null!=
a.stopImmediatePropagation&&a.stopImmediatePropagation();a.stopPropagation();a.preventDefault();0==this._touchManager.touchType&&(this._touchManager.touchType=1);if(1==this._touchManager.touchType){var b=a.type;this._touch.position.set(0,0,0);this._touch.pressure=-1;this._mouseEventB32.value=a.buttons;if("wheel"!=b){var c=this._inputElement.getBoundingClientRect();this._touch.position.set(a.offsetX/c.width,a.offsetY/c.height,0);"mousemove"==b?oa.gt(this._mouseEventB32.value,0)&&(this._mouseEventB32.getArrayElement(0)&&
(this._touch.touchId=0,this._touchManager.move(this._touch)),this._mouseEventB32.getArrayElement(1)&&(this._touch.touchId=2,this._touchManager.move(this._touch)),this._mouseEventB32.getArrayElement(2)&&(this._touch.touchId=1,this._touchManager.move(this._touch))):"mouseenter"==b&&(this._touch.touchId=0);"mousedown"==b&&(this._touch.touchId=a.button,this._touchManager.begin(this._touch));"mouseup"==b&&(this._touch.touchId=a.button,this._touchManager.end(this._touch));"mouseleave"==b&&(this._mouseEventB32.getArrayElement(0)&&
(this._touch.touchId=0,this._touchManager.cancel(this._touch)),this._mouseEventB32.getArrayElement(1)&&(this._touch.touchId=2,this._touchManager.cancel(this._touch)),this._mouseEventB32.getArrayElement(2)&&(this._touch.touchId=1,this._touchManager.cancel(this._touch)))}else null!=a&&(this._wheelDelta.set(a.deltaX,a.deltaY,a.deltaZ),this._touchManager.wheel(a.deltaMode,this._wheelDelta))}},handleTouchEvent:function(a){this._active||this._focusDelay.start(.1);a.stopPropagation();a.preventDefault();
null!=a.stopImmediatePropagation&&a.stopImmediatePropagation();0==this._touchManager.touchType&&(this._touchManager.touchType=2);if(2==this._touchManager.touchType){var b=a.type,c=this._inputElement.getBoundingClientRect();this._touch.position.set(0,0);var d=this._touch.touchId=0;for(a=a.changedTouches;d<a.length;){var e=a[d];++d;this._touch.position.set((e.clientX-c.left)/c.width,(e.clientY-c.top)/c.height,0);this._touch.touchId=e.identifier;this._touch.pressure=e.force;"touchmove"==b?this._touchManager.move(this._touch):
"touchstart"==b?this._touchManager.begin(this._touch):"touchend"==b?this._touchManager.end(this._touch):"touchcancel"==b&&this._touchManager.cancel(this._touch)}}},handleWindowEvent:function(a){a=a.type;"focus"==a?(this._focusDelay.stop(),this._focusDelay.start(.1)):"blur"==a?(this._active=!1,this._frame=0,Ib.focus=!1,Ib.systemDispatcher.dispatchEvent(B.blur),this._focusDelay.stop(),ya.focus=!1):"resize"==a&&this._inited&&this.doResize()},focus1:function(){Ib.focus=!0;Ib.systemDispatcher.dispatchEvent(B.focus);
this._active=!0},tick:function(){var a=!0;if(0<this.frameTime){var b=ha._custom(),c=b-this._now;c>=this.frameTime&&(this._now=b-c%this.frameTime,a=!0)}this._active&&a&&(this._frame++,W.frame++,this.dispatchEvent(va.update));this._setTimeoutMode?Tc.delay(g(this,this.tick),m.floatToInt(1E3*this.frameTime)):window.requestAnimationFrame(g(this,this.tick));ka.reset()},doResize:function(){if(null!=this._canvas_webgl.parentElement){var a=this._canvas_webgl.parentElement.clientWidth;var b=this._canvas_webgl.parentElement.clientHeight}else a=
window.innerWidth,b=window.innerHeight;if(this.width!=a||this.height!=b)this.width=m.floatToInt(a),this.height=m.floatToInt(b),this._canvas_webgl.width=this.width,this._canvas_webgl.height=this.height,va.resize.vintlist[0]=this.width,va.resize.vintlist[1]=this.height,this.dispatchEvent(va.resize)},handleFullscreenEvent:function(a){a=window.document;this.requestedFullscreen=!1;if(null!=(a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement))a=!0;else{a=!1;for(var b=
["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],c=["fullscreenerror","mozfullscreenerror","webkitfullscreenerror","MSFullscreenError"],d=0,e=b.length;d<e;){var f=d++;window.document.removeEventListener(b[f],g(this,this.handleFullscreenEvent),this._capture);window.document.removeEventListener(c[f],g(this,this.handleFullscreenEvent),this._capture)}}a!=this.isFullscreen&&(this.isFullscreen=a,va.resize.vbool=this.isFullscreen,this.dispatchEvent(va.fullScreen))},
handleKeyEvent:function(a){this._key.deviceType=0;this._key.deviceId=0;this._key.keyCode=a.keyCode;this._key.key=a.key;this._key.value=0;this._key.modifier.value=0;this._key.modifier.setArrayElement(3,a.altKey);this._key.modifier.setArrayElement(2,a.ctrlKey);this._key.modifier.setArrayElement(1,a.shiftKey);this._key.modifier.setArrayElement(4,a.metaKey);this._key.type="keydown"==a.type?1:2;this._keyManager.keyTrigger(this._key)}});var de=function(){};de.prototype={setup:function(a,b){this.gl=a;this.version=
b}};var Jb=function(){this.enabled=!1;this.id=Jb._id++;this.params=new ee};Jb.prototype={unload:function(){this.enabled=!1;this.data=null},setData:function(a){this.data=a;this.enabled=!0;this._time=ha._custom()},bind:function(a){this._time=ha._custom();return!1}};var Uc=function(){Jb.call(this);this.params.type=3553;this._uploadFrame=0};Uc.prototype=n(Jb.prototype,{setData:function(a){Jb.prototype.setData.call(this,a);null!=this.data&&(this.data instanceof Lc&&(a=this.data,this.width=a.width,this.height=
a.height),this.data instanceof HTMLImageElement?(a=this.data,this.width=a.width,this.height=a.height):this.data instanceof HTMLCanvasElement?(a=this.data,this.width=a.width,this.height=a.height):this.data instanceof HTMLVideoElement&&(a=this.data,this.width=a.width,this.height=a.height))},unload:function(){Jb.prototype.unload.call(this);null!=this._texture&&(W.gl.gl.deleteTexture(this._texture),this._texture=null)},bind:function(a){null==a&&(a=0);Jb.prototype.bind.call(this,a);if(!this.enabled||0==
this.width||0==this.height)return!1;if(null!=this.data)return this._uploadFrame=W.frame,this.upload(),!1;if(null!=this._texture){if(this._uploadFrame==W.frame)return!1;W.gl.gl.activeTexture(33984+a);W.gl.gl.bindTexture(this.params.type,this._texture);this.params.bind();return!0}return!1},upload:function(){null==this._texture&&(this._texture=W.gl.gl.createTexture());W.gl.gl.bindTexture(this.params.type,this._texture);var a=null;if(null!=this.data){var b=!1;this.data instanceof Lc&&(a=this.data,this.data=
a.data);if(this.data instanceof HTMLImageElement){var c=this.data;this.width=c.width;this.height=c.height;0!=this.width&&0!=this.height&&(W.gl.gl.texImage2D(this.params.type,0,this.params.format,this.params.format,5121,c),b=!0)}else this.data instanceof HTMLCanvasElement?(c=this.data,this.width=c.width,this.height=c.height,0!=this.width&&0!=this.height&&(W.gl.gl.texImage2D(this.params.type,0,this.params.format,this.params.format,5121,c),b=!0)):this.data instanceof HTMLVideoElement&&(c=this.data,this.width=
c.width,this.height=c.height,0!=this.width&&0!=this.height&&(W.gl.gl.texImage2D(this.params.type,0,this.params.format,this.params.format,5121,c),b=!0));this.updateParams();this.data=null;null!=a&&a.dispose();return b}return!1},updateParams:function(){this.params.dirty=!0;this.params.setSize(this.width,this.height)}});(function(a,b,c){null==c&&(c=16);null==b&&(b=0);null==a&&(a=256);this._depth=16;Uc.call(this);this.width=a;this.height=b;0>=this.height&&(this.height=this.width);this.enabled=!0;this._depth=
c}).prototype=n(Uc.prototype,{bindBuffer:function(){if(null==this._frameBuffer){this._frameBuffer=W.gl.gl.createFramebuffer();W.gl.gl.bindFramebuffer(36160,this._frameBuffer);this._renderBuffer=W.gl.gl.createRenderbuffer();W.gl.gl.bindRenderbuffer(36161,this._renderBuffer);24==this._depth?(W.gl.gl.renderbufferStorage(36161,34041,this.width,this.height),W.gl.gl.framebufferRenderbuffer(36160,33306,36161,this._renderBuffer)):16==this._depth&&(W.gl.gl.renderbufferStorage(36161,33189,this.width,this.height),
W.gl.gl.framebufferRenderbuffer(36160,36096,36161,this._renderBuffer));this.params.mipmap=!1;this.upload();W.gl.gl.framebufferTexture2D(36160,36064,3553,this._texture,0);W.gl.gl.texImage2D(3553,0,6408,this.width,this.height,0,6408,5121,null);W.gl.gl.bindRenderbuffer(36161,null);this.updateParams();W.gl.gl.clearDepth(1);W.gl.gl.clearStencil(0);W.gl.gl.clearColor(1,1,1,0);var a=16384;0<this._depth&&(a|=256);16<this._depth&&(a|=1024);W.gl.gl.clear(a)}W.gl.gl.bindFramebuffer(36160,this._frameBuffer);
W.gl.gl.bindRenderbuffer(36161,this._renderBuffer)},bind:function(a){null==a&&(a=0);return Uc.prototype.bind.call(this,a)},unload:function(){null!=this._frameBuffer&&(W.gl.gl.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null);null!=this._renderBuffer&&(W.gl.gl.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null)}});(function(){fb.call(this)}).prototype=n(fb.prototype,{dispose:function(){null!=this._howl&&(this._howl.off("end",g(this,this._end),this.id),this._howl.off("play",g(this,
this._play),this.id),this._howl.off("pause",g(this,this._pause),this.id),this._howl.off("stop",g(this,this._stop),this.id),this._howl.off("rate",g(this,this._rate),this.id),this._howl.off("seek",g(this,this._seek),this.id),this.clip=this._howl=null,this.id=-1)},_end:function(){this._event.id=this.id;this._event.action=2;this.clip.dispatchEvent(this._event)},_play:function(){this._event.id=this.id;this._event.action=1;this.clip.dispatchEvent(this._event)},_pause:function(){this._event.id=this.id;this._event.action=
3;this.clip.dispatchEvent(this._event)},_stop:function(){this._event.id=this.id;this._event.action=4;this.clip.dispatchEvent(this._event)},_rate:function(){this._event.id=this.id;this._event.action=5;this.clip.dispatchEvent(this._event)},_seek:function(){this._event.id=this.id;this._event.action=6;this.clip.dispatchEvent(this._event)}});var J=function(a){this._create=a;this._idleList=new N;this._activeList=new N;this._activeMap=new ba;this.length=0};J.prototype={get:function(){if(0<this._idleList.get_length())var a=
this._idleList.pop();else J.current=this,a=this._create(),this.length++;this._activeList.push(a);return this._activeMap.h[a.instanceID]=a},set:function(a){this._activeMap.h.hasOwnProperty(a.instanceID)&&(this._idleList.push(a),this._activeList.remove(a),this._activeMap.remove(a.instanceID))}};var N=function(){this._index=this._length=0};N.prototype={clear:function(){if(null!=this._buffer&&!(1>this._length)){var a=this._length,b=this._buffer.length;for(a=a<b?a:b;0<a--;)this._buffer[a]=null;this._length=
0}},dispose:function(){this._buffer=null;this._length=0},copyFastArray:function(a){this.clear();if(null!=a)for(var b=a.get_length();0<b--;)this.setArrayElement(b,a.getArrayElement(b))},fromList:function(a){if(null==a)return this;null==this._buffer&&(this._buffer=[],this._length=0);for(var b=a.length,c=0;c<b;){var d=c++;this._buffer[d]=a[d]}this._length=b;return this},push:function(a){null==this._buffer&&(this._buffer=[]);this._buffer[this._length++]=a},pop:function(){if(null==this._buffer||1>this._length)return null;
var a=this._buffer[--this._length];this._buffer[this._length]=null;return a},shift:function(){if(null==this._buffer||1>this._length)return null;this._length--;return this._buffer.shift()},get:function(a,b){null==b&&(b=!1);if(b||0>a)a%=this._length,0>a&&(a+=this._length);return this.getArrayElement(a)},getArrayElement:function(a){return 1>this._length||null==this._buffer||a>=this._length?null:this._buffer[a]},setArrayElement:function(a,b){null==this._buffer&&(this._buffer=[]);this._buffer[a]=b;++a;
this._length<a&&(this._length=a)},indexOf:function(a,b){null==b&&(b=0);return null==this._buffer||1>this._length?-1:this._buffer.indexOf(a,b)},insert:function(a,b){null==this._buffer&&(this._buffer=[]);this._buffer.splice(a,0,b);this._length++},remove:function(a,b){null==b&&(b=0);if(null==this._buffer||1>this._length)return-1;a=this.indexOf(a,b);if(-1==a)return-1;this._buffer.splice(a,1);this._length--;return a},removeAt:function(a,b){null==b&&(b=1);null==this._buffer||1>this._length||1>b||(a+b>=
this._length&&(b=this._length-a),1>b||(this._length-=b,this._buffer.splice(a,b)))},unshift:function(a){null==this._buffer&&(this._buffer=[]);this._buffer.unshift(a);this._length++},sort:function(a){if(null!=this._buffer&&!(2>this._length)){var b=this._buffer.length-this._length;0<this.get_length()&&this._buffer.splice(this._length,b);this._buffer.sort(a)}},join:function(a){null==a&&(a="");for(var b="",c=0,d=this._length;c<d;){var e=c++;0<e&&""!=a&&(b+=null==a?"null":""+a);b+=da.string(this.getArrayElement(e))}return b},
hasNext:function(){if(this._index<this._length)return!0;this._index=0;return!1},next:function(){return this.getArrayElement(this._index++)},get_length:function(){return this._length},set_length:function(a){this._length=a;if(null==this._buffer)return this._length;var b=this._buffer.length;a<b&&this._buffer.splice(a,b-a);return this._length}};var ba=function(){this.h={}};ba.prototype={get:function(a){return this.h[a]},remove:function(a){if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},
keys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)?a.push(b|0):null;return x.iter(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var a=this.it.next();return this.ref[a]}}}};var nd=function(){H.call(this,null);this.enabled=!1;this._duration=-1;this._list=new ba};nd.prototype=n(H.prototype,{fromBytes:function(a){var b=this.__getCodec(a);null!=b&&(this.reset(),this._url="data:"+b+";base64,"+kb.encode(a),ya.focus?
this._fromBytes():(this._innerLoad=g(this,this._fromBytes),ya.onBegin.addEventListener(B.focus._type,g(this,this.focusHandler))))},_fromBytes:function(){this._src=new Howl({src:[this._url],preload:!0,autoplay:!1});this.enabled=!0;var a=Wb.onUpdate;a.action=7;a.id=-1;this.dispatchEvent(a)},fromUrl:function(a){this.reset();this._url=a;ya.focus?this._fromUrl():(this._innerLoad=g(this,this._fromUrl),ya.onBegin.addEventListener(B.focus._type,g(this,this.focusHandler)))},_fromUrl:function(){this._src=new Howl({src:[this._url],
preload:!0,autoplay:!1});this.enabled=!0;var a=Wb.onUpdate;a.action=7;a.id=-1;this.dispatchEvent(a)},focusHandler:function(a){ya.onBegin.removeEventListener(B.focus._type,g(this,this.focusHandler));nd.focused=!0;null!=this._innerLoad&&(this._innerLoad(),this._innerLoad=null)},dispose:function(){H.prototype.dispose.call(this);null!=this._src&&this._src.unload();for(var a=this._list.iterator();a.hasNext();)a.next().dispose();this._list=null;this.enabled=!1},reset:function(){null!=this._src&&this._src.unload();
this.duration=0;this._duration=-1},__getCodec:function(a){switch(a.getString(0,4)){case "OggS":return"audio/ogg";case "RIFF":if("WAVE"==a.getString(8,4))return"audio/wav";var b=a.b[2],c=a.b[1];switch(a.b[0]){case 73:if(68==c&&51==b)return"audio/mp3";break;case 255:switch(c){case 250:case 251:return"audio/mp3"}}break;case "fLaC":return"audio/flac";default:switch(b=a.b[2],c=a.b[1],a.b[0]){case 73:if(68==c&&51==b)return"audio/mp3";break;case 255:switch(c){case 250:case 251:return"audio/mp3"}}}return null}});
var Vc=function(){this._workerState=0;this.method="GET";this.timeout=10};Vc.prototype={load:function(a){null==this._delay&&(this._delay=new aa(g(this,this.timeoutHandler)));this._url=a;this.bytes=null;null!=this._xmlHttpRequest&&(this._xmlHttpRequest.onreadystatechange=null,this._xmlHttpRequest.abort(),this._xmlHttpRequest=null);Vc.workerEnable&&0==this._workerState&&(this._workerState=null==window.Worker?-1:1);if(Vc.workerEnable&&1==this._workerState)this._worker=new Worker("worker.js"),this._worker.postMessage(a),
this._worker.onmessage=g(this,this.onWorkerMessage);else{null==this._xmlHttpRequest&&(this._xmlHttpRequest=new XMLHttpRequest);this._xmlHttpRequest.responseType="arraybuffer";this._xmlHttpRequest.onreadystatechange=g(this,this.readyStateChange);this._xmlHttpRequest.open(this.method,a,!0);aa.add(this._delay,this.timeout);if(null!=this.headers){a=0;for(var b=this.headers;a<b.length;){var c=b[a];++a;this._xmlHttpRequest.setRequestHeader(c.name,c.value)}}try{null!=this.data?this._xmlHttpRequest.send(this.data.b.bufferValue):
this._xmlHttpRequest.send("")}catch(d){}this.bytes=null}},readyStateChange:function(a){this.bytes=null;if(4==this._xmlHttpRequest.readyState){a=this._xmlHttpRequest.status;if(200<=a&&400>a||0==a&&""==this._xmlHttpRequest.statusText)if(a=this._xmlHttpRequest.response,null!=a)this.bytes=Aa.ofData(a);else try{if(null!=this._xmlHttpRequest.responseText){var b=VBArray(request.responseText).toArray();this.bytes=new Aa(new ArrayBuffer(b.length));a=0;for(var c=b.length;a<c;){var d=a++;this.bytes.b[d]=b[d]}}}catch(e){this.bytes=
null}aa.remove(this._delay);this.headers=this._xmlHttpRequest=null;if(null!=this.onComplete)this.onComplete(this);this.data=this.bytes=null}},onWorkerMessage:function(a){this.bytes=Aa.ofData(a.data);if(null!=this.onComplete)this.onComplete(this)},timeoutHandler:function(){this.bytes=null;if(null!=this.onComplete)this.onComplete(this);this.data=null}};var K=function(){this.h={}};K.prototype={get:function(a){return null!=p[a]?this.getReserved(a):this.h[a]},setReserved:function(a,b){null==this.rh&&(this.rh=
{});this.rh["$"+a]=b},getReserved:function(a){return null==this.rh?null:this.rh["$"+a]},existsReserved:function(a){return null==this.rh?!1:this.rh.hasOwnProperty("$"+a)},remove:function(a){if(null!=p[a]){a="$"+a;if(null==this.rh||!this.rh.hasOwnProperty(a))return!1;delete this.rh[a]}else{if(!this.h.hasOwnProperty(a))return!1;delete this.h[a]}return!0},keys:function(){return x.iter(this.arrayKeys())},arrayKeys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(b);if(null!=this.rh)for(b in this.rh)36==
b.charCodeAt(0)&&a.push(b.substr(1));return a},iterator:function(){return new Hb(this,this.arrayKeys())}};var Lb=function(a,b){this._callback=b;this.cache=Kb.getObject(a);this._delaytime=10;a=Gd.getLocalStorage();null!=a&&(a=a.getItem(this.cache.name),null!=a&&""!=a&&(this.cache.readFromFile(a),this._callback(this),this._callback=null));window.addEventListener("beforeunload",g(this,this.beforeunload),!1)};Lb.getStorage=function(a,b){if(null==a||""==a)throw new u("name is empty");for(var c=" ~%&\\;:\"',<>?#/".split(""),
d=0;d<c.length;){var e=c[d];++d;if(-1<a.indexOf(e))throw new u("name is not allowed");}c=Lb._map;if(null!=p[a]?c.existsReserved(a):c.h.hasOwnProperty(a))return b=Lb._map,null!=p[a]?b.getReserved(a):b.h[a];b=new Lb(a,b);c=Lb._map;null!=p[a]?c.setReserved(a,b):c.h[a]=b;return b};Lb.prototype={set:function(a,b){this.cache.set(a,b);this.cache.get_dirty()&&this.update()},flush:function(){null!=this._delay&&this._delay.stop();this.sync()},update:function(){null==this._delay&&(this._delay=new aa(g(this,
this.sync)));.1<this._delaytime&&(this._delaytime*=.8);aa.add(this._delay,this._delaytime)},sync:function(){this._delaytime=10;var a=this.cache.writeToFile(),b=Gd.getLocalStorage();null!=b&&(b.removeItem(this.cache.name),b.setItem(this.cache.name,a))},beforeunload:function(a){this.sync()}};var Lc=function(){this.data=new Image;this.data.onload=g(this,this._onload);this.data.onerror=g(this,this._onerror)};Lc.prototype={fromBytes:function(a,b){if(null==this.data)throw new u("image has destory");this._complete=
b;null==a?this._onerror():(this.height=this.width=0,a="data:image/png;base64,"+kb.encode(a),this.data.src=a,this.data.crossOrigin="Anonymous")},fromUrl:function(a,b){if(null==this.data)throw new u("image has destory");this._complete=b;this.height=this.width=0;this.data.src=a;this.data.crossOrigin="Anonymous"},dispose:function(){this.removeCallback();null!=this.data&&(this.data.src="",this.data=null)},removeCallback:function(){null!=this.data&&(this.data.onload=null,this.data.onerror=null)},_onload:function(){this.removeCallback();
this.width=this.data.width;this.height=this.data.height;null!=this._complete&&(this._complete(this),this._complete=null)},_onerror:function(){this.removeCallback();null!=this._complete&&(this.width=this.height=0,this._complete(this),this._complete=null)}};var od=function(){};od.main=function(){ia.main=new od};od.prototype={startGameMain:function(a){l.fnt=new fe;l.table=new ge;l.version="";l.init("assets");Xb.pressDelay=.1;this._game=new ia;this._game.backgroundColor.setRGBA(-1412567041);this._game.onInit(g(this,
this.onGameInit));new Xb(this._game);lb.game=this._game},onGameInit:function(){var a=ia.getParam("init");null!=a&&a();this._world=new Wc;this._world.name="game";this._game.addWorld(this._world);a=new w;a.get_transform().rotation.setEulerAngles(0,-180,0);this._world.addChild(a);a.name="camera 3d";var b=a.addComponent(Xc);this._worldCamera=a.addComponent(Pa);this._worldCamera.clearFlags.type=3;this._worldCamera.clearFlags.color.setRGBA(-1412567296);this._worldCamera.farClipPlane=6E3;b.setView(800,500);
this._worldCamera.actor.addEventListener(t.onPostRender._type,g(this,this.onPostRender));this._uiWorld=new Wc;this._uiWorld.name="ui";this._game.addWorld(this._uiWorld);a=new w;a.get_transform().rotation.setEulerAngles(0,-180,0);this._uiWorld.addChild(a);a.name="camera ui";this._alignView=a.addComponent(Xc);this._uiCamera=a.addComponent(Pa);this._game.debugCamera=this._uiCamera;this._uiCamera.clearFlags.type=2;this._uiCamera.clearFlags.color.setRGBA(-1412567296);this._uiCamera.farClipPlane=6E3;a=
new w;this._uiWorld.addChild(a);a.get_transform().position.set(0,50,20);b=a.get_transform().rotation;var c=a.get_transform().position,d=h.get_zero();b.setLookAt(h._pool.get().sub(d,c).normalize(),null);a.addComponent(Yc);this._alignView.setView(800,500,g(this,this.viewInit));lb.world3D=this._world;lb.camera3D=this._worldCamera;lb.worldUI=this._uiWorld;lb.cameraUI=this._uiCamera;lb.updateService=new he},viewInit:function(a){y.init();y.align=a;y.camera=a.camera;y.distance=a.distance;y.viewHeight=a.height;
y.viewWidth=a.width;F.init(this._uiWorld,this._uiCamera,this._world);(new ie).setParent(F.root);Lb.getStorage("test.bin",function(a){a.set("name","hello");a.flush()})},onPostRender:function(a){null!=lb.camera3D.renderTarget&&(a=S.add(!1),a.blit(this._worldCamera.renderTarget,null),a.execute(this._game.getBufferContext()))}};var lb=function(){},L=function(){},Mc=function(){this.width=16;this.height=10;this.tplId=-1;this.objects=T.fromArray([]);this.map=new Hd(16,10);this.wallGroupList=T.fromArray([])};
Mc.prototype={set:function(a){this.reset();this.resize(a.width,a.height);for(var b=0,c=this.width;b<c;)for(var d=b++,e=0,f=this.height;e<f;){var r=e++,h=mb.get();this.map.set(d,r,h);var g=this.map.getIndex(d,r);h.init(g,d,r);a.getWall(d,r)&&(h.type=1,0==d||d>=this.width-1||0==r||r>=this.height-1)&&(h.type=4)}for(b=a.objects.get_length();0<b--;)this.objects.push(a.objects.getArrayElement(b).clone());this.postInit()},getByPosition:function(a,b){a=m.floatToInt(a/50);b=m.floatToInt(b/50);var c=this.width,
d=this.height;return this.map.get(0>a?0:a>c?c:a,0>b?0:b>d?d:b)},clearRuntime:function(){for(var a=this.map.length;0<a--;){var b=this.map.getArrayElement(a);null!=b&&b.clearRuntime()}},reset:function(){for(var a=this.objects.get_length();0<a--;)this.objects.getArrayElement(a).dispose();this.objects.clear();this.wallGroupList.clear();for(a=this.map.length;0<a--;){var b=this.map.getArrayElement(a);null!=b&&b.dispose()}},resize:function(a,b){this.width=a;this.height=b;this.map.resize(a,b);this.map.clear();
for(var c=0;c<a;)for(var d=c++,e=0,f=b;e<f;){var r=e++,h=mb.get();this.map.set(d,r,h);var g=this.map.getIndex(d,r);h.init(g,d,r)}},postInit:function(){for(var a=this.map.length;0<a--;){var b=this.map.getArrayElement(a);if(-1==b.group&&(1==b.type||4==b.type)&&4!=b.type){var c=this.map.get(b.x+1,b.y);if(null!=c&&-1==c.group&&(1==c.type||4==c.type)&&4!=c.type){var d=this.map.get(b.x,b.y+1);if(null!=d&&-1==d.group&&(1==d.type||4==d.type)&&4!=d.type){var e=this.map.get(b.x+1,b.y+1);null==e||-1!=e.group||
1!=e.type&&4!=e.type||4==e.type||(b.group=e.group=d.group=c.group=0,this.wallGroupList.push(b))}}}}}};var T={fromArray:function(a){for(var b=new N,c=a.length;0<c--;)b.setArrayElement(c,a[c]);return b}},Hd=function(a,b){this._list=[];this.resize(a,b)};Hd.prototype={fill:function(a){for(var b=this.length;0<b--;)this._list[b]=a},clear:function(){this.fill(null)},resize:function(a,b){if(1>a*b)throw new u("error size ");this.width=a;this.height=b;this.length=a*b},getIndex:function(a,b){return 0>a||0>b||
a>=this.width||b>=this.height?-1:b*this.width+a},get:function(a,b){a=this.getIndex(a,b);return 0<=a?this.getArrayElement(a):null},set:function(a,b,c){a=this.getIndex(a,b);0<=a&&this.setArrayElement(a,c)},getArrayElement:function(a){return this._list[a]},setArrayElement:function(a,b){this._list[a]=b}};var Ea=function(){};Ea.init=function(){Ea.userData=new je;Ea.saveData=new ke};var le=function(){};le.get=function(a){return"["+a+"]"};var Nc=function(){},ab=function(){};ab.init=function(){ab._inited||
(ab._inited=!0,ab.response=new me,lb.updateService.add(ab.response),ab.request=new ne,new oe,Zc.service=ab.request,lb.updateService.add(ab.request))};var Ia=function(){};Ia.init=function(a){Ia.trail=new pe;a.add(Ia.trail);Ia.skin=new qe;a.add(Ia.skin);Ia.level=new re;a.add(Ia.level);Ia.item=new se;a.add(Ia.item)};var y=function(){};y.postInit=function(){null==y.game&&(y.loading=new te,y.topmask=new ue,y.map=new ve,y.game=new we,y.home=new xe,y.edit=new ye,y.save=new ze,y.mode_single=new Ae,y.mode_match=
new Be,y.mode_replay=new Ce,y.openDoor=new De)};y.init=function(){};var Ee=function(a){this.self=a;this._map=new ba;this._enterMap=new ba;this.triggerEnterList=T.fromArray([]);this.triggerExitList=T.fromArray([])};Ee.prototype={clear:function(){this.triggerEnterList.clear();this.triggerExitList.clear();for(var a=this._enterMap.keys();a.hasNext();){var b=a.next();this._enterMap.remove(b)}},add:function(a){this._map.h[a.instanceID]=a},update:function(){this.triggerEnterList.clear();this.triggerExitList.clear();
for(var a=this._enterMap.keys();a.hasNext();){var b=a.next();this._map.h.hasOwnProperty(b)||(this.triggerExitList.push(this._enterMap.h[b]),this._enterMap.remove(b))}for(a=this._map.keys();a.hasNext();){b=a.next();var c=this._map.h[b];this._map.remove(b);this._enterMap.h.hasOwnProperty(b)||(this._enterMap.h[b]=c,this.triggerEnterList.push(c))}}};var $a=function(a){null==a&&(a=0);this.value=0;this.value=a};$a.prototype={getArrayElement:function(a){oa.gt(0,a)?(a=oa.toFloat(a)%oa.toFloat(32)|0,a+=32):
oa.gte(a,32)&&(a=oa.toFloat(a)%oa.toFloat(32)|0);a=1<<a;return(this.value&a)==a},setArrayElement:function(a,b){null==b&&(b=!0);0>a?a=a%32+32:32<=a&&(a%=32);this.value=b?this.value|1<<a:this.value&~(1<<a)}};var xb=function(){this.walls=T.fromArray([]);this.objects=T.fromArray([]);this.width=this.height=this.version=this.id=0;this.params=new Id};xb.prototype={clear:function(){this.walls.clear();for(var a=this.objects.get_length();0<a--;)this.objects.getArrayElement(a).dispose();this.objects.clear();
this.width=this.height=0;this.params.clear()},decode:function(a){this.clear();this.id=a.readUnsignedInt();this.version=a.readUnsignedInt();this.width=a.readUnsignedShort();this.height=a.readUnsignedShort();for(var b=m.ceilToInt(this.width*this.height/32);0<b--;)this.walls.push(a.readInt());for(b=a.readUnsignedByte();0<b--;){var c=Qa.get();c.x=a.readUnsignedByte();c.y=a.readUnsignedByte();c.type=a.readUnsignedByte();c.params.decode(a);this.objects.push(c)}this.params.decode(a)},getWall:function(a,
b){if(0>a||0>b||a>=this.width||b>=this.height)return!0;b=a+b*this.width;a=m.floatToInt(b/32);b%=32;a=this.walls.getArrayElement(a);xb.b32.value=a;return xb.b32.getArrayElement(b)},setWall:function(a,b,c){if(!(0>a||0>b||a>=this.width||b>=this.height)){b=a+b*this.width;a=m.floatToInt(b/32);b%=32;a>=this.walls.get_length()&&this.walls.setArrayElement(a,0);var d=this.walls.getArrayElement(a);xb.b32.value=d;xb.b32.setArrayElement(b,c);this.walls.setArrayElement(a,xb.b32.value)}}};var mb=function(){this.type=
0;this.instanceID=mb._id++;this.shapes=T.fromArray([])};mb.get=function(){return mb.pool.get()};mb.prototype={init:function(a,b,c){this.index=a;this.x=b;this.y=c;this.type=0;this.shapes.clear();this.group=-1},dispose:function(){mb.pool.set(this)},clearRuntime:function(){1!=this.type&&4!=this.type&&(this.type=0)},setTypeIfNotWall:function(a){1!=this.type&&4!=this.type&&(this.type=a)},check:function(a){a.spring=0;if(1==this.type||4==this.type)a.density=1;else{if(2==this.type||3==this.type){var b=!0;
null==b&&(b=!1);if(b){if(D.pause)debugger}else debugger;if(!a.ignoreBoard&&0>a.offsety&&a.currentCell.y>this.y){a.density=1;3==this.type&&(a.spring=1);return}}else if(0<a.offsety&&this.y>a.currentCell.y&&(3==a.currentCell.type||2==a.currentCell.type)&&!a.crossBoard&&a.currentCell.y<this.y){a.density=1;return}a.density=0}},getLeft:function(a){null==a&&(a=0);return 50*this.x+a},getRight:function(a){null==a&&(a=0);return 50*(this.x+1)-1E-5+a},getTop:function(a){null==a&&(a=0);return 50*(this.y+1)-1E-5+
a},getBottom:function(a){null==a&&(a=0);return 50*this.y+a},addShape:function(a){this.shapes.push(a)},removeShape:function(a){this.shapes.remove(a)}};var Id=function(){this._intMap=new ba};Id.prototype={copy:function(a){if(null!=a)for(a=new $c(a._intMap);a.hasNext();){var b=a.next();this.setValue(b.key,b.value)}},setValue:function(a,b){this._intMap.h[a]=b},getValue:function(a,b){null==b&&(b=0);return this._intMap.h.hasOwnProperty(a)?this._intMap.h[a]:b},decode:function(a){this.clear();for(var b=a.readUnsignedByte();0<
b--;)this.setValue(a.readUnsignedByte(),a.readInt())},clear:function(){for(var a=new $c(this._intMap);a.hasNext();){var b=a.next();this._intMap.remove(b.key)}}};var Qa=function(){this.params=new Id;this.instanceID=Qa._id++};Qa.get=function(){return Qa.pool.get()};Qa.prototype={copy:function(a){this.x=a.x;this.y=a.y;this.params=a.params},clone:function(){var a=Qa.get();a.type=this.type;a.x=this.x;a.y=this.y;a.params.copy(this.params);return a},dispose:function(){Qa.pool.set(this);this.params.clear()}};
var ke=function(){this.pveLevelState=[];this.openKeys=[];this.useTotalKey=0};ke.prototype={getMaxLevel:function(){return 50},setPveLevelState:function(a,b){},getPveLevelState:function(a){return 0}};var je=function(){this.level=1;this.exp=0;this.skin=1;this.items=[];this.pveLevels=[];this.pveCurrentLevel=1;this.pveKeyBreaks=[]};je.prototype={};var Ja=function(a,b,c){this.boardOffset=0;this.crossBoard=!0;this.size=a;this.spring=this.density=0;this.currentPoint=new G;this.nextPoint=new G;this.velocity=
new h;this.offsetx=b*a;this.offsety=c*a;this.ignoreBoard=!1};Ja.prototype={reset:function(){this.density=this.prevDesity=0},setCurrent:function(a){var b=this.currentPoint,c=a.x+this.offsetx;a=a.y+this.offsety;null==a&&(a=0);null==c&&(c=0);b.x=c;b.y=a},update:function(a,b,c){this.prevCell=this.nextCell;this.prevDesity=this.density;this.density=0;this.currentCell=c.getByPosition(this.currentPoint.x,this.currentPoint.y);var d=this.nextPoint,e=a.x+this.offsetx;a=a.y+this.offsety;null==a&&(a=0);null==
e&&(e=0);d.x=e;d.y=a;this.velocity.copy(b);this.nextCell=c.getByPosition(this.nextPoint.x,this.nextPoint.y);this.nextCell.check(this);0==this.density&&0>this.offsety&&(b=c.getByPosition(this.nextPoint.x+this.boardOffset*(0<this.offsetx?1:-1),this.nextPoint.y),b==this.nextCell||2!=b.type&&3!=b.type||(b.check(this),this.nextCell=this.currentCell=b))},getChangeType:function(){var a=this.currentCell.x!=this.nextCell.x,b=this.currentCell.y!=this.nextCell.y;return a&&b?3:a?1:2}};var w=function(){this._destorying=
!1;H.call(this);this._dontDestroy=this._destorying=!1;this.visible=this._enabled=!0;this.frame=0;this.timeScale=1;this.layer=this.deltaTime=0;this._timeScale=1;this.sortId=0};w.destory=function(a){if(null!=a){if(null==w._destoryed){w._destoryed=new ba;var b=new N;w._destoryList=b}a._destorying||w._destoryed.h.hasOwnProperty(a.instanceID)||(a._destorying=!0,w._destoryed.h[a.instanceID]=a,w._destoryCount++,a.set_enabled(!1))}};w._endFrame=function(){if(!(1>w._destoryCount)){w._destoryCount=0;for(var a=
w._destoryed.iterator();a.hasNext();){var b=a.next();w._destoryed.remove(b.instanceID);w._destoryList.push(b)}for(a=w._destoryList.get_length();0<a--;)w._destoryList.getArrayElement(a)._destory();w._destoryList.clear()}};w.prototype=n(H.prototype,{setParent:function(a){null!=a&&a.get_transform().addChild(this.get_transform())},addComponentIfNotExist:function(a){var b=this.getComponent(a);null==b&&(b=this.addComponent(a));return b},addComponent:function(a){null==this._components&&(this._components=
new N);for(var b=this._components.get_length();0<b--;){var c=this._components.get(b);if(U.__instanceof(c,a)&&null==this.getComponentState(a,1)&&null!=yb.get(a).getClassMeta("once",!0))return c}c=ad.createInstance(a);if(null==c)return null;this._components.push(c);c.__connectActor(this);null==this._componentStates&&(this._componentStates=new N);this._componentStates.push(hb.pop(c,0));c instanceof Fa&&(this._transform=c);return c},removeComponent:function(a){if(null!=this._components)for(var b=this._components.get_length();0<
b--;){var c=this._components.get(b);U.__instanceof(c,a)&&(null==this._componentStates&&(this._componentStates=new N),this._componentStates.push(hb.pop(c,1)),this._components.removeAt(b),c instanceof Fa&&(this._transform=null))}},getComponent:function(a){if(null==this._components)return null;for(var b=this._components.get_length();0<b--;){var c=this._components.get(b);if(U.__instanceof(c,a))return c}return null},getComponentState:function(a,b){if(null==this._componentStates)return null;var c=this._componentStates.get_length();
if(1>c)return null;for(;0<c--;){var d=this._componentStates.getArrayElement(c);if(null!=d&&d.state==b&&U.__instanceof(d.component,a))return d}return null},componentUpdate:function(){if(null!=this._componentStates){var a=this._componentStates.get_length();if(!(1>a)){null==this._componentStatesTemp&&(this._componentStatesTemp=new N);this._componentStatesTemp.copyFastArray(this._componentStates);this._componentStates.clear();for(var b=0;b<a;){var c=b++;c=this._componentStatesTemp.get(c);hb.push(c);0==
c.state?(c.component.__init(),this.world.addComponent(c.component)):1==c.state&&(c.component.__disconnectActor(),this._components.remove(c.component),this.world.removeComponent(c.component))}this._componentStatesTemp.clear()}}},_collectActors:function(a){var b=this.get_transform().childCount;this.dispatchEvent(t.onCollectChildren);if(0<b)for(var c=0;c<b;){var d=c++;d=this.get_transform().getChild(d).actor;d._enabled&&(a.push(d),d._collectActors(a))}this.dispatchEvent(t.onCollectChildrenComplete)},
_collectComponent:function(a){if(null!=this.world&&null!=this._components)for(var b=this._components.get_length();0<b--;)null!=this._components.get(b).classType&&(a?this.world.addComponent(this._components.get(b)):this.world.removeComponent(this._components.get(b)))},_connectWorld:function(a){this.world=a;this.componentUpdate();this._collectComponent(!0);this.onEnable();this.dispatchEvent(t.onEnable)},_disconnectWorld:function(){this._collectComponent(!1);this.onDisable();this.dispatchEvent(t.onDisable);
this.world=null;this.get_transform()._removed()},onEnable:function(){},onDisable:function(){},onUpdate:function(){},_frameStart:function(a){this.componentUpdate();this.get_transform()._frameChanged=!1;null!=this.get_transform().parent?this._timeScale=this.get_transform().parent.actor._timeScale*this.timeScale:this._timeScale=this.timeScale;this.deltaTime=a*this._timeScale},_fixedUpdate:function(a){var b=this.deltaTime;this.deltaTime=a*this._timeScale;this.get_transform().checkChanged();this.dispatchEvent(t.onFixedUpdate);
this.deltaTime=b},_update:function(){this.get_transform().checkChanged();this.dispatchEvent(t.onUpdate);this.onUpdate()},_destory:function(){if(!this._dontDestroy){this.dispose();this.onDestory();null!=this.get_transform().parent&&this.dispatchEvent(t.onRemoved);if(null!=this._components){this._collectComponent(!1);for(var a=this._components.get_length();0<a--;)this._components.getArrayElement(a).__disconnectActor()}this.transform=this._componentStates=this._components=null}},onDestory:function(){},
_setVisible:function(a){this.visible!=a&&(this.visible=a)},get_transform:function(){null==this._transform&&(this._transform=this.getComponent(Fa),null==this._transform&&(this._transform=this.addComponent(Fa)));return this._transform},set_enabled:function(a){this._enabled!=a&&null!=this.world&&this.world.set_dirty(!0);return this._enabled=a},get_frame:function(){return this.world.frame}});var R=function(){w.call(this);this._positionOffset=new h(0,0,0);this._renderQueue=1E4};R.prototype=n(w.prototype,
{begin:function(a){this.shape=a;a.drawLine=!1;this.get_transform().position.copy(a.position).add(this._positionOffset);this.get_transform().rotation.setEulerAngles(0,0,a.rotation);this.get_transform().scale.copy(a.scale)},udpate:function(){this.syncTransform()},end:function(){},syncTransform:function(){this.get_transform().position.copy(this.shape.position).add(this._positionOffset);this.get_transform().rotation.setEulerAngles(0,0,this.shape.rotation);this.get_transform().scale.copy(this.shape.scale)}});
var X=function(){H.call(this)};X.__name__="lovedna.game.components.Component";X.prototype=n(H.prototype,{onConstruct:function(){H.prototype.onConstruct.call(this);this.classType=ad.getClassName(this);this.__inited=!1},onAwake:function(){},onStart:function(){},onDestroy:function(){},__connectActor:function(a){this.actor=a;this.onAwake();this.transform=this.actor.get_transform()},__init:function(){this.__inited=!0;if(null!=this.__calbacks)for(var a=this.__calbacks.keys();a.hasNext();){var b=a.next(),
c=this.__calbacks;this.actor.addEventListener(b,null!=p[b]?c.getReserved(b):c.h[b]);b==t.onAdded._type&&this.actor.dispatchEvent(t.onAdded)}this.onStart()},__disconnectActor:function(){if(null!=this.__calbacks){for(var a=this.__calbacks.keys();a.hasNext();){var b=a.next(),c=this.__calbacks;this.actor.removeEventListener(b,null!=p[b]?c.getReserved(b):c.h[b]);this.__calbacks.remove(b)}this.__calbacks=null}this.onDestroy();this.actor=null},bindEvent:function(a,b){if(null!=b){null==this.__calbacks&&(this.__calbacks=
new K);var c=this.__calbacks,d=a._type;(null!=p[d]?c.existsReserved(d):c.h.hasOwnProperty(d))||(c=this.__calbacks,d=a._type,null!=p[d]?c.setReserved(d,b):c.h[d]=b,this.__inited&&this.actor.addEventListener(a._type,b))}else null!=this.__calbacks&&(b=this.__calbacks,c=a._type,null!=p[c]?b.existsReserved(c):b.h.hasOwnProperty(c))&&(b=this.__calbacks,c=a._type,b=null!=p[c]?b.getReserved(c):b.h[c],this.__calbacks.remove(a._type),this.__inited&&this.actor.removeEventListener(a._type,b))},__class__:X});
var ka=function(a,b,c){null==c&&(c=!0);this._list=[];this._index=0;this._create=a;this._opts=b;this.count=0;c&&ka._pools.push(this);this._avacount=10};ka.reset=function(){for(var a=ha._custom(),b=ka._pools.length;0<b--;)ka._pools[b].clear(a)};ka.prototype={get:function(){if(this._index<this._list.length){var a=this._list[this._index++];null!=this._opts&&null!=this._opts.reset&&this._opts.reset(a)}else a=this._create(),this._list[this._index++]=a,null!=this._opts&&null!=this._opts.init&&this._opts.init(a);
this.count=this._list.length;return a},clear:function(a){this._index=0}};var ta=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};ta.prototype={copy:function(a){if(null==a||a==this)return this;var b=a.x,c=a.y,d=a.z;a=a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);this.x=b;this.y=c;this.z=d;this.w=a;return this},parse:function(a){if(null==a)return this;a=a.split(",");for(var b=a.length,c=4;0<c--;)if(c>=b)this.setArrayElement(c,
0);else{var d=a[c];0<d.length?this.setArrayElement(c,parseFloat(d)):this.setArrayElement(c,0)}return this},lerpTo:function(a,b){if(0>=b)return this;if(1<=b)return this.copy(a);this.x+=b*(a.x-this.x);this.y+=b*(a.y-this.y);this.z+=b*(a.z-this.z);this.w+=b*(a.w-this.w);return this},setArrayElement:function(a,b){0>a?a=a%4+4:4<=a&&(a%=4);switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b}},fillArray:function(a,b){null==b&&(b=0);a[b++]=this.x;a[b++]=this.y;a[b++]=
this.z;a[b++]=this.w}};var E=function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);ta.call(this,a,b,c,d)};E.prototype=n(ta.prototype,{setRGBA:function(a){this.x=.00392156863*oa.toFloat(a>>>24&255);this.y=.00392156863*oa.toFloat(a>>>16&255);this.z=.00392156863*oa.toFloat(a>>>8&255);this.w=.00392156863*oa.toFloat(a&255);return this},parse:function(a){if(null==a||""==a)return this;0==a.indexOf("#")&&(a="0x"+x.substr(a,1,null));-1==a.indexOf("0x")&&(a="0x"+a);10>a.length&&(a=m.stringFill(a,
10-a.length,"F"));this.setRGBA(m.hexToInt(a));return this}});var G=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b};G.prototype={copy:function(a){if(null==a||a==this)return this;var b=a.x;a=a.y;null==a&&(a=0);null==b&&(b=0);this.x=b;this.y=a;return this},scale:function(a){var b=this.x*a;a*=this.y;null==a&&(a=0);null==b&&(b=0);this.x=b;this.y=a;return this},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(0!=a)return this.scale(1/a);var b=a=0;null==b&&(b=0);null==
a&&(a=0);this.x=a;this.y=b;return this},distanceSquared:function(a,b){var c=null==b,d=c?this:a;b=c?a:b;a=d.x-b.x;d=d.y-b.y;return a*a+d*d},clamp:function(a,b){var c=this.x;this.x=c<a?a:c>b?b:c;c=this.y;this.y=c<a?a:c>b?b:c;return this},setArrayElement:function(a,b){0>a?a=a%2+2:2<=a&&(a%=2);0==a?this.x=b:this.y=b},fillArray:function(a,b){null==b&&(b=0);a[b++]=this.x;a[b++]=this.y},fromArray:function(a,b){null==b&&(b=0);if(null==a)return this;var c=a.length;b<c&&(this.x=a[b++]);b<c&&(this.y=a[b++]);
return this},parse:function(a){if(null==a)return this;a=a.split(",");for(var b=a.length,c=2;0<c--;)if(c>=b)this.setArrayElement(c,0);else{var d=a[c];0<d.length?this.setArrayElement(c,m.stringToFloat(d)):this.setArrayElement(c,0)}return this},get_angle:function(){return 0==this.y&&0==this.x?0:57.29577951308232*Math.atan2(this.y,this.x)},set_angle:function(a){var b=Math.sqrt(this.x*this.x+this.y*this.y);0==b&&(b=1);a*=.017453292519943295;this.x=Math.cos(a)*b;this.y=Math.sin(a)*b;return a}};var h=function(a,
b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c};h.get_forward=function(){return h._pool.get().set(0,0,1)};h.get_up=function(){return h._pool.get().set(0,1,0)};h.get_right=function(){return h._pool.get().set(1,0,0)};h.get_zero=function(){return h._pool.get().set(0,0,0)};h.get_one=function(){return h._pool.get().set(1,1,1)};h.prototype={set:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;return this},copy:function(a){return null==
a||a==this?this:this.set(a.x,a.y,a.z)},add:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return this.set(d.x+a.x,d.y+a.y,d.z+a.z)},sub:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return this.set(d.x-a.x,d.y-a.y,d.z-a.z)},mul:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return this.set(d.x*a.x,d.y*a.y,d.z*a.z)},dot:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return d.x*a.x+d.y*a.y+d.z*a.z},cross:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return this.set(d.y*a.z-d.z*a.y,d.z*a.x-d.x*a.z,
d.x*a.y-d.y*a.x)},min:function(a,b){var c=null==b,d=c?this:a,e=c?a:b;a=d.x;b=e.x;c=d.y;var f=e.y;d=d.z;e=e.z;return this.set(a<b?a:b,c<f?c:f,d<e?d:e)},max:function(a,b){var c=null==b,d=c?this:a,e=c?a:b;a=d.x;b=e.x;c=d.y;var f=e.y;d=d.z;e=e.z;return this.set(a>b?a:b,c>f?c:f,d>e?d:e)},scale:function(a){return this.set(this.x*a,this.y*a,this.z*a)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0!=a?this.scale(1/a):this.set(0,0,0)},distanceSquared:function(a,b){var c=
null==b,d=c?this:a;c=c?a:b;a=d.x-c.x;b=d.y-c.y;d=d.z-c.z;return a*a+b*b+d*d},distance:function(a,b){return Math.sqrt(this.distanceSquared(a,b))},angle:function(a,b,c){null==c&&(c=!0);var d=this.x*this.x+this.y*this.y+this.z*this.z,e=a.x*a.x+a.y*a.y+a.z*a.z;return 0<d&&0<e?(null==b&&(b=h.get_up()),d=this.dot(a)/Math.sqrt(d*e),d=57.29577951308232*Math.acos(-1>d?-1:1<d?1:d),c?(a=h.instance.cross(this,a).mul(b),a=a.x+a.y+a.z,(0<a?1:0>a?-1:0)*d):d):0},lerpTo:function(a,b){if(null==a||0>=b)return this;
if(1<=b)return this.copy(a);0<=b&&1>=b&&(this.x+=b*(a.x-this.x),this.y+=b*(a.y-this.y),this.z+=b*(a.z-this.z));return this},parse:function(a){if(null==a)return this;a=a.split(",");for(var b=a.length,c=3;0<c--;)if(c>=b)this.setArrayElement(c,0);else{var d=a[c];0<d.length?this.setArrayElement(c,parseFloat(d)):this.setArrayElement(c,0)}return this},setArrayElement:function(a,b){0>a?a=a%3+3:3<=a&&(a%=3);0==a?this.x=b:1==a?this.y=b:this.z=b},fillArray:function(a,b){null==b&&(b=0);a[b++]=this.x;a[b++]=
this.y;a[b++]=this.z},fromArray:function(a,b){null==b&&(b=0);if(null==a)return this;var c=a.length;b<c&&(this.x=a[b++]);b<c&&(this.y=a[b++]);b<c&&(this.z=a[b++]);return this}};var Ra=function(){H.call(this)};Ra.__name__="lovedna.game.components.ui.UIRect";Ra.prototype=n(X.prototype,{onAwake:function(){X.prototype.onAwake.call(this);this._vec3=Ra._v3;this._vec2=Ra._v2;this._color=Ra._c4;var a=this.actor.getComponent(Fa);if(null!=a){this.actor.removeComponent(Fa);this.rectTransform=this.actor.addComponent(Mb);
this.rectTransform.position.copy(a.position);this.rectTransform.scale.copy(a.scale);this.rectTransform.rotation.copy(a.rotation);this.transform=this.rectTransform;null!=a.parent&&a.parent.addChild(this.rectTransform);for(var b=0,c=a.childCount;b<c;){var d=b++;this.rectTransform.addChild(a.getChild(d))}}else this.rectTransform=this.actor.addComponent(Mb);this.actor.layer=4},__class__:Ra});var ra=function(){H.call(this)};ra.__name__="lovedna.game.components.ui.GUI";ra.prototype=n(Ra.prototype,{addMeshRenderer:function(){var a=
this.actor.addComponent(zb);a.mesh=this.mesh;a.materials[0]=this.material;this._hasRenderer=!0;return a},collectRenderObject:function(a,b){if(this.actor.visible&&!this._hasRenderer){this.material.setMatrixHandler(k.toString(k.M),(M=this.actor.get_transform(),g(M,M.getLocalToWorld)));this.material.setMatrixHandler(k.toString(k.IM),(M=this.actor.get_transform(),g(M,M.getWorldToLocal)));var c=this.material,d=this.mesh.gpuBuffer,e=0;null==b&&(b=0);null==e&&(e=0);c=Xa._pool.get().set(c,d,e,b);a.add(c)}},
onAwake:function(){Ra.prototype.onAwake.call(this);this._hasRenderer=!1;this.material=new bd("ui");this.material.renderState.depthState.compareFunction=0;this.material.renderState.depthState.writeEnabled=!1;this.material.renderState.cullMode=0;this.material.renderQueue=ra.defaultRenderQueue;this.geometryBuffer=new bb;this.geometryBuffer.uv=new cb;this.geometryBuffer.color=new Ab;this.mesh=new Ba;this.mesh.fromBuffer(this.geometryBuffer);this.bindEvent(t.onCollectChildren,g(this,this.onCollectChildren));
this.batch=!0;this.actor.layer=4},onDestroy:function(){Ra.prototype.onDestroy.call(this);this.rectTransform=null},onCollectChildren:function(a){Ka.collect(this)},__class__:ra});var P=function(){H.call(this)};P.__name__="lovedna.game.components.ui.Image";P.prototype=n(ra.prototype,{onAwake:function(){ra.prototype.onAwake.call(this);this.imageType=-1;this.fillAmount=1;this.fillOrigin=this.fillMothod=0;this.rectTransform.width=this.rectTransform.height=-1},onStart:function(){ra.prototype.onStart.call(this);
this.bindEvent(t.onRectTransform,g(this,this.onRectTransform))},onDestroy:function(){ra.prototype.onDestroy.call(this);Ba.deleteGeometryBuffer(this.geometryBuffer.instanceID);this.geometryBuffer.dispose();this.geometryBuffer=null;this.material.dispose();null!=this.resource&&this.resource.removeEventListener(B.init._type,g(this,this.onSpriteInit));this.set_resource(null)},onSpriteInit:function(a){this.resource.removeEventListener(B.init._type,g(this,this.onSpriteInit));this.resource.enabled&&(this.material.setAtlas(this.resource),
this.material.name=this.resource.name,null==this.actor.name&&(this.actor.name=this.resource.name),0>this.rectTransform.width&&(this.rectTransform.width=this.resource.data.originalSize.x),0>this.rectTransform.height&&(this.rectTransform.height=this.resource.data.originalSize.y),.5==this.rectTransform.pivot.x&&(this.rectTransform.pivot.x=this.resource.data.pivot.x),.5==this.rectTransform.pivot.y&&(this.rectTransform.pivot.y=this.resource.data.pivot.y),this.onRectTransform(),this.dispatchEvent(B.init))},
onRectTransform:function(a){this.draw()},draw:function(){if(null!=this.resource&&this.resource.enabled&&(null==this._uvBuffer&&(this._uvBuffer=new cb),this.geometryBuffer.position.clear(),0!=this.rectTransform.width&&0!=this.rectTransform.height)){var a=this.imageType;-1==a&&(a=0,this.resource.data.border.hasBorder()?a=1:null!=this.border&&this.border.hasBorder()&&(a=1));0==a?this.simpleFill():1==a?this.slicedFill():2==a?this.filledFill():this.simpleFill();this.geometryBuffer.update();this.dispatchEvent(B.update)}},
clearBuffer:function(){this.geometryBuffer.position.clear();this.geometryBuffer.uv.clear();this.geometryBuffer.color.clear();this.geometryBuffer.group.indices.clear()},simpleFill:function(){var a=this.rectTransform.width,b=this.rectTransform.height,c=a/this.resource.data.originalSize.x,d=b/this.resource.data.originalSize.y,e=this.resource.data.offset.x,f=this.resource.data.originalSize.y-this.resource.data.offset.y-this.resource.data.frame.w;e=e*c-this.rectTransform.pivot.x*a;f=f*d-this.rectTransform.pivot.y*
b;a=this.resource.data.frame.z*c;b=this.resource.data.frame.w*d;this.clearBuffer();0!=a&&0!=b&&this.drawQuad(0,0,a,b,this.resource.data.getRectUvs(0,0,1,1),0,e,f)},filledFill:function(){0>=this.fillAmount||(1<=this.fillAmount?this.simpleFill():0!=this.fillMothod&&1!=this.fillMothod||this.fillHorizontalVertical())},fillHorizontalVertical:function(){var a=this.rectTransform.width,b=this.rectTransform.height,c=a/this.resource.data.originalSize.x,d=b/this.resource.data.originalSize.y,e=this.resource.data.offset.x,
f=this.resource.data.originalSize.y-this.resource.data.offset.y-this.resource.data.frame.w;e=e*c-this.rectTransform.pivot.x*a;f=f*d-this.rectTransform.pivot.y*b;a=this.resource.data.frame.z*c;b=this.resource.data.frame.w*d;this.clearBuffer();0==this.fillMothod?1==this.fillOrigin?this.drawQuad(a*(1-this.fillAmount),0,a*this.fillAmount,b,this.resource.data.getRectUvs(1-this.fillAmount,0,this.fillAmount,1),0,e,f):this.drawQuad(0,0,a*this.fillAmount,b,this.resource.data.getRectUvs(0,0,this.fillAmount,
1),0,e,f):3==this.fillOrigin?this.drawQuad(0,0,a,b*this.fillAmount,this.resource.data.getRectUvs(0,0,1,this.fillAmount),0,e,f):this.drawQuad(0,b*(1-this.fillAmount),a,b*this.fillAmount,this.resource.data.getRectUvs(0,1-this.fillAmount,1,this.fillAmount),0,e,f)},slicedFill:function(){var a=this.border;null==a&&(a=this.resource.data.border);if(1E-5>m.abs(a.x)&&1E-5>m.abs(a.y)&&1E-5>m.abs(a.z)&&1E-5>m.abs(a.w))this.simpleFill();else{var b=this.rectTransform.width,c=this.rectTransform.height;if(!(0>=
b||0>=c)){var d=this.resource.data.originalSize.x,e=this.resource.data.originalSize.y,f=a.x,r=a.z;r=0<r?r:0;var h=a.y,g=a.w;g=0<g?g:0;if(f+r>=d||h+g>=e)this.simpleFill();else{var k=this.resource.data.offset.x,n=this.resource.data.originalSize.y-this.resource.data.offset.y-this.resource.data.frame.w;k-=this.rectTransform.pivot.x*b;n-=this.rectTransform.pivot.y*c;var p=b-f-r;p=0<p?p:0;var l=c-h-g;l=0<l?l:0;var q=a.x+a.z;0<q&&b<q&&(q=b/q,f*=q,r*=q);q=a.y+a.w;0<q&&c<q&&(a=c/q,h*=a,g*=a);this.clearBuffer();
a=0;0<h&&0<f&&this.drawQuad(0,0,f,h,this.resource.data.getRectUvs(0,0,f,h),a++,k,n);0<h&&0<r&&this.drawQuad(b-r,0,r,h,this.resource.data.getRectUvs(d-r,0,r,h),a++,k,n);0<g&&0<f&&this.drawQuad(0,c-g,f,g,this.resource.data.getRectUvs(0,e-g,f,g),a++,k,n);0<g&&0<r&&this.drawQuad(b-r,c-g,r,g,this.resource.data.getRectUvs(d-r,e-g,r,g),a++,k,n);0<p&&0<h&&this.drawQuad(f,0,p,h,this.resource.data.getRectUvs(f,0,d-f-r,h),a++,k,n);0<p&&0<g&&this.drawQuad(f,c-g,p,g,this.resource.data.getRectUvs(f,e-g,d-f-r,g),
a++,k,n);0<l&&0<f&&this.drawQuad(0,h,f,l,this.resource.data.getRectUvs(0,h,f,e-h-g),a++,k,n);0<l&&0<r&&this.drawQuad(b-r,h,r,l,this.resource.data.getRectUvs(d-r,h,r,e-h-g),a++,k,n);0<l&&0<p&&this.drawQuad(f,h,p,l,this.resource.data.getRectUvs(f,h,d-f-r,e-h-g),a++,k,n)}}}},drawQuad:function(a,b,c,d,e,f,r,h){null==h&&(h=0);null==r&&(r=0);this.geometryBuffer.position.push(this._vec3.set(a+r,b+h,0));this.geometryBuffer.position.push(this._vec3.set(a+c+r,b+h,0));this.geometryBuffer.position.push(this._vec3.set(a+
c+r,b+d+h,0));this.geometryBuffer.position.push(this._vec3.set(a+r,b+d+h,0));this.geometryBuffer.uv.add(e);a=this._color;e=d=c=b=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;this.geometryBuffer.color.push(this._color);this.geometryBuffer.color.push(this._color);this.geometryBuffer.color.push(this._color);this.geometryBuffer.color.push(this._color);f*=4;this.geometryBuffer.group.indices.push3(f,f+1,f+2);this.geometryBuffer.group.indices.push3(f,f+2,f+3)},set_resource:function(a){null!=
this.resource&&this.resource.removeEventListener(B.init._type,g(this,this.onSpriteInit));this.resource=a;if(null!=this.resource)if(this.resource.enabled)this.onSpriteInit(null);else this.resource.addEventListener(B.init._type,g(this,this.onSpriteInit));return this.resource},__class__:P});var na=function(){H.call(this);this._map=new K;this._instanceMap=new ba;this._loader=new I};na.prototype=n(H.prototype,{get:function(a){return this.getRes(a)},getRes:function(a){var b=this._map;if(null!=p[a]?b.existsReserved(a):
b.h.hasOwnProperty(a))if(b=this._map,!(null!=p[a]?b.getReserved(a):b.h[a]).unloaded)return b=this._map,null!=p[a]?b.getReserved(a):b.h[a];this._current=this.createRes();b=this._map;var c=this._current;null!=p[a]?b.setReserved(a,c):b.h[a]=c;b=na._all;null!=p[a]?b.setReserved(a,this):b.h[a]=this;this._instanceMap.h[this._current.instanceID]=a;this.innerLoad(a);return this._current},innerLoad:function(a){var b=this._loader.load(a);b.name=a;this._current.set_file(b);this.onLoadBefore(this._current);b.get_enabled()||
b.addEventListener(B.complete._type,g(this,this.fileComplete))},createRes:function(){return null},onLoadBefore:function(a){},init:function(){},fileComplete:function(a){var b=a.target;b.removeEventListener(B.complete._type,g(this,this.fileComplete));a=this._map;b=b.name;a=null!=p[b]?a.getReserved(b):a.h[b];a.fileComplete();this.onComplete(a)},onComplete:function(a){}});var Fe=function(){na.call(this);Oc.map.h[cd.TYPE]="atlas"};Fe.prototype=n(na.prototype,{get:function(a){return na.prototype.get.call(this,
a)},addAtlas:function(a){this._path.set(a);a=this._atlasMap;var b=this._path.getPathWithoutExt(),c=this._path.getExt().toLowerCase();null!=p[b]?a.setReserved(b,c):a.h[b]=c},getRes:function(a){var b=this._regions;if(null!=p[a]?b.existsReserved(a):b.h.hasOwnProperty(a))return b=this._regions,null!=p[a]?b.getReserved(a):b.h[a];b=new Jd;var c=this._regions;null!=p[a]?c.setReserved(a,b):c.h[a]=b;this._path.set(a);c=this.getAtlasPath(this._path);if(null==c&&null!=this._path.getDir()){var d=this._path.getDir()+
".png";d=l.meta.getMeta(d);null!=d&&1==d.get("isAtlas")&&(this.addAtlas(d.path),c=d.path)}null!=c?(b.set_name(a.split(this._path.set(c).getPathWithoutExt()+"/").join("")),b.set_atlasName(c),b.set_texture(l.texture.get(c)),b.texture._file.forceBytes=!0,a=this._atlas,a=null!=p[c]?a.getReserved(c):a.h[c],null!=a&&b.init(a)):(b.set_texture(l.texture.get(a)),b.texture.enabled&&b.init(null));return b},createRes:function(){return new Jd},onConstruct:function(){na.prototype.onConstruct.call(this);this._atlasMap=
new K;this._regions=new K;this._path=new nb;this._atlas=new K},init:function(){na.prototype.init.call(this);l.texture.addEventListener(B.data._type,g(this,this.ondata))},getAtlasPath:function(a){var b=a.getPathWithoutExt();if(null==b){b=this._atlasMap;var c=a.getFileWithoutExt();return(null!=p[c]?b.existsReserved(c):b.h.hasOwnProperty(c))?a.toString():null}for(c=this._atlasMap.keys();c.hasNext();)if(a=c.next(),-1!=b.indexOf(a))return b=this._atlasMap,a+"."+(null!=p[a]?b.getReserved(a):b.h[a]);return null},
ondata:function(a){var b=l.texture.res._file.path;a=this._regions;var c=null!=p[b]?a.getReserved(b):a.h[b];null!=c&&(c.data.name=b,c.init(null));if(l.texture.tag==cd.TYPE){this._path.set(l.texture.res._file.path);a=this._path.getPathWithoutExt();var d=l.texture.bytes,e=new cd;l.texture.res.texture.params.mipmap=!1;e.decode(d);d=this._atlas;null!=p[b]?d.setReserved(b,e):d.h[b]=e;b=e.regions;for(d=b.length;0<d--;){c=nb.combine(a,b[d].name);var f=this._regions;c=null!=p[c]?f.getReserved(c):f.h[c];null!=
c&&c.init(e)}}}});var Oc=function(a){this.type=a;this.compress=!0};Oc.prototype={decode:function(a){if(oa.gt(1,a._length-a.position)||oa.gt(2,a._length-a.position)||oa.gt(13,a._length-a.position)||oa.gte(a.position+13,a._length))return null;if(-199789115==a.readUnsignedInt()){this.type=a.readUnsignedInt();var b=0!=a.readUnsignedByte(),c=a.readInt(),d=La._new();a.readBlob(d,0,c);return b?La.fromBytes(pd.uncompress(La.toBytes(d))):d}a.position-=4;return null}};var cd=function(){this._regions=new K;
this.pages=[];this.regions=[];this.rotate=-1};cd.prototype={getRegion:function(a){var b=this._regions;return null!=p[a]?b.getReserved(a):b.h[a]},addRegion:function(a){this.regions.push(a);var b=this._regions,c=a.name;null!=p[c]?b.setReserved(c,a):b.h[c]=a;a.postInit()},decode:function(a){this._regions=new K;this.pages=[];this.regions=[];for(var b=a.readUnsignedByte();0<b--;){var c=new Kd;c.decode(a);this.pages.push(c)}for(b=a.readUnsignedShort();0<b--;)c=new Ca,c.decode(a),c.page=this.pages[c.index],
this.addRegion(c)}};var gb=function(){this._lasttype=0;this.reset()};gb.prototype={reset:function(){this._lasttype=this._index=this._value=0},getCode:function(){return this._value},getString:function(){return ea.hex(this._value,null)},addInt:function(a){2!=this._lasttype&&(this._lasttype=2,this._addInt(this._lasttype));this._addInt(a)},addString:function(a){4!=this._lasttype&&(this._lasttype=4,this._addInt(this._lasttype));var b=a.length;for(this._addInt(b);0<b--;)this._addInt(x.cca(a,b))},addBool:function(a){16!=
this._lasttype&&(this._lasttype=16,this._addInt(this._lasttype));this._addInt(a?1:0)},_addInt:function(a){this._value*=16777619;this._value^=a}};var nb=function(a){this.set(a)};nb.combine=function(a,b){return""==a||null==a?b:null==b||""==b?a:""==a?b:nb.addSlash(a)+nb.removeSlash(b)};nb.addSlash=function(a){if(0==a.length)return"/";var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return b<c?c!=a.length-1?a+"\\":a:b!=a.length-1?a+"/":a};nb.removeSlash=function(a){a:for(;;){var b=x.cca(a,a.length-1);if(null==
b)break;else switch(b){case 47:case 92:a=x.substr(a,0,-1);break;default:break a}}a:for(;b=x.cca(a,0),null!=b;)switch(b){case 47:case 92:a=x.substr(a,1,null);break;default:break a}return a};nb.prototype={toString:function(){return(null==this._dir?"":this._dir+(this._leftslash?"/":"\\"))+(null==this._file?"":this._file)+(null==this._ext?"":"."+this._ext)},getDir:function(){return this._dir},getPathWithoutExt:function(){return nb.combine(this._dir,this._file)},getExt:function(){return this._ext},getFileWithoutExt:function(){return this._file},
isHttp:function(){var a=x.substr(this._value,0,7);return"http://"!=a?"https:/"==a:!0},set:function(a){this._value=a;this.clear();if(""==a||null==a)return this;switch(a){case ".":case "..":return this._dir=a,this._file="",this}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this._dir=x.substr(a,0,c),a=x.substr(a,c+1,null),this._leftslash=!1):c<b?(this._dir=x.substr(a,0,b),a=x.substr(a,b+1,null),this._leftslash=!0):this._dir=null;-1!=a.indexOf("?")&&(b=a.split("?"),a=b.shift(),this._param=b.join("?"));
b=a.lastIndexOf(".");-1!=b?(this._ext=x.substr(a,b+1,null),this._file=x.substr(a,0,b)):(this._ext=null,this._file=a);return this},clear:function(){this._param=this._ext=this._file=this._dir=null;this._leftslash=!1}};var qd=function(){H.call(this);this.list=T.fromArray([]);this._map=new K};qd.prototype=n(H.prototype,{addMeta:function(a){this.list.push(a);if(null!=a.path){var b=this._map,c=a.path;null!=p[c]?b.setReserved(c,a):b.h[c]=a}},getMeta:function(a){var b=this._map;return(null!=p[a]?b.existsReserved(a):
b.h.hasOwnProperty(a))?(b=this._map,null!=p[a]?b.getReserved(a):b.h[a]):null},decode:function(a){this.list.clear();for(var b=new $c(this._map);b.hasNext();){var c=b.next();this._map.remove(c.key)}if(null!=a&&(b=a.readUnsignedInt(),!(6E4<b)))for(;0<b--;)c=new Ge,c.read(JSON.parse(a.readUTF())),null!=c.path&&this.addMeta(c)}});var I=function(){H.call(this);this._bytesLoader=new Vc;this._bytesLoader.onComplete=g(this,this.onBytesComplete);this._fileList=new N};I.setGlobalRoot=function(a){null==a&&(a=
"");I._defaultRoot=a;I._path.set(I._defaultRoot);I._path.isHttp()&&(I._defaultRoot=I._path.toString()+"/");!ea.endsWith(I._defaultRoot,"/")&&0<I._defaultRoot.length&&(I._defaultRoot+="/")};I.setVersion=function(a,b){var c=I._version;null!=p[a]?c.setReserved(a,b):c.h[a]=b};I.getVersion=function(a){var b=I._version;if(null!=p[a]?!b.existsReserved(a):!b.h.hasOwnProperty(a))return"";b=I._version;return null!=p[a]?b.getReserved(a):b.h[a]};I.prototype=n(H.prototype,{load:function(a,b){var c=this,d=new Yb;
I._path.set(a);var e=I._path.toString();d.setType(b).setPath(e);if(I._path.isHttp())d.setUrl(a);else{b="";if(I.enableVersion)if(b=I._version,null!=p[a]?b.existsReserved(a):b.h.hasOwnProperty(a))b=I._version,b=null!=p[a]?b.getReserved(a):b.h[a];else{b=I.meta.getMeta(a);b=null!=b?ea.hex(b.crc,null):"";var f=I._version;null!=p[a]?f.setReserved(a,b):f.h[a]=b}a=I._defaultRoot+e;""!=b&&(a+="?"+b);d.setUrl(a)}a=d.get_key();e=I._fileMap;(null!=p[a]?e.existsReserved(a):e.h.hasOwnProperty(a))?(d=I._fileMap,
d=null!=p[a]?d.getReserved(a):d.h[a]):(e=I._fileMap,null!=p[a]?e.setReserved(a,d):e.h[a]=d,this._fileList.push(d),I._list.push(this),I._loading||(null==I._delayCall&&(I._delayCall=new aa(function(){c._loadnext()})),I._delayCall.running||aa.add(I._delayCall,.1)));Bb.onLoad.file=d;I.onLoadEvent.dispatchEvent(Bb.onLoad);return d},_loadnext:function(){I._loading||0!=I._list.get_length()&&I._list.shift()._load()},_load:function(){if(1>this._fileList.get_length())this._loadnext();else if(this._current=
this._fileList.shift(),this._current.type==ob.NULL){if(null!=this._current.callback){var a=this._current.callback;a();this._current.dispose()}this._loadnext()}else if(this._current.done)this._loadnext();else if(null!=I.onLoadBefore)I.onLoadBefore(this._current,g(this,this.doLoad));else this.doLoad()},doLoad:function(){var a=this;I._loading=!0;if(this._current.forceBytes)null==this._current.bytes?this._bytesLoader.load(this._current.url):this.completeFile();else if(this._current.type==ob.IMAGE){var b=
new Lc;null!=this._current.bytes?b.fromBytes(this._current.bytes,function(b){a._current.image=b;a.completeFile()}):b.fromUrl(this._current.url,function(b){a._current.image=b;a.completeFile()})}else this.completeFile()},onBytesComplete:function(a){var b=this;this._current.bytes=a.bytes;this._current.type==ob.IMAGE?(new Lc).fromUrl(this._current.url,function(a){b._current.image=a;b.completeFile()}):this.completeFile()},completeFile:function(){I._loading=!1;if(this._current.type!=ob.NULL){for(var a=
I._fileMap.keys();a.hasNext();){var b=a.next(),c=I._fileMap;(null!=p[b]?c.getReserved(b):c.h[b])==this._current&&I._fileMap.remove(b)}this._current.dispatchEvent(B.complete);this._current.complete()}this._loadnext()}});var He=function(){na.call(this)};He.prototype=n(na.prototype,{get:function(a){return na.prototype.get.call(this,a)},createRes:function(){return new Ie},onLoadBefore:function(a){na.prototype.onLoadBefore.call(this,a)}});var Je=function(){na.call(this)};Je.prototype=n(na.prototype,{createRes:function(){return new Ke}});
var Le=function(){na.call(this)};Le.prototype=n(na.prototype,{get:function(a){return na.prototype.get.call(this,a)},createRes:function(){return new Me},onLoadBefore:function(a){na.prototype.onLoadBefore.call(this,a);if(!a.enabled&&!a._file.forceBytes){var b=l.meta.getMeta(a._file.name);null!=b&&1==b.get("isAtlas")&&(a._file.forceBytes=!0)}}});var l=A.lovedna.Assets=function(){};l.init=function(a){null==a&&(a="");I.setGlobalRoot(a);if(!l._init){l._init=!0;a=[l.bytes,l.texture,l.atlas,l.audio,l.fnt,
l.cube,l.gltf,l.spine,l.table];for(var b=a.length;0<b--;){var c=a.pop();null!=c&&c.init()}l.meta=I.meta;a=La.fromBytes(kb.decode("eNrtPEtvI0d6ml17nZ3d2U32keTYiC/dVIukSMkzEkMElIbSEEtSgkjRDgyDaZJNqmGym+5uUqQMX7IB4gDe9SZAcoiBII9rkg2QReBsvPEph/yJnGa8zsmnHBPkq2dXVRcpaWbs3QDhQNNk1feq1/eqqr6zsft7GxvtykG9+uLQG7vRuxsbG1/e+PrGC74zce98JYpDzx/debG3jN3opY2NOxvo8yUAQZ8XNl7Ez69svISfv7LxVfy8u/E1/Pz6xj38/MbGN/HzVzd+DT+/tfFt/PzOxnfx89c3fgM/fxPgowtn4IbdfjCZBP6/f/XlgTv0fNc4rRnF7PbO9u5e4ZXd4u7evbtJTcF4JVt4UNx+sFvM399+kFQNx4ETF4y52y8ohUVUWFQKd1DhTlJ44YyHBWPiDrzZZKpQQXVFsa4o1+2IdQpNXoW5CkJ4C3dQMMbBpcoN1xR5TVGp2eE1O0oNqVD4jN1waky8RVLixI5fwP8L+KHTx/8JmIPBwhgcDRZiyRKVLJOS2F0UHqL/41noFh5KFYfnB1VWdTjruUll5ECZE7umYxn9sTOZmoZjG/ls3ja2s3nDuncXN8KYBpcF0+gHfhQbnk9aZiwMy3jbCF0g4RuLzKJkvCPAF6+FVzF2VmDQ7wWjTLgwCoXMooApoBEA1Ml0Frutfui6/mkQmbh0GkTQiLfv3TXgg0uCMpRl8tndEikMsotlGY27Cd/sILu0NoPsJa+8ukTw8KAllHkAPxnnKQz5uOU7U8KyP/amwN/GPyIsTsu7ciUxCsbFtF9OKkEGQSQMELuTadmkxKA+x75eWhlA3sQiA44Nf5aIiMUBwDL0WxCaiA6rT6iVGVQOaGU4abmRtJg09d7dC290QWe1ETr+QBguzHg2R8NFOeEaEcOB4dsuZPce7D2wjR78uP8gWygWbaMP33eK93cfZHd3dotUAhFzEAPEIIhN4ACi25gbmqg94GfZRuRD/SQAeQaxjVSWJTcDryYz8nwz8i0jY/Qt0qIJUkgxtCSCEXYb8EtoEa6cGMmoEejJlNKGb68beeMNYI1Ug2lM8E+YQujbNv9WQN+4RBhrO4215FhLjrWUsQpprCuOdcWxrtTWE5HJXAVdBqveCdvBsTOZOK2p03dNXB6OeklT4Ud54ixMeNqYISgESyGL6mHNijA726/gz33LyoD22N3dYsi7u5ZMiC97Is9RMDqCMYLZSkfci0Ap9t12UF26hk3nwTAYtWInjIXfVX/ApxwvJKSgs0wCYWzJBC0jJ1Qxqqx9IgFoxRZRi7w00Y7qLGMQYvPcxTTwXT/2nPHaNtpc+IeuH3nxck2rkGLOIcqm3E0ZET3dmOfZltZbMyd0P4cWoRm1ulW2URAm4vNpG9ZcE2c6BYerNQ29GPied0yq0IgSD91+nKwOIv+sbCJttIXqsgsrh59XJRFkjkGWBGRJQRQVi1XZzJ5bTMmK8px32gGRaZ08lNJsniEyXG4SmZaI5LeZZwcG35mN4+7cDeN/e9GJwcPsgbnECgVZSS/2An//9KRVa9dOmoA6871hEE6Q3tsxRuCWdkFDht6ic7rfOV1T39hvQO3L3hA4Guede3clXqgR++cdgJg74RLaSArnszlCcv2BN0S9QNGbJ2eNSl0hUTR84OuM90mtTAo8TFKrI9euNI+rzbZCb8eA6TaCib1P61MUab2O5OFJ/eQsRbAfjINwH9fJxMDXxXU6UgcnzSr/0fperdmsNY+Vfp51e7AGo9fv59/YR/ClFGun6wHdvhvh+m6t+bD6mg7q0gULG1OoV6u140eo3dgownC68QHwIQOa8so82SruGEgmWMZMOICMTc8y3pCnOqoks5w1PekCqb8vg3A8OKVTEgs1D7wBsAILjr5ZIm+w++4YBDXK4hyknMn/wlzETtJsXsbTDddREVLQdGAxAh6yMnFryOCtRSUDKRQkg8nFjt70fCx1MhTgJmSUnueDCRqGcmWImyLmcg3mci3m1RrMq7WYl2swLxkmG50yJaHpunQ34hl6OS0z5AwqMJmOsgWVLs2U8uUUlN6VNPSjcZdVQ1dLWgzEv5zq5glTOlgUokwAl3wBVx07+WYy7zIGKSAA2OwgtxSJYl03U7hCwryompGY0TJLaBmjltbt4OiOfudruRw1H4Y3cUbuGRiD/YNKq4pndKNy2j2rHoOKL2Ox83be3ra3LVvom1pjv9ZYreBxtWAA8JrtQ33osL7er/5uVYYACrJSZGtFECxBiMCUQ7gMAW2bRK15qQWC9pTGbD2N7X0OlSaAlMNNLBJVCzdU6WwqaQ0UmQ2rjdSNbVAdKe+VU1gapjFau3yUMGJXsPl6+Mqk5yHzSMArjYMaMZJ66IfecDiLXAr9sHZ0dN6qpqF3CHRr6vZnYyek4K3T6uF5vXKmTPW0rUzPZ2W63WLul57ZEmGOPSdyD7GlwNRBTdnCH9cFunlv0I9iqRJ9wT7UgyrPuQFTULUdYygfcBXLvH+S1IYMsimAYF9S4iZoNPZJ2s+zUCZbvvZsbpVS7TyuNBqVFUSyEFiCJkQBgVRmGyzahKBSoqmIRHlU6qePKt12tdWWGXlDga7z2wmYJcO9ne4bCFD6TjjQ9BrxdJSKd9Z33XpbmPZG5K7m3zLzVb6JDngkAq9UHXTG0YXdxGqrnPjX6Sma1sbK5C0aTdmWkq9WSQPZliGpAtzCmSCKZ7NSK8Mp5XJPfvzP7U8//uDTv3rv8cd//8nf/c1nH7335IO/fPzhT9uPP/zhwZM/ea/55P0ff/r9nz3+8AdP/uL3f/7BTzTMD4B5PwyiyGzabVU8nApqHzTL+JvZtg/sprYJDWfaZA4EnraplbFtI0sDE9nI5R7/yw8/+cc//flPP37ywb9+8v6Pnrz/Zz//8z948qM//s8/fF9Dm3smEBNnOCOScpH0DlD+9Gd/+8kP/vrT977/5IOfPHn3Hz776N0tUHyfffRHMl1hmKW+h6Zm0gOlTuTUNBDsEvuwRAE2EaiLcdCORlTgbctmykI+VVHUoclCxHTK0SQI4osodqcowWTns6/YtEozKjsMDa8EMjA7Ji2z1aeGK+59iHHmKD1hSB0leUnMM5RdI+wgWqI/J9NFOxX1qkJX6g9jkzJXBSOdG1GLSpXnih4mbCwhS2LLBjnx4WXySIdUxtMLpyyoz9IqS5BoHLHTN3G/4JnKpLUyMnes6TkvtKoJkuiQ2Hl5cDTaUyiBUOAI/GM26lwySQmCV/0N5lXPPJws+Z87X2Sy5OnSJc81HfF/Jty+bbT4FCGhMh9QgJV54QsIa24dl0h+33mn26q2FYd4No9cxRkmcGuc4dsFPb8A7/j2PjHrG51PjLtotT9Mqr8YXziXI+p2hPZpUIo8V8gWSk/nK2PS/+8rP0df+aa25JtMd0x7ITYm//GSYkwcroxEc5JKICB6KcymkgZfnUpIoaMMcDuV9dZqnxRuAXDPO8QqJRhKmrpzSpSqxvzNug2qqlF9o5SKuuddIeSWlV8Xc9V2j67NWD1QAthpn3fBl+XjPo7cNBwVoSlGOavzEPqcvZjrWJW3146JNnevhVyVv+eW+gY5fGXN3iSXn87n02WryelzY6BsFyQ+hDQVSrdPpT97Ov3ZUurPllZ/ttT6s6XXwT8ihyakJHaijUSjPBcdJmxRpvgMyRXaSJ/SYyNrkwir1qYSzL6q5tmLZlpCsjARexpKaeMzmhe4EUWqCNeQZNQ0mflXSUKCNsBmpRYNmF99XgmJnqdtEslRMO5cUHTMJWlYKpTDatCg6QuGYws8bIOLL1pfUJhqQrLb1O6Q3HrkdHNWG08QrucdvNaxOdApcwJAz0jlxUhRJi5HA4ndAqlhZqPcieG77iAyLg3Q5sY0DKYuPNwQBa6xN3dBsYZovx0IqAYfRQv//Vu53Mvg+KEDDMDiuN6tvtbuUiDqG3bHwWDfcH2nN0ZH8yTok2qri45DDMCJ6gKON3cQ18hIEHK5izieRvu53MiLL2a9bD+Y5L53EQZ+EB2HwWyaG43bR1uvur3j+tbpAbhGUxDYwxyEY1al5FRgo9I8r9S7rbPjg6QQ/eoeVVrtbuX09OzktVqj0lbT7kXowTrZBKB9kt5j0IFj5ym1v0AHvnZQT4VQ6BQjINO9hqo/b5Hy/Wqzw/YcSESlR2R5BgWTbT9oUSFsA6sYDob18/b+wdnDI3imN5Kui/xm3QPmLTLOz7C1NaOLipESd7gYND2vwiD7zthN4Lqtw0q9WsYwJtX5igDVRq3VqnWqK0WoTrwogknJezJBSI83AyZncERYmFyH7ZOzMjsoJsaGikiNartSPzs5P37UrLZaKwVruLEzHnv9s2A2ugBvJmISpvDTLE4OD+vnLZiyK6mf9PvjGVpFjKqIoun/BD4OXX8UX0gI3Vb7rNo8bj/Sj4XQiwVdyzrOeAZ+Y6phQqcWWKda6tasMCfpsEghc0JCG7crA3yI05033wE+OjlWxRkGo30oLmnKiaaAyi4nQ3soRz63jSV+wZFEFIezfmyAWq75w0A5Y9YEz6JeMlIfMEp98N/AVo9do+fGl67rs/0AMBUkkQuhN7dLMsnOU5Cce+7laoqPnoIiPpIPXQTTTSRXvw05paHr6HZuQ1du7Tqy4An03Wk8c8Z8KZYo2ZAVwISAxWkbDrCZxRdB6A6M3tKIL1zigBv90HXQOUbT86ez2IgDgzgIlshpgpY8py81YEK1AWEEsSKmHc3CodN3udNfhMBtOIYWoMOV+ZJCYzgbj0UAkns1qGsJYWDfG7ioHPeUpae6J5FFfZAiiHJaoXOF1gemJDbRQbl+uR+NVGeiwy3QgdBJDnRf6NIjxEb/AvmuKMJFjU/gTeSzBRHp89cLb4iii5sSpdSsQOJC2EwCbzQPhmEw4ZtXeO5BMwRybDMjRW8NOb5dk9B7B3QFCddJtzS6pzVwTsWLOA/27u8VFbB+t+H5vPcAAdT9ToneUUDeWxzUa81q5YxcU4jCUa/mJ6E5M62i76fEbytdwFS0AmNyMotpTpJwwn4/tu2FbMFKxRW6kKdO2oE39phXsJPf2bXshKQ2+uPsJyj1kQDnyO5oIbtXsGwsmyDcpnBa3cqxfVR+dL2Q3bEAiQi1LpmanOxF21VIECYuxGF6i0FRCJh6zIue3B+5dPPOlMbM15squlHVHSxYzI4uEJmJOcwuLFstWqaLrqSRSsguBbLLNNllmuzyGrIQDKWlPe8IcsIPJqF4IUGmoArGKSxFCssVFNClAUImG5MQEMm0RYVLypb4DgEtjaCUI22xr7wU0DT5fjVFkqRCRnIsTf2HmywYjEoyAkRym0m7Zroq5w2hAUAmQ5IaI9uI073U02UgUqDkvkzP52kGWDs20Lb0S0AAl10rIS2w8nQJaT2gJrstSmRkY3/PQrsigoy+3HbgnjFMWOl5ePrQE8jDJfmLoikFULah/NwW8xmqP8ikk1iBKVp1RpSqA5+elhbCYKYJ4MehYEpM6j8a015YQz5EZFOutmSj0WkKxceceNPDYIZPne5l89L9hXEwQOuB08xqnB3oHUZBuIQGcwTiZECWzI44ODSOpne5EhbYPyWXD7eMtZyhu4XRFM05TimsYI7if1OTOICZyemxhFOr2m1XX+vWTx5qbPx1TOrBoPpa29SlGmxhOGzUywnnZOLcitm1bAQOyTQT+wzdsBN7LyN0vuQlaaRDJloSNCNOGskpgio08tmFsUm+LJXbOUycTU5SvjIgypye9alLMfpGgO5GPpVwLY4xO+M9diviomMNopvamj15Sos4FrYr7LCOOvlx6CKd1NklkTe/mjVyA4gBQq/PcwzrxBeCS+ShSWuvXkpFiymYjgQTSvWKCy9593Hs+jMHdW6dHFuDVhMpwJaSLzDsb4WxieZJiDqSdAX+ifqIQlG0ROGmGHQkBh3GoHMjBh2GZqmXHqUmZCSG4nBMPDCKKPaKH3rRGiWtDgkPWlpvrelUaW2u6e+hrLxxnI7aKTDZUkb2kSURJyibaNLJ/SDSgK7FAUoGGMIfnZe6zb+VETPOvK9IaWWXpVQUjELddSiL0rpMId8Dm9AMrOI3rMoaUheCiqNvBiOZRS6ULjdAt0GTVnCMHjKltFxR1HpeRFlo6mwlFJRuQQqsCQFWkL4wqQvK0bzUegH6xq48zyOfCVrnKajpcjoMaKam8pYpEyrz0MNrTn9kytKhD2wihnkWWaAo1CqtSCOIx0HwuRxQKiyWtNB1Y969ElamTH0eYQro8wo0qh3mbUM57MNQ5fETUzBlfG0b/Ukks9CpcsHIUkt6K6nu5flcEnlljMIumlDqrJJaBN6KFwb+xPXjs7zgR/BWXYe0x0dlm/Kxmdcu56UEOvjcXxJNa5KCcuqGJS1jllIDW+35sUBxLjn3LAcOo5mEvAkboNjBeUSaABJporQWOS8sUB8r1OUdNkX+66jjNJNA/EI+aLw5X9cfQPxRkgfl6dJeEF8YNE+cTgySrdWthAktN+fY6S7pnJLk1DLykMkx5fy2RjsxD4UgOL2IIc2ta7AeqWwurFUqsJ4CH68D76TA53rwlEMASLTMTMJH3Ce2/Luj/H4k/K4rvzvKb53FEOJwZg6EMyq6xXpN/Z4IIJsQoUJUgRqCuJwUS9rjSNAUgsee+FXScBzj5Z5ykFdAP8T6Veu/pTBk5Y/DceRzEUV+hHQQi1T0qKgNCd4RwB/D30PkUu0I3jHzRkXUPjUFBALbwmQnHdkcRaxNkZmlbK7zo9boGJImuyBkFXwpqrxu21TwIgLFy1J3T3mCpiTKQ2wd/m7TInC7A1u3nXrd1jXvO5duQa/zOpQ9beZ0UIuubmOXlD5kHBT/Qt7zFO7DFNwye+uFkCW1mSGRZyh/gUVZfXkK0LHRJml2QR48uCYn6oWu5FupxHPgJOXj35qjrvRw/SUlxCxvDuf0RY8EC/3Ot9h5mOjN5cSZ4jOwj29yoeKaNz5cf0miSE/Ky0X6zWCo4Ju00rHNiXBJQ1Oh3u4Q3vi0366cHVfb3dPKWaXRWnN1VD6ANEluIpiUOTs/xW80kFwjHdlcTiaQvItKKLepUFyD8CvzjInm0oR4RYl2Tzmx4RIevYwnXmxKjTw6DFW/ozuN0111GeI5jiYupqsJsHSnE0CtofdE4RByv11rVLutGpqJ+mHL5ZiLU6aIppCzZ4JtJSwtm0pli4ySw6DKOhOTe7yDbNYyvLa+w8+aOWHs9ccuXl1feukGqyuXi72Ja4fBpdIJQMqZ5NmNkG34lz7i4fT7LowdTnvQwzp2XoZLXYPa76ypPd2//orU7W5Gpd93Eo6iPD95sgJgmwAUVhEokPpiSbpyteLG9XO9jE4zJ2EwCklcrZuU6E86KyncvBL/6AHwQRm3ieZX6Dv2+iiRXyazQKpZSjVXKaKYHxmVYDiM3JicOEJvZfMGNqFr5cjTJi+m8wY5Vk6ok6VAqURoX4UQQfaFYqKvIjBtJr66gxBKtABd1iFylJSuWXlBfr7iVvxcexU+Mevqn1xD72SiF4y1YcnhPs9nF0LPjr0hKxY7PAJFgt9LRuuulLqqP6A1lyV1bKdOFGFudLgWW1wACsumUpmB5pAYJUlmYFJG76w0uSg2ZWwzdD5i2Jd1iUTb3HBQ1w8d86A1l5tk0i0yjLF2JqG/XK4/LU835/FmPrubcTJxJubMyOl18brtegtGfYhL9FZEANnEwnIRNkWNljFZMa/P8DcsEuviuYiQIkCH2WnChlppLIG4QJDnHvpuiCQh24rzLNpgRi9yRP9toTeGkePRQBD1d0nCDoPYid3BISaCq6SSLNpA5xzwFYh+EJnkzA6wSaqWmLxPqzSUlilKCTiEEzKlhImG0hU5i5I0hHTgZjndGPFv5UXNU9bVlFByV4H8aSwj8j7+6cvP9saa53+58+nfWiNZoOQwr/ZNKMQvwdZHhbz+6ue190/XGKnb3gelB/XTV3af/m7o2nuYc+UipvZ9Bje9Zrj+kvINDjCQO6zkmO62omH1b9dIvd8FCKTfHDib28kMWNde4VqvGKrzF1XIvfV8r1WuuVD5znfZasZGuOFEb+Ll/F8v/LIvVvkAeETTFGXynl+5sjeehVBBXE/ty4gS1/ZzfwXSF6JYfnnvlD+tztAcVRJ0xOf+yh69PpHuxN/kHVGJDhHfhgpKhM+mG1wk/1xV1AQ0wIrxUZUUTZiB9ihzLJ5hFK/ZC+uP4yIsksLfwiEIgrEybBlv8rItNNcyCHxzO23B5Iv6TqaMAK95pcU6bfi/VZ6mqg=="));
l._embedMap=new Ne;try{a=La.fromBytes(pd.uncompress(La.toBytes(a)));for(var d=a.readUnsignedShort(),e=new Ld;0<d--;){var f=a.readUnsignedInt(),r=La._new();a.readBytes(r,0,f);var h=e.readName(r);null!=h&&(e.name=h,e.onCreateItem=(M=l._embedMap,g(M,M.createTableItem)),e.decode(r))}l._embedMap.tableInit();var k=l.getEmbed("image_ui");null!=k&&(l.atlas.addAtlas("lovedna/ui.png"),l.texture.getRes("lovedna/ui.png")._file.bytes=La.toBytes(k));k=l.getEmbed("font_en");null!=k&&(l.texture.getRes("lovedna/font_en.png")._file.bytes=
La.toBytes(k))}catch(tg){}}};l.setVersion=function(a,b){I.setVersion(a,b)};l.disableVersion=function(){I.enableVersion=!1};l.getEmbed=function(a){return null==l._embedMap?null:l._embedMap.get(a)};l.loadMeta=function(a,b){if(l._init){""==I.getVersion(a)&&l.setVersion(a,l.version);var c=l.bytes.get(a);null==l._metasuccess&&(l._metasuccess=new K);if(null!=b){var d=l._metasuccess;null!=p[a]?d.setReserved(a,b):d.h[a]=b}c.addEventListener(B.complete._type,l.metaComplete)}};l.metaComplete=function(a){a=
a.target;if(a.enabled){var b=new Oc(0),c=b.decode(a.bytes);b.type==qd.TYPE&&l.meta.decode(c)}b=l._metasuccess;c=a._file.name;if(null!=p[c]?b.existsReserved(c):b.h.hasOwnProperty(c))b=l._metasuccess,c=a._file.name,b=null!=p[c]?b.getReserved(c):b.h[c],null!=b&&b(),l._metasuccess.remove(a._file.name)};l.prototype={};var Zb=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+10;a.set_resource(l.atlas.get(L.trapPath+"demonBlue.png"));a.addMeshRenderer()};Zb.get=
function(){return Zb.pool.get()};Zb.prototype=n(R.prototype,{end:function(){Zb.pool.set(this)}});var $b=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+1;a.set_resource(l.atlas.get(L.trapPath+"board.png"));a.addMeshRenderer()};$b.get=function(){return $b.pool.get()};$b.prototype=n(R.prototype,{end:function(){$b.pool.set(this)}});var ac=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+1;a.set_resource(l.atlas.get(L.trapPath+
"board2.png"));a.addMeshRenderer()};ac.get=function(){return ac.pool.get()};ac.prototype=n(R.prototype,{end:function(){ac.pool.set(this)}});var bc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+1;a.set_resource(l.atlas.get(L.trapPath+"gravity.png"));a.addMeshRenderer()};bc.get=function(){return bc.pool.get()};bc.prototype=n(R.prototype,{end:function(){bc.pool.set(this)}});var cc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=
this._renderQueue+10;a.set_resource(l.atlas.get(L.trapPath+"bullet.png"));a.addMeshRenderer()};cc.get=function(){return cc.pool.get()};cc.prototype=n(R.prototype,{end:function(){cc.pool.set(this)}});var rd=function(){H.call(this)};rd.__name__="client.displays.objects.Keyholes";rd.prototype=n(ra.prototype,{onAwake:function(){ra.prototype.onAwake.call(this)},onStart:function(){ra.prototype.onStart.call(this);this.addMeshRenderer()},set:function(a,b){b=l.atlas.get(L.trapPath+"keyHole"+(1>b?1:3<b?3:b)+
".png");this.material.setAtlas(b);this.geometryBuffer.position.clear();this.geometryBuffer.uv.clear();this.geometryBuffer.group.clear();if(b.enabled){for(var c=b.data.frame.z,d=b.data.frame.w,e=h._pool.get(),f=0,r=0;r<a;){var g=r++,k=g%4;g=m.floatToInt(g/4);e.set(k*(c-1.5),-g*d,0);this.geometryBuffer.position.push(h.instance.set(0,0,0).add(e));this.geometryBuffer.position.push(h.instance.set(c,0,0).add(e));this.geometryBuffer.position.push(h.instance.set(c,d,0).add(e));this.geometryBuffer.position.push(h.instance.set(0,
d,0).add(e));this.geometryBuffer.uv.push(b.data.getUV(0,0));this.geometryBuffer.uv.push(b.data.getUV(1,0));this.geometryBuffer.uv.push(b.data.getUV(1,1));this.geometryBuffer.uv.push(b.data.getUV(0,1));this.geometryBuffer.group.indices.push3(f,f+1,f+2);this.geometryBuffer.group.indices.push3(f,f+2,f+3);f+=4}this.geometryBuffer.update()}},__class__:rd});var dc=function(){R.call(this);this._positionOffset.set(0,-25,0);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+1;a.set_resource(l.atlas.get(L.trapPath+
"door.png"));a.addMeshRenderer();a=new w;this._holes=a.addComponent(rd);this._holes.material.renderQueue=this._renderQueue+2;a.get_transform().position.set(-17,40);a.setParent(this)};dc.get=function(){return dc.pool.get()};dc.prototype=n(R.prototype,{end:function(){dc.pool.set(this)},begin:function(a){R.prototype.begin.call(this,a);var b=a.data.params.getValue(4);a=a.data.params.getValue(5);this._holes.set(a,b)}});var ec=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+
1;a.set_resource(l.atlas.get(L.trapPath+"dragon.png"));a.addMeshRenderer()};ec.get=function(){return ec.pool.get()};ec.prototype=n(R.prototype,{end:function(){ec.pool.set(this)}});var wa=function(){H.call(this)};wa.__name__="lovedna.game.components.Renderer";wa.prototype=n(X.prototype,{cull:function(a){return!0},collectRenderObject:function(a){},onConstruct:function(){X.prototype.onConstruct.call(this);this.visible=!0;this.materials=[new bd];this.cameraCull=!0},onDestroy:function(){X.prototype.onDestroy.call(this);
if(null!=this.materials){for(var a=this.materials.length;0<a--;)this.materials[a].dispose(),this.materials[a]=null;this.materials=null}},get_material:function(){return this.materials[0]},__class__:wa});var ua=function(){this.identity()};ua.prototype={copy:function(a){return null==a?this:this.set(a.m0,a.m1,a.m2,a.m3,a.m4,a.m5,a.m6,a.m7,a.m8,a.m9,a.m10,a.m11,a.m12,a.m13,a.m14,a.m15)},set:function(a,b,c,d,e,f,r,h,g,k,n,m,p,l,q,t){this.m0=a;this.m1=b;this.m2=c;this.m3=d;this.m4=e;this.m5=f;this.m6=r;
this.m7=h;this.m8=g;this.m9=k;this.m10=n;this.m11=m;this.m12=p;this.m13=l;this.m14=q;this.m15=t;this._dirty=!0;return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},append:function(a,b){null==b&&(b=!1);if(null==a)return this;var c=this,d=a;b&&(c=a,d=this);return this.set(c.m0*d.m0+c.m4*d.m1+c.m8*d.m2+c.m12*d.m3,c.m1*d.m0+c.m5*d.m1+c.m9*d.m2+c.m13*d.m3,c.m2*d.m0+c.m6*d.m1+c.m10*d.m2+c.m14*d.m3,c.m3*d.m0+c.m7*d.m1+c.m11*d.m2+c.m15*d.m3,c.m0*d.m4+c.m4*d.m5+c.m8*d.m6+c.m12*
d.m7,c.m1*d.m4+c.m5*d.m5+c.m9*d.m6+c.m13*d.m7,c.m2*d.m4+c.m6*d.m5+c.m10*d.m6+c.m14*d.m7,c.m3*d.m4+c.m7*d.m5+c.m11*d.m6+c.m15*d.m7,c.m0*d.m8+c.m4*d.m9+c.m8*d.m10+c.m12*d.m11,c.m1*d.m8+c.m5*d.m9+c.m9*d.m10+c.m13*d.m11,c.m2*d.m8+c.m6*d.m9+c.m10*d.m10+c.m14*d.m11,c.m3*d.m8+c.m7*d.m9+c.m11*d.m10+c.m15*d.m11,c.m0*d.m12+c.m4*d.m13+c.m8*d.m14+c.m12*d.m15,c.m1*d.m12+c.m5*d.m13+c.m9*d.m14+c.m13*d.m15,c.m2*d.m12+c.m6*d.m13+c.m10*d.m14+c.m14*d.m15,c.m3*d.m12+c.m7*d.m13+c.m11*d.m14+c.m15*d.m15)},inverse:function(){var a=
this.getDeterminant();if(0==a)throw new u("non-invertible matrix");a=1/a;var b=this.m12*this.m10*this.m7-this.m8*this.m14*this.m7-this.m12*this.m6*this.m11+this.m4*this.m14*this.m11+this.m8*this.m6*this.m15-this.m4*this.m10*this.m15,c=this.m8*this.m13*this.m7-this.m12*this.m9*this.m7+this.m12*this.m5*this.m11-this.m4*this.m13*this.m11-this.m8*this.m5*this.m15+this.m4*this.m9*this.m15,d=this.m12*this.m9*this.m6-this.m8*this.m13*this.m6-this.m12*this.m5*this.m10+this.m4*this.m13*this.m10+this.m8*this.m5*
this.m14-this.m4*this.m9*this.m14,e=this.m13*this.m10*this.m3-this.m9*this.m14*this.m3-this.m13*this.m2*this.m11+this.m1*this.m14*this.m11+this.m9*this.m2*this.m15-this.m1*this.m10*this.m15,f=this.m8*this.m14*this.m3-this.m12*this.m10*this.m3+this.m12*this.m2*this.m11-this.m0*this.m14*this.m11-this.m8*this.m2*this.m15+this.m0*this.m10*this.m15,r=this.m12*this.m9*this.m3-this.m8*this.m13*this.m3-this.m12*this.m1*this.m11+this.m0*this.m13*this.m11+this.m8*this.m1*this.m15-this.m0*this.m9*this.m15,h=
this.m8*this.m13*this.m2-this.m12*this.m9*this.m2+this.m12*this.m1*this.m10-this.m0*this.m13*this.m10-this.m8*this.m1*this.m14+this.m0*this.m9*this.m14,g=this.m5*this.m14*this.m3-this.m13*this.m6*this.m3+this.m13*this.m2*this.m7-this.m1*this.m14*this.m7-this.m5*this.m2*this.m15+this.m1*this.m6*this.m15,k=this.m12*this.m6*this.m3-this.m4*this.m14*this.m3-this.m12*this.m2*this.m7+this.m0*this.m14*this.m7+this.m4*this.m2*this.m15-this.m0*this.m6*this.m15,n=this.m4*this.m13*this.m3-this.m12*this.m5*this.m3+
this.m12*this.m1*this.m7-this.m0*this.m13*this.m7-this.m4*this.m1*this.m15+this.m0*this.m5*this.m15,m=this.m12*this.m5*this.m2-this.m4*this.m13*this.m2-this.m12*this.m1*this.m6+this.m0*this.m13*this.m6+this.m4*this.m1*this.m14-this.m0*this.m5*this.m14,p=this.m9*this.m6*this.m3-this.m5*this.m10*this.m3-this.m9*this.m2*this.m7+this.m1*this.m10*this.m7+this.m5*this.m2*this.m11-this.m1*this.m6*this.m11,l=this.m4*this.m10*this.m3-this.m8*this.m6*this.m3+this.m8*this.m2*this.m7-this.m0*this.m10*this.m7-
this.m4*this.m2*this.m11+this.m0*this.m6*this.m11,q=this.m8*this.m5*this.m3-this.m4*this.m9*this.m3-this.m8*this.m1*this.m7+this.m0*this.m9*this.m7+this.m4*this.m1*this.m11-this.m0*this.m5*this.m11,t=this.m4*this.m9*this.m2-this.m8*this.m5*this.m2+this.m8*this.m1*this.m6-this.m0*this.m9*this.m6-this.m4*this.m1*this.m10+this.m0*this.m5*this.m10;this.m0=(this.m9*this.m14*this.m7-this.m13*this.m10*this.m7+this.m13*this.m6*this.m11-this.m5*this.m14*this.m11-this.m9*this.m6*this.m15+this.m5*this.m10*this.m15)*
a;this.m4=b*a;this.m8=c*a;this.m12=d*a;this.m1=e*a;this.m5=f*a;this.m9=r*a;this.m13=h*a;this.m2=g*a;this.m6=k*a;this.m10=n*a;this.m14=m*a;this.m3=p*a;this.m7=l*a;this.m11=q*a;this.m15=t*a;this._dirty=!0;return this},setProjection:function(a,b,c,d){null==d&&(d=1.78);null==c&&(c=60);null==b&&(b=1E3);null==a&&(a=.1);c=1/Math.tan(.008726646259971648*c);this.m0=c/d;this.m4=this.m3=this.m2=this.m1=0;this.m5=c;this.m9=this.m8=this.m7=this.m6=0;this.m10=(b+a)/(a-b);this.m11=-1;this.m13=this.m12=0;this.m14=
2*b*a/(a-b);this.m15=0;this._dirty=!0;return this},setOrtho:function(a,b,c,d,e,f){this.m0=2/(b-a);this.m4=this.m3=this.m2=this.m1=0;this.m5=2/(d-c);this.m9=this.m8=this.m7=this.m6=0;this.m10=-2/(f-e);this.m11=0;this.m12=-(b+a)/(b-a);this.m13=-(d+c)/(d-c);this.m14=-(f+e)/(f-e);this.m15=1;this._dirty=!0;return this},lookAt:function(a,b,c){null==b&&(b=h._pool.get().set(0,0,0));null==c&&(c=h.get_up());var d=h._pool.get(),e=h._pool.get(),f=h._pool.get(),r=h._pool.get();b=d.copy(b).sub(a);r.copy(b).normalize();
e.copy(b).normalize();e.cross(c).normalize();f.copy(e).cross(r).normalize();this.identity();this.m0=e.x;this.m4=e.y;this.m8=e.z;this.m1=f.x;this.m5=f.y;this.m9=f.z;this.m2=-r.x;this.m6=-r.y;this.m10=-r.z;this.appendTranslation(d.copy(a).scale(-1));return this},setTranslation:function(a){this.m12=a.x;this.m13=a.y;this.m14=a.z;this._dirty=!0;return this},getTranslation:function(a){null==a&&(a=h._pool.get());return a.set(this.m12,this.m13,this.m14)},setScale:function(a){this.m0=a.x;this.m5=a.y;this.m10=
a.z;this._dirty=!0;return this},getScale:function(a){null==a&&(a=h._pool.get());return a.set(1E-5>m.abs(this.m4)&&1E-5>m.abs(this.m8)?m.abs(this.m0):Math.sqrt(this.m0*this.m0+this.m4*this.m4+this.m8*this.m8),1E-5>m.abs(this.m1)&&1E-5>m.abs(this.m9)?m.abs(this.m5):Math.sqrt(this.m1*this.m1+this.m5*this.m5+this.m9*this.m9),1E-5>m.abs(this.m2)&&1E-5>m.abs(this.m6)?m.abs(this.m10):Math.sqrt(this.m2*this.m2+this.m6*this.m6+this.m10*this.m10))},setRotation:function(a){var b=a.x*a.x,c=a.x*a.y,d=a.x*a.z,
e=a.x*a.w,f=a.y*a.y,r=a.y*a.z,h=a.y*a.w,g=a.z*a.z;a=a.z*a.w;this.m0=1-2*(f+g);this.m1=2*(c+a);this.m2=2*(d-h);this.m4=2*(c-a);this.m5=1-2*(b+g);this.m6=2*(r+e);this.m8=2*(d+h);this.m9=2*(r-e);this.m10=1-2*(b+f);this._dirty=!0;return this},getRotation:function(a){null==a&&(a=xa._pool.get());var b=this.getRotationMatrix();return a.setFromAxes(b.m0,b.m4,b.m8,b.m1,b.m5,b.m9,b.m2,b.m6,b.m10)},getRotationMatrix:function(a){null==a&&(a=ua._pool.get());var b=0>this.m4*this.m5*this.m6*this.m7?-1:1,c=0>this.m8*
this.m9*this.m10*this.m11?-1:1,d=Math.sqrt,e=(0>this.m0*this.m1*this.m2*this.m3?-1:1)*d(this.m0*this.m0+this.m1*this.m1+this.m2*this.m2);b*=d(this.m4*this.m4+this.m5*this.m5+this.m6*this.m6);c*=d(this.m8*this.m8+this.m9*this.m9+this.m10*this.m10);0==c&&(c=1);return a.set(this.m0/e,this.m1/e,this.m2/e,0,this.m4/b,this.m5/b,this.m6/b,0,this.m8/c,this.m9/c,this.m10/c,0,0,0,0,1)},appendTranslation:function(a){1E-5>m.abs(a.x)&&1E-5>m.abs(a.y)&&1E-5>m.abs(a.z)||this.append(ua._pool.get().identity().setTranslation(a));
return this},appendScale:function(a){1E-5>m.abs(a.x-1)&&1E-5>m.abs(a.y-1)&&1E-5>m.abs(a.z-1)||this.append(ua._pool.get().identity().setScale(a));return this},appendRotation:function(a){0==a.x&&0==a.y&&0==a.z&&1==a.w||this.append(ua._pool.get().identity().setRotation(a));return this},appendTRS:function(a,b,c){null!=a&&this.appendTranslation(a);null!=b&&this.appendRotation(b);null!=c&&this.appendScale(c);return this},setTRS:function(a,b,c){return this.identity().appendTRS(a,b,c)},transformPoint:function(a,
b){null==b&&(b=!1);var c=a.x,d=a.y,e=a.z,f=1;b&&(f=1/(c*this.m3+d*this.m7+e*this.m11+this.m15));return a.set((c*this.m0+d*this.m4+e*this.m8+this.m12)*f,(c*this.m1+d*this.m5+e*this.m9+this.m13)*f,(c*this.m2+d*this.m6+e*this.m10+this.m14)*f)},fillFloat32Array:function(a,b){null==b&&(b=0);a[b++]=this.m0;a[b++]=this.m1;a[b++]=this.m2;a[b++]=this.m3;a[b++]=this.m4;a[b++]=this.m5;a[b++]=this.m6;a[b++]=this.m7;a[b++]=this.m8;a[b++]=this.m9;a[b++]=this.m10;a[b++]=this.m11;a[b++]=this.m12;a[b++]=this.m13;
a[b++]=this.m14;a[b++]=this.m15},getDeterminant:function(){return this.m3*this.m6*this.m9*this.m12-this.m2*this.m7*this.m9*this.m12-this.m3*this.m5*this.m10*this.m12+this.m1*this.m7*this.m10*this.m12+this.m2*this.m5*this.m11*this.m12-this.m1*this.m6*this.m11*this.m12-this.m3*this.m6*this.m8*this.m13+this.m2*this.m7*this.m8*this.m13+this.m3*this.m4*this.m10*this.m13-this.m0*this.m7*this.m10*this.m13-this.m2*this.m4*this.m11*this.m13+this.m0*this.m6*this.m11*this.m13+this.m3*this.m5*this.m8*this.m14-
this.m1*this.m7*this.m8*this.m14-this.m3*this.m4*this.m9*this.m14+this.m0*this.m7*this.m9*this.m14+this.m1*this.m4*this.m11*this.m14-this.m0*this.m5*this.m11*this.m14-this.m2*this.m5*this.m8*this.m15+this.m1*this.m6*this.m8*this.m15+this.m2*this.m4*this.m9*this.m15-this.m0*this.m6*this.m9*this.m15-this.m1*this.m4*this.m10*this.m15+this.m0*this.m5*this.m10*this.m15},get_data:function(){null==this._data&&(this._data=new Float32Array(16));if(this._dirty){var a=0;this._data[a++]=this.m0;this._data[a++]=
this.m1;this._data[a++]=this.m2;this._data[a++]=this.m3;this._data[a++]=this.m4;this._data[a++]=this.m5;this._data[a++]=this.m6;this._data[a++]=this.m7;this._data[a++]=this.m8;this._data[a++]=this.m9;this._data[a++]=this.m10;this._data[a++]=this.m11;this._data[a++]=this.m12;this._data[a++]=this.m13;this._data[a++]=this.m14;this._data[a++]=this.m15}return this._data}};var fc=function(){H.call(this)};fc.__name__="lovedna.game.components.LineRenderer";fc.prototype=n(wa.prototype,{setWidth:function(a,
b){this.startWidth=a;this.endWidth=b},clear:function(){this._count=0;this._dirty=!0;this.bindEvent(t.onUpdate,null)},setPosition:function(a,b){var c=this._points.getArrayElement(a);null==c&&(c=new h,this._points.setArrayElement(a,c));c.copy(b);++a;a>this._count&&(this._count=a);this._dirty=!0;1<this._count&&this.bindEvent(t.onUpdate,g(this,this.onUpdate))},cull:function(a){return!this.visible||!this._gbuffer.enabled||3>this._gbuffer.indexBuffer.length?!0:!1},collectRenderObject:function(a){for(var b=
0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){0==this.space?d.setMatrix(k.toString(k.M),this.transform.getLocalToWorld()):d.setMatrix(k.toString(k.M),fc._worldMat);var e=this._gbuffer;a.add(Xa._pool.get().set(d,e,0,0))}}},onAwake:function(){wa.prototype.onAwake.call(this);this._dirty=this.additive=!1;this._points=T.fromArray([]);this.endWidth=this.startWidth=2;this._count=0;this._gbuffer=new Cb;this._buffer=new bb;this._buffer.uv=new cb;this._gbuffer.set(this._buffer);
this.space=this.get_material().renderState.cullMode=0},onStart:function(){wa.prototype.onStart.call(this);this.additive?this.get_material().renderState.blendState.destinationColorBlendMode=1:this.get_material().renderState.blendState.destinationColorBlendMode=771;this.get_material().renderState._id=0},onUpdate:function(a){if(this._dirty)if(this._dirty=!1,this._buffer.clear(this._buffer.position),this._buffer.clear(this._buffer.uv),this._buffer.group.clear(),2>this._count)this._buffer.update();else if(null!=
Pa.current){var b=h.get_forward();Pa.current.transform.get_worldRotation().rotate(b);var c=h._pool.get(),d=h._pool.get(),e=h._pool.get();a=G._pool.get();for(var f=0,r=1/(this._count-1),g=(this.endWidth-this.startWidth)*r,k=0,n=this._count-1;k<n;){var m=k++,p=this._points.getArrayElement(m),l=this._points.getArrayElement(m+1);c.sub(l,p);d.cross(c,b).normalize().scale(this.startWidth+g*m);e.copy(p).add(d);this._buffer.position.push(e);e.copy(p).sub(d);this._buffer.position.push(e);p=m*r;l=0;null==l&&
(l=0);null==p&&(p=0);a.x=p;a.y=l;this._buffer.uv.push(a);m*=r;p=1;null==p&&(p=0);null==m&&(m=0);a.x=m;a.y=p;this._buffer.uv.push(a);this._buffer.group.indices.push3(f,f+1,f+3);this._buffer.group.indices.push3(f,f+3,f+2);f+=2}b=this._points.getArrayElement(this._count-1);e.copy(b).add(d);this._buffer.position.push(e);e.copy(b).sub(d);this._buffer.position.push(e);d=1;e=0;null==e&&(e=0);null==d&&(d=0);a.x=d;a.y=e;this._buffer.uv.push(a);e=d=1;null==e&&(e=0);null==d&&(d=0);a.x=d;a.y=e;this._buffer.uv.push(a);
this._buffer.update()}},__class__:fc});var gc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+10;a.set_resource(l.atlas.get(L.trapPath+"editTarget.png"));a.addMeshRenderer();this._line=this.addComponent(fc);this._line.space=1;this._line.get_material().renderQueue=this._renderQueue+9;this._line.get_material().color.w=.5;this._line.setWidth(2,2);this._start=new h;this._end=new h};gc.get=function(){return gc.pool.get()};gc.prototype=n(R.prototype,{end:function(){gc.pool.set(this)},
begin:function(a){R.prototype.begin.call(this,a);this._target=a;this._line.clear();this._start.copy(this._target.position);this._end.copy(this._target.owner.position);this._line.setPosition(0,this._start);this._line.setPosition(1,this._end)},syncTransform:function(){R.prototype.syncTransform.call(this);this._start.copy(this._target.position);this._line.setPosition(0,this._start);this._end.copy(this._target.owner.position);this._line.setPosition(1,this._end)}});var hc=function(){R.call(this);var a=
this.addComponent(P);a.material.renderQueue=this._renderQueue+10;a.set_resource(l.atlas.get(L.trapPath+"fire.png"));a.material.renderState.blendState.destinationColorBlendMode=1;a.addMeshRenderer()};hc.get=function(){return hc.pool.get()};hc.prototype=n(R.prototype,{end:function(){hc.pool.set(this)},begin:function(a){R.prototype.begin.call(this,a);this._r=0},udpate:function(){R.prototype.udpate.call(this);this._r+=1800*this.deltaTime;this.get_transform().rotation.setEulerAngles(0,0,this._r)}});var ic=
function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+10;a.set_resource(l.atlas.get(L.trapPath+"bird.png"));a.addMeshRenderer()};ic.get=function(){return ic.pool.get()};ic.prototype=n(R.prototype,{end:function(){ic.pool.set(this)}});var jc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+3;a.set_resource(l.atlas.get(L.trapPath+"gear.png"));a.addMeshRenderer()};jc.get=function(){return jc.pool.get()};jc.prototype=n(R.prototype,
{end:function(){jc.pool.set(this)}});var kc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+10;a.set_resource(l.atlas.get(L.trapPath+"gravity.png"));a.addMeshRenderer()};kc.get=function(){return kc.pool.get()};kc.prototype=n(R.prototype,{end:function(){kc.pool.set(this)}});var lc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+3;a.rectTransform.pivot.x=.4;a.set_resource(l.atlas.get(L.trapPath+"gun.png"));a.addMeshRenderer()};
lc.get=function(){return lc.pool.get()};lc.prototype=n(R.prototype,{end:function(){lc.pool.set(this)}});var mc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+3;a.rectTransform.pivot.x=.4;a.set_resource(l.atlas.get(L.trapPath+"gunHoming.png"));a.addMeshRenderer()};mc.get=function(){return mc.pool.get()};mc.prototype=n(R.prototype,{end:function(){mc.pool.set(this)}});var Pc=function(){H.call(this)};Pc.__name__="lovedna.game.components.TrailRenderer";Pc.prototype=
n(wa.prototype,{clear:function(){for(var a=this._capacity;0<a--;)this._points.get(a).life=0;this._index=0;this._gbuffer.indexBuffer.length=0},onConstruct:function(){wa.prototype.onConstruct.call(this);this.additive=!0;this.capacity=50;this.life=5;this.minDistance=.2;this.width=.5;this._color=new E(1,1,1,1);this._index=0;this.alignRotation=new h(0,0,0);this.emiting=!0},onAwake:function(){wa.prototype.onAwake.call(this);this._gbuffer=new Cb;this._buffer=new bb;this.get_material().renderQueue=20001;
this.get_material().renderState.depthState.writeEnabled=!1;this.align=this.textureMode=this.get_material().renderState.cullMode=0;this.colors=new Oe;this.colors.add(0,new E(1,1,1,1));this.colors.add(.5,new E(1,1,1,.8));this.colors.add(1,new E(1,1,1,0));this.sizes=new Pe;this.sizes.add(new sd(0,1));this.sizes.add(new sd(1,0))},onStart:function(){wa.prototype.onStart.call(this);3>this.capacity&&(this.capacity=3);this._capacity=this.capacity;this._distance=this.minDistance*this.minDistance;this._points=
new N;this._buffer.color=new Ab;this._buffer.uv=new cb;for(var a=0,b=this._capacity;a<b;){var c=a++;this._points.push(new Na);var d=0;0==this.textureMode?d=1-c/(this._capacity-1):1==this.textureMode&&(d=0==(c&1)?0:1);var e=G.instance,f=d,r=0;null==r&&(r=0);null==f&&(f=0);e.x=f;e.y=r;this._buffer.uv.push(e);e=G.instance;f=1;null==f&&(f=0);null==d&&(d=0);e.x=d;e.y=f;this._buffer.uv.push(e);d=2*c;c>=this._capacity-1||(this._buffer.group.indices.push3(d,d+2,d+3),this._buffer.group.indices.push3(d,d+3,
d+1))}this._gbuffer.set(this._buffer);this.bindEvent(t.onLateUpdate,g(this,this.onUpdate));this._transform=this.actor.get_transform();this._frameId=this._transform.transformFrame;0>=this.life&&(this.life=1);0>=this.width&&(this.width=1);this.additive?this.get_material().renderState.blendState.destinationColorBlendMode=1:this.get_material().renderState.blendState.destinationColorBlendMode=771;this.get_material().renderState._id=0},cull:function(a){return!this.visible||!this._gbuffer.enabled||3>this._gbuffer.indexBuffer.length?
!0:!1},collectRenderObject:function(a){for(var b=0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){d.setMatrix(k.toString(k.M),Pc._worldMat);var e=this._gbuffer;a.add(Xa._pool.get().set(d,e,0,0))}}},onUpdate:function(a){if(this.visible){this._frameId<this._transform.transformFrame&&(this._frameId=this._transform.transformFrame,a=this._transform.get_worldPosition(),null==this._lastPosition&&(this._lastPosition=(new h).copy(a)),a.distanceSquared(this._lastPosition)>this._distance&&
(this._lastPosition.copy(a),this.emiting&&(this._points.get(this._index++,!0).add(a,this.life),this._index>=this._points.get_length()&&(this._index=0))));0>=this.life&&(this.life=1);var b=this.actor.deltaTime,c=this._capacity;a=this._index-1;for(var d=0;0<c--;){var e=this._points.get(a--,!0);e.update(b);if(0>=e.life)break;++d}if(!(2>d)&&(a=this._index-1,b=h.get_forward(),0==this.align?(b.add(this.alignRotation),Pa.current.actor.get_transform().get_worldRotation().rotate(b)):1==this.align?(b.add(this.alignRotation),
this._transform.get_worldRotation().rotate(b)):2==this.align&&b.copy(this.alignRotation),c=d,--d,this._buffer.position.clear(),this._buffer.color.clear(),0<c)){for(e=this.transform.get_worldScale().x;0<c--;){var f=this._points.get(a--,!0);f.normal=b;0<c?(f.next=this._points.get(a,!0),f.next.prev=f):f.next=null;var r=1-c/d;this.colors.evaluate(r)&&(this._color.copy(this.colors.start),this._color.lerpTo(this.colors.end,this.colors.ratio));r=this.sizes.evaluate(r)*this.width*e;f.drawTo(this,r,this.align)}this._buffer.update();
c=6*m.floatToInt(.5*this._buffer.position.length-1);this._gbuffer.indexBuffer.length=c}}},add:function(a){this._buffer.position.push(a);this._buffer.color.push(this._color)},__class__:Pc});var Nb=function(){H.call(this)};Nb.__name__="lovedna.game.components.ParticleRenderer";Nb.prototype=n(wa.prototype,{getPosition:function(){return 1==this.space?this.transform.get_worldPosition():h.instance.set(0,0,0)},getRotation:function(){return 1==this.space?this.transform.get_worldRotation():this.transform.rotation},
clear:function(){for(var a=this._list.get_length();0<a--;){var b=this._list.getArrayElement(a);this._list.removeAt(a);Ob.temp.set(b)}this._dirty=!0},emit:function(a){null==a&&(a=1);if(1>a)return!1;if(this._list.get_length()<this._capacity){for(var b=this.transform.get_worldScale().x;0<a--;){this.shape.life=this._life;this.shape.update();var c=Ob.temp.get();c.startTime=this._life;c.life=this.life.get();c.time=c.life;c.sizeStart=this.sizeStart.get()*b;c.sizeEnd=this.sizeEnd.get()*b;c.position.copy(this.shape.position);
var d=(1==this.space?this.shape.rotation:this.transform.get_worldRotation()).rotate(h.get_forward()).scale(this.speed.get()*b);c.speed.copy(d);c.angleStart=.017453292519943295*this.angle.get();c.angleDelta=.017453292519943295*this.angleDelta.get();c.id=m.floatToInt(this.partId.get());c.id>=this._partSize&&(c.id=this._partSize);this._list.push(c);this._dirty=!0;if(this._list.get_length()>=this._capacity)return!1}return!0}return!1},cull:function(a){return!this.visible||!this._gbuffer.enabled||3>this._gbuffer.indexBuffer.length?
!0:!1},collectRenderObject:function(a){for(var b=0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){1==this.space?d.setMatrix(k.toString(k.M),Nb._worldMat):d.setMatrixHandler(k.toString(k.M),(M=this.transform,g(M,M.getLocalToWorld)));var e=this._gbuffer;a.add(Xa._pool.get().set(d,e,0,0))}}},onConstruct:function(){wa.prototype.onConstruct.call(this);this.additive=!0;this.capacity=50;this.life=new ib(4,5);this.sizeStart=new ib(1,1);this.sizeEnd=new ib(0,0);this.rateTime=.2;this.speed=
new ib(1,1);this._life=0;this.emiting=this.playing=!0;this.delay=0;this.angle=new ib(0,0);this.angleDelta=new ib(-100,100);this.space=1;this.partId=new ib(0,0);this._partSize=1},onAwake:function(){wa.prototype.onAwake.call(this);this.get_material().loadShader("particle");this.get_material().renderQueue=20002;this.get_material().renderState.depthState.writeEnabled=!1;this.get_material().renderState.cullMode=0;this._param0=new ta(0,1,1,0);this.acceleration=new h(0,0,0);this.get_material().setFloat3("acceleration",
this.acceleration);this.get_material().setFloat4("param0",this._param0);this.set_shape(new Qe(0,0));this._list=T.fromArray([])},onStart:function(){wa.prototype.onStart.call(this);this._gbuffer=new Cb;this._capacity=this.capacity;this._time=-this.delay;1>this._capacity&&(this._capacity=1);this._buffer=new bb;this._buffer.uv=new cb;this._buffer.tangent=new Ab;this._buffer.color=new Ab;this._buffer.color2=new Ab;this._buffer.color3=new Ab;for(var a=0,b=this._capacity;a<b;){var c=a++,d=G.instance,e=0,
f=1;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);d=G.instance;f=e=1;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);d=G.instance;e=1;f=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);d=G.instance;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);c*=4;this._buffer.group.indices.push3(c,c+1,c+2);this._buffer.group.indices.push3(c,c+2,c+3)}this._gbuffer.set(this._buffer);this.bindEvent(t.onUpdate,g(this,this.onUpdate));
this._gbuffer.indexBuffer.length=0;this.additive?this.get_material().renderState.blendState.destinationColorBlendMode=1:this.get_material().renderState.blendState.destinationColorBlendMode=771;this.get_material().renderState._id=0},onUpdate:function(a){if(this.playing){this._gbuffer.indexBuffer.length=0;var b=this.actor.deltaTime;this._life+=b;this._param0.x=this._life;this._time+=b;for(a=this._list.get_length();0<a--;){var c=this._list.getArrayElement(a);c.time-=b;0>=c.time&&(this._list.removeAt(a),
Ob.temp.set(c),this._dirty=!0)}0>=this.rateTime&&(this.rateTime=.01);for(;this._time>=this.rateTime;)this._time-=this.rateTime,this.emiting&&this.emit();if(this._dirty&&(a=this._list.get_length(),this._dirty=!1,this.count=a,0<a)){this._buffer.clear(this._buffer.position);this._buffer.clear(this._buffer.color);this._buffer.clear(this._buffer.color2);this._buffer.clear(this._buffer.color3);b=0;for(c=a;b<c;){var d=b++;this._list.getArrayElement(d).draw(this._buffer)}this._gbuffer.indexBuffer.length=
6*a;this._buffer.update()}this._gbuffer.indexBuffer.length=6*this.count}},set_shape:function(a){if(null==a)return this.shape;this.shape=a;this.shape.init(this);return this.shape},__class__:Nb});var Re=function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.name=a;this.size=b;this.index=c};Re.prototype={};var k={_new:function(a,b,c){null==c&&(c=0);null==b&&(b=0);b=new Re(a,b,c);c=k._nameMap;null!=p[a]?c.setReserved(a,b):c.h[a]=b;return b},toString:function(a){return a.name},add:function(a,b){return k._new(a.name+
b.name)}},nc=function(){R.call(this);this._shake=new h;this._skin=new w;this._skin.setParent(this);this._image=this._skin.addComponent(P);this._image.rectTransform.pivot.y=0;this._skin.get_transform().position.y=-10;this._image.set_resource(l.atlas.get(L.trapPath+"hero0.png"));this._image.addMeshRenderer();this._image.material.renderQueue=this._renderQueue+5;this._position=new h;var a=new w;a.setParent(this);this._trail=a.addComponent(Pc);this._trail.additive=!1;this._trail.get_material().setAtlas(l.atlas.get(L.effectPath+
"type0_2.png"));this._trail.get_material().renderQueue=this._renderQueue+4;this._trail.width=10;this._trail.life=.6;this._trail.minDistance=1;this._trail.capacity=30;this._trail.sizes.clear();this._trail.sizes.addValue(0,1);this._trail.sizes.addValue(1,.8);this._trail.get_material().color.w=.8;this._particle=a.addComponent(Nb);this._particle.get_material().renderQueue=this._renderQueue+4;this._particle.additive=!1;this._particle.capacity=10;a=this._particle.life;var b=.5,c=.8;null==c&&(c=0);null==
b&&(b=0);a.x=b;a.y=c;this._particle.emiting=!1;this._particle.get_material().setAtlas(l.atlas.get(L.effectPath+"QuestionTuto.png"));this._particle.get_material().setAtlas(l.atlas.get(L.effectPath+"mask1.png"),k.toString(k.NORMALMAP));a=this._particle.sizeStart;c=b=32;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._particle.sizeEnd;c=b=25;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._particle.speed;b=5;c=30;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._particle.angle;b=-30;c=30;null==c&&
(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._particle.angleDelta;b=-30;c=30;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=new w;a.get_transform().position.y=10;a.setParent(this);a.name="test";this._smokeParticle=a.addComponent(Nb);this._smokeParticle.get_material().renderQueue=this._renderQueue+4;this._smokeParticle.get_material().color.setRGBA(-858993409);this._smokeParticle.additive=!1;this._smokeParticle.capacity=20;a=this._smokeParticle.life;b=.2;c=.8;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._smokeParticle.emiting=
!1;this._smokeParticle.get_material().setAtlas(l.atlas.get(L.effectPath+"circle.png"));this._smokeParticle.get_material().setAtlas(l.atlas.get(L.effectPath+"mask1.png"),k.toString(k.NORMALMAP));a=this._smokeParticle.sizeStart;b=1;c=4;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._smokeParticle.sizeEnd;b=6;c=10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._smokeParticle.speed;b=40;c=70;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._smokeShape=this._smokeParticle.shape;this._smokeShape.minSize=
5;this._smokeShape.maxSize=10;a=this._smokeShape.rangeY;b=-.2;c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._smokeParticle.transform.position.y=-10};nc.get=function(){return nc.pool.get()};nc.prototype=n(R.prototype,{end:function(){nc.pool.set(this)},begin:function(a){R.prototype.begin.call(this,a);this._hero=a;this._smokeParticle.clear();this._trail.clear();this._particle.clear();this._shakeTime=this._partDistance=0;this._hero.self?(this._image.material.color.w=1,this._trail.get_material().color.w=
.5,this._particle.get_material().color.w=.8):(this._image.material.color.w=.5,this._trail.get_material().color.w=.2,this._particle.get_material().color.w=.2);this._fly=0;this._position.copy(a.position);this.get_transform().rotation.setEulerAngles(0,0,0);this._skin.get_transform().scale.set(1,1,1);a=Ia.skin.get(4).base;this._image.rectTransform.width=this._image.rectTransform.height=-1;this._image.set_resource(l.atlas.get(L.trapPath+""+a+".png"));this._enableSmoke=this._enableTrail=!0;this._trail.emiting=
this._enableTrail},syncTransform:function(){if(null!=this._hero&&this._hero.playing){this._position.copy(this.shape.position);var a=!1,b=0;this._hero.running?(this._shakeTime+=20*this.deltaTime,this._shake.y=.8*Math.sin(this._shakeTime),this._trail.transform.position.copy(this._shake),a=!0):this._hero.flying&&this._enableSmoke&&(b=1,a=!0);a&&this._enableTrail&&(this._partDistance+=this.get_transform().position.distance(this._position),100<this._partDistance&&(this._partDistance-=100,this._particle.emit()));
this._enableSmoke&&(this._hero.flyCount<this._fly||5==this._hero.flyCount)&&(b=6);if(0<b){this._smokeParticle.transform.position.x=10*(0<this._hero.velocity.x?1:-1);if(0<this.shape.scale.x){a=this._smokeShape.rangeX;var c=-.5,d=-.1;null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d}else a=this._smokeShape.rangeX,c=.1,d=.5,null==d&&(d=0),null==c&&(c=0),a.x=c,a.y=d;for(a=0;a<b;)a++,this._smokeParticle.emit()}this.get_transform().position.copy(this._position).add(this._positionOffset);this.get_transform().rotation.setEulerAngles(0,
0,this.shape.rotation);this._skin.get_transform().scale.copy(this.shape.scale);this._fly=this._hero.flyCount}}});var oc=function(){R.call(this);var a=this.addComponent(P);a.set_resource(l.atlas.get(L.trapPath+"demonRed.png"));a.material.renderQueue=this._renderQueue+10;a.addMeshRenderer()};oc.get=function(){return oc.pool.get()};oc.prototype=n(R.prototype,{end:function(){oc.pool.set(this)}});var pc=function(){R.call(this);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+10;a.set_resource(l.atlas.get(L.trapPath+
"ricochet.png"));a.addMeshRenderer()};pc.get=function(){return pc.pool.get()};pc.prototype=n(R.prototype,{end:function(){pc.pool.set(this)}});var qc=function(){R.call(this);this._positionOffset.set(0,-25,0);var a=this.addComponent(P);a.material.renderQueue=this._renderQueue+2;a.set_resource(l.atlas.get(L.trapPath+"treasure2.png"));a.addMeshRenderer()};qc.get=function(){return qc.pool.get()};qc.prototype=n(R.prototype,{end:function(){qc.pool.set(this)}});var Se=function(){w.call(this);this._points=
T.fromArray([]);this._index=0;var a=new w;a.setParent(this);this._backgroundRenderer=a.addComponent(zb);this._backgroundRenderer.mesh=new Ba;this._backGeom=new bb;this._backGeom.uv=new cb;this._backgroundRenderer.mesh.fromBuffer(this._backGeom);this._backgroundRenderer.get_material().renderQueue=0;this._backgroundRenderer.get_material().renderState.cullMode=0;this._backgroundRenderer.get_material().renderState.depthState.compareFunction=0;this._backgroundRenderer.get_material().renderState.depthState.writeEnabled=
!1;this._backgroundRenderer.get_material().setTexture(l.texture.get("image/map/back_castle.jpg").texture);this._wallRenderer=a.addComponent(zb);this._wallRenderer.mesh=new Ba;this._wallGeom=new bb;this._wallGeom.uv=new cb;this._wallRenderer.mesh.fromBuffer(this._wallGeom);this._wallRenderer.get_material().renderQueue=10003;this._wallRenderer.get_material().renderState.depthState.compareFunction=0;this._wallRenderer.get_material().renderState.depthState.writeEnabled=!1;this._wallRenderer.get_material().setTexture(l.texture.get("image/map/wall_castle.jpg").texture);
this._wallRenderer.get_material().renderState.cullMode=0;a=new w;a.setParent(this);this._decalRenderer=a.addComponent(zb);this._decalRenderer.mesh=new Ba;this._decalGeom=new bb;this._decalGeom.uv=new cb;this._decalRenderer.mesh.fromBuffer(this._decalGeom);this._decalRenderer.get_material().renderQueue=2E4;a=new w;a.setParent(this);this._gridRenderer=a.addComponent(zb);this._gridRenderer.visible=!1;this._gridRenderer.mesh=new Ba;this._gridGeom=new bb;this._gridGeom.uv=new cb;this._gridRenderer.mesh.fromBuffer(this._gridGeom);
this._gridRenderer.get_material().renderQueue=10002;this._gridRenderer.get_material().renderState.depthState.writeEnabled=!1;this._gridGeom.position.push(h.instance.set(0,0,0));this._gridGeom.position.push(h.instance.set(800,0,0));this._gridGeom.position.push(h.instance.set(800,500,0));this._gridGeom.position.push(h.instance.set(0,500,0));a=G.instance;var b=0,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);a=G.instance;b=1;c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);
a=G.instance;c=b=1;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);a=G.instance;b=0;c=1;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);this._gridGeom.group.indices.push3(0,1,2);this._gridGeom.group.indices.push3(0,2,3);this._gridGeom.update();this._gridRenderer.get_material().setTexture(l.texture.get("image/map/grid.png").texture);this._gridRenderer.get_material().setFloat4(k.toString(k.add(k.BASECOLORMAP,k._REGION)),new ta(0,0,16,10));this._gridRenderer.get_material().enableDefine(k.toString(k.add(k.BASECOLORMAP,
k._REGION)));this._gridRenderer.get_material().renderState.blendState.destinationColorBlendMode=1;this._uiOffset=new G};Se.prototype=n(w.prototype,{showGrid:function(a){this._gridRenderer.visible=a},load:function(a){this._map=a;this._gridRenderer.visible=!1;this._backGeom.position.clear();this._backGeom.uv.clear();this._backGeom.group.clear();this._wallGeom.position.clear();this._wallGeom.uv.clear();this._wallGeom.group.clear();this._decalGeom.position.clear();this._decalGeom.uv.clear();this._decalGeom.group.clear();
this._index=0;var b=1*m.randomInstance.getFloat();this._uiOffset.x=b;b=1*m.randomInstance.getFloat();this._uiOffset.y=b;var c=Da.width;b=Da.height;var d=Da.width/Da.height;1.6<d?c=500*d:b=800/d;d=.5*(c-50*a.width);for(var e=.5*(b-50*a.height),f=this._map.map,r=f.length;0<r--;){var g=f.getArrayElement(r);if(1==g.type||4==g.type){var k=g.x,n=g.y,p=50*g.x,l=p+50,q=50*g.y;g=q+50;0<d&&(0==k&&(p=-d-100),k+1==a.width&&(l=c+100));0<e&&(0==n&&(q=-e-200),n+1==a.height&&(g=b+200));var t=this._map.map.get(k-
1,n);(null==t?0:1!=t.type&&4!=t.type)?(t=this._map.map.get(k,n-1),t=null==t?!1:!(1==t.type||4==t.type)):t=!1;t?(t=this._map.map.get(k-1,n-1),t=null==t?!1:!(1==t.type||4==t.type)):t=!1;t?(this._points.push(h._pool.get().set(p,q+2)),this._points.push(h._pool.get().set(p+2,q))):this._points.push(h._pool.get().set(p,q));t=this._map.map.get(k+1,n);(null==t?0:1!=t.type&&4!=t.type)?(t=this._map.map.get(k,n-1),t=null==t?!1:!(1==t.type||4==t.type)):t=!1;t?(t=this._map.map.get(k+1,n-1),t=null==t?!1:!(1==t.type||
4==t.type)):t=!1;t?(this._points.push(h._pool.get().set(l-2,q)),this._points.push(h._pool.get().set(l,q+2))):this._points.push(h._pool.get().set(l-0,q));q=this._map.map.get(k+1,n);(null==q?0:1!=q.type&&4!=q.type)?(q=this._map.map.get(k,n+1),q=null==q?!1:!(1==q.type||4==q.type)):q=!1;q?(q=this._map.map.get(k+1,n+1),q=null==q?!1:!(1==q.type||4==q.type)):q=!1;q?(this._points.push(h._pool.get().set(l,g-2)),this._points.push(h._pool.get().set(l-2,g))):this._points.push(h._pool.get().set(l-0,g-0));l=this._map.map.get(k-
1,n);(null==l?0:1!=l.type&&4!=l.type)?(l=this._map.map.get(k,n+1),l=null==l?!1:!(1==l.type||4==l.type)):l=!1;l?(k=this._map.map.get(k-1,n+1),k=null==k?!1:!(1==k.type||4==k.type)):k=!1;k?(this._points.push(h._pool.get().set(p+2,g)),this._points.push(h._pool.get().set(p,g-2))):this._points.push(h._pool.get().set(p,g-0));this.drawPoints(this._points)}}this._wallGeom.update();this._index=0;f=-d-100;c+=100;r=-e-100;b+=100;0>d&&(f=-100,c=50*a.width);0>e&&(r=0,b=50*a.height);this._points.push(h._pool.get().set(f,
r));this._points.push(h._pool.get().set(c,r));this._points.push(h._pool.get().set(c,b));this._points.push(h._pool.get().set(f,b));this.drawPoints(this._points,this._backGeom);this._backGeom.update()},drawPoints:function(a,b){var c=a.get_length();if(!(3>c)){null==b&&(b=this._wallGeom);for(var d=0;d<c;){var e=d++,f=a.get(e);b.position.push(f);e=G.instance;var r=f.x/512;f=1-f.y/512;null==f&&(f=0);null==r&&(r=0);e.x=r;e.y=f;b.uv.push(e)}d=c-2;for(e=0;0<d--;)b.group.indices.push3(this._index,this._index+
e+1,this._index+e+2),++e;this._index+=c;a.clear()}}});var Te=function(){this._successList=T.fromArray([]);this._hitList=T.fromArray([])};Te.prototype={clear:function(){this._hitList.clear();this._successList.clear()},success:function(a){this._successList.push(a)},enter:function(a,b){var c=pb.get();c.phase=1;c.target=a;c.trap=b;this._hitList.push(c)},exit:function(a,b){var c=pb.get();c.phase=2;c.target=a;c.trap=b;this._hitList.push(c)},readHit:function(){if(0<this._hitList.get_length()){var a=this._hitList.pop();
a.dispose();return a}return null}};var z=function(){this.editCheckWall=new G(0,0);this.owner=this;this.drawLine=!0;this.instanceID=z._id++;this.enabled=!0;this._positionOffset=new h;this.position=new h;this.size=13;this._mapCellList=T.fromArray([]);this.rotation=this._colliderRadius=0;this.scale=new h(1,1,1);this.ignoreCollision=!1;this._min=new G;this._max=new G};z.prototype={dispose:function(){},setGrid:function(a,b){this.position.set(50*(a+.5)+this._positionOffset.x,50*(b+.5)+this._positionOffset.y,
0);null!=this.world&&this.updatePosition()},setMapObject:function(a){this.data=a;0==this._colliderRadius&&(this._colliderRadius=this.size);this.onSetEditSize();null!=this.data&&this.setGrid(this.data.x,this.data.y)},onAdd:function(a){this.world=a;this.enabled=!0;this.clearMapCell();this.updatePosition()},onRemove:function(a){this.rotation=0;this.scale.set(1,1);this.clearMapCell();this.dispose()},begin:function(a){},update:function(a){},lateUpdate:function(a){},onTriggerEnter:function(a,b){this.world.event.enter(a,
this)},onTriggerExit:function(a,b){this.world.event.exit(a,this)},render:function(){D.drawCircle(this.position,this._colliderRadius,null,this.enabled?E.RED:E.BLACK)},colliderWith:function(a){if(this.ignoreCollision||a.ignoreCollision||0>this._colliderRadius||0>a._colliderRadius)return!1;var b=z._v20,c=this.position.x,d=this.position.y;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b=z._v21;c=a.position.x;d=a.position.y;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b=z._v20.distanceSquared(z._v21);a=this._colliderRadius+
a._colliderRadius;return b<a*a},getColliderShapes:function(a){for(var b=this._mapCellList.get_length();0<b--;)for(var c=this._mapCellList.getArrayElement(b).shapes,d=c.get_length();0<d--;){var e=c.getArrayElement(d);e!=this&&e.colliderWith(this)&&a.add(e)}a.update()},editBegin:function(){},editUpdate:function(a,b){this.data.x=a;this.data.y=b;this.setMapObject(this.data);return!0},editChange:function(a){},onSetEditSize:function(){var a=this._min,b=-this._colliderRadius,c=-this._colliderRadius;null==
c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;c=b=this._colliderRadius;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c},onDispose:function(){this.editMode=!1;this.drawLine=!0;this.enabled=!1},clearMapCell:function(){for(var a=this._mapCellList.get_length();0<a--;)this._mapCellList.getArrayElement(a).removeShape(this);this._mapCellList.clear()},innerRender:function(){var a=h.get_up().copy(this.position);a.y+=4;var b=h.get_right().copy(this.position);b.y-=4;D.drawLine(a,b,E.WHITE);a.copy(this.position);
b.copy(this.position);a.x+=4;b.x-=4;D.drawLine(a,b,E.WHITE)},onSetup:function(a){},updatePosition:function(){for(var a=this._mapCellList.get_length();0<a--;){var b=this._mapCellList.getArrayElement(a);z._changed.h[b.index]=-1}this._mapCellList.clear();a=this.world.mapData.getByPosition(this.position.x+this._min.x,this.position.y+this._min.y);b=this.world.mapData.getByPosition(this.position.x+this._max.x,this.position.y+this._max.y);if(null!=a&&null!=b)if(a!=b)for(var c=a.x,d=b.x+1;c<d;)for(var e=
c++,f=a.y,r=b.y+1;f<r;){var h=f++;h=this.world.mapData.map.get(e,h);null!=h&&(this._mapCellList.push(h),h=h.index,z._changed.h.hasOwnProperty(h)?z._changed.h[h]+=1:z._changed.h[h]=1)}else this._mapCellList.push(a),a=a.index,z._changed.h.hasOwnProperty(a)?z._changed.h[a]+=1:z._changed.h[a]=1;for(a=z._changed.keys();a.hasNext();)c=a.next(),b=z._changed.h[c],z._changed.remove(c),c=this.world.mapData.map.getArrayElement(c),0!=b&&(0<b?c.addShape(this):c.removeShape(this))}};var td=function(){H.call(this)};
td.__name__="client.physics.GameWorld";td.prototype=n(X.prototype,{load:function(a){this._doclear();this._ready=!1;this.mapData=a;this.mapData.clearRuntime();this._array2=this.mapData.map;for(var b=a.objects.get_length();0<b--;){var c=a.objects.getArrayElement(b),d=ud.get(c);null!=d&&(this.add(d),5==c.type&&(this.door=d))}if(null!=this.door){this.hero=Pb.get();this.hero.self=!0;this.hero.setMapObject(this.door.data);if(null!=this.onInit)this.onInit();this.param.hero=this.hero;this._finish=this._started=
this._clear=!1;this._startWaitFrame=-1;this._ready=!0;this.bindEvent(t.onUpdate,g(this,this.onUpdate));this.param.start();this._fixedTime=.016666666666666666;this._time=0;this.event.clear()}},add:function(a){this._addedMap.h.hasOwnProperty(a.instanceID)||(this._addedMap.h[a.instanceID]=a,this._addShapes.push(a))},remove:function(a){this._addedMap.h.hasOwnProperty(a.instanceID)&&(this._addedMap.remove(a.instanceID),this._removeShapes.push(a))},pause:function(){this.bindEvent(t.onUpdate,null);this._started&&
(this._running=!1)},finish:function(){this._finish=!0},clear:function(){this._clear=!0},action:function(){if(this._ready){if(this._ready=!1,this._running=!0,this._started=!1,this._time=0,this._startWaitFrame=6,this._actionFrame=-1,this.hero.setMapObject(this.door.data),this.add(this.hero),null!=this.onGameStart)this.onGameStart()}else this._finish||this.param.frame<this._actionFrame+4||(this._actionFrame=this.param.frame,this.param.pressed=!0)},onAwake:function(){X.prototype.onAwake.call(this);this._array2=
new Hd(16,10);this._addedMap=new ba;this._updateShapes=T.fromArray([]);this._addShapes=T.fromArray([]);this._removeShapes=T.fromArray([]);this._tempShapes=T.fromArray([]);this._running=!1;this.param=new Ue(this);this._finish=!1;this.event=new Te},onUpdate:function(a){this._finish&&(this.bindEvent(t.onUpdate,null),this._running=!1);a=this._addShapes.get_length();if(0<a){this._tempShapes.copyFastArray(this._addShapes);this._addShapes.clear();for(var b=0;b<a;){var c=b++;c=this._tempShapes.getArrayElement(c);
c.editMode=!1;c.drawLine=!0;if(null!=this.onAddShape)this.onAddShape(c);c.onAdd(this);c.onSetup(this.param);this._updateShapes.push(c);this._started&&c.begin(this.param)}}a=this._removeShapes.get_length();if(0<a)for(this._tempShapes.copyFastArray(this._removeShapes),this._removeShapes.clear();0<a--;){b=this._tempShapes.getArrayElement(a);if(null!=this.onRemoveShape)this.onRemoveShape(b);b.onRemove(this);this._updateShapes.remove(b)}if(0<this._startWaitFrame){for(this._time+=this.actor.deltaTime;this._time>=
this._fixedTime;)this._time-=this._fixedTime,this._startWaitFrame--;if(1>this._startWaitFrame)for(this._started=!0,this._time=0,a=this._updateShapes.get_length();0<a--;)this._updateShapes.getArrayElement(a).begin(this.param)}if(this._started)for(this._time+=this.actor.deltaTime;this._time>=this._fixedTime;)this._time-=this._fixedTime,this.loopUpdate(.016666666666666666);for(a=this._updateShapes.get_length();0<a--;)b=this._updateShapes.getArrayElement(a),b.drawLine&&(b.render(),b.innerRender());if(null!=
this.onRender)this.onRender();null!=q.getKey(65)?this.actor.timeScale=.5:this.actor.timeScale=1.2;this._clear&&this._doclear()},loopUpdate:function(a){if(this._running)for(var b=1;0<b--&&this._running;){this.param.update(a);for(var c=this._updateShapes.get_length();0<c--;){var d=this._updateShapes.getArrayElement(c);d.enabled&&d.update(this.param)}this.param.pressed=!1;for(c=this._updateShapes.get_length();0<c--;)d=this._updateShapes.getArrayElement(c),d.enabled&&d.lateUpdate(this.param);for(;;){c=
this.event.readHit();if(null==c)break;if(null!=this.onTrigger)this.onTrigger(c)}}},_doclear:function(){this._running=!1;this.bindEvent(t.onUpdate,null);this.param.pressed=!1;this._startWaitFrame=-1;this._ready=!1;for(var a=this._updateShapes.get_length();0<a--;){var b=this._updateShapes.getArrayElement(a);b.dispose();b.onRemove(this);if(null!=this.onRemoveShape)this.onRemoveShape(b)}this._updateShapes.clear();for(a=this._addShapes.get_length();0<a--;)b=this._addShapes.getArrayElement(a),b.dispose(),
b.onRemove(this);this._addShapes.clear();for(a=this._removeShapes.get_length();0<a--;)if(b=this._removeShapes.getArrayElement(a),b.dispose(),b.onRemove(this),null!=this.onRemoveShape)this.onRemoveShape(b);this._removeShapes.clear();for(a=new $c(this._addedMap);a.hasNext();)b=a.next(),this._addedMap.remove(b.key)},__class__:td});var pb=function(){this.instanceID=pb._id++};pb.get=function(){return pb.pool.get()};pb.prototype={dispose:function(){pb.pool.set(this)}};var Ue=function(a){this.world=a;this.actionFrameList=
T.fromArray([]);this.pressed=!1;this.frame=this.deltaTime=0};Ue.prototype={start:function(){this.frame=0;this.actionFrameList.clear();this.pressed=!1},update:function(a){this.frame++;this.deltaTime=a},record:function(a){this.hero==a&&this.actionFrameList.push(this.frame)}};var rc=function(){z.call(this);this._center=new h(0,0,0);this._colliderRadius=11;this.type=102};rc.get=function(){return rc.pool.get()};rc.prototype=n(z.prototype,{dispose:function(){rc.pool.set(this);this.onDispose()},update:function(a){this._angle+=
114.47619047619047*a.deltaTime;360<this._angle&&(this._angle-=360);var b=-(.017453292519943295*this._angle+this._baseAngle);a=Math.cos(b)*this._length;b=Math.sin(b)*this._length;this.position.copy(this._center);this.position.x+=a;this.position.y+=b;this.updatePosition()},render:function(){D.drawCircle(this.position,20,null,E.BLACK);D.drawCircle(this.position,this._colliderRadius,null,this.enabled?E.RED:E.BLACK)},setMapObject:function(a){z.prototype.setMapObject.call(this,a);this.editMode&&null!=this._editDot&&
this._editDot.relateChanged()},editChange:function(a){a||(this._dir++,this.init(),this.editMode&&null!=this._editDot&&this._editDot.relateChanged())},editUpdate:function(a,b){a=z.prototype.editUpdate.call(this,a,b);this.editMode&&null!=this._editDot&&this._editDot.relateChanged();return a},onSetup:function(a){this._angle=0;this._moveDistance=this.data.params.getValue(1,3);3>this._moveDistance&&(this._moveDistance=3);this._dir=this.data.params.getValue(2,0)%4;this.init();this._length=50*this._moveDistance;
this._center.scale(50*this._moveDistance).add(this.position)},onAdd:function(a){z.prototype.onAdd.call(this,a);this.editMode&&(this._editDot=Db.get(),a.add(this._editDot),this._editDot.setRelate(this))},onDispose:function(){z.prototype.onDispose.call(this);this._editDot=null},init:function(){0>this._dir&&(this._dir+=4);0==this._dir?(this._center.set(1,0),this._baseAngle=3.141592653589793):1==this._dir?(this._center.set(0,1),this._baseAngle=1.5707963267948966):2==this._dir?(this._center.set(-1,0),
this._baseAngle=0):3==this._dir&&(this._center.set(0,-1),this._baseAngle=-1.5707963267948966);this.data.params.setValue(2,this._dir)}});var Qb=function(){z.call(this);this.type=2;var a=this._min,b=-40,c=-10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c};Qb.get=function(){return Qb.pool.get()};Qb.prototype=n(z.prototype,{dispose:function(){Qb.pool.set(this);this.onDispose()},render:function(){D.drawPlane(this.position,h.get_right().scale(50),
h.get_up(),this.enabled?E.GREEN:E.GRAY)},setMapObject:function(a){this._positionOffset.x=25;this._positionOffset.y=25;z.prototype.setMapObject.call(this,a)},editChange:function(a){if(!a){a=Rb.get();var b=Qa.get();b.copy(this.data);b.type=3;a.setMapObject(b);this.world.add(a);this.world.remove(this)}},onSetup:function(a){this.ignoreCollision=!0;a=this.world.mapData.map.get(this.data.x,this.data.y);null!=a&&a.setTypeIfNotWall(this.type);a=this.world.mapData.map.get(this.data.x+1,this.data.y);null!=
a&&a.setTypeIfNotWall(this.type)},onSetEditSize:function(){var a=this._min,b=-40,c=-10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}});var Rb=function(){z.call(this);this.type=3;var a=this._min,b=-40,c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-1;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c};Rb.get=function(){return Rb.pool.get()};Rb.prototype=n(z.prototype,{dispose:function(){Rb.pool.set(this);this.onDispose()},render:function(){D.drawPlane(this.position,
h.get_right().scale(50),h.get_up(),this.enabled?E.GREEN:E.GRAY)},setMapObject:function(a){this._positionOffset.x=25;this._positionOffset.y=25;z.prototype.setMapObject.call(this,a)},editChange:function(a){if(!a){a=Qb.get();var b=Qa.get();b.copy(this.data);b.type=2;a.setMapObject(b);this.world.add(a);this.world.remove(this)}},onSetup:function(a){this.ignoreCollision=!0;a=this.world.mapData.map.get(this.data.x,this.data.y);null!=a&&a.setTypeIfNotWall(this.type);a=this.world.mapData.map.get(this.data.x+
1,this.data.y);null!=a&&a.setTypeIfNotWall(this.type)},onSetEditSize:function(){var a=this._min,b=-40,c=-10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}});var sc=function(){z.call(this);this._colliderRadius=20;this.type=13};sc.get=function(){return sc.pool.get()};sc.prototype=n(z.prototype,{dispose:function(){sc.pool.set(this);this.onDispose()},update:function(a){var b=!0;a.hero.flying&&a.hero.running&&(b=!1);b?(this._time+=a.deltaTime,
3<this._time&&(this._time-=3,this.world.event.enter(a.hero,this))):this._time=0},render:function(){D.drawCircle(this.position,25,null,E.BLACK);0<this._time&&D.drawCircle(this.position,this._time/3*25,null,E.RED)},onSetup:function(a){this._time=0;this.ignoreCollision=!0}});var Eb=function(){z.call(this);this._colliderRadius=6;this._dir=new G;var a=this._colliderRadius;this._wallCheck00=new Ja(a,-1,-1);this._wallCheck11=new Ja(a,1,1);this._wallCheck10=new Ja(a,1,-1);this._wallCheck01=new Ja(a,-1,1);
this._wallCheck00.crossBoard=!1;this._wallCheck10.crossBoard=!1;this._wallCheck01.crossBoard=!1;this._wallCheck11.crossBoard=!1;this.type=130};Eb.get=function(){return Eb.pool.get()};Eb.prototype=n(z.prototype,{dispose:function(){Eb.pool.set(this);this.onDispose()},start:function(a,b){this._dir.copy(b).normalize();this.position.x+=this._dir.x*(.51*this._colliderRadius+25.00001+136.625*a);this.position.y+=this._dir.y*(.51*this._colliderRadius+25.00001+136.625*a)},update:function(a){a=a.deltaTime;this._wallCheck00.setCurrent(this.position);
this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);var b=h.instance.set(136.625*this._dir.x,136.625*this._dir.y,0);this.position.x+=b.x*a;this.position.y+=b.y*a;this._wallCheck00.update(this.position,b,this.world.mapData);this._wallCheck11.update(this.position,b,this.world.mapData);this._wallCheck10.update(this.position,b,this.world.mapData);this._wallCheck01.update(this.position,b,this.world.mapData);0<this._wallCheck00.density||
0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density?(this.enabled=!1,this.world.remove(this)):(this.updatePosition(),this._time+=10*a,a=.1*Math.sin(this._time),this.scale.x=1+a,this.scale.y=1-a)},onSetup:function(a){z.prototype.onSetup.call(this,a);this._time=0}});var tc=function(){z.call(this);this._colliderRadius=11;this.size=13;this.type=100};tc.get=function(){return tc.pool.get()};tc.prototype=n(z.prototype,{dispose:function(){tc.pool.set(this);this.onDispose()},
render:function(){D.drawCircle(this.position,this._colliderRadius,null,this.enabled?E.RED:E.BLACK)}});var uc=function(){z.call(this);this.size=30;this._positionOffset.set(25,-25+this.size);this._colliderRadius=30;var a=this.editCheckWall,b=2,c=2;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this.type=5};uc.get=function(){return uc.pool.get()};uc.prototype=n(z.prototype,{render:function(){D.drawPlane(this.position,h.get_right().scale(this.size),h.get_up().scale(this.size),this.enabled?E.WHITE:E.GRAY)},
dispose:function(){uc.pool.set(this);this.onDispose()},onSetup:function(a){this.ignoreCollision=!0}});var vc=function(){z.call(this);this.type=12;this._colliderRadius=20;this.size=6;this.ignoreCollision=!0;this._fireDirection=new G;this._preTime=.3342482464165904};vc.get=function(){return vc.pool.get()};vc.prototype=n(z.prototype,{dispose:function(){vc.pool.set(this);this.onDispose()},render:function(){D.drawCircle(this.position,this.size,null,E.BLACK)},update:function(a){this._time-=a.deltaTime;
0>=this._time&&(6>this._count?(a=wc.get(),a.owner=this,a.setMapObject(this.data),a.start(-this._time,this._fireDirection,(6-this._count)*this._preTime),this.world.add(a),this._time+=this._preTime,this._count++):(this._time+=1.9528438548337905-this._preTime,this._count=0))},editChange:function(a){a||(this._dir++,this.init())},onSetup:function(a){this.ignoreCollision=!0;this._count=this._time=0;this._dir=this.data.params.getValue(2,0);this.init()},init:function(){this._dir%=4;0>this._dir&&(this._dir+=
4);if(0==this._dir){var a=this._fireDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this._dir?(a=this._fireDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this._dir?(a=this._fireDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this._dir&&(a=this._fireDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this.rotation=90*this._dir;this.data.params.setValue(2,this._dir)}});var Db=function(){z.call(this);this.size=20;this.type=150;this._colliderRadius=
20;this._moveDirection=new G;var a=this._min,b=-this._colliderRadius,c=-this._colliderRadius;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;c=b=this._colliderRadius;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c};Db.get=function(){return Db.pool.get()};Db.prototype=n(z.prototype,{dispose:function(){Db.pool.set(this);this.onDispose()},setRelate:function(a){this._relate=this.owner=a;this.data=Qa.get();this.data.copy(this._relate.data);this.relateChanged()},relateChanged:function(){this.distance=this._relate.data.params.getValue(1,
3);3>this.distance&&(this.distance=3);this.direction=this._relate.data.params.getValue(2,0)%4;0>this.direction&&(this.direction+=4);if(0==this.direction){var a=this._moveDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this.direction?(a=this._moveDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this.direction?(a=this._moveDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this.direction&&(a=this._moveDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),
a.x=b,a.y=c);a=this._relate.data.x;b=m.floatToInt(this._moveDirection.x*this.distance);this.data.x=a+b;a=this._relate.data.y;b=m.floatToInt(this._moveDirection.y*this.distance);this.data.y=a+b;this.setGrid(this.data.x,this.data.y)},setMapObject:function(a){z.prototype.setMapObject.call(this,a);this.relateChanged()},editBegin:function(){},editUpdate:function(a,b){if(0!=this._moveDirection.x){b=m.floatToInt((a-this._relate.data.x)*this._moveDirection.x);if(3>b)return!1;this._relate.data.params.setValue(1,
b);return z.prototype.editUpdate.call(this,a,this._relate.data.y)}a=m.floatToInt((b-this._relate.data.y)*this._moveDirection.y);if(3>a)return!1;this._relate.data.params.setValue(1,a);return z.prototype.editUpdate.call(this,this._relate.data.x,a)},render:function(){D.drawCircle(this.position,this._colliderRadius,null,E.YELLOW)}});var xc=function(){z.call(this);this.type=106;this._colliderRadius=20;this._shootDirection=new G;this._moveDirection=new G;this._basePosition=new G;this._p1=new h;this._p2=
new h;this._p3=new h};xc.get=function(){return xc.pool.get()};xc.prototype=n(z.prototype,{dispose:function(){xc.pool.set(this);this.onDispose()},update:function(a){var b=a.deltaTime;this._shootTime-=b;if(0>=this._shootTime){var c=Eb.get();c.setMapObject(this.data);a=a.world.mapData.getByPosition(this.position.x,this.position.y);c.position.set(50*(a.x+.5),50*(a.y+.5));c.start(-this._shootTime,this._shootDirection);this.world.add(c);this._shootTime+=1.0027447392497713}this._time+=b;this._time>this._totalTime&&
(this._time-=this._totalTime);b=this._time/this._totalTime;b=49.863138686131386*this._totalTime*(.5>b?2*b:1-2*(b-.5))*.5;this.position.x=this._basePosition.x+this._moveDirection.x*b;this.position.y=this._basePosition.y+this._moveDirection.y*b},render:function(){this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);var a=xa.instance.setEulerAngles(0,0,this._shootDirection.get_angle());a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);
this._p3.add(this.position);D.drawTriangle(this._p1,this._p2,this._p3,E.BLACK)},onSetup:function(a){this.ignoreCollision=!0;this._shootTime=0;a=this.data.params.getValue(2,0)%4;0>a&&(a+=4);if(0==a){a=this._shootDirection;var b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==a?(a=this._shootDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this.rotation=90):2==a?(a=this._shootDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this.scale.x=-1):3==a&&(a=this._shootDirection,
b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this.rotation=-90);a=this.data.params.getValue(3,0)%4;0>a&&(a+=4);if(0==a){b=this._moveDirection;c=1;var d=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d}else 1==a?(b=this._moveDirection,c=0,d=1,null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d):2==a?(b=this._moveDirection,c=-1,d=0,null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d):3==a&&(b=this._moveDirection,c=0,d=-1,null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d);this._moveDistance=this.data.params.getValue(1,1);1>this._moveDistance&&
(this._moveDistance=1);this._totalTime=2.0054894784995425*this._moveDistance;this._basePosition.x=this.position.x;this._basePosition.y=this.position.y;this._time=0;this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);a=xa.instance.setEulerAngles(0,0,90*a);a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position)}});var wc=function(){z.call(this);this.type=131;this._colliderRadius=12;this._dir=new G;this._totalTime=
1.6};wc.get=function(){return wc.pool.get()};wc.prototype=n(z.prototype,{dispose:function(){wc.pool.set(this);this.onDispose()},start:function(a,b,c){null==c&&(c=0);this._dir.copy(b).normalize();this.position.x+=this._dir.x*(this._colliderRadius+1E-5+74.79470802919708*a);this.position.y+=this._dir.y*(this._colliderRadius+1E-5+74.79470802919708*a);this.rotation=this._dir.get_angle();this._totalTime=c;this._totalTime-=a},update:function(a){a=a.deltaTime;var b=h.instance.set(74.79470802919708*this._dir.x,
74.79470802919708*this._dir.y,0);this.position.x+=b.x*a;this.position.y+=b.y*a;this.updatePosition();this._totalTime-=a;0>=this._totalTime&&(this.enabled=!1,this.world.remove(this))},onSetup:function(a){z.prototype.onSetup.call(this,a);this.rotation=this._dir.get_angle()}});var qb=function(){this.a=new G;this.b=new G};qb.prototype={intersect:function(a,b){var c=a,d=b;null==d&&(c=this,d=a);a=c.a;c=c.b;b=d.a;var e=d.b;d=(a.x-b.x)*(c.y-b.y)-(a.y-b.y)*(c.x-b.x);var f=(a.x-e.x)*(c.y-e.y)-(a.y-e.y)*(c.x-
e.x);if(0<=d*f)return null;b=(b.x-a.x)*(e.y-a.y)-(b.y-a.y)*(e.x-a.x);if(0<=b*(b+d-f))return null;f=b/(f-d);b=qb._helperVec2;d=a.x+f*(c.x-a.x);a=a.y+f*(c.y-a.y);null==a&&(a=0);null==d&&(d=0);b.x=d;b.y=a;return qb._helperVec2}};var yc=function(){z.call(this);this.type=103;this.velocity=new h;this._moveDirection=new h;this.size=this._colliderRadius=11;this._wallCheck00=new Ja(this.size,-1,-1);this._wallCheck11=new Ja(this.size,1,1);this._wallCheck10=new Ja(this.size,1,-1);this._wallCheck01=new Ja(this.size,
-1,1);this._wallCheck00.ignoreBoard=!0;this._wallCheck10.ignoreBoard=!0;this._wallCheck01.ignoreBoard=!0;this._wallCheck11.ignoreBoard=!0;this._distanceToWall=1E-5;this._moveLine=new qb;this._checkLine=new qb;this._nextPosition=new h;this._tracePosition=new h;this._totalAcc=new h;this._moveAdd=new h};yc.get=function(){return yc.pool.get()};yc.prototype=n(z.prototype,{dispose:function(){yc.pool.set(this);this.onDispose()},update:function(a){var b=this.world.mapData.getByPosition(this.position.x,this.position.y);
if(null==b||1!=b.type&&4!=b.type){b=a.deltaTime;this._tracePosition.copy(a.hero.position);a=h._pool.get().copy(this._tracePosition).sub(this.position);var c=this._moveDirection.angle(a,h.get_forward());a.normalize();this._rotation+=b*c*4;a=G.instance;c=1;var d=0;null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.set_angle(this._rotation);this._moveDirection.set(a.x,a.y,0).normalize();a=h._pool.get().copy(this._moveDirection).scale(100).add(this.position);D.drawLine(this.position,a);this._wallCheck00.setCurrent(this.position);
this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);a=121.5*this._moveDirection.x*b;b*=121.5*this._moveDirection.y;this._nextPosition.copy(this.position);this._nextPosition.x+=a+this._moveAdd.x;this._nextPosition.y+=b+this._moveAdd.y;this._moveAdd.set(0,0,0);this._wallCheck00.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck11.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck10.update(this._nextPosition,
this.velocity,this.world.mapData);this._wallCheck01.update(this._nextPosition,this.velocity,this.world.mapData);if(0<this._wallCheck00.density||0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density)if(c=!1,0<this._wallCheck00.density&&0<this._wallCheck01.density&&(this._nextPosition.x=this._wallCheck00.currentCell.getLeft(this._colliderRadius+this._distanceToWall),c=!0),0<this._wallCheck00.density&&0<this._wallCheck10.density&&(this._nextPosition.y=this._wallCheck00.currentCell.getBottom(this._colliderRadius+
this._distanceToWall),c=!0),0<this._wallCheck10.density&&0<this._wallCheck11.density&&(this._nextPosition.x=this._wallCheck10.nextCell.getLeft(-this._colliderRadius-this._distanceToWall),c=!0),0<this._wallCheck11.density&&0<this._wallCheck01.density&&(this._nextPosition.y=this._wallCheck11.nextCell.getBottom(-this._colliderRadius-this._distanceToWall),c=!0),!c){c=this._wallCheck00;if(0<c.density){d=c.getChangeType();if(3==d){this._moveLine.a.copy(c.currentPoint);this._moveLine.b.copy(c.nextPoint);
d=this._checkLine.a;var e=c.nextCell.getRight(),f=c.nextCell.getTop();null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;d=this._checkLine.b;e=c.nextCell.getLeft();f=c.nextCell.getTop();null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;d=null!=this._moveLine.intersect(this._checkLine)?2:1}1==d?this._nextPosition.x=c.nextCell.getRight(this._colliderRadius+this._distanceToWall):2==d&&(this._nextPosition.y=c.nextCell.getTop(this._colliderRadius+this._distanceToWall))}c=this._wallCheck10;0<c.density&&(d=c.getChangeType(),
3==d&&(this._moveLine.a.copy(c.currentPoint),this._moveLine.b.copy(c.nextPoint),d=this._checkLine.a,e=c.nextCell.getLeft(),f=c.nextCell.getTop(),null==f&&(f=0),null==e&&(e=0),d.x=e,d.y=f,d=this._checkLine.b,e=c.nextCell.getRight(),f=c.nextCell.getTop(),null==f&&(f=0),null==e&&(e=0),d.x=e,d.y=f,d=null!=this._moveLine.intersect(this._checkLine)?2:1),1==d?this._nextPosition.x=c.nextCell.getLeft(-this._colliderRadius-this._distanceToWall):2==d&&(this._nextPosition.y=c.nextCell.getTop(this._colliderRadius+
this._distanceToWall)));c=this._wallCheck01;0<c.density&&(d=c.getChangeType(),3==d&&(this._moveLine.a.copy(c.currentPoint),this._moveLine.b.copy(c.nextPoint),d=this._checkLine.a,e=c.nextCell.getRight(),f=c.nextCell.getBottom(),null==f&&(f=0),null==e&&(e=0),d.x=e,d.y=f,d=this._checkLine.b,e=c.nextCell.getLeft(),f=c.nextCell.getBottom(),null==f&&(f=0),null==e&&(e=0),d.x=e,d.y=f,d=null!=this._moveLine.intersect(this._checkLine)?2:1),1==d?this._nextPosition.x=c.nextCell.getRight(this._colliderRadius+
this._distanceToWall):2==d&&(this._nextPosition.y=c.nextCell.getBottom(-this._colliderRadius-this._distanceToWall)));c=this._wallCheck11;0<c.density&&(d=c.getChangeType(),3==d&&(this._moveLine.a.copy(c.currentPoint),this._moveLine.b.copy(c.nextPoint),d=this._checkLine.a,e=c.nextCell.getLeft(),f=c.nextCell.getBottom(),null==f&&(f=0),null==e&&(e=0),d.x=e,d.y=f,d=this._checkLine.b,e=c.nextCell.getRight(),f=c.nextCell.getBottom(),null==f&&(f=0),null==e&&(e=0),d.x=e,d.y=f,d=null!=this._moveLine.intersect(this._checkLine)?
2:1),1==d?this._nextPosition.x=c.nextCell.getLeft(-this._colliderRadius-this._distanceToWall):2==d&&(this._nextPosition.y=c.nextCell.getBottom(-this._colliderRadius-this._distanceToWall)))}a=this._nextPosition.x-a-this.position.x;b=this._nextPosition.y-b-this.position.y;0<a&&(c=this._moveDirection.y,this._moveAdd.y=a*(0<c?1:0>c?-1:0)*.5);0<b&&(a=this._moveDirection.x,this._moveAdd.x=b*(0<a?1:0>a?-1:0)*.5);this.position.copy(this._nextPosition);this.updatePosition()}},onSetup:function(a){this._nextPosition.copy(this.position);
this.ignoreCollision=!0;this._moveDirection.copy(a.hero.position).sub(this.position).normalize();var b=G.instance,c=this._moveDirection.x,d=this._moveDirection.y;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this._rotation=b.get_angle();this._tracePosition.copy(a.hero.position)}});var zc=function(){z.call(this);this.type=105;this._colliderRadius=12;this.size=13};zc.get=function(){return zc.pool.get()};zc.prototype=n(z.prototype,{dispose:function(){zc.pool.set(this);this.onDispose()},render:function(){z.prototype.render.call(this);
D.drawCircle(this.position,20,null,E.BLACK)}});var Ac=function(){z.call(this);this.type=14;this.size=20;this._colliderRadius=38;this._positionOffset.set(25,25)};Ac.get=function(){return Ac.pool.get()};Ac.prototype=n(z.prototype,{dispose:function(){Ac.pool.set(this);this.onDispose()},onTriggerEnter:function(a,b){6==a.type&&a.inverseGravity()}});var Bc=function(){z.call(this);this.type=10;this._colliderRadius=20;this.size=25;this._moveDirection=new G;this._p1=new h;this._p2=new h;this._p3=new h};Bc.get=
function(){return Bc.pool.get()};Bc.prototype=n(z.prototype,{dispose:function(){Bc.pool.set(this);this.onDispose()},update:function(a){this._time-=a.deltaTime;0>=this._time&&(a=Eb.get(),a.owner=this,a.setMapObject(this.data),a.start(-this._time,this._moveDirection),this.world.add(a),this._time+=2.0054894784995425)},render:function(){this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);var a=xa.instance.setEulerAngles(0,0,45*this._dir);a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);
this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position);D.drawTriangle(this._p1,this._p2,this._p3,E.BLACK)},editChange:function(a){a||(this._dir++,this.init())},onSetup:function(a){this.ignoreCollision=!0;this._time=.20632279534109818;this._dir=this.data.params.getValue(2,0);this.init()},init:function(){this._dir%=8;0>this._dir&&(this._dir+=8);if(0==this._dir){var a=this._moveDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this._dir?(a=this._moveDirection,
c=b=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this._dir?(a=this._moveDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this._dir?(a=this._moveDirection,b=-1,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):4==this._dir?(a=this._moveDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):5==this._dir?(a=this._moveDirection,c=b=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):6==this._dir?(a=this._moveDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):7==this._dir&&(a=
this._moveDirection,b=1,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this.rotation=45*this._dir;this.data.params.setValue(2,this._dir)}});var xa=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};xa.prototype={copy:function(a){if(null==a||a==this)return this;var b=a.x,c=a.y,d=a.z;a=a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);this.x=b;this.y=c;this.z=d;this.w=a;return this},dot:function(a,b){var c=null==b,d=c?this:
a;a=c?a:b;return d.x*a.x+d.y*a.y+d.z*a.z+d.w*a.w},mul:function(a,b){var c=null==b,d=c?this:a,e=c?a:b;a=d.w*e.x+d.x*e.w+d.y*e.z-d.z*e.y;b=d.w*e.y+d.y*e.w+d.z*e.x-d.x*e.z;c=d.w*e.z+d.z*e.w+d.x*e.y-d.y*e.x;d=d.w*e.w-d.x*e.x-d.y*e.y-d.z*e.z;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d;return this},rotate:function(a){var b=a.x,c=a.y,d=a.z,e=this.w*b+this.y*d-this.z*c,f=this.w*c+this.z*b-this.x*d,r=this.w*d+this.x*c-this.y*b;b=-this.x*b-this.y*c-this.z*
d;return a.set(e*this.w+b*-this.x+f*-this.z-r*-this.y,f*this.w+b*-this.y+r*-this.x-e*-this.z,r*this.w+b*-this.z+e*-this.y-f*-this.x)},setEulerAngles:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a*=.017453292519943295;b*=.017453292519943295;var d=Math.sin,e=Math.cos,f=.008726646259971648*c;c=d(f);f=e(f);var r=.5*a;a=d(r);r=e(r);b*=.5;d=d(b);var h=e(b);e=h*a;b=d*r;r*=h;a*=d;this.x=e*f+b*c;this.y=b*f-e*c;this.z=r*c-a*f;this.w=r*f+a*c;return this},getEulerAngles:function(a){null==a&&(a=
h._pool.get());var b=this.x*this.x,c=this.y*this.y,d=this.z*this.z,e=this.y*this.x+this.z*this.w;e=.4999<e?1:-.4999>e?-1:0;0==e?(e=2*(this.w*this.x-this.z*this.y),a.x=Math.asin(-1>e?-1:1<e?1:e),a.y=Math.atan2(2*(this.y*this.w+this.x*this.z),1-2*(c+b)),a.z=Math.atan2(2*(this.w*this.z+this.y*this.x),1-2*(b+d))):(a.x=1.5707963267948966*e,a.y=0,a.z=2*e*Math.atan2(this.y,this.w));a.scale(57.29577951308232);return a},setLookAt:function(a,b){null==b&&(b=h.get_up());var c=-a.dot(b);if(1==c||-1==c)return this.setEulerAngles(90*
c,0,0),this;b=h._pool.get().cross(b,a).normalize();c=h._pool.get().cross(a,b).normalize();this.setFromAxes(b.x,c.x,a.x,b.y,c.y,a.y,b.z,c.z,a.z);return this},setFromAxes:function(a,b,c,d,e,f,r,h,g){var k=a+e+g;0<=k?(a=Math.sqrt(k+1),this.w=.5*a,a=.5/a,this.x=(h-f)*a,this.y=(c-r)*a,this.z=(d-b)*a):a>e&&a>g?(a=Math.sqrt(1+a-e-g),this.x=.5*a,a=.5/a,this.y=(d+b)*a,this.z=(c+r)*a,this.w=(h-f)*a):e>g?(a=Math.sqrt(1+e-a-g),this.y=.5*a,a=.5/a,this.x=(d+b)*a,this.z=(h+f)*a,this.w=(c-r)*a):(a=Math.sqrt(1+g-
a-e),this.z=.5*a,a=.5/a,this.x=(c+r)*a,this.y=(h+f)*a,this.w=(d-b)*a);return this},slerpTo:function(a,b){if(null==a||0>=b)return this;if(1<=b)return this.copy(a),this;if(0<=b&&1>=b){var c=this.dot(a),d=m.abs(c),e=1-b,f=b;if(.1<1-d){f=Math.acos(d);d=Math.sin;var r=1/d(f);e=d((1-b)*f)*r;f=d(b*f)*r}0>c&&(f=-f);b=e*this.x+f*a.x;c=e*this.y+f*a.y;d=e*this.z+f*a.z;a=e*this.w+f*a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);this.x=b;this.y=c;this.z=d;this.w=a}return this},get_up:function(){return this.rotate(h.get_up())},
get_right:function(){return this.rotate(h.get_right())}};var Cc=function(){z.call(this);this.type=11;this._colliderRadius=20;this.size=25;this._shootDirection=new G;this._p1=new h;this._p2=new h;this._p3=new h;this._rotation=new xa};Cc.get=function(){return Cc.pool.get()};Cc.prototype=n(z.prototype,{dispose:function(){Cc.pool.set(this);this.onDispose()},update:function(a){},lateUpdate:function(a){var b=a.deltaTime,c=a.hero.velocity.x,d=a.hero.velocity.y,e=this._shootDirection;c=a.hero.position.x-
this.position.x+11*(0<c?1:0>c?-1:0);d=a.hero.position.y-this.position.y+11*(0<d?1:0>d?-1:0);null==d&&(d=0);null==c&&(c=0);e.x=c;e.y=d;e=xa.instance.setEulerAngles(0,0,this._shootDirection.get_angle());this._rotation.slerpTo(e,8*b);this.rotation=this._rotation.getEulerAngles().z;this._time-=a.deltaTime;0>=this._time&&(this._shootDirection.set_angle(this.rotation),a=Eb.get(),a.owner=this,a.setMapObject(this.data),a.start(-this._time,this._shootDirection),this.world.add(a),this._time+=2.0054894784995425)},
render:function(){this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);var a=xa.instance.setEulerAngles(0,0,this.rotation);a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position);D.drawTriangle(this._p1,this._p2,this._p3,E.BLACK)},onSetup:function(a){this.ignoreCollision=!0;this._time=.20632279534109818;var b=this._shootDirection,c=a.hero.position.x-this.position.x;a=a.hero.position.y-this.position.y;null==
a&&(a=0);null==c&&(c=0);b.x=c;b.y=a;this.rotation=this._shootDirection.get_angle();this._rotation.setEulerAngles(0,0,this.rotation);this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);b=xa.instance.setEulerAngles(0,0,this._shootDirection.get_angle());b.rotate(this._p1);b.rotate(this._p2);b.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position)}});var Pb=function(){z.call(this);this.type=6;this._colliderCheck=new Ee(this);this._positionOffset.y=
-15;this._positionOffset.x=25;this.velocity=new h(0,0);this.shapeSize=10;this._wallCheck00=new Ja(this.shapeSize,-1,-1);this._wallCheck11=new Ja(this.shapeSize,1,1);this._wallCheck10=new Ja(this.shapeSize,1,-1);this._wallCheck01=new Ja(this.shapeSize,-1,1);this._wallCheck00.boardOffset=4;this._wallCheck10.boardOffset=4;this._wallCheck01.boardOffset=4;this._wallCheck11.boardOffset=4;this._moveLine=new qb;this._checkLine=new qb;this._colliderRadius=11;this._nextPosition=new h;this._distanceToWall=1E-5;
this._targetScaleY=1;this._replayFrameList=T.fromArray([]);this.acc=new h};Pb.get=function(){return Pb.pool.get()};Pb.prototype=n(z.prototype,{dispose:function(){this.self=this._replayMode=this.ignoreCollision=!1;Pb.pool.set(this);this.onDispose()},setReplay:function(a){if(null!=a&&!(1>a.length)){this._replayMode=!0;for(var b=a.length;0<b--;)this._replayFrameList.push(a[b]);this._replayActionFrame=this._replayFrameList.pop()}},inverseGravity:function(){this.gravity&&(this.gravity=!1,this.rotation=
180,this._gravityScaleY=-1,this.scale.x=(0<this._xdir?1:-1)*this._gravityScaleY)},begin:function(a){this.playing=this.running=!0},update:function(a){var b=a.deltaTime;if(this._replayMode){if(a.frame==this._replayActionFrame){if(0<this._replayFrameList.get_length())this._replayActionFrame=this._replayFrameList.pop();else{this.ignoreCollision&&this.world.event.success(this);return}this._pressed=8}}else a.pressed&&(this._pressed=8);if(0<this._pressed)if(this._pressed--,4>this.flyCount){var c=this.getGravity();
this.velocity.y=337.5*c;if(0<this._spring){c=Nc.springJumpUpVelocity;var d=this.getGravity();this.velocity.y=c*d}else c=this.getGravity(),this.velocity.y=337.5*c;this.velocity.x=134*this._xdir;this.flyCount=4;this._pressed=0;a.record(this)}else 0==this.runCount&&(c=this.getGravity(),this.velocity.y=368.5*c,this._xdir=-this._xdir,this.scale.x=(0<this._xdir?1:-1)*this._gravityScaleY,this.velocity.x=134*this._xdir,this.flyCount=4,this._pressed=0,a.record(this));this._wallCheck00.setCurrent(this.position);
this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);a=this.velocity.y*b-421.87499999999994*this.getGravity()*b*b;this.velocity.y-=843.7499999999999*this.getGravity()*b;0<this.flyCount&&1>this.runCount&&(this.gravity?-69.68>this.velocity.y:69.68<this.velocity.y)&&(a=this.velocity.y,a+=.5*(-69.68*this.getGravity()-a),this.velocity.y=a,a=this.velocity.y*b);c=G._pool.get();d=this.velocity.x;var e=this.velocity.y;null==e&&
(e=0);null==d&&(d=0);c.x=d;c.y=e;this._nextPosition.copy(this.position);this._nextPosition.x+=b*this.velocity.x;this._nextPosition.y+=a;this.flying=0<this.flyCount;this.running=0<this.runCount;this.flyCount++;this.runCount++;this._wallCheck00.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck11.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck10.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck01.update(this._nextPosition,
this.velocity,this.world.mapData);0<this._wallCheck00.density||0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density?(this._spring=this._wallCheck00.spring+this._wallCheck01.spring+this._wallCheck10.spring+this._wallCheck11.spring,a=!1,0<this._wallCheck00.density&&0<this._wallCheck01.density&&(this._nextPosition.x=this._wallCheck00.nextCell.getRight(this.shapeSize+this._distanceToWall),this.touchLeft(),a=!0),0<this._wallCheck00.density&&0<this._wallCheck10.density&&
(this._nextPosition.y=this._wallCheck00.currentCell.getBottom(this.shapeSize+this._distanceToWall),a=!0,this.touchYAxis(this._wallCheck00.nextCell,!0)),0<this._wallCheck10.density&&0<this._wallCheck11.density&&(this._nextPosition.x=this._wallCheck10.nextCell.getLeft(-this.shapeSize-this._distanceToWall),this.touchRight(),a=!0),0<this._wallCheck11.density&&0<this._wallCheck01.density&&(this._nextPosition.y=this._wallCheck11.nextCell.getBottom(-this.shapeSize-this._distanceToWall),a=!0,this.touchYAxis(this._wallCheck11.nextCell,
!1)),a||(a=this._wallCheck00,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getRight(2),e=a.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getLeft(-2),e=a.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?(this._nextPosition.x=a.nextCell.getRight(this.shapeSize+this._distanceToWall),this.touchLeft()):
2==c&&(this._nextPosition.y=a.nextCell.getTop(this.shapeSize+this._distanceToWall),this.touchYAxis(a.nextCell,!0))),a=this._wallCheck10,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getLeft(-2),e=a.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getRight(2),e=a.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?
2:1),1==c?(this._nextPosition.x=a.nextCell.getLeft(-this.shapeSize-this._distanceToWall),this.touchRight()):2==c&&(this._nextPosition.y=a.nextCell.getTop(this.shapeSize+this._distanceToWall),this.touchYAxis(a.nextCell,!0))),a=this._wallCheck01,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getRight(),e=a.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getLeft(),
e=a.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?(this._nextPosition.x=a.nextCell.getRight(this.shapeSize+this._distanceToWall),this.touchLeft()):2==c&&(this._nextPosition.y=a.nextCell.getBottom(-this.shapeSize-this._distanceToWall),this.touchYAxis(a.nextCell,!1))),a=this._wallCheck11,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getLeft(),
e=a.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getRight(),e=a.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?(this._nextPosition.x=a.nextCell.getLeft(-this.shapeSize-this._distanceToWall),this.touchRight()):2==c&&(this._nextPosition.y=a.nextCell.getBottom(-this.shapeSize-this._distanceToWall),this.touchYAxis(a.nextCell,!1)))),this._targetScaleY=1):(this._beginFall&&(this._beginFall=
!1,0>this.velocity.y&&(0<this._wallCheck00.prevDesity&&this._wallCheck00.prevCell.getRight(),0<this._wallCheck10.prevDesity&&this._wallCheck10.prevCell.getLeft()),this.fall()),this.falling(),a=this.velocity.y/337.5,this._targetScaleY=1+.5*m.abs(-1>a?-1:1<a?1:a));a=this.scale.y;this.scale.y=a+5*(this._targetScaleY-a)*b;this.acc.copy(this._nextPosition).sub(this.position);this.position.copy(this._nextPosition);this.updatePosition()},lateUpdate:function(a){this.getColliderShapes(this._colliderCheck);
var b=this._colliderCheck.triggerEnterList.get_length();if(0<b)for(;0<b--;)this._colliderCheck.triggerEnterList.getArrayElement(b).onTriggerEnter(this,a);b=this._colliderCheck.triggerExitList.get_length();if(0<b)for(;0<b--;)this._colliderCheck.triggerExitList.getArrayElement(b).onTriggerExit(this,a)},render:function(){D.drawPlane(this.position,h.get_right().scale(this.shapeSize),h.get_up().scale(this.shapeSize),E.RED);var a=h.instance.copy(this.position);a.y+=3.5999999999999996;D.drawPlane(a,h.get_right().scale(this.shapeSize+
3.5999999999999996),h.get_up().scale(this.shapeSize+3.5999999999999996),E.BLUE)},onSetup:function(a){this.type=6;this.playing=this.running=!1;this._wallCheck00.reset();this._wallCheck10.reset();this._wallCheck01.reset();this._wallCheck11.reset();this._nextPosition.copy(this.position);this._hasGround=!1;this.gravity=!0;this.velocity.x=134;this.flyCount=this.runCount=1E3;this._xdir=1;this._pressed=this._spring=0;a=this.world.mapData.getByPosition(this.position.x,this.position.y);a=this.world.mapData.map.get(a.x,
a.y-1);1==a.type||4==a.type?(this.flyCount=0,this.velocity.x=150.25,this.flying=!1):(this.velocity.x=134,this.flying=!0);this.velocity.y=0;this._gravityScaleY=1;this._colliderCheck.clear();this.scale.set(1,1);this.rotation=0},getGravity:function(){return this.gravity?1:-1},touchYAxis:function(a,b){null==b&&(b=!0);this.gravity||(b=!b);b?(this.flyCount=this.velocity.y=0,this.velocity.x=150.25*this._xdir,this._beginFall=!0):(this.velocity.y=0,this.velocity.x=150.25*this._xdir);this._hasGround||(this._hasGround=
!0,this.scale.y=this._targetScaleY=.5)},touchLeft:function(){this.runCount=0;this.velocity.x=150.25*this._xdir},touchRight:function(){this.runCount=0;this.velocity.x=150.25*this._xdir},fall:function(){this.velocity.x=134*this._xdir},falling:function(){this._hasGround=!1}});var Dc=function(){z.call(this);this.type=101;this._moveDirection=new G;this._basePosition=new G;this._time=0;this._colliderRadius=11;this._p1=new h;this._p2=new h;this._p3=new h};Dc.get=function(){return Dc.pool.get()};Dc.prototype=
n(z.prototype,{dispose:function(){Dc.pool.set(this);this.onDispose()},update:function(a){this._time+=a.deltaTime;this._time>this._totalTime&&(this._time-=this._totalTime);a=this._time/this._totalTime;.5>a?(a=dd.quadInOut(2*a),this.scale.x=0<this._moveDirection.x+this._moveDirection.y?1:-1):(a=dd.quadInOut(1-2*(a-.5)),this.scale.x=0<-(this._moveDirection.x+this._moveDirection.y)?1:-1);a=134.15178571428572*this._totalTime*a*.5;this.position.x=this._basePosition.x+this._moveDirection.x*a;this.position.y=
this._basePosition.y+this._moveDirection.y*a;this.updatePosition()},render:function(){D.drawCircle(this.position,20,null,E.BLACK);D.drawCircle(this.position,this._colliderRadius,null,this.enabled?E.RED:E.BLACK);this._p1.set(0,-this._colliderRadius,0);this._p2.set(0,this._colliderRadius,0);this._p3.set(this._colliderRadius,0,0);var a=xa.instance.setEulerAngles(0,0,0>this.scale.x?180:0);a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);
this._p3.add(this.position);D.drawTriangle(this._p1,this._p2,this._p3,E.RED)},setMapObject:function(a){z.prototype.setMapObject.call(this,a);this.editMode&&null!=this._editDot&&this._editDot.relateChanged()},editChange:function(a){a||(this._dir++,this.init(),this.editMode&&null!=this._editDot&&this._editDot.relateChanged())},editUpdate:function(a,b){a=z.prototype.editUpdate.call(this,a,b);this.editMode&&null!=this._editDot&&this._editDot.relateChanged();return a},onSetup:function(a){this._basePosition.x=
this.position.x;this._basePosition.y=this.position.y;this._time=0;this._moveDistance=this.data.params.getValue(1,3);3>this._moveDistance&&(this._moveDistance=3);this._dir=this.data.params.getValue(2,0)%4;this.init();this.scale.x=0<this._moveDirection.x+this._moveDirection.y?1:-1;this._totalTime=100*this._moveDistance/134.15178571428572},onAdd:function(a){z.prototype.onAdd.call(this,a);this.editMode&&(this._editDot=Db.get(),a.add(this._editDot),this._editDot.setRelate(this))},onDispose:function(){z.prototype.onDispose.call(this);
this._editDot=null},init:function(){0>this._dir&&(this._dir+=4);if(0==this._dir){var a=this._moveDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this._dir?(a=this._moveDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this._dir?(a=this._moveDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this._dir&&(a=this._moveDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this.data.params.setValue(2,this._dir)}});var Ec=function(){z.call(this);this.type=
104;this._colliderRadius=11;this._wallCheck00=new Ja(this._colliderRadius,-1,-1);this._wallCheck11=new Ja(this._colliderRadius,1,1);this._wallCheck10=new Ja(this._colliderRadius,1,-1);this._wallCheck01=new Ja(this._colliderRadius,-1,1);this._moveLine=new qb;this._checkLine=new qb;this._distanceToWall=1E-5;this._moveVelocity=new G;this._nextPosition=new h;this._willPosition=new h};Ec.get=function(){return Ec.pool.get()};Ec.prototype=n(z.prototype,{dispose:function(){Ec.pool.set(this);this.onDispose()},
update:function(a){var b=this.world.mapData.getByPosition(this.position.x,this.position.y);if(null==b||1!=b.type&&4!=b.type){a=a.deltaTime;this._wallCheck00.setCurrent(this.position);this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);b=h.instance.set(134.625*this._moveVelocity.x,134.625*this._moveVelocity.y,0);this._nextPosition.x+=b.x*a;this._nextPosition.y+=b.y*a;this._willPosition.copy(this._nextPosition);this._wallCheck00.update(this._nextPosition,
b,this.world.mapData);this._wallCheck11.update(this._nextPosition,b,this.world.mapData);this._wallCheck10.update(this._nextPosition,b,this.world.mapData);this._wallCheck01.update(this._nextPosition,b,this.world.mapData);if(0<this._wallCheck00.density||0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density){a=!1;0<this._wallCheck00.density&&0<this._wallCheck01.density&&(this._nextPosition.x=this._wallCheck00.currentCell.getLeft(this.size+this._distanceToWall),a=!0);0<
this._wallCheck00.density&&0<this._wallCheck10.density&&(this._nextPosition.y=this._wallCheck00.currentCell.getBottom(this.size+this._distanceToWall),a=!0);0<this._wallCheck10.density&&0<this._wallCheck11.density&&(this._nextPosition.x=this._wallCheck10.nextCell.getLeft(-this.size-this._distanceToWall),a=!0);0<this._wallCheck11.density&&0<this._wallCheck01.density&&(this._nextPosition.y=this._wallCheck11.nextCell.getBottom(-this.size-this._distanceToWall),a=!0);if(!a){a=this._wallCheck00;if(0<a.density){b=
a.getChangeType();if(3==b){this._moveLine.a.copy(a.currentPoint);this._moveLine.b.copy(a.nextPoint);b=this._checkLine.a;var c=a.nextCell.getRight(),d=a.nextCell.getTop();null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b=this._checkLine.b;c=a.nextCell.getLeft();d=a.nextCell.getTop();null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b=null!=this._moveLine.intersect(this._checkLine)?2:1}1==b?this._nextPosition.x=a.nextCell.getRight(this.size+this._distanceToWall):2==b&&(this._nextPosition.y=a.nextCell.getTop(this.size+
this._distanceToWall))}a=this._wallCheck10;0<a.density&&(b=a.getChangeType(),3==b&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),b=this._checkLine.a,c=a.nextCell.getLeft(),d=a.nextCell.getTop(),null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d,b=this._checkLine.b,c=a.nextCell.getRight(),d=a.nextCell.getTop(),null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d,b=null!=this._moveLine.intersect(this._checkLine)?2:1),1==b?this._nextPosition.x=a.nextCell.getLeft(-this.size-this._distanceToWall):
2==b&&(this._nextPosition.y=a.nextCell.getTop(this.size+this._distanceToWall)));a=this._wallCheck01;0<a.density&&(b=a.getChangeType(),3==b&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),b=this._checkLine.a,c=a.nextCell.getRight(),d=a.nextCell.getBottom(),null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d,b=this._checkLine.b,c=a.nextCell.getLeft(),d=a.nextCell.getBottom(),null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d,b=null!=this._moveLine.intersect(this._checkLine)?2:1),1==b?this._nextPosition.x=
a.nextCell.getRight(this.size+this._distanceToWall):2==b&&(this._nextPosition.y=a.nextCell.getBottom(-this.size-this._distanceToWall)));a=this._wallCheck11;0<a.density&&(b=a.getChangeType(),3==b&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),b=this._checkLine.a,c=a.nextCell.getLeft(),d=a.nextCell.getBottom(),null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d,b=this._checkLine.b,c=a.nextCell.getRight(),d=a.nextCell.getBottom(),null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d,b=null!=this._moveLine.intersect(this._checkLine)?
2:1),1==b?this._nextPosition.x=a.nextCell.getLeft(-this.size-this._distanceToWall):2==b&&(this._nextPosition.y=a.nextCell.getBottom(-this.size-this._distanceToWall)))}this._willPosition.sub(this._nextPosition);a=this._willPosition.x;b=this._willPosition.y;c=m.abs(a)+m.abs(b);this._count++;4<=this._count?(this._count=0,this._moveVelocity.y=-this._moveVelocity.y,this._moveVelocity.x=-this._moveVelocity.x,this._nextPosition.y+=c*this._moveVelocity.y,this._nextPosition.x+=c*this._moveVelocity.x):(0!=
b&&(this._moveVelocity.y=-this._moveVelocity.y,this._nextPosition.y+=c*this._moveVelocity.y),0!=a&&(this._moveVelocity.x=-this._moveVelocity.x,this._nextPosition.x+=c*this._moveVelocity.x));this.rotation=this._moveVelocity.get_angle()}this.position.copy(this._nextPosition);this.updatePosition()}},onSetup:function(a){this._count=0;a=this.data.params.getValue(2,0)%4;0>a&&(a+=4);if(0==a){a=this._moveVelocity;var b=1,c=1;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==a?(a=this._moveVelocity,b=-1,c=
1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==a?(a=this._moveVelocity,c=b=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==a&&(a=this._moveVelocity,b=1,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this._nextPosition.copy(this.position);this.rotation=this._moveVelocity.get_angle()}});var Fc=function(){z.call(this);this.type=7;this._colliderRadius=this.size=30;this._positionOffset.set(25,-25+this._colliderRadius);var a=this.editCheckWall,b=2,c=2;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c};Fc.get=
function(){return Fc.pool.get()};Fc.prototype=n(z.prototype,{dispose:function(){Fc.pool.set(this);this.onDispose()},colliderWith:function(a){var b=a.position.x,c=a.position.y,d=this.position.x-this._colliderRadius,e=this.position.x+this._colliderRadius,f=this.position.y+this._colliderRadius,r=this.position.y-this._colliderRadius;a.position.x<d?b=d:a.position.x>e&&(b=e);a.position.y<r?c=r:a.position.y>f&&(c=f);b-=a.position.x;c-=a.position.y;return b*b+c*c<a._colliderRadius*a._colliderRadius?!0:!1},
onTriggerEnter:function(a,b){this.world.event.enter(a,this);b.hero==a&&b.record(b.hero)},render:function(){D.drawPlane(this.position,h.get_right().scale(this._colliderRadius),h.get_up().scale(this._colliderRadius),this.enabled?E.GREEN:E.BLACK)}});var Ve=function(){};Ve.prototype={execute:function(a){}};var We=function(){};We.prototype=n(Ve.prototype,{execute:function(a){}});var oe=function(){ab.response.map(1,new We)};oe.prototype={};var Xe=function(){};Xe.get=function(a){switch(a){case 2:var b=$b.get();
break;case 3:b=ac.get();break;case 5:b=dc.get();break;case 6:b=nc.get();break;case 7:b=qc.get();break;case 10:b=lc.get();break;case 11:b=mc.get();break;case 12:b=ec.get();break;case 13:b=bc.get();break;case 14:b=kc.get();break;case 101:b=oc.get();break;case 102:b=Zb.get();break;case 103:b=ic.get();break;case 104:b=pc.get();break;case 105:b=jc.get();break;case 130:b=cc.get();break;case 131:b=hc.get();break;case 150:b=gc.get();break;default:b=null}null!=b&&(b.name=ud.getNameByType(a));return b};var Ye=
function(){this._list=[]};Ye.prototype={add:function(a){this._list.push(a)},update:function(){if(!(1>this._list.length)){var a=this._list.shift();if(!(0>a.protocol))this.onRequest(a)}},onRequest:function(a){}};var ne=function(){this._list=[];this._map=new ba;this._map.h[1]=g(this,this._login)};ne.prototype=n(Ye.prototype,{onRequest:function(a){var b=this._map.h[a.protocol];null!=b&&(null==this._resp&&(this._resp=ab.response),b(a))},_login:function(a){a=new Ze;this._resp.add(a)}});var ed=function(){this._retryCall=
new aa(g(this,this._retry));this._transfer=new $e};ed.prototype={loadLevel:function(a,b,c){this._mapData=b;this._callback=c;a>=Ia.level.max||(a=Ia.level.getLevel(a),null!=a&&(this._mapData.set(this._transfer.decode(a.data)),a.data.position=0));null!=this._callback&&this._callback(this._mapData)},load:function(a,b){this._mapData=a;this._callback=b;this._url=a.url;-1==a.url.indexOf(".tmx")&&(this._url+=".tmx");this._res=l.bytes.get(this._url);this._res.addEventListener(B.complete._type,g(this,this.resComplete));
this._res.enabled&&this.resComplete()},_retry:function(){this._res.unload();this._res=l.bytes.get(this._url);this._res.addEventListener(B.complete._type,g(this,this.resComplete))},resComplete:function(a){null==this._res.bytes||oa.gt(1,this._res.bytes._length)?this._retryCall.start(3):(this._res.removeEventListener(B.complete._type,g(this,this.resComplete)),-1!=this._url.indexOf("tmb")?this._mapData.set(this._transfer.decode(this._res.bytes)):this._mapData.set(this._transfer.parse(this._res.bytes.toString(),
this._url)),null!=this._callback&&this._callback(this._mapData),this._res.unload())}};var me=function(){this._list=[];this._commands=new ba};me.prototype={map:function(a,b){this._commands.h[a]=b},add:function(a){x.remove(this._list,a);this._list.push(a)},update:function(){if(!(1>this._list.length)){var a=this._list.shift();if(!(0>a.protocol)){var b=this._commands.h[a.protocol];null!=b&&b.execute(a)}}}};var ud=function(){};ud.get=function(a){switch(a.type){case 2:var b=Qb.get();break;case 3:b=Rb.get();
break;case 5:b=uc.get();break;case 7:b=Fc.get();break;case 10:b=Bc.get();break;case 11:b=Cc.get();break;case 12:b=vc.get();break;case 13:b=sc.get();break;case 14:b=Ac.get();break;case 100:b=tc.get();break;case 101:b=Dc.get();break;case 102:b=rc.get();break;case 103:b=yc.get();break;case 104:b=Ec.get();break;case 105:b=zc.get();break;case 106:b=xc.get();break;case 150:b=Db.get();break;default:b=null}if(null==b)return null;b.setMapObject(a);b.ignoreCollision=!1;return b};ud.getNameByType=function(a){switch(a){case 2:a=
"Board";break;case 3:a="BoardSpring";break;case 5:a="Door";break;case 6:a="Hero";break;case 7:a="Treasure";break;case 10:a="Gun";break;case 11:a="GunHoming";break;case 12:a="Dragon";break;case 13:a="Boiler";break;case 14:a="Gravity";break;case 100:a="Chainsaw";break;case 101:a="RedDemon";break;case 102:a="BlueDemon";break;case 103:a="Fly";break;case 104:a="Ricochet";break;case 105:a="Gear";break;case 106:a="Elk";break;case 130:a="Bullet";break;case 131:a="Flame";break;case 150:a="editTarget";break;
default:a="unknow"}return a};var $e=function(){this._levelData=new xb;this._encode=new xb};$e.prototype={parse:function(a,b){this._levelData.clear();var c=v.parse(a).firstElement();a=m.stringToInt(c.get("width"));b=m.stringToInt(c.get("height"));this._tileSize=m.stringToInt(c.get("tilewidth"));this._levelData.width=a;this._levelData.height=b;for(c=c.elements();c.hasNext();){var d=c.next();if(d.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(d.nodeType));if("layer"==
d.nodeName){d=d.firstElement();if(d.nodeType!=v.Document&&d.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+ca.toString(d.nodeType));d=d.children[0];if(d.nodeType==v.Document||d.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(d.nodeType));d=d.nodeValue.split(",");for(var e=d.length;0<e--;){var f=m.trim(d[e]);f=m.stringToInt(f);if(0<f){var r=e%a,h=m.floatToInt(e/a);h=b-h-1;this._levelData.setWall(r,h,1==f);if(1<f&&4>f){var g=Qa.get();
g.x=r;g.y=h;g.type=f;this._levelData.objects.push(g)}}}}else{if(d.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(d.nodeType));if("objectgroup"==d.nodeName)for(d=d.elements();d.hasNext();)e=d.next(),this.parseObject(e)}}return this._levelData},decode:function(a){this._encode.decode(a);return this._encode},parseObject:function(a){if(!a.exists("visible")||0!=m.stringToBool(a.get("visible"))){var b=m.stringToFloat(a.get("x")),c=m.stringToFloat(a.get("y"));b=m.floatToInt(b/
this._tileSize);var d=this._levelData.height-1-m.floatToInt(c/this._tileSize);if(!(b>=this._levelData.width||d>=this._levelData.height||0>b||0>d)){var e=a.get("template");if(null!=e){e=ea.replace(e,".tx","");c=Qa.get();c.x=b;c.y=d;switch(e){case "\u53cd\u91cd\u529b":b=14;break;case "\u55b7\u706b\u9f99":b=12;break;case "\u5b9d\u7bb1":b=7;break;case "\u5bfc\u5f39":b=11;break;case "\u5f39\u7403":b=104;break;case "\u70ae\u624b":b=10;break;case "\u79fb\u52a8\u70ae":b=106;break;case "\u7ea2\u9b54\u9b3c":b=
101;break;case "\u82cd\u8747":b=103;break;case "\u84dd\u9b54\u9b3c":b=102;break;case "\u94fe\u952f":b=100;break;case "\u9505\u7089":b=13;break;case "\u95e8":b=5;break;case "\u9f7f\u8f6e":b=105;break;default:b=-1}c.type=b;if(-1!=c.type){for(a=a.elements();a.hasNext();){b=a.next();if(b.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(b.nodeType));if("properties"==b.nodeName)for(b=b.elements();b.hasNext();){var f=b.next();d=f.get("type");e=f.get("name");f=f.get("value");
switch(d){case "int":d=this.getType(e),c.params.setValue(d,m.stringToInt(f))}}}this._levelData.objects.push(c)}}}}},getType:function(a){switch(a){case "direction":a=2;break;case "forward":a=3;break;case "length":a=1;break;case "level":a=4;break;default:a=0}return a}};var he=function(){lb.game.addEventListener(B.update._type,g(this,this.update));this._list=[]};he.prototype={add:function(a){x.remove(this._list,a);this._list.push(a)},update:function(a){a=this._list.length;if(!(1>a))for(var b=0;b<a;){var c=
b++;this._list[c].update()}}};var F=function(){};F.init=function(a,b,c){F.root=new w;F.root.name="view root";F.root.get_transform().position.set(400,250,0);a.addChild(F.root);F.touchInput=F.root.addComponentIfNotExist(fd);F.touchInput.camera=b;F._gameRoot=new w;F._gameRoot.get_transform().position.set(400,250,0);c.addChild(F._gameRoot)};F.showGame=function(a){a.setParent(F._gameRoot)};F.show=function(a,b){null==b&&(b=0);if(!(0>b||10<b)){var c=F.root,d=F._layer[b];if(null!=d)if(d!=a)d.get_transform().removeFromParent(),
d.isShow=!1,d.onRemove();else if(d.viewLayer!=a.viewLayer){F.removeFromHistory(a);a._inited||(a._inited=!0,a.onInit());a.viewLayer=b;null!=a._canvas&&(a._canvas.order=b);a.isShow=!0;a.onAdd();c.get_transform().addChildAt(a.get_transform(),b);F._history.push(a);return}F._layer[b]=a;null!=a&&(a._inited||(a._inited=!0,a.onInit()),a.viewLayer=b,null!=a._canvas&&(a._canvas.order=b),a.isShow=!0,a.onAdd(),c.get_transform().addChildAt(a.get_transform(),b),F._history.push(a))}};F.close=function(a){var b=a.viewLayer;
if(!(0>b)){var c=F._layer[b];c==a&&(F._layer[b]=null,c.isShow=!1,c.onRemove(),c.get_transform().removeFromParent(),F.removeFromHistory(c))}};F.back=function(){if(1<F._history.length){var a=F._history[F._history.length-1];F.close(a);a=F._history[F._history.length-1];null!=a&&F.show(a,a.viewLayer)}};F.removeFromHistory=function(a){for(var b=F._history.length;0<b--;)F._history[b]==a&&F._history.splice(b,1)};var Md=function(){this.name="item";this.__list=[]};Md.prototype={createTableItem:function(){var a=
new af;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var se=function(){Md.call(this);this._map=new ba};se.prototype=n(Md.prototype,{addItem:function(a){this._map.h[a.id]=a}});var Nd=function(){this.name="level";this.__list=[]};Nd.prototype={createTableItem:function(){var a=new bf;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=
this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var re=function(){Nd.call(this);this._list=[];this.max=0};re.prototype=n(Nd.prototype,{getLevel:function(a){return this._list[a]},addItem:function(a){this._list[a.id]=a;a.id>this.max&&(this.max=a.id)}});var Od=function(){this.name="skin";this.__list=[]};Od.prototype={createTableItem:function(){var a=new cf;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=
this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var qe=function(){Od.call(this);this._map=new ba};qe.prototype=n(Od.prototype,{get:function(a){return this._map.h[a]},addItem:function(a){this._map.h[a.id]=a}});var Pd=function(){this.name="trail";this.__list=[]};Pd.prototype={createTableItem:function(){var a=new df;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=this.__list){for(var a=
0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var pe=function(){Pd.call(this)};pe.prototype=n(Pd.prototype,{addItem:function(a){}});var af=function(){};af.prototype={};var bf=function(){};bf.prototype={};var cf=function(){};cf.prototype={};var df=function(){};df.prototype={};var fa=function(){w.call(this);this.viewLayer=-1;this._canvas=this.addComponent(Ka);var a=this._canvas.rectTransform;this._transform=a;a.width=800;a.height=500;this.isShow=
!1};fa.prototype=n(w.prototype,{close:function(){this._inited&&(0>this.viewLayer||F.close(this))},show:function(a){F.show(this,a)},back:function(){F.back()},onInit:function(){},onAdd:function(){},onRemove:function(){}});var ye=function(){fa.call(this)};ye.prototype=n(fa.prototype,{onInit:function(){this._dragOffset=new h;this.data=new Mc;var a=new w;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,
225,0);this._txt.language=!0;this._txt.set_text("\u7f16\u8f91\u5730\u5bab");a=new w;a.name="back";var b=a.addComponent(P),c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(l.atlas.get(L.uiPath+"ui_back.png"));a.setParent(this);this.backBtn=a.addComponent(la);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,25);a=new w;b=a.addComponent(P);c=b.rectTransform.anchorX;
e=d=.9111111111111111;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=.05;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(l.atlas.get(L.uiPath+"ui_edit.png"));a.setParent(this);this.backBtn=a.addComponent(la);this.backBtn.onClick=g(this,this.onSaveClick);b=new w;c=b.addComponent(Y);c.set_alignmentX(0);c.set_alignmentY(0);c.size=22;b.setParent(a);b.get_transform().position.set(10,0,0);c.language=!0;c.set_text("\u4fdd\u5b58")},onAdd:function(){this._dragObject=null;
F.touchInput.enabled=!0;y.game.show();this.gameWorld=y.game.gameWorld;var a=ia.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){if(a=a.split(":"),this.data.url=a[0],this.list=[],a=a[1],!m.stringEmpty(a)){a=a.split(",");for(var b=0,c=a.length;b<c;){var d=b++;this.list.push(m.stringToInt(a[d]))}}}else a=m.floatToInt(9*m.randomInstance.getFloat()+1),this.data.url="levels/"+a;this.gameWorld.onInit=g(this,this.onGameInit);this.gameWorld.onAddShape=g(this,this.onAddShape);F.root.addEventListener(t.onTouchBegin._type,
g(this,this.onTouchBegin));F.root.addEventListener(t.onTouchEnd._type,g(this,this.onTouchEnd));this.data=Ea.mapData;y.game.load(this.data)},onRemove:function(){F.root.removeEventListener(t.onTouchBegin._type,g(this,this.onTouchBegin));F.root.removeEventListener(t.onTouchEnd._type,g(this,this.onTouchEnd))},onUpdate:function(){if(null!=this._dragObject){var a=q.getTouch();if(null!=a){a=a.position;a.z=y.distance;var b=y.camera.screenToWorldPoint(a);b.sub(this._dragOffset);a=m.floatToInt(b.x/50);b=m.floatToInt(b.y/
50);var c=this.gameWorld.mapData.width-2;a=1>a?1:a>c?c:a;c=this.gameWorld.mapData.height-2;b=1>b?1:b>c?c:b;a==this._dragObject.data.x&&b==this._dragObject.data.y||!this._dragObject.editUpdate(a,b)||(this._changed=!0)}}},onGameInit:function(){this.gameWorld.remove(this.gameWorld.hero);y.game.bg.showGrid(!0)},onTouchBegin:function(a){if(null==a.currentActor){a=a.touch.position;a.z=y.distance;a=y.camera.screenToWorldPoint(a);var b=this.gameWorld.mapData.getByPosition(a.x,a.y);null!=b&&0<b.shapes.get_length()&&
(this._dragObject=b.shapes.getArrayElement(0),this._dragOffset.copy(a),this._dragOffset.x-=50*(this._dragObject.data.x+.5),this._dragOffset.y-=50*(this._dragObject.data.y+.5),this._dragOffset.z=0,this._changed=!1,this._targetX=this._dragObject.data.x,this._targetY=this._dragObject.data.y,this._dragObject.editBegin())}},onTouchEnd:function(a){null!=this._dragObject&&(this.checkBehindWall(this._dragObject)&&(this._dragObject.data.x=this._targetX,this._dragObject.data.y=this._targetY,this._dragObject.setMapObject(this._dragObject.data)),
this._dragObject.editChange(this._changed),this._dragObject=null,this._changed=!1)},checkBehindWall:function(a){var b=m.floatToInt(a.editCheckWall.x),c=m.floatToInt(a.editCheckWall.y);if(0<b||0<c)for(var d=0;d<b;)for(var e=d++,f=0,r=c;f<r;){var h=f++;h=this.gameWorld.mapData.map.get(e+a.data.x,h+a.data.y);if(null!=h&&(1==h.type||4==h.type))return!0}return!1},onBackClick:function(a){a.currentActor==a.downActor&&(this.close(),y.home.show(1))},onSaveClick:function(a){a.currentActor==a.downActor&&(this.close(),
y.save.show(1),y.save.start(this.data))},onAddShape:function(a){a.editMode=!0;y.game.onAddShape(a)}});var we=function(){w.call(this);this._displays=T.fromArray([]);this._displayMap=new ba;this._display=new w;this.bg=new Se;this.bg.setParent(this);this.bg.get_transform().position.set(-400,-250);var a=new w;a.get_transform().position.set(-400,-250);a.setParent(this);this._display.setParent(a);this.gameWorld=a.addComponent(td)};we.prototype=n(w.prototype,{show:function(){F.showGame(this);this.onAdd()},
close:function(){this.get_transform().removeFromParent();this.onRemove()},load:function(a){this.data=a;this.bg.load(a);this.bg.showGrid(!1);this.gameWorld.load(a)},onAddShape:function(a){var b=Xe.get(a.type);null!=b&&(this._displayMap.h[a.instanceID]=b,this._displays.push(b),b.begin(a),b.setParent(this._display))},onRemoveShape:function(a){var b=this._displayMap.h[a.instanceID];null!=b&&(b.end(),this._displayMap.remove(a.instanceID),this._displays.remove(b),b.get_transform().removeFromParent())},
onGameRender:function(){for(var a=this._displays.get_length();0<a--;)this._displays.getArrayElement(a).udpate()},onAdd:function(){this.gameWorld.onAddShape=g(this,this.onAddShape);this.gameWorld.onRemoveShape=g(this,this.onRemoveShape);this.gameWorld.onRender=g(this,this.onGameRender)},onRemove:function(){this.gameWorld.clear()}});var xe=function(){fa.call(this)};xe.prototype=n(fa.prototype,{onInit:function(){this.loader=new ed;var a=new w;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);
this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,225,0);this._txt.language=!0;this._txt.set_text("\u6211\u7684\u5730\u5bab");a=new w;var b=a.addComponent(P);this.backImage=b;var c=b.rectTransform.anchorX,d=.08888888888888889,e=.08888888888888889;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b=b.rectTransform.anchorY;d=c=.05;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this.backImage.set_resource(l.atlas.get(L.uiPath+"ui_attack.png"));a.setParent(this);b=new w;c=b.addComponent(Y);c.set_alignmentX(0);
c.set_alignmentY(0);c.size=22;b.setParent(a);b.get_transform().position.set(10,0,0);c.language=!0;c.set_text("\u63a2\u9669");this.backBtn=a.addComponent(la);this.backBtn.onClick=g(this,this.onAttackClick);a=new w;b=a.addComponent(P);c=b.rectTransform.anchorX;e=d=.9111111111111111;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=.05;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(l.atlas.get(L.uiPath+"ui_edit.png"));a.setParent(this);this.backBtn=a.addComponent(la);
this.backBtn.onClick=g(this,this.onEditClick);b=new w;c=b.addComponent(Y);c.set_alignmentX(0);c.set_alignmentY(0);c.size=22;b.setParent(a);b.get_transform().position.set(10,0,0);c.language=!0;c.set_text("\u5e03\u7f6e")},onAdd:function(){F.root.addEventListener(t.onTouchEnd._type,g(this,this.onTouchEnd));y.loading.show(4);y.game.show();this.gameWorld=y.game.gameWorld;this.gameWorld.onInit=g(this,this.onGameInit);var a=ia.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){var b=a.split(":");Ea.mapData.url=
b[0];this.loader.load(Ea.mapData,g(this,this.success))}else b=m.floatToInt(9*m.randomInstance.getFloat()+1),null!=a&&(a=a.split(":"),a=m.stringToInt(a[0]),null!=a&&(b=a)),this.loader.loadLevel(b,Ea.mapData,g(this,this.success))},onRemove:function(){F.root.removeEventListener(t.onTouchEnd._type,g(this,this.onTouchEnd))},success:function(a){y.loading.close();y.game.load(a)},onGameInit:function(){this.gameWorld.mapData.wallGroupList.get(0)},onTouchEnd:function(a){},onAttackClick:function(a){a.currentActor==
a.downActor&&(this.close(),y.map.show(0))},onEditClick:function(a){null!=a.currentActor&&a.currentActor==a.downActor&&(this.close(),y.edit.show(1))}});var te=function(){fa.call(this)};te.prototype=n(fa.prototype,{onInit:function(){fa.prototype.onInit.call(this);this.viewInit()},viewInit:function(){var a=new w;a.setParent(this);var b=a.addComponent(P),c=a.addComponent(la);a.name="loading";c.scaleEffect=!1;a=new w;a.setParent(this);this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);
this._txt.set_text("\u6b63\u5728\u52a0\u8f7d");this._txt.colorTop=(new E).setRGBA(-1);this._txt.colorBottom=(new E).setRGBA(-572662273);b.set_resource(l.atlas.get("default/splash.jpg"))}});(function(){fa.call(this)}).prototype=n(fa.prototype,{onInit:function(){fa.prototype.onInit.call(this);var a=new w,b=a.addComponent(P);b.addMeshRenderer();b.set_resource(l.atlas.get("image/map/1.jpg"));a.setParent(this);this._search=new w;a=this._search.addComponent(P);b=a.rectTransform.anchorX;var c=0,d=0;null==
d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.rectTransform.position.set(80,0,0);a.addMeshRenderer();this._search.addComponent(la).onClick=g(this,this.onSearch);this._search.setParent(this);a.set_resource(l.atlas.get(L.uiPath+"ui_search.png"));a=new w;b=a.addComponent(Y);b.size=26;b.set_alignmentX(0);b.set_alignmentY(0);b.addMeshRenderer();a.setParent(this._search);b.set_text("\u63a2\u7d22\u5730\u5bab")},onSearch:function(a){a.currentActor==a.downActor&&(this.close(),y.mode_single.show(1))}});var Qd=function(){w.call(this);
this.name="LevelCell";var a=new w;this._image=a.addComponent(P);this._image.material.renderQueue=30002;a.setParent(this);a.name="levelCell";a=this.addComponent(Ra);a.rectTransform.width=60;a.rectTransform.height=60;this.addComponent(la)};Qd.prototype=n(w.prototype,{update:function(a){this.data=a;this.get_transform().position.set(a.x,a.y,0);this.set_enabled(!0);this.data.state=0==this.data.id?-1:Ea.saveData.getPveLevelState(this.data.id);1==this.data.id&&-1==this.data.state&&(this.data.state=0);this.data.id==
Ea.saveData.getMaxLevel()&&(this.data.state=0);-1==this.data.state?this._image.set_resource(l.atlas.get(L.uiPath+"ui_levelLock.png")):0<=this.data.state&&this._image.set_resource(l.atlas.get(L.uiPath+"ui_levelStar"+this.data.state+".png"))}});var la=function(){H.call(this)};la.__name__="lovedna.game.components.ui.Button";la.prototype=n(X.prototype,{onAwake:function(){X.prototype.onAwake.call(this);this.mouseEnabled=!0;this._event=new Qc("");this.scaleEffect=!0},onStart:function(){X.prototype.onStart.call(this);
null==this.rect&&(this.rect=this.actor.getComponent(Ra));this.collider=this.actor.addComponent(vd);this.bindEvent(t.onTouchBegin,g(this,this.onTouchBegin));this.bindEvent(t.onTouchEnd,g(this,this.onTouchEnd));this.bindEvent(t.onRectTransform,g(this,this.onRectTransform))},onDestroy:function(){X.prototype.onDestroy.call(this);this.collider=null;this._event.clear();this.rect=this.onRelease=this.onPress=this.onClick=this._event=null},onTouchBegin:function(a){if(this.mouseEnabled&&!(0<=this._tid)){this._event.copy(t.onTouchBegin);
this._tid=this._event.touch.touchId;if(null!=this.onPress)this.onPress(this._event);this._event.clear();this.scaleEffect&&this.scaleTo(la.SCALE_PRESS,la.TIME_PRESS)}},onTouchEnd:function(a){if(this.mouseEnabled&&(this._event.copy(t.onTouchEnd),this._event.touch.touchId==this._tid)){this._tid=-1;if(null!=this.onRelease)this.onRelease(this._event);if(this.scaleEffect)this.scaleTo(1,la.TIME_RELEASE);else if(null!=this.onClick)this.onClick(this._event)}},scaleTo:function(a,b){this._totalTime=b;this._time=
0;this._targetScale=a;this._currentScale=this.transform.scale.x;this._scaleDelta=this._targetScale-this._currentScale;this.bindEvent(t.onUpdate,g(this,this.onUpdate))},onUpdate:function(a){this._time+=C.deltaTime;a=1;0<this._totalTime&&(a=this._time/this._totalTime);if(1<=a&&(this.bindEvent(t.onUpdate,null),0>this._tid&&null!=this.onClick))this.onClick(this._event);a=dd.backOut(a);a=this._currentScale+this._scaleDelta*a;this.transform.scale.set(a,a,a)},onRectTransform:function(a){if(null!=this.rect){a=
this.rect.rectTransform.width;var b=this.rect.rectTransform.height;this.collider.size.set(a,b,1);this.collider.center.set((.5-this.rect.rectTransform.pivot.x)*a,(.5-this.rect.rectTransform.pivot.y)*b,0)}},__class__:la});var ve=function(){this._page=5;fa.call(this);this._lineHeight=220};ve.prototype=n(fa.prototype,{focus:function(a){this._cacheLine=-1;this._targetPosition.copy(this._moveMap.get_transform().position);var b=this._levels.getArrayElement(a);null!=b?(this._targetPosition.y=-b.y,null==this._select.get_transform().parent&&
this._select.setParent(this._icons),this._select.select(b)):(a=m.floatToInt(a/5)*this._lineHeight+150,this._targetPosition.y=-a);this._targetPosition.y>this._max?this._targetPosition.y=this._max:this._targetPosition.y<this._min&&(this._targetPosition.y=this._min)},onInit:function(){fa.prototype.onInit.call(this);this._downPosition=new h;this._startPosition=new h;this._targetPosition=new h;this._velocity=new h;this._dragActor=new w;this._dragActor.name="drag area";var a=this._dragActor.addComponent(Ra);
a.rectTransform.width=y.viewWidth+100;a.rectTransform.height=y.viewHeight;this._dragActor.addComponent(la);this._dragActor.setParent(this);this._moveMap=new w;this._moveMap.setParent(this);a=Ia.level.max;this._zoom=1;this._page=m.ceilToInt(a/(5*m.floatToInt(760/this._lineHeight)));for(var b=0,c=this._page;b<c;){var d=b++,e=new w;this._bg=e.addComponent(P);this._bg.material.renderQueue=3E4;this._bg.set_resource(l.atlas.get("image/map/1.jpg"));var f=this._bg.rectTransform.pivot,r=0,k=0;null==k&&(k=
0);null==r&&(r=0);f.x=r;f.y=k;e.setParent(this._moveMap);e.get_transform().position.y=670*d;this._bg.rectTransform.width=1124;this._bg.rectTransform.position.x=-100}this._draging=!1;this._icons=new w;this._icons.setParent(this._moveMap);b=new w;c=b.addComponent(P);c.set_resource(l.atlas.get(L.uiPath+"ui_searchBig.png"));b.setParent(this);d=c.rectTransform.anchorX;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;c.rectTransform.position.x=90;c.rectTransform.position.y=-50;b.addComponent(la);b=new w;
c=b.addComponent(P);c.set_resource(l.atlas.get(L.uiPath+"ui_home.png"));b.setParent(this);d=c.rectTransform.anchorX;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;d=c.rectTransform.anchorY;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;c.rectTransform.position.x=90;c.rectTransform.position.y=50;b.addComponent(la).onClick=g(this,this.onHomeClick);b=new w;this._lineRenderer=b.addComponent(fc);this._lineRenderer.setWidth(2,2);this._lineRenderer.get_material().renderQueue=30001;this._lineRenderer.get_material().renderState.depthState.writeEnabled=
!1;this._lineRenderer.get_material().renderState.depthState.compareFunction=0;this._lineRenderer.get_material().color.w=.5;b.setParent(this._icons);b=new md;b.setSeed(91);this._levels=T.fromArray([]);for(c=0;c<a;)d=c++,f=m.floatToInt(d/5),e=m.floatToInt(d%5),0!=(f&1)&&(e=5-e-1),e=100*e+b.randomFloat(-10,10),f=f*this._lineHeight+b.randomFloat(-50,50),r=new Rd(d),r.x=330+e,r.y=150+f,this._levels.push(r),this._lineRenderer.setPosition(d,h.instance.set(r.x,r.y));this._showCells=T.fromArray([]);for(a=
0;20>a;)a++,b=new Qd,this._showCells.push(b),b.setParent(this._icons),b.get_transform().position.x=-2E3;this._cacheLine=-1;this._max=-(.5*y.viewHeight);this._min=-670*this._page-this._max;this._moveMap.get_transform().position.y=this._max;this._select=new ef;this.focus(Ea.saveData.getMaxLevel())},onAdd:function(){fa.prototype.onAdd.call(this);var a=y.viewWidth-1024;0>a&&(a=0);var b=.5*-y.viewWidth;this._moveMap.get_transform().position.x=b+a;this._icons.get_transform().position.x=a;this._downPosition.copy(this._moveMap.get_transform().position);
this._targetPosition.copy(this._moveMap.get_transform().position);this._targetPosition.y>this._max?this._targetPosition.y=this._max:this._targetPosition.y<this._min&&(this._targetPosition.y=this._min);this._zoom=y.align.scale;1>this._zoom&&(this._zoom=1);this._zoom=1.5;this.refreshCells();F.root.addEventListener(t.onTouchBegin._type,g(this,this.onTouchBegin));F.root.addEventListener(t.onTouchEnd._type,g(this,this.onTouchEnd))},onRemove:function(){fa.prototype.onRemove.call(this);F.root.removeEventListener(t.onTouchBegin._type,
g(this,this.onTouchBegin));F.root.removeEventListener(t.onTouchEnd._type,g(this,this.onTouchEnd))},onUpdate:function(){fa.prototype.onUpdate.call(this);if(this._draging){var a=q.getTouch();null!=a&&(this._velocity.copy(this._targetPosition),a=h.instance.copy(a.position),a.z=y.distance,a.copy(y.camera.screenToWorldPoint(a)),a.sub(this._startPosition),a.x=0,this._targetPosition.copy(this._downPosition).add(a.scale(this._zoom)),this._targetPosition.y>this._max?this._targetPosition.y=this._max:this._targetPosition.y<
this._min&&(this._targetPosition.y=this._min),this._velocity.sub(this._targetPosition))}this.refreshCells();this._moveMap.get_transform().position.lerpTo(this._targetPosition,8*this.deltaTime)},refreshCells:function(){var a=-(this._moveMap.get_transform().position.y-this._max);a=m.floatToInt((a-100)/this._lineHeight);0>a&&(a=0);if(this._cacheLine!=a){this._cacheLine=a;Rd.max=Ea.saveData.getMaxLevel();for(var b=0;20>b;){var c=b++,d=5*a+c;c=this._showCells.getArrayElement(c);d=this._levels.getArrayElement(d);
null==d?c.get_transform().position.x=-2E3:c.update(d)}}},onTouchBegin:function(a){0<a.touch.touchId||null!=a.downActor&&a.downActor!=this._dragActor&&"LevelCell"!=a.downActor.name||(this._draging=!0,a=h.instance.copy(q.getTouch().position),a.z=y.distance,this._startPosition.copy(y.camera.screenToWorldPoint(a)),this._downPosition.copy(this._moveMap.get_transform().position),this._targetPosition.copy(this._downPosition))},onTouchEnd:function(a){0<a.touch.touchId||(this._draging=!1,this._targetPosition.y-=
5*this._velocity.y,this._velocity.y=0,this._targetPosition.y>this._max?this._targetPosition.y=this._max:this._targetPosition.y<this._min&&(this._targetPosition.y=this._min),a.downActor==a.currentActor&&a.downActor!=this._dragActor&&!(5E-4<a.touch.down.distanceSquared(a.touch.up))&&a.downActor instanceof Qd&&(a=a.downActor,Ia.level.getLevel(a.data.id),-1!=a.data.state&&(this._select.data==a.data?(Ea.pveTargetLevel=a.data.id,this.close(),y.mode_single.targetLevel=Ea.pveTargetLevel,y.mode_single.show(1)):
(null==this._select.get_transform().parent&&this._select.setParent(this._icons),this._select.select(a.data)))))},onHomeClick:function(a){a.currentActor==a.downActor&&(this.close(),y.home.show(0))}});var ef=function(){w.call(this);this._image=this.addComponent(P);this._image.set_resource(l.atlas.get(L.uiPath+"ui_levelSelect.png"));var a=new w;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);a.setParent(this);a.get_transform().position.set(10,40,0)};ef.prototype=n(w.prototype,
{select:function(a){this.data=a;this.get_transform().position.set(a.x,a.y+30,0);this._txt.set_text("\u5173\u5361"+a.id)}});var Rd=function(a){this.id=a;this.state=m.floatToInt(4*m.randomInstance.getFloat()+-1)};Rd.prototype={};var Be=function(){fa.call(this)};Be.prototype=n(fa.prototype,{onInit:function(){this.loader=new ed;this.data=new Mc;var a=new w;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,
225,0);this.delayReStart=new aa(g(this,this.delayCall));a=new w;a.name="back";var b=a.addComponent(P),c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(l.atlas.get(L.uiPath+"back.png"));a.setParent(this);this.backBtn=a.addComponent(la);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,23)},onAdd:function(){y.loading.show(4);y.game.show();this.gameWorld=y.game.gameWorld;
var a=ia.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){if(a=a.split(":"),this.data.url=a[0],this.list=[],a=a[1],!m.stringEmpty(a)){a=a.split(",");for(var b=0,c=a.length;b<c;){var d=b++;this.list.push(m.stringToInt(a[d]))}}}else a=m.floatToInt(9*m.randomInstance.getFloat()+1),this.data.url="levels/"+a;this._txt.set_text(this.data.url);this.loader.load(this.data,g(this,this.success));this.gameWorld.onTrigger=g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);F.root.addEventListener(t.onTouchBegin._type,
g(this,this.onTouchBegin))},onRemove:function(){F.root.removeEventListener(t.onTouchBegin._type,g(this,this.onTouchBegin))},success:function(a){y.loading.close();y.game.load(a)},delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){if(!(null==this.list||1>this.list.length)){var a=this.list,b=Pb.get();b.setMapObject(this.gameWorld.door.data);this.gameWorld.add(b);b.setReplay(a)}},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?this.gameWorld.hero!=
a.target?this.gameWorld.remove(a.target):this.gameWorld.pause():this.gameWorld.hero==a.target&&6!=a.trap.type&&this.gameWorld.pause())},onTouchBegin:function(a){null==a.currentActor&&this.gameWorld.action()},onBackClick:function(a){a.currentActor==a.downActor&&this.delayCall()}});var De=function(){fa.call(this);this._hasOpen=[];this._hasOpen[0]=!1;this._hasOpen[1]=!1;this._hasOpen[2]=!1;this._hasOpen[3]=!1;this._hasOpen[4]=!1;this._hasOpen[5]=!1;this._hasOpen[6]=!1;this._hasOpen[7]=!1;this._hasOpen[8]=
!1;this._hasOpen[9]=!1;this._hasOpen[10]=!1;this._hasOpen[11]=!1;this._progress=12;this._successDelay=new aa(g(this,this.openSuccess))};De.prototype=n(fa.prototype,{setCount:function(a,b,c,d){null==c&&(c=1);null==b&&(b=1);1>a&&(a=1);12<a&&(a=12);if(1>b||3<b)b=1;this._count=a;this._keyLevel=b;this._hasOpen[0]=!1;this._hasOpen[1]=!1;this._hasOpen[2]=!1;this._hasOpen[3]=!1;this._hasOpen[4]=!1;this._hasOpen[5]=!1;this._hasOpen[6]=!1;this._hasOpen[7]=!1;this._hasOpen[8]=!1;this._hasOpen[9]=!1;this._hasOpen[10]=
!1;this._hasOpen[11]=!1;if(null!=d)for(a=d.length;0<a--;)b=d[a],b=1>b?1:12<b?12:b,this._hasOpen[b]=!0;this._successCount=c},setSuccessCallback:function(a){this._successCallback=a},onInit:function(){var a=new w;a.addComponent(P).set_resource(l.atlas.get("image/ui/lockBg.jpg"));a.setParent(this);a=new w;this._bg=a.addComponent(P);this._bg.set_resource(l.atlas.get(L.uiPath+"ui_lockBig.png"));a.setParent(this);this._bg.rectTransform.pivot.y=1;this._bg.rectTransform.position.x=10;this._bg.rectTransform.position.y=
80;this._bg.rectTransform.height=310;this._list=[];for(a=0;12>a;){var b=a++,c=new Rc;c.name=b+"";this._list.push(c);var d=b%4;b=m.floatToInt(b/4);c.get_transform().position.set(70*d-100,90*-b-100,0);c.setParent(this._bg.actor);c.onKeyPress=g(this,this.keyHolePress)}a=new w;a.name="back";c=a.addComponent(P);d=c.rectTransform.anchorX;var e=b=0;null==e&&(e=0);null==b&&(b=0);d.x=b;d.y=e;d=c.rectTransform.anchorY;e=b=0;null==e&&(e=0);null==b&&(b=0);d.x=b;d.y=e;c.set_resource(l.atlas.get(L.uiPath+"ui_back.png"));
a.setParent(this);a.addComponent(la).onClick=g(this,this.onBackClick);a.get_transform().position.set(50,25)},onAdd:function(){fa.prototype.onAdd.call(this);this._success=!1;var a=this._count;1>a&&(a=1);12<a&&(a=12);var b=m.ceilToInt(a/4);this._bg.rectTransform.height=160+80*b;b=this._list.length;for(this._progress=a;0<b--;)a=this._list[b],b<this._count?(a.setParent(this._bg.actor),a.show(this._keyLevel),this._hasOpen[b]&&(a.open(),this._progress--)):a.get_transform().removeFromParent();Rc.success=
!1},onBackClick:function(a){a.currentActor==a.downActor&&this.back()},keyHolePress:function(a){if(a.closed){var b=m.stringToInt(a.name);this._hasOpen[b]=!0;a.open();this._progress--;this._successCount--;if(0>=this._successCount||0>=this._progress)Rc.success=!0,this._successDelay.start(.5)}},openSuccess:function(){this.back();null!=this._successCallback&&this._successCallback()}});var Rc=function(){w.call(this);this._bg=this.addComponent(P);this._bg.material.color.setRGBA(1717986918);this._skin=(new w).addComponent(P);
this.btn=this.addComponent(la);this.btn.onPress=g(this,this.onPress);this._break=!1;this._v=new h};Rc.prototype=n(w.prototype,{show:function(a){this._bg.set_resource(l.atlas.get(L.uiPath+"ui_keyHole"+a+"bg.png"));this._skin.set_resource(l.atlas.get(L.uiPath+"ui_keyHole"+a+".png"));this._skin.material.renderQueue=ra.defaultRenderQueue;this._skin.actor.setParent(this);this.closed=this.btn.scaleEffect=!0;this._break=!1;this._skin.transform.position.set(0,0,0);this._skin.transform.rotation.setEulerAngles(0,
0,0)},open:function(){this.closed=this.btn.scaleEffect=!1;this._break=!0;this._v.set(600*m.randomInstance.getFloat()+-300,300*m.randomInstance.getFloat()+600,300);this._skin.material.renderQueue=ra.defaultRenderQueue+2;this._r=0},onPress:function(a){if(!Rc.success&&null!=this.onKeyPress)this.onKeyPress(this)},onUpdate:function(){w.prototype.onUpdate.call(this);if(this._break){var a=h.instance.copy(this._v).scale(this.deltaTime);this._skin.transform.position.add(a);this._skin.transform.rotation.setEulerAngles(0,
0,this._r);this._r+=500*this.deltaTime;this._v.y-=3E3*this.deltaTime;-500>this._skin.transform.position.y&&(this._break=!1)}}});var Ce=function(){fa.call(this)};Ce.prototype=n(fa.prototype,{onInit:function(){this.loader=new ed;this.data=new Mc;var a=new w;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,225,0);this.delayReStart=new aa(g(this,this.delayCall));a=new w;a.name="back";var b=a.addComponent(P),
c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(l.atlas.get(L.uiPath+"back.png"));a.setParent(this);this.backBtn=a.addComponent(la);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,23)},onAdd:function(){F.touchInput.enabled=!0;y.loading.show(4);y.game.show();this.gameWorld=y.game.gameWorld;var a=ia.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){if(a=
a.split(":"),this.data.url=a[0],this.list=[],a=a[1],!m.stringEmpty(a)){a=a.split(",");for(var b=0,c=a.length;b<c;){var d=b++;this.list.push(m.stringToInt(a[d]))}}}else a=m.floatToInt(9*m.randomInstance.getFloat()+1),this.data.url="levels/"+a;this._txt.set_text(this.data.url);this.loader.load(this.data,g(this,this.success));this.gameWorld.onTrigger=g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);F.root.addEventListener(t.onTouchBegin._type,g(this,this.onTouchBegin))},onRemove:function(){F.root.removeEventListener(t.onTouchBegin._type,
g(this,this.onTouchBegin))},success:function(a){y.loading.close();y.game.load(a)},delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){null==this.list||1>this.list.length||this.gameWorld.hero.setReplay(this.list)},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?(this.gameWorld.remove(a.target),this.gameWorld.finish()):6!=a.trap.type&&(this.gameWorld.pause(),this.delayReStart.start(.5)))},onTouchBegin:function(a){null==a.currentActor&&this.gameWorld.action()},
onBackClick:function(a){a.currentActor==a.downActor&&this.delayCall()}});var ze=function(){fa.call(this)};ze.prototype=n(fa.prototype,{start:function(a){this.data=a;y.game.load(a)},onInit:function(){this.delayReStart=new aa(g(this,this.delayCall));var a=new w;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;this._txt.set_text("\u4fdd\u5b58\u5730\u5bab");a.setParent(this);a.get_transform().position.set(0,225,0);a=new w;a.name="back";var b=a.addComponent(P);
this.backImage=b;var c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b=b.rectTransform.anchorY;d=c=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this.backImage.set_resource(l.atlas.get(L.uiPath+"ui_back.png"));a.setParent(this);this.backBtn=a.addComponent(la);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,25);this._state=0},onAdd:function(){y.game.show();this.gameWorld=y.game.gameWorld;this.gameWorld.onTrigger=g(this,this.onGameTrigger);this.gameWorld.onInit=
g(this,this.onGameInit);this.gameWorld.onGameStart=g(this,this.onGameStart);F.root.addEventListener(t.onTouchBegin._type,g(this,this.onTouchBegin));this._state=0;Wa.onEvent.addEventListener(Oa.onUpdate._type,g(this,this.onKeyUpdate))},onRemove:function(){F.root.removeEventListener(t.onTouchBegin._type,g(this,this.onTouchBegin));Wa.onEvent.removeEventListener(Oa.onUpdate._type,g(this,this.onKeyUpdate));y.game.close()},onKeyUpdate:function(a){1==Oa.onUpdate.key.type&&32==Oa.onUpdate.key.keyCode&&this.gameWorld.action()},
delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){this._state=1;this.backImage.set_resource(l.atlas.get(L.uiPath+"ui_back.png"))},onGameStart:function(){this._state=2;this.backImage.set_resource(l.atlas.get(L.uiPath+"ui_retry.png"))},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?this.gameWorld.hero!=a.target?this.gameWorld.remove(a.target):(this.gameWorld.pause(),this._state=3,this.close(),y.home.show(1)):6!=a.trap.type&&(this.gameWorld.pause(),
this.delayReStart.start(.5)))},onTouchBegin:function(a){null==a.currentActor&&this.gameWorld.action()},onBackClick:function(a){a.currentActor==a.downActor&&(2==this._state?this.delayCall():(this.close(),y.edit.show(1)))}});var Ae=function(){fa.call(this);this.targetLevel=-1};Ae.prototype=n(fa.prototype,{onInit:function(){this.loader=new ed;this.data=new Mc;var a=new w;this._txt=a.addComponent(Y);this._txt.addMeshRenderer();this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;
a.setParent(this);a.get_transform().position.set(0,225,0);this.delayReStart=new aa(g(this,this.delayCall));a=new w;a.name="back";var b=a.addComponent(P);this.backImage=b;var c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b=b.rectTransform.anchorY;d=c=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this.backImage.set_resource(l.atlas.get(L.uiPath+"ui_back.png"));a.setParent(this);this.backBtn=a.addComponent(la);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,
25);b=ia.getParam("get");a=m.floatToInt(9*m.randomInstance.getFloat()+1);null!=b&&(b=b.split(":"),b=m.stringToInt(b[0]),null!=b&&(a=b));-1==this.targetLevel&&(this.targetLevel=a);this._state=0},onAdd:function(){F.touchInput.enabled=!0;y.loading.show(4);y.game.show();this.gameWorld=y.game.gameWorld;this.gameWorld.onTrigger=g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);this.gameWorld.onGameStart=g(this,this.onGameStart);F.root.addEventListener(t.onTouchBegin._type,g(this,
this.onTouchBegin));Wa.onEvent.addEventListener(Oa.onUpdate._type,g(this,this.onKeyUpdate));this._state=0;this._txt.set_text("\u5173\u5361"+this.targetLevel);this.loader.loadLevel(this.targetLevel,this.data,g(this,this.success))},onRemove:function(){F.root.removeEventListener(t.onTouchBegin._type,g(this,this.onTouchBegin));Wa.onEvent.removeEventListener(Oa.onUpdate._type,g(this,this.onKeyUpdate));y.game.close()},onKeyUpdate:function(a){1==Oa.onUpdate.key.type&&32==Oa.onUpdate.key.keyCode&&this.gameWorld.action()},
success:function(a){if(-1!=this.viewLayer){y.loading.close();for(var b=Ia.level.getLevel(this.targetLevel),c=a.objects.get_length();0<c--;){var d=a.objects.getArrayElement(c);5==d.type&&(d.params.setValue(4,b.keyLevel),d.params.setValue(5,b.keyTotal))}y.game.load(a)}},delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){this._state=1;this.backImage.set_resource(l.atlas.get(L.uiPath+"ui_back.png"))},onGameStart:function(){this.gameWorld.hero.self=!0;this.gameWorld.add(this.gameWorld.hero);
this._state=2;this.backImage.set_resource(l.atlas.get(L.uiPath+"ui_retry.png"))},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?this.gameWorld.hero!=a.target?this.gameWorld.remove(a.target):(this.gameWorld.pause(),this._state=3,Ea.saveData.setPveLevelState(this.targetLevel,m.floatToInt(2*m.randomInstance.getFloat()+1)),this.close(),y.map.show(0),y.map.focus(this.targetLevel+1)):6!=a.trap.type&&(this.gameWorld.pause(),this.delayReStart.start(.5)))},onTouchBegin:function(a){if(null==a.currentActor)if(1==
this._state&&-1==Ea.saveData.getPveLevelState(this.targetLevel)){a=Ia.level.getLevel(this.targetLevel);var b=a.keyTotal-1;b=m.floatToInt(0==b?1:b*m.randomInstance.getFloat()+1);y.openDoor.setCount(a.keyTotal,a.keyLevel,b);y.openDoor.show(1);y.openDoor.setSuccessCallback(g(this,this.openDoorSuccess))}else this.gameWorld.action()},onBackClick:function(a){a.currentActor==a.downActor&&(2==this._state?this.delayCall():(this.close(),y.map.show(0),y.map.focus(this.targetLevel)))},openDoorSuccess:function(){Ea.saveData.setPveLevelState(this.targetLevel,
0);y.mode_single.show(1)}});var ie=function(){w.call(this);this._updateState=!1;l.init("assets");l.atlas.addAtlas("default/ui.png");this._progress=this._showProgress=0;this._loaded=!1;l.setVersion("version.txt",(new Date).getTime()+"");l.bytes.get("version.txt").addEventListener(B.complete._type,g(this,this.versionComplete))};ie.prototype=n(w.prototype,{onUpdate:function(){if(!this._loaded){if(1>this._progress){var a=this._showProgress;this._showProgress=a+(this._progress-a)*this.deltaTime}else this._showProgress+=
this.deltaTime,1<this._showProgress&&(this._showProgress=1);null!=this._txt&&this._txt.set_text(m.floatToInt(100*this._showProgress)+"%");null!=this._progressBar&&(this._progressBar.rectTransform.width=300*this._showProgress);1<=this._showProgress&&!this._updateState&&(this.finish(),this._loaded=!0)}},viewInit:function(){var a=new w;a.setParent(this);var b=a.addComponent(P),c=a.addComponent(la);a.name="loading";c.scaleEffect=!1;b.addMeshRenderer();a=new w;a.get_transform().position.y=-100;a.setParent(this);
ra.defaultRenderQueue+=10;c=new w;var d=c.addComponent(P);d.set_resource(l.atlas.get("default/ui/Background.png"));d.addMeshRenderer();c.setParent(a);d.rectTransform.width=300;d.rectTransform.height=32;c=new w;this._progressBar=c.addComponent(P);this._progressBar.rectTransform.pivot.x=0;this._progressBar.rectTransform.position.x=-150;this._progressBar.set_resource(l.atlas.get("default/ui/UISprite.png"));this._progressBar.addMeshRenderer();c.setParent(a);this._progressBar.rectTransform.width=0;this._progressBar.rectTransform.height=
32;c=new w;c.setParent(a);this._txt=c.addComponent(Y);this._txt.set_font(l.fnt.get("default/font_en.png"));this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.addMeshRenderer();this._txt.set_text("Loading");this._txt.colorBottom=(new E).setRGBA(858993663);this._txt.colorTop=(new E).setRGBA(858993663);b.set_resource(l.atlas.get("default/splash.jpg"));ra.defaultRenderQueue-=10},versionComplete:function(a){a=a.target;var b=(new Date).getTime()+"";a.enabled&&(b=a.bytes.toString());l.version=
b;l.loadMeta("version.bin",g(this,this.metaSuccess))},metaSuccess:function(){this._progress=this._showProgress=0;this._loaded=!1;this.loadrecord=new ff;this.loadrecord.start();this.viewInit();l.atlas.get("image/pack.png");l.texture.get("image/map/back_castle.jpg");l.texture.get("image/map/wall_castle.jpg");l.texture.get("image/ui/lockBg.jpg");l.texture.get("image/map/1.jpg");Y.defaultFnt=l.fnt.get("font/ch.png");Ia.init(l.table.get("data/data.bin"));this.loadrecord.end(null,g(this,this.progress))},
progress:function(){this._progress=this.loadrecord.loaded/this.loadrecord.total},finish:function(){Ea.init();ab.init();this._txt.set_font(Y.defaultFnt);this._txt.set_text("\u6b63\u5728\u767b\u9646");var a=new gf;a.user="test";a.pass="test";null!=this._progressBar&&(this._progressBar.actor.get_transform().parent.removeFromParent(),this._progressBar=null);this.get_transform().removeFromParent();Y.languageFormat=le.get;y.postInit();F.touchInput.enabled=!0;y.map.show(0)}});var ue=function(){fa.call(this)};
ue.prototype=n(fa.prototype,{onInit:function(){fa.prototype.onInit.call(this);var a=new w;a.setParent(this);this.geom=new bb;this.geom.color=new Ab;var b=-(.5*Da.width+50),c=-b,d=.5*Da.height+50,e=-d,f=new E(0,0,0,1),r=new E(0,0,0,0);this.geom.position.push(h.instance.set(b,e,0));this.geom.color.push(f);this.geom.position.push(h.instance.set(c,e,0));this.geom.color.push(f);this.geom.position.push(h.instance.set(c,d,0));this.geom.color.push(f);this.geom.position.push(h.instance.set(b,d,0));this.geom.color.push(f);
b=-400;c=400;d=250;e=-250;this.geom.position.push(h.instance.set(b,e,0));this.geom.color.push(r);this.geom.position.push(h.instance.set(c,e,0));this.geom.color.push(r);this.geom.position.push(h.instance.set(c,d,0));this.geom.color.push(r);this.geom.position.push(h.instance.set(b,d,0));this.geom.color.push(r);this.geom.group.indices.push3(0,1,5);this.geom.group.indices.push3(5,4,0);this.geom.group.indices.push3(1,2,6);this.geom.group.indices.push3(6,5,1);this.geom.group.indices.push3(2,3,7);this.geom.group.indices.push3(7,
6,2);this.geom.group.indices.push3(3,0,4);this.geom.group.indices.push3(4,7,3);b=new Ba;b.fromBuffer(this.geom);a=a.addComponent(zb);a.get_material().renderQueue=4E4;a.mesh=b}});var Zc=function(){this.kv=new Sd;this.protocol=-1;Zc.service.add(this)};Zc.prototype={};var gf=function(){Zc.call(this);this.protocol=1};gf.prototype=n(Zc.prototype,{});var Td=function(){this.kv=new Sd;this.protocol=-1};Td.prototype={};var Ze=function(){Td.call(this);this.protocol=1};Ze.prototype=n(Td.prototype,{});var hf=
function(a,b){this.high=a;this.low=b};hf.prototype={};var Ta=function(){this.buf=new Fb;this.cache=[];this.useCache=Ta.USE_CACHE;this.useEnumIndex=Ta.USE_ENUM_INDEX;this.shash=new K;this.scount=0};Ta.run=function(a){var b=new Ta;b.serialize(a);return b.toString()};Ta.prototype={toString:function(){return this.buf.b},serializeString:function(a){var b=this.shash;b=null!=p[a]?b.getReserved(a):b.h[a];if(null!=b)this.buf.b+="R",this.buf.b+=null==b?"null":""+b;else{b=this.shash;var c=this.scount++;null!=
p[a]?b.setReserved(a,c):b.h[a]=c;this.buf.b+="y";a=encodeURIComponent(a);this.buf.b+=da.string(a.length);this.buf.b+=":";this.buf.b+=null==a?"null":""+a}},serializeRef:function(a){for(var b=typeof a,c=0,d=this.cache.length;c<d;){var e=c++,f=this.cache[e];if(typeof f==b&&f==a)return this.buf.b+="r",this.buf.b+=null==e?"null":""+e,!0}this.cache.push(a);return!1},serializeFields:function(a){for(var b=0,c=ma.fields(a);b<c.length;){var d=c[b];++b;this.serializeString(d);this.serialize(ma.field(a,d))}this.buf.b+=
"g"},serialize:function(a){var b=wb.typeof(a);switch(b._hx_index){case 0:this.buf.b+="n";break;case 1:if(0==a){this.buf.b+="z";break}this.buf.b+="i";this.buf.b+=null==a?"null":""+a;break;case 2:isNaN(a)?this.buf.b+="k":isFinite(a)?(this.buf.b+="d",this.buf.b+=null==a?"null":""+a):this.buf.b+=0>a?"m":"p";break;case 3:this.buf.b+=a?"t":"f";break;case 4:U.__instanceof(a,jf)?(a=a.__name__,this.buf.b+="A",this.serializeString(a)):U.__instanceof(a,kf)?(this.buf.b+="B",this.serializeString(a.__ename__)):
this.useCache&&this.serializeRef(a)||(this.buf.b+="o",this.serializeFields(a));break;case 5:throw new u("Cannot serialize function");case 6:b=b.c;if(b==String){this.serializeString(a);break}if(this.useCache&&this.serializeRef(a))break;switch(b){case Array:b=0;this.buf.b+="a";for(var c=0,d=a.length;c<d;){var e=c++;null==a[e]?++b:(0<b&&(1==b?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==b?"null":""+b),b=0),this.serialize(a[e]))}0<b&&(1==b?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==b?"null":
""+b));this.buf.b+="h";break;case Date:this.buf.b+="v";this.buf.b+=da.string(a.getTime());break;case ba:this.buf.b+="q";for(b=a.keys();b.hasNext();)c=b.next(),this.buf.b+=":",this.buf.b+=null==c?"null":""+c,this.serialize(a.h[c]);this.buf.b+="h";break;case Ud:this.buf.b+="l";for(a=a.h;null!=a;)b=a.item,a=a.next,this.serialize(b);this.buf.b+="h";break;case gd:this.buf.b+="M";for(b=a.keys();b.hasNext();)c=b.next(),d=ma.field(c,"__id__"),ma.deleteField(c,"__id__"),this.serialize(c),c.__id__=d,this.serialize(a.h[c.__id__]);
this.buf.b+="h";break;case K:this.buf.b+="b";for(b=a.keys();b.hasNext();)c=b.next(),this.serializeString(c),this.serialize(null!=p[c]?a.getReserved(c):a.h[c]);this.buf.b+="h";break;case Aa:this.buf.b+="s";this.buf.b+=da.string(Math.ceil(8*a.length/6));this.buf.b+=":";c=0;d=a.length-2;b=Ta.BASE64_CODES;if(null==b){b=Array(Ta.BASE64.length);e=0;for(var f=Ta.BASE64.length;e<f;){var r=e++;b[r]=x.cca(Ta.BASE64,r)}Ta.BASE64_CODES=b}for(;c<d;)e=a.b[c++],f=a.b[c++],r=a.b[c++],this.buf.b+=String.fromCodePoint(b[e>>
2]),this.buf.b+=String.fromCodePoint(b[(e<<4|f>>4)&63]),this.buf.b+=String.fromCodePoint(b[(f<<2|r>>6)&63]),this.buf.b+=String.fromCodePoint(b[r&63]);c==d?(d=a.b[c++],a=a.b[c++],this.buf.b+=String.fromCodePoint(b[d>>2]),this.buf.b+=String.fromCodePoint(b[(d<<4|a>>4)&63]),this.buf.b+=String.fromCodePoint(b[a<<2&63])):c==d+1&&(a=a.b[c++],this.buf.b+=String.fromCodePoint(b[a>>2]),this.buf.b+=String.fromCodePoint(b[a<<4&63]));break;default:this.useCache&&this.cache.pop(),null!=a.hxSerialize?(this.buf.b+=
"C",this.serializeString(b.__name__),this.useCache&&this.cache.push(a),a.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(b.__name__),this.useCache&&this.cache.push(a),this.serializeFields(a))}break;case 7:b=b.e;if(this.useCache){if(this.serializeRef(a))break;this.cache.pop()}this.buf.b+=da.string(this.useEnumIndex?"j":"w");this.serializeString(b.__ename__);this.useEnumIndex?(this.buf.b+=":",this.buf.b+=da.string(a._hx_index)):this.serializeString(Ma[a.__enum__].__constructs__[a._hx_index]);
this.buf.b+=":";b=wb.enumParameters(a);this.buf.b+=da.string(b.length);for(c=0;c<b.length;)d=b[c],++c,this.serialize(d);this.useCache&&this.cache.push(a);break;default:throw new u("Cannot serialize "+da.string(a));}}};var Tc=function(a){var b=this;this.id=setInterval(function(){b.run()},a)};Tc.delay=function(a,b){var c=new Tc(b);c.run=function(){c.stop();a()};return c};Tc.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){}};var Vd=function(){};Vd.prototype=
{resolveClass:function(a){return Ya[a]},resolveEnum:function(a){return Ma[a]}};var db=function(a){this.buf=a;this.length=a.length;this.pos=0;this.scache=[];this.cache=[];a=db.DEFAULT_RESOLVER;null==a&&(a=new Vd,db.DEFAULT_RESOLVER=a);this.resolver=a};db.initCodes=function(){for(var a=[],b=0,c=db.BASE64.length;b<c;){var d=b++;a[db.BASE64.charCodeAt(d)]=d}return a};db.prototype={readDigits:function(){for(var a=0,b=!1,c=this.pos;;){var d=this.buf.charCodeAt(this.pos);if(d!=d)break;if(45==d){if(this.pos!=
c)break;b=!0}else{if(48>d||57<d)break;a=10*a+(d-48)}this.pos++}b&&(a*=-1);return a},readFloat:function(){for(var a=this.pos;;){var b=this.buf.charCodeAt(this.pos);if(b!=b)break;if(43<=b&&58>b||101==b||69==b)this.pos++;else break}return parseFloat(x.substr(this.buf,a,this.pos-a))},unserializeObject:function(a){for(;;){if(this.pos>=this.length)throw new u("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var b=this.unserialize();if("string"!=typeof b)throw new u("Invalid object key");var c=
this.unserialize();a[b]=c}this.pos++},unserializeEnum:function(a,b){if(58!=this.buf.charCodeAt(this.pos++))throw new u("Invalid enum format");var c=this.readDigits();if(0==c)return wb.createEnum(a,b);for(var d=[];0<c--;)d.push(this.unserialize());return wb.createEnum(a,b,d)},unserialize:function(){switch(this.buf.charCodeAt(this.pos++)){case 65:var a=this.unserialize(),b=this.resolver.resolveClass(a);if(null==b)throw new u("Class not found "+a);return b;case 66:a=this.unserialize();b=this.resolver.resolveEnum(a);
if(null==b)throw new u("Enum not found "+a);return b;case 67:a=this.unserialize();b=this.resolver.resolveClass(a);if(null==b)throw new u("Class not found "+a);a=Object.create(b.prototype);this.cache.push(a);a.hxUnserialize(this);if(103!=this.buf.charCodeAt(this.pos++))throw new u("Invalid custom data");return a;case 77:a=new gd;for(this.cache.push(a);104!=this.buf.charCodeAt(this.pos);)b=this.unserialize(),a.set(b,this.unserialize());this.pos++;return a;case 82:a=this.readDigits();if(0>a||a>=this.scache.length)throw new u("Invalid string reference");
return this.scache[a];case 97:a=[];for(this.cache.push(a);;){b=this.buf.charCodeAt(this.pos);if(104==b){this.pos++;break}117==b?(this.pos++,b=this.readDigits(),a[a.length+b-1]=null):a.push(this.unserialize())}return a;case 98:a=new K;for(this.cache.push(a);104!=this.buf.charCodeAt(this.pos);){b=this.unserialize();var c=this.unserialize();null!=p[b]?a.setReserved(b,c):a.h[b]=c}this.pos++;return a;case 99:a=this.unserialize();b=this.resolver.resolveClass(a);if(null==b)throw new u("Class not found "+
a);a=Object.create(b.prototype);this.cache.push(a);this.unserializeObject(a);return a;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:a=this.unserialize();b=this.resolver.resolveEnum(a);if(null==b)throw new u("Enum not found "+a);this.pos++;c=this.readDigits();var d=b.__constructs__.slice()[c];if(null==d)throw new u("Unknown enum index "+a+"@"+c);a=this.unserializeEnum(b,d);this.cache.push(a);return a;case 107:return NaN;case 108:a=new Ud;for(this.cache.push(a);104!=
this.buf.charCodeAt(this.pos);)a.add(this.unserialize());this.pos++;return a;case 109:return-Infinity;case 110:return null;case 111:return a={},this.cache.push(a),this.unserializeObject(a),a;case 112:return Infinity;case 113:a=new ba;this.cache.push(a);for(b=this.buf.charCodeAt(this.pos++);58==b;)b=this.readDigits(),c=this.unserialize(),a.h[b]=c,b=this.buf.charCodeAt(this.pos++);if(104!=b)throw new u("Invalid IntMap format");return a;case 114:a=this.readDigits();if(0>a||a>=this.cache.length)throw new u("Invalid reference");
return this.cache[a];case 115:a=this.readDigits();d=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<a)throw new u("Invalid bytes length");var e=db.CODES;null==e&&(e=db.initCodes(),db.CODES=e);var f=this.pos,r=a&3,h=f+(a-r);b=new Aa(new ArrayBuffer(3*(a>>2)+(2<=r?r-1:0)));for(c=0;f<h;){var g=e[d.charCodeAt(f++)],k=e[d.charCodeAt(f++)];b.b[c++]=g<<2|k>>4;g=e[d.charCodeAt(f++)];b.b[c++]=k<<4|g>>2;k=e[d.charCodeAt(f++)];b.b[c++]=g<<6|k}2<=r&&(k=e[d.charCodeAt(f++)],h=e[d.charCodeAt(f++)],
b.b[c++]=k<<2|h>>4,3==r&&(d=e[d.charCodeAt(f++)],b.b[c++]=h<<4|d>>2));this.pos+=a;this.cache.push(b);return b;case 116:return!0;case 118:return 48<=this.buf.charCodeAt(this.pos)&&57>=this.buf.charCodeAt(this.pos)&&48<=this.buf.charCodeAt(this.pos+1)&&57>=this.buf.charCodeAt(this.pos+1)&&48<=this.buf.charCodeAt(this.pos+2)&&57>=this.buf.charCodeAt(this.pos+2)&&48<=this.buf.charCodeAt(this.pos+3)&&57>=this.buf.charCodeAt(this.pos+3)&&45==this.buf.charCodeAt(this.pos+4)?(a=x.strDate(x.substr(this.buf,
this.pos,19)),this.pos+=19):a=new Date(this.readFloat()),this.cache.push(a),a;case 119:a=this.unserialize();b=this.resolver.resolveEnum(a);if(null==b)throw new u("Enum not found "+a);a=this.unserializeEnum(b,this.unserialize());this.cache.push(a);return a;case 120:throw u.wrap(this.unserialize());case 121:a=this.readDigits();if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<a)throw new u("Invalid string length");b=x.substr(this.buf,this.pos,a);this.pos+=a;b=decodeURIComponent(b.split("+").join(" "));
this.scache.push(b);return b;case 122:return 0}this.pos--;throw new u("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos);}};var Aa=function(a){this.length=a.byteLength;this.b=new Uint8Array(a);this.b.bufferValue=a;a.hxBytes=this;a.bytes=this.b};Aa.ofString=function(a,b){if(b==lf.RawNative){b=new Uint8Array(a.length<<1);for(var c=0,d=a.length;c<d;){var e=c++,f=a.charCodeAt(e);b[e<<1]=f&255;b[e<<1|1]=f>>8}return new Aa(b.buffer)}b=[];for(c=0;c<a.length;)d=a.charCodeAt(c++),55296<=d&&
56319>=d&&(d=d-55232<<10|a.charCodeAt(c++)&1023),127>=d?b.push(d):(2047>=d?b.push(192|d>>6):(65535>=d?b.push(224|d>>12):(b.push(240|d>>18),b.push(128|d>>12&63)),b.push(128|d>>6&63)),b.push(128|d&63));return new Aa((new Uint8Array(b)).buffer)};Aa.ofData=function(a){var b=a.hxBytes;return null!=b?b:new Aa(a)};Aa.prototype={blit:function(a,b,c,d){if(0>a||0>c||0>d||a+d>this.length||c+d>b.length)throw new u(mf.OutsideBounds);0==c&&d==b.b.byteLength?this.b.set(b.b,a):this.b.set(b.b.subarray(c,c+d),a)},
getString:function(a,b,c){if(0>a||0>b||a+b>this.length)throw new u(mf.OutsideBounds);null==c&&(c=lf.UTF8);var d="",e=this.b,f=a;a+=b;switch(c._hx_index){case 0:for(;f<a;)if(c=e[f++],128>c){if(0==c)break;d+=String.fromCodePoint(c)}else if(224>c)c=(c&63)<<6|e[f++]&127,d+=String.fromCodePoint(c);else if(240>c)b=e[f++],c=(c&31)<<12|(b&127)<<6|e[f++]&127,d+=String.fromCodePoint(c);else{b=e[f++];var r=e[f++];c=(c&15)<<18|(b&127)<<12|(r&127)<<6|e[f++]&127;d+=String.fromCodePoint(c)}break;case 1:for(;f<a;)c=
e[f++]|e[f++]<<8,d+=String.fromCodePoint(c)}return d},toString:function(){return this.getString(0,this.length)}};var lf=Ma["haxe.io.Encoding"]={__ename__:"haxe.io.Encoding",__constructs__:["UTF8","RawNative"],UTF8:{_hx_index:0,__enum__:"haxe.io.Encoding",toString:Z},RawNative:{_hx_index:1,__enum__:"haxe.io.Encoding",toString:Z}},kb=function(){};kb.encode=function(a,b){null==b&&(b=!0);var c=(new Wd(kb.BYTES)).encodeBytes(a).toString();if(b)switch(a.length%3){case 1:c+="==";break;case 2:c+="="}return c};
kb.decode=function(a,b){null==b&&(b=!0);if(b)for(;61==x.cca(a,a.length-1);)a=x.substr(a,0,-1);return(new Wd(kb.BYTES)).decodeBytes(Aa.ofString(a))};var Wd=function(a){for(var b=a.length,c=1;b>1<<c;)++c;if(8<c||b!=1<<c)throw new u("BaseCode : base length must be a power of two.");this.base=a;this.nbits=c};Wd.prototype={encodeBytes:function(a){for(var b=this.nbits,c=this.base,d=8*a.length/b|0,e=new Aa(new ArrayBuffer(d+(0==8*a.length%b?0:1))),f=0,r=0,h=(1<<b)-1,g=0,k=0;k<d;){for(;r<b;)r+=8,f<<=8,f|=
a.b[g++];r-=b;e.b[k++]=c.b[f>>r&h]}0<r&&(e.b[k++]=c.b[f<<b-r&h]);return e},initTable:function(){for(var a=[],b=0;256>b;){var c=b++;a[c]=-1}b=0;for(c=this.base.length;b<c;){var d=b++;a[this.base.b[d]]=d}this.tbl=a},decodeBytes:function(a){var b=this.nbits;null==this.tbl&&this.initTable();for(var c=this.tbl,d=a.length*b>>3,e=new Aa(new ArrayBuffer(d)),f=0,r=0,h=0,g=0;g<d;){for(;8>r;){r+=b;f<<=b;var k=c[a.b[h++]];if(-1==k)throw new u("BaseCode : invalid encoded char");f|=k}r-=8;e.b[g++]=f>>r&255}return e}};
var Ud=function(){this.length=0};Ud.prototype={add:function(a){a=new nf(a,null);null==this.h?this.h=a:this.q.next=a;this.q=a;this.length++}};var nf=function(a,b){this.item=a;this.next=b};nf.prototype={};var gd=function(){this.h={__keys__:{}}};gd.prototype={set:function(a,b){var c=a.__id__||(a.__id__=O.$haxeUID++);this.h[c]=b;this.h.__keys__[c]=a},get:function(a){return this.h[a.__id__]},keys:function(){var a=[],b;for(b in this.h.__keys__)this.h.hasOwnProperty(b)&&a.push(this.h.__keys__[b]);return x.iter(a)}};
var Hb=function(a,b){this.map=a;this.keys=b;this.index=0;this.count=b.length};Hb.prototype={hasNext:function(){return this.index<this.count},next:function(){var a=this.map,b=this.keys[this.index++];return null!=p[b]?a.getReserved(b):a.h[b]}};var mf=Ma["haxe.io.Error"]={__ename__:"haxe.io.Error",__constructs__:["Blocked","Overflow","OutsideBounds","Custom"],Blocked:{_hx_index:0,__enum__:"haxe.io.Error",toString:Z},Overflow:{_hx_index:1,__enum__:"haxe.io.Error",toString:Z},OutsideBounds:{_hx_index:2,
__enum__:"haxe.io.Error",toString:Z},Custom:(M=function(a){return{_hx_index:3,e:a,__enum__:"haxe.io.Error",toString:Z}},M.__params__=["e"],M)},hd=function(){};hd.i32ToFloat=function(a){hd.helper.setInt32(0,a,!0);return hd.helper.getFloat32(0,!0)};var $c=function(a){this.map=a;this.keys=a.keys()};$c.prototype={hasNext:function(){return this.keys.hasNext()},next:function(){var a=this.keys.next();return{value:this.map.get(a),key:a}}};var rb=function(){};rb.getType=function(a){a=rb.getMeta(a);return null==
a||null==a.obj?{}:a.obj};rb.getMeta=function(a){return a.__meta__};rb.getStatics=function(a){a=rb.getMeta(a);return null==a||null==a.statics?{}:a.statics};rb.getFields=function(a){a=rb.getMeta(a);return null==a||null==a.fields?{}:a.fields};var za=function(a,b,c){this.xml=b;this.message=a;this.position=c;this.lineNumber=1;for(a=this.positionAtLine=0;a<c;){var d=a++;d=b.charCodeAt(d);10==d?(this.lineNumber++,this.positionAtLine=0):13!=d&&this.positionAtLine++}};za.prototype={toString:function(){return U.getClass(this).__name__+
": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine}};var Gb=function(){};Gb.parse=function(a,b){null==b&&(b=!1);var c=v.createDocument();Gb.doParse(a,b,0,c);return c};Gb.doParse=function(a,b,c,d){null==c&&(c=0);for(var e=null,f=1,r=1,h=null,g=0,k=0,n=0,l=a.charCodeAt(c),m=new Fb,q=1,t=-1;l==l;){switch(f){case 0:switch(l){case 9:case 10:case 13:case 32:break;default:f=r;continue}break;case 1:if(60==l)f=0,r=2;else{g=c;f=13;continue}break;case 2:switch(l){case 33:if(91==a.charCodeAt(c+
1)){c+=2;if("CDATA["!=x.substr(a,c,6).toUpperCase())throw new u(new za("Expected <![CDATA[",a,c));c+=5;f=17}else if(68==a.charCodeAt(c+1)||100==a.charCodeAt(c+1)){if("OCTYPE"!=x.substr(a,c+2,6).toUpperCase())throw new u(new za("Expected <!DOCTYPE",a,c));c+=8;f=16}else{if(45!=a.charCodeAt(c+1)||45!=a.charCodeAt(c+2))throw new u(new za("Expected \x3c!--",a,c));c+=2;f=15}g=c+1;break;case 47:if(null==d)throw new u(new za("Expected node name",a,c));g=c+1;f=0;r=10;break;case 63:f=14;g=c;break;default:f=
3;g=c;continue}break;case 3:if(!(97<=l&&122>=l||65<=l&&90>=l||48<=l&&57>=l||58==l||46==l||95==l||45==l)){if(c==g)throw new u(new za("Expected node name",a,c));e=v.createElement(x.substr(a,g,c-g));d.addChild(e);++k;f=0;r=4;continue}break;case 4:switch(l){case 47:f=11;break;case 62:f=9;break;default:f=5;g=c;continue}break;case 5:if(!(97<=l&&122>=l||65<=l&&90>=l||48<=l&&57>=l||58==l||46==l||95==l||45==l)){if(g==c)throw new u(new za("Expected attribute name",a,c));h=x.substr(a,g,c-g);if(e.exists(h))throw new u(new za("Duplicate attribute ["+
h+"]",a,c));f=0;r=6;continue}break;case 6:if(61==l)f=0,r=7;else throw new u(new za("Expected =",a,c));break;case 7:switch(l){case 34:case 39:m=new Fb;f=8;g=c+1;t=l;break;default:throw new u(new za('Expected "',a,c));}break;case 8:switch(l){case 38:q=c-g;m.b+=null==q?x.substr(a,g,null):x.substr(a,g,q);f=18;q=8;g=c+1;break;case 60:case 62:if(b)throw new u(new za("Invalid unescaped "+String.fromCodePoint(l)+" in attribute value",a,c));l==t&&(r=c-g,m.b+=null==r?x.substr(a,g,null):x.substr(a,g,r),r=m.b,
m=new Fb,e.set(h,r),f=0,r=4);break;default:l==t&&(r=c-g,m.b+=null==r?x.substr(a,g,null):x.substr(a,g,r),r=m.b,m=new Fb,e.set(h,r),f=0,r=4)}break;case 9:g=c=Gb.doParse(a,b,c,e);f=1;break;case 10:if(!(97<=l&&122>=l||65<=l&&90>=l||48<=l&&57>=l||58==l||46==l||95==l||45==l)){if(g==c)throw new u(new za("Expected node name",a,c));r=x.substr(a,g,c-g);if(null==d||0!=d.nodeType)throw new u(new za("Unexpected </"+r+">, tag is not open",a,c));if(d.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+
ca.toString(d.nodeType));if(r!=d.nodeName){if(d.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(d.nodeType));throw new u(new za("Expected </"+d.nodeName+">",a,c));}f=0;r=12;continue}break;case 11:if(62==l)f=1;else throw new u(new za("Expected >",a,c));break;case 12:if(62==l)return 0==k&&d.addChild(v.createPCData("")),c;throw new u(new za("Expected >",a,c));case 13:60==l?(r=c-g,m.b+=null==r?x.substr(a,g,null):x.substr(a,g,r),r=v.createPCData(m.b),m=new Fb,d.addChild(r),
++k,f=0,r=2):38==l&&(q=c-g,m.b+=null==q?x.substr(a,g,null):x.substr(a,g,q),f=18,q=13,g=c+1);break;case 14:63==l&&62==a.charCodeAt(c+1)&&(++c,l=x.substr(a,g+1,c-g-2),d.addChild(v.createProcessingInstruction(l)),++k,f=1);break;case 15:45==l&&45==a.charCodeAt(c+1)&&62==a.charCodeAt(c+2)&&(d.addChild(v.createComment(x.substr(a,g,c-g))),++k,c+=2,f=1);break;case 16:91==l?++n:93==l?--n:62==l&&0==n&&(d.addChild(v.createDocType(x.substr(a,g,c-g))),++k,f=1);break;case 17:93==l&&93==a.charCodeAt(c+1)&&62==a.charCodeAt(c+
2)&&(l=v.createCData(x.substr(a,g,c-g)),d.addChild(l),++k,c+=2,f=1);break;case 18:if(59==l){g=x.substr(a,g,c-g);if(35==g.charCodeAt(0))g=120==g.charCodeAt(1)?da.parseInt("0"+x.substr(g,1,g.length-1)):da.parseInt(x.substr(g,1,g.length-1)),m.b+=String.fromCodePoint(g);else if(l=Gb.escapes,null!=p[g]?l.existsReserved(g):l.h.hasOwnProperty(g))l=Gb.escapes,g=null!=p[g]?l.getReserved(g):l.h[g],m.b+=da.string(g);else{if(b)throw new u(new za("Undefined entity: "+g,a,c));m.b+=da.string("&"+g+";")}g=c+1;f=
q}else if(!(97<=l&&122>=l||65<=l&&90>=l||48<=l&&57>=l||58==l||46==l||95==l||45==l)&&35!=l){if(b)throw new u(new za("Invalid character in entity: "+String.fromCodePoint(l),a,c));m.b+=String.fromCodePoint(38);l=c-g;m.b+=null==l?x.substr(a,g,null):x.substr(a,g,l);--c;g=c+1;f=q}}l=a.charCodeAt(++c)}1==f&&(g=c,f=13);if(13==f){if(0==d.nodeType){if(d.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(d.nodeType));throw new u(new za("Unclosed node <"+d.nodeName+">",a,
c));}if(c!=g||0==k)b=c-g,m.b+=null==b?x.substr(a,g,null):x.substr(a,g,b),d.addChild(v.createPCData(m.b));return c}if(!b&&18==f&&13==q)return m.b+=String.fromCodePoint(38),b=c-g,m.b+=null==b?x.substr(a,g,null):x.substr(a,g,b),d.addChild(v.createPCData(m.b)),c;throw new u(new za("Unexpected end",a,c));};var ld=function(a){this.output=new Fb;this.pretty=a};ld.print=function(a,b){null==b&&(b=!1);b=new ld(b);b.writeNode(a,"");return b.output.b};ld.prototype={writeNode:function(a,b){switch(a.nodeType){case 0:this.output.b+=
da.string(b+"<");if(a.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(a.nodeType));this.output.b+=da.string(a.nodeName);for(var c=a.attributes();c.hasNext();){var d=c.next();this.output.b+=da.string(" "+d+'="');d=ea.htmlEscape(a.get(d),!0);this.output.b+=da.string(d);this.output.b+='"'}if(this.hasChildren(a)){this.output.b+=">";this.pretty&&(this.output.b+="\n");if(a.nodeType!=v.Document&&a.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+
ca.toString(a.nodeType));for(c=x.iter(a.children);c.hasNext();)d=c.next(),this.writeNode(d,this.pretty?b+"\t":b);this.output.b+=da.string(b+"</");if(a.nodeType!=v.Element)throw new u("Bad node type, expected Element but found "+ca.toString(a.nodeType));this.output.b+=da.string(a.nodeName);this.output.b+=">"}else this.output.b+="/>";this.pretty&&(this.output.b+="\n");break;case 1:if(a.nodeType==v.Document||a.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(a.nodeType));a=a.nodeValue;
0!=a.length&&(b+=ea.htmlEscape(a),this.output.b+=da.string(b),this.pretty&&(this.output.b+="\n"));break;case 2:this.output.b+=da.string(b+"<![CDATA[");if(a.nodeType==v.Document||a.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(a.nodeType));this.output.b+=da.string(a.nodeValue);this.output.b+="]]\x3e";this.pretty&&(this.output.b+="\n");break;case 3:if(a.nodeType==v.Document||a.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(a.nodeType));a=a.nodeValue;
a=a.replace(/[\n\r\t]+/g,"");this.output.b+=null==b?"null":""+b;b=ea.trim("\x3c!--"+a+"--\x3e");this.output.b+=da.string(b);this.pretty&&(this.output.b+="\n");break;case 4:if(a.nodeType==v.Document||a.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(a.nodeType));this.output.b+=da.string("<!DOCTYPE "+a.nodeValue+">");this.pretty&&(this.output.b+="\n");break;case 5:if(a.nodeType==v.Document||a.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(a.nodeType));
this.output.b+=da.string("<?"+a.nodeValue+"?>");this.pretty&&(this.output.b+="\n");break;case 6:if(a.nodeType!=v.Document&&a.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+ca.toString(a.nodeType));for(a=x.iter(a.children);a.hasNext();)c=a.next(),this.writeNode(c,b)}},hasChildren:function(a){if(a.nodeType!=v.Document&&a.nodeType!=v.Element)throw new u("Bad node type, expected Element or Document but found "+ca.toString(a.nodeType));for(a=x.iter(a.children);a.hasNext();){var b=
a.next();switch(b.nodeType){case 0:case 1:return!0;case 2:case 3:if(b.nodeType==v.Document||b.nodeType==v.Element)throw new u("Bad node type, unexpected "+ca.toString(b.nodeType));if(0!=ea.ltrim(b.nodeValue).length)return!0}}return!1}};var u=function(a){Error.call(this);this.val=a;Error.captureStackTrace&&Error.captureStackTrace(this,u)};u.wrap=function(a){return a instanceof Error?a:new u(a)};u.prototype=n(Error.prototype,{});var U=function(){};U.getClass=function(a){if(null==a)return null;if(a instanceof
Array&&null==a.__enum__)return Array;var b=a.__class__;if(null!=b)return b;a=U.__nativeClassName(a);return null!=a?U.__resolveNativeClass(a):null};U.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a.__enum__){var d=Ma[a.__enum__];c=d.__constructs__[a._hx_index];var e=d[c];if(e.__params__){b+="\t";d=[];var f=0;for(e=e.__params__;f<e.length;){var g=
e[f];f+=1;d.push(U.__string_rec(a[g],b))}return c+"("+d.join(",")+")"}return c}if(a instanceof Array){c="[";b+="\t";d=0;for(f=a.length;d<f;)e=d++,c+=(0<e?",":"")+U.__string_rec(a[e],b);return c+"]"}try{d=a.toString}catch(sg){return"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d&&(c=a.toString(),"[object Object]"!=c))return c;c="{\n";b+="\t";d=null!=a.hasOwnProperty;f=null;for(f in a)d&&!a.hasOwnProperty(f)||"prototype"==f||"__class__"==f||"__super__"==f||"__interfaces__"==f||"__properties__"==
f||(2!=c.length&&(c+=", \n"),c+=b+f+" : "+U.__string_rec(a[f],b));b=b.substring(1);return c+("\n"+b+"}");case "string":return a;default:return String(a)}};U.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;if(Object.prototype.hasOwnProperty.call(a,"__interfaces__"))for(var c=a.__interfaces__,d=0,e=c.length;d<e;){var f=d++;f=c[f];if(f==b||U.__interfLoop(f,b))return!0}return U.__interfLoop(a.__super__,b)};U.__instanceof=function(a,b){if(null==b)return!1;switch(b){case Array:return a instanceof
Array;case qg:return"boolean"==typeof a;case rg:return null!=a;case of:return"number"==typeof a;case Xd:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(U.__downcastCheck(a,b))return!0}else{if("object"==typeof b&&U.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==jf&&null!=a.__name__||b==kf&&null!=a.__ename__?!0:null!=a.__enum__?Ma[a.__enum__]==b:!1}};U.__downcastCheck=function(a,b){return a instanceof b?!0:
b.__isInterface__?U.__interfLoop(U.getClass(a),b):!1};U.__cast=function(a,b){if(null==a||U.__instanceof(a,b))return a;throw new u("Cannot cast "+da.string(a)+" to "+da.string(b));};U.__nativeClassName=function(a){a=U.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};U.__isNativeObj=function(a){return null!=U.__nativeClassName(a)};U.__resolveNativeClass=function(a){return O[a]};var Gd=function(){};Gd.getLocalStorage=function(){try{var a=window.localStorage;
a.getItem("");if(0==a.length){var b="_hx_"+Math.random();a.setItem(b,b);a.removeItem(b)}return a}catch(c){return null}};var Ua=function(){this._pool=J.current;this.instanceID=Ua._id++;this._vec3=h.instance;this._hsv=wd.instance};Ua.prototype={start:function(a,b){this._life=this._duration=a;null!=b&&(this._color=new E,this._color.copy(b))},fill:function(a,b){var c=1;0<this._duration&&(c=this._life/this._duration);this.onFill(a,c);this._life-=b;return 0>=this._life?(this._pool.set(this),!1):!0},onFill:function(a,
b){},getColor:function(a){if(null!=this._color)return this._color.w=a,this._color;Ua._c.w=a;return Ua._c}};var pf=function(){Ua.call(this);this.position=new h;this.rotation=new xa};pf.prototype=n(Ua.prototype,{setup:function(a,b,c){this.position.copy(a);this.radius=b;this.rotation.setEulerAngles(0,0,0);this.rotation.copy(c)},onFill:function(a,b){for(var c=Math.sin,d=Math.cos,e=this.getColor(b),f=0;18>f;){var g=f++,h=this._hsv,k=20*g,l=1,m=1;null==m&&(m=1);null==l&&(l=1);null==k&&(k=0);h.h=k;h.s=l;
h.v=m;k=.3490658503988659*g;h=d(k)*this.radius;k=c(k)*this.radius;this.rotation.rotate(this._vec3.set(h,k,0)).add(this.position);null==this._color&&(e=this._hsv.toColor(),e.w=b);a.addVertex(this._vec3,e);h=g+1;18<=h&&(h=0);a.addIndex(g,h)}}});var wd=function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=0);this.h=a;this.s=b;this.v=c};wd.prototype={toColor:function(){var a=E.instance;if(0==this.s){var b=this.v,c=this.v,d=this.v,e=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=
b;a.y=c;a.z=d;a.w=e;return a}b=this.h%360/60;e=b|0;d=b-e;b=this.v*(1-this.s);c=this.v*(1-this.s*d);d=this.v*(1-this.s*(1-d));switch(e){case 0:c=this.v;e=1;null==e&&(e=1);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.z=b;a.w=e;break;case 1:d=this.v;e=1;null==e&&(e=1);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.z=b;a.w=e;break;case 2:c=this.v;e=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;break;case 3:d=this.v;e=1;null==e&&(e=1);null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;break;case 4:c=d;d=this.v;e=1;null==e&&(e=1);null==d&&(d=0);null==b&&(b=0);null==c&&(c=0);a.x=c;a.y=b;a.z=d;a.w=e;break;case 5:d=this.v,e=1,null==e&&(e=1),null==c&&(c=0),null==b&&(b=0),null==d&&(d=0),a.x=d,a.y=b,a.z=c,a.w=e}return a}};var qf=function(){Ua.call(this);this.p1=new h;this.p2=new h};qf.prototype=n(Ua.prototype,{setup:function(a,b){this.p1.copy(a);this.p2.copy(b)},onFill:function(a,b){b=this.getColor(b);a.addVertex(this.p1,
b);a.addVertex(this.p2,b);a.addIndex(0,1)}});var rf=function(){Ua.call(this);this.pos=new h;this.right=new h;this.up=new h};rf.prototype=n(Ua.prototype,{setup:function(a,b,c){this.pos.copy(a);this.right.set(1,0,0);this.up.set(0,1,0);this.right.copy(b);this.up.copy(c)},onFill:function(a,b){b=this.getColor(b);this._vec3.copy(this.pos).sub(this.right).sub(this.up);a.addVertex(this._vec3,b);this._vec3.copy(this.pos).add(this.right).sub(this.up);a.addVertex(this._vec3,b);this._vec3.copy(this.pos).add(this.right).add(this.up);
a.addVertex(this._vec3,b);this._vec3.copy(this.pos).sub(this.right).add(this.up);a.addVertex(this._vec3,b);a.addIndex(0,1);a.addIndex(1,2);a.addIndex(2,3);a.addIndex(3,0)}});var sf=function(){Ua.call(this);this.point1=new h;this.point2=new h;this.point3=new h};sf.prototype=n(Ua.prototype,{setup:function(a,b,c){this.point1.copy(a);this.point2.copy(b);this.point3.copy(c)},onFill:function(a,b){b=this.getColor(b);a.addVertex(this.point1,b);a.addVertex(this.point2,b);a.addVertex(this.point3,b);a.addIndex(0,
1);a.addIndex(1,2);a.addIndex(2,0)}});var tf=function(){this.geometry=new bb;this.geometry.color=new Ab;this.offset=0};tf.prototype={clear:function(){this.geometry.position.clear();this.geometry.color.clear();this.geometry.group.clear();this.offset=0},addVertex:function(a,b){this.geometry.position.push(a);this.geometry.color.push(b)},addIndex:function(a,b){this.geometry.group.indices.push2(a+this.offset,b+this.offset)},begin:function(){this.offset=this.geometry.position.length}};var bb=function(){H.call(this);
this.group=new uf;this.position=new vf;this.changed=!1};bb.prototype=n(H.prototype,{clear:function(a){null!=a&&a.clear()},update:function(){this.changed=!0;this.dispatchEvent(B.update)},dispose:function(){H.prototype.dispose.call(this);null!=this.group&&(this.group.dispose(),this.group=null,this.dispatchEvent(B.delete));null!=this.position&&(this.position.dispose(),this.position=null);null!=this.uv&&(this.uv.dispose(),this.uv=null);null!=this.uv2&&(this.uv2.dispose(),this.uv2=null);null!=this.normal&&
(this.normal.dispose(),this.normal=null);null!=this.tangent&&(this.tangent.dispose(),this.tangent=null);null!=this.color&&(this.color.dispose(),this.color=null);null!=this.color2&&(this.color2.dispose(),this.color2=null);null!=this.color3&&(this.color3.dispose(),this.color3=null);null!=this.color3&&(this.color3.dispose(),this.color3=null);null!=this.color4&&(this.color4.dispose(),this.color4=null);null!=this.color5&&(this.color5.dispose(),this.color5=null);null!=this.color6&&(this.color6.dispose(),
this.color6=null);null!=this.joint&&(this.joint.dispose(),this.joint=null);null!=this.weight&&(this.weight.dispose(),this.weight=null)}});var uf=function(){this.indices=new wf;this._index=this.count=0};uf.prototype={clear:function(){this.indices.clear();this._index=this.count=0},dispose:function(){this.indices.dispose();this._length=this._offset=this.indices=null},getGroupOffset:function(a){return this._offset[a]},getGroupLength:function(a){return this._length[a]}};var wf=function(){this.length=0;
this.data=[];this.offset=0};wf.prototype={clear:function(){this.offset=this.length=0;this._changed=!0},dispose:function(){this.data=null},push2:function(a,b){this.data[this.length++]=a+this.offset;this.data[this.length++]=b+this.offset;this._changed=!0},push3:function(a,b,c){this.data[this.length++]=a+this.offset;this.data[this.length++]=b+this.offset;this.data[this.length++]=c+this.offset;this._changed=!0},get_changed:function(){return this._changed?(this._changed=!1,!0):!1}};var Gc=function(a){null==
a&&(a=5126);this.length=this.dataLength=0;this.data=[];this.componentType=a;this.bytesPerElement=m.getByteLengthByType(a)};Gc.prototype={clear:function(){this.length=this.dataLength=0;this._changed=!0},dispose:function(){this.data=null},get_changed:function(){return this._changed?(this._changed=!1,!0):!1}};var vf=function(a){null==a&&(a=5126);Gc.call(this,a)};vf.prototype=n(Gc.prototype,{push:function(a){if(null==a)throw new u("null value");if(null!=this.onPush)this.onPush(a);a.fillArray(this.data,
3*this.length);this._changed=!0;this.length++;this.dataLength=3*this.length},get:function(a){return h.instance.fromArray(this.data,3*a)}});var md=function(){this._seed=2147483647*Math.random()|0;this.running=!0};md.prototype={setSeed:function(a){this._seed=a},get:function(){var a=this._seed;a^=a>>11;a^=a<<7&-1658038656;a^=a<<15&-272236544;this.running&&(this._seed=a^a>>18);return this._seed},getFloat:function(){return m.fixed(this.get()/2147483646,9)},randomFloat:function(a,b){null==b&&(b=1);null==
a&&(a=0);return b<=a?a:a+(b-a)*this.getFloat()}};var m=function(){};m.lerpTo=function(a,b,c,d,e){return c+(e-a)/(b-a)*(d-c)};m.stringToInt=function(a){if(null==a||1>a.length)return 0;-1!=a.indexOf("_")&&(a=ea.replace(a,"_",""));return da.parseInt(a)};m.stringToFloat=function(a){if(null==a||1>a.length)return 0;-1!=a.indexOf("_")&&(a=ea.replace(a,"_",""));if(-1!=a.indexOf(":")){a=a.split(":");for(var b=a.length,c=0,d=1;0<b--;)c+=parseFloat(a[b])*d,d*=60;return c}return parseFloat(m.trim(a))};m.stringToBool=
function(a){a=m.trim(a).toLowerCase();return"true"==a?!0:"false"==a?!1:0!=m.stringToInt(a)};m.hexToInt=function(a){if(0==a.indexOf("0x"))return 10<a.length&&(a=x.substr(a,0,10)),m.stringToInt(a);8<a.length&&(a=x.substr(a,0,8));return m.stringToInt("0x"+a)};m.floatToInt=function(a){return m.floor(a)|0};m.toExp=function(a,b){for(var c=1;0!=(b&1)&&(c*=a),b>>=1,0!=b;)a*=a;return c};m.fixed=function(a,b){null==b&&(b=4);var c=m.toExp(10,b);a=da.string((a*c|0)/c);c=a.indexOf(".");if(-1!=c)for(c=x.substr(a,
c+1,null).length;c<b;)c++,a+="0";else for(a+=".",c=0;c<b;)c++,a+="0";return m.stringToFloat(a)};m.abs=function(a){return 0>a?-a:a};m.absInt=function(a){return 0>a?-a:a};m.intToNextPow2=function(a){--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;return(a|a>>16)+1};m.pow2Count=function(a){a=m.intToNextPow2(a);for(var b=0;1<a;)a>>=1,++b;return b};m.floor=function(a){var b=a|0;0>a&&b!=a&&--b;return b};m.ceil=function(a){var b=a|0;if(a==b)return b;++a;b=a|0;0>a&&b!=a&&--b;return b};m.ceilToInt=function(a){return m.ceil(a)|
0};m.trim=function(a,b){null==b&&(b=" ");if(null==a)return null;a=ea.replace(ea.trim(a),"\t","");if(""==b)return a;0==a.indexOf(b)&&(a=x.substr(a,1,null));a.lastIndexOf(b)==a.length-1&&(a=x.substr(a,0,-1));return a};m.stringFill=function(a,b,c){null==c&&(c=" ");if(""==c||0==b)return a;var d=0>b;b=m.absInt(b);for(var e="",f=0;f<b;)f++,e+=c;return d?e+a:a+e};m.binarySearchLow=function(a,b){var c=a.length;if(2>c&&b>=a[0])return 0;var d=0,e=c-1,f=e>>>1;for(c=e;0<c--;){var g=a[f];if(b>g)d=f,f+=e-d>>>1;
else if(b<g)e=f,f=d+(e-d>>>1);else if(b==g)return f;if(3>e-d){if(b>=a[e])return e;if(b>=a[f])return f;if(b>=a[d])return d}}return-1};m.stringEmpty=function(a){return null!=a?""==a:!0};m.getByteLengthByType=function(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:return 4}};m.stringToArray=function(a){var b=[];if(null!=a){for(var c=0,d="",e=0,f=a.length;e<f;){var g=e++;g=a.charAt(g);","==g&&1>c?(b.push(m.trim(d)),d=""):("{"!=g&&
"["!=g&&"("!=g||++c,"}"!=g&&"]"!=g&&")"!=g||--c,d+=g)}""!=d&&b.push(m.trim(d))}return b};var Ab=function(a){null==a&&(a=5126);Gc.call(this,a)};Ab.prototype=n(Gc.prototype,{push:function(a){if(null==a)throw new u("null value");a.fillArray(this.data,4*this.length);this._changed=!0;this.length++;this.dataLength=4*this.length}});var D=function(){};D.update=function(a){D.buffer.clear();var b=D._list.get_length();if(0<b){for(D._cleared=!1;0<b--;){var c=D._list.getArrayElement(b);D.buffer.begin();c.fill(D.buffer,
a)||D._list.removeAt(b)}D.buffer.geometry.update()}else D._cleared||D.buffer.geometry.update(),D._cleared=!0;D._enabled=!0};D.getGeometry=function(){D._enabled=!1;return D.buffer.geometry};D.drawLine=function(a,b,c,d){null==d&&(d=0);if(D.editorMode){var e=D._lines.get();e.setup(a,b);e.start(d,c);D._list.push(e)}};D.drawTriangle=function(a,b,c,d,e){null==e&&(e=0);if(D.editorMode){var f=D._triangles.get();f.setup(a,b,c);f.start(e,d);D._list.push(f)}};D.drawPlane=function(a,b,c,d,e){null==e&&(e=0);if(D.editorMode){var f=
D._planes.get();f.setup(a,b,c);f.start(e,d);D._list.push(f)}};D.drawCircle=function(a,b,c,d,e){null==e&&(e=0);if(D.editorMode){var f=D._circles.get();f.setup(a,b,c);f.start(e,d);D._list.push(f)}};var Ib=function(){},ha=function(){};ha.getnow=function(){return.001*(new Date).getTime()+ha._offset};var xf=function(a){this._items=new N;this._items.push(null);this._compare=a;this.count=0};xf.prototype={push:function(a){this._items.push(a);this.toRoot(this._items.get_length()-1);this.count=this._items.get_length()-
1},shift:function(){if(1==this._items.get_length())return null;if(2==this._items.get_length())return this.count=0,this._items.pop();var a=this._items.get(1);this.toLeaf();this.count=this._items.get_length()-1;return a},Clear:function(){this._items.set_length(1)},toRoot:function(a){for(var b=a;1<b;){var c=b>>1,d=this._items.get(b),e=this._items.get(c);if(0>this._compare(d,e))this._items.setArrayElement(b,e),this._items.setArrayElement(c,d);else break;b=c;if(0>a--)break}},toLeaf:function(){var a=1;
this._items.setArrayElement(1,this._items.pop());for(var b=this._items.get_length(),c=b;;){var d=a,e=a<<1;if(e<b){var f=this._items.get(a),g=this._items.get(e);0<this._compare(f,g)&&(a=e,f=g);e+1<b&&(g=this._items.get(e+1),0<this._compare(f,g)&&(a=e+1))}if(a!=d)f=this._items.get(a),e=this._items.get(d),this._items.setArrayElement(a,e),this._items.setArrayElement(d,f);else break;if(0>c--)break}}};var Yd=function(a){null==a&&(a=0);this.bigEndian=!1;this._data=new Aa(new ArrayBuffer(a));this._length=
this.position=0};Yd.prototype={dispose:function(){null!=this._data&&(this._data=null,this._length=this.position=0)},toString:function(){return this._data.getString(0,this._length)},setBytes:function(a){if(null==a||0==a.length)return this;this.__resize(a.length);this.position=0;this._data.blit(0,a,0,a.length);return this},getBytes:function(){this.trim();return this._data},readUnsignedByte:function(){if(oa.gt(this._length,this.position))return this._data.b[this.position++];throw new u("EOF");},readByte:function(){var a=
this.readUnsignedByte();return 0!=(a&128)?a-256:a},readUnsignedShort:function(){var a=this.readUnsignedByte(),b=this.readUnsignedByte();return this.bigEndian?a<<8|b:(b<<8)+a},readShort:function(){var a=this.readUnsignedShort();return 0!=(a&32768)?a-65536:a},readUnsignedInt:function(){var a=this.readUnsignedByte(),b=this.readUnsignedByte(),c=this.readUnsignedByte(),d=this.readUnsignedByte();return this.bigEndian?a<<24|b<<16|c<<8|d:d<<24|c<<16|b<<8|a},readInt:function(){var a=this.readUnsignedByte(),
b=this.readUnsignedByte(),c=this.readUnsignedByte(),d=this.readUnsignedByte();return this.bigEndian?a<<24|b<<16|c<<8|d:d<<24|c<<16|b<<8|a},readFloat:function(){return hd.i32ToFloat(this.readInt())},readUTFBytes:function(a){if(this.position+a>this._length)throw new u("EOF");this.position+=a;return this._data.getString(this.position-a,a)},readUTF:function(){var a=this.readUnsignedShort();return this.readUTFBytes(a)},readTinyUTF:function(){var a=this.readUnsignedByte();return this.readUTFBytes(a)},readBlob:function(a,
b,c){null==c&&(c=0);null==b&&(b=0);0==c&&(c=this._length-this.position);if(oa.gt(this.position+c,this._length))throw new u("EOF");a._data.length<b+c&&a.__resize(b+c);a._data.blit(b,this._data,this.position,c);this.position+=c},writeBytes:function(a,b,c){null==c&&(c=0);null==b&&(b=0);0!=a.length&&(0==c&&(c=a.length-b),this.__resize(this.position+c),this._data.blit(this.position,a,b,c),this.position+=c)},readBytes:function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.readBlob(a,b,c)},trim:function(){if(this._data.length>
this._length){var a=new Aa(new ArrayBuffer(this._length));a.blit(0,this._data,0,this._length);this._data=a}},__resize:function(a){if(a>this._data.length){var b=new Aa(new ArrayBuffer(3*(a+1)>>1));b.blit(0,this._data,0,this._length);this._data=b}this._length<a&&(this._length=a)}};var cb=function(a){null==a&&(a=5126);Gc.call(this,a)};cb.prototype=n(Gc.prototype,{add:function(a){for(var b=0,c=a.length;b<c;){var d=b++;this.push(a.get(d))}},push:function(a){if(null==a)throw new u("null value");if(null!=
this.onPush)this.onPush(a);a.fillArray(this.data,2*this.length);this._changed=!0;this.length++;this.dataLength=2*this.length},get:function(a){return G.instance.fromArray(this.data,2*a)}});var La={_new:function(a){null==a&&(a=0);return new Yd(a)},fromBytes:function(a){return null==a?null:(new Yd).setBytes(a)},toBytes:function(a){return null==a?null:a.getBytes()}},Zd=function(a,b){null==b&&(b=!1);null==a&&(a="");this._list=[];this._keep=b;this.decode(a)};Zd.prototype={readLine:function(){return this._position<
this._length?this._list[this._position++]:null},decode:function(a){0<this._length&&this._list.splice(0,this._length);this._position=this._length=0;if(null!=a){a=ea.replace(a,"\r","\n");a=a.split("\n");for(var b=0,c=a.length;b<c;){var d=b++;d=a[d];(""!=d||this._keep)&&this._list.push(d)}this._length=this._list.length;this._position=0}}};var yf=function(a,b){this.x=a;this.y=b};yf.prototype={};var zf=function(a,b,c){this.x=a;this.y=b;this.z=c};zf.prototype={};var ad=function(){};ad.createInstance=function(a,
b){a=null==b?Object.create(a.prototype):wb.createInstance(a,b);a instanceof fb&&!a.__constructed&&(a.__constructed=!0,a.instanceID=fb._id++,a.onConstruct());return a};ad.getClassName=function(a){return null==a?"null":U.getClass(a).__name__};var B=function(a){this.name=a;this._type=ad.getClassName(this)+"."+a+"."+((new Date(2019,8,26,19,1,27)).getTime()|0)};B.__name__="lovedna.events.Event";B.prototype={copy:function(a){this.type=a._type;this.name=a.name;this.currentTarget=a.currentTarget;this.target=
a.target},clear:function(){this.currentTarget=this.target=null},__class__:B};var Fd=function(a,b){this.callback=a;this.priority=b};Fd.prototype={dispose:function(){this.callback=null}};var Bb=function(a){B.call(this,a)};Bb.__name__="lovedna.events.FileLoadEvent";Bb.prototype=n(B.prototype,{__class__:Bb});var Oa=function(a){B.call(this,a)};Oa.__name__="lovedna.events.KeyEvent";Oa.prototype=n(B.prototype,{__class__:Oa});var Wb=function(a){B.call(this,a);this.action=0;this.id=-1};Wb.__name__="lovedna.events.MediaEvent";
Wb.prototype=n(B.prototype,{__class__:Wb});var Sb=function(a){B.call(this,a);this.value=new h;this.deltaMode=0};Sb.__name__="lovedna.events.MouseWheelEvent";Sb.prototype=n(B.prototype,{__class__:Sb});var va=function(a){B.call(this,a);this.vintlist=[];this.vfloatlist=[];this.vstringlist=[]};va.__name__="lovedna.events.SystemEvent";va.prototype=n(B.prototype,{__class__:va});var Va=function(){this.instanceID=Va._id++;this._key=null;this.type=0;this._alive=!1;this.device=this.touchId=-1;this.pressure=
this.size=1;this.position=new h;this.down=new h;this.up=new h;this.time=new h;this.lastTime=new h;this._will=new $a;this._was=new $a};Va.prototype={has:function(a){return this._was.getArrayElement(a)},copy:function(a){null!=a&&(this.device=a.device,this.touchId=a.touchId,this.size=a.size,this.pressure=a.pressure,this.type=a.type,this.position.copy(a.position),this.down.copy(a.down),this.up.copy(a.up),this.time.copy(a.time),this.lastTime.copy(a.lastTime),this._key=a._key,this._alive=a._alive,this._will.value=
a._will.value,this._was.value=a._was.value);return this},copyValue:function(a){this.touchId=a.touchId;this.position.copy(a.position);this.size=a.size;this.pressure=a.pressure},begin:function(a){this._will.value=0;this._was.value=0;this.copyValue(a);this.down.copy(this.position);this.lastTime.x=this.time.x;this.time.x=ha._custom();this._will.setArrayElement(1);this._alive=!0},move:function(a){if(this._was.getArrayElement(1)||this._will.getArrayElement(1))this.copyValue(a),this.lastTime.y=this.time.y,
this.time.y=ha._custom(),this._will.setArrayElement(2)},end:function(a){this.copyValue(a);this.up.copy(this.position);this.lastTime.z=this.time.z;this.time.z=ha._custom();this._will.setArrayElement(5)},cancel:function(a){this.copyValue(a);this.up.copy(this.position);this.lastTime.z=this.time.z;this.time.z=ha._custom();this._will.setArrayElement(5)},execute:function(a){null==a&&(a=ha._custom());this._was.getArrayElement(1)&&(this._was.getArrayElement(4)||a-this.time.x>=Va.holdTime&&this._will.setArrayElement(4));
a=this._will.getArrayElement(1);var b=this._will.getArrayElement(2),c=this._will.getArrayElement(4),d=this._will.getArrayElement(5),e=!0;a&&(this.type=1,this._was.setArrayElement(1),e=!1,this.fire());b&&(this.type=2,this._was.setArrayElement(2),e=!1,this.fire());c&&(this.type=4,this._was.setArrayElement(4),e=!1,this.fire());d&&(this.type=5,this._was.setArrayElement(5),e=!1,this.fire(),this._was.value=0,this._was.setArrayElement(5),this._will.value=0,this._alive=!1);e&&(this.type=3,this.fire());this._will.value=
0},fire:function(){var a=Tb.onUpdate;a.touch.copy(this);Va.onEvent.dispatchEvent(a)}};var Tb=function(a){B.call(this,a);this.touch=new Va};Tb.__name__="lovedna.events.TouchEvent";Tb.prototype=n(B.prototype,{__class__:Tb});var Kd=function(){this.width=this.height=0;this.format="rgba8888";this.magFilter=this.minFilter="linear";this.vWrap=this.uWrap=0};Kd.prototype={decode:function(a){this.name=a.readTinyUTF();this.width=a.readUnsignedShort();this.height=a.readUnsignedShort();this.format=a.readTinyUTF();
this.minFilter=a.readTinyUTF();this.magFilter=a.readTinyUTF();this.uWrap=a.readUnsignedByte();this.vWrap=a.readUnsignedByte()}};var Ca=function(){this.rotate=0;this.frame=new Sc(0,0,1,1);this.originalSize=new G(1,1);this.offset=new G(0,0);this.index=0;this.pivot=new G(.5,.5);Ca._uv=G.instance;this.normalzedFrame=new Sc;this.border=new Af(0,0,0,0)};Ca.prototype={decode:function(a){this.name=a.readTinyUTF();this.rotate=a.readByte();this.frame.x=a.readUnsignedShort();this.frame.y=a.readUnsignedShort();
this.frame.set_width(a.readUnsignedShort());this.frame.set_height(a.readUnsignedShort());this.originalSize.x=a.readUnsignedShort();this.originalSize.y=a.readUnsignedShort();this.offset.x=a.readUnsignedShort();this.offset.y=a.readUnsignedShort();this.index=a.readUnsignedByte();this.pivot.x=a.readFloat();var b=a.readFloat();this.pivot.y=1-b;this.border.setBorder(a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat())},postInit:function(){this.normalzedFrame.x=this.frame.x/this.page.width;this.normalzedFrame.y=
this.frame.y/this.page.height;this.normalzedFrame.set_width(this.frame.z/this.page.width);this.normalzedFrame.set_height(this.frame.w/this.page.height)},copy:function(a){this.name=a.name;this.rotate=a.rotate;this.frame.copy(a.frame);this.normalzedFrame.copy(a.normalzedFrame);this.originalSize.copy(a.originalSize);this.offset.copy(a.offset);this.page=a.page;this.pivot.copy(a.pivot);this.border.copy(a.border);this.index=a.index;this._uv11=this._uv00=null},getUV:function(a,b){if(null==this._uv00)if(this._uv00=
new G,this._uv11=new G,0==this.rotate){var c=this._uv00,d=this.frame.x/this.page.width,e=(this.frame.y+this.frame.w)/this.page.height;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=this._uv11;d=(this.frame.x+this.frame.z)/this.page.width;e=this.frame.y/this.page.height;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e}else 0<this.rotate?(c=this._uv00,d=this.frame.x/this.page.width,e=this.frame.y/this.page.height,null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._uv11,d=(this.frame.x+this.frame.w)/this.page.width,
e=(this.frame.y+this.frame.z)/this.page.height,null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e):(c=this._uv00,d=(this.frame.x+this.frame.w)/this.page.width,e=(this.frame.y+this.frame.z)/this.page.height,null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._uv11,d=this.frame.x/this.page.width,e=this.frame.y/this.page.height,null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e);0==this.rotate?(c=Ca._uv,d=this._uv00.x,a=d+(this._uv11.x-d)*a,d=this._uv00.y,b=d+(this._uv11.y-d)*b,null==b&&(b=0),null==a&&(a=0),c.x=a,c.y=b):
(c=Ca._uv,d=this._uv00.x,b=d+(this._uv11.x-d)*b,d=this._uv00.y,a=d+(this._uv11.y-d)*a,null==a&&(a=0),null==b&&(b=0),c.x=b,c.y=a);return Ca._uv},getRectUvs:function(a,b,c,d){null==Ca._uvBuffer?Ca._uvBuffer=new cb:Ca._uvBuffer.clear();if(1>a&&1>b&&1>=c&&1>=d)Ca._uvBuffer.push(this.getUV(a,b)),Ca._uvBuffer.push(this.getUV(a+c,b)),Ca._uvBuffer.push(this.getUV(a+c,b+d)),Ca._uvBuffer.push(this.getUV(a,b+d));else{var e=this.frame.z,f=this.frame.w;Ca._uvBuffer.push(this.getUV(a/e,b/f));Ca._uvBuffer.push(this.getUV((a+
c)/e,b/f));Ca._uvBuffer.push(this.getUV((a+c)/e,(b+d)/f));Ca._uvBuffer.push(this.getUV(a/e,(b+d)/f))}return Ca._uvBuffer}};var id=function(){H.call(this);this._chars=new ba;this.scaleH=this.scaleW=this.base=this.lineHeight=this.italic=this.bold=0;this.pages=1;this.id=this.packed=0};id.prototype=n(H.prototype,{decode:function(a){this.face=a.readUTF();this.size=a.readInt();this.bold=a.readInt();this.italic=a.readInt();this.lineHeight=a.readInt();this.base=a.readInt();this.scaleW=a.readInt();this.scaleH=
a.readInt();this.pages=a.readInt();this.packed=a.readInt();this.id=a.readInt();this.file=a.readUTF();for(var b=this.count=a.readInt();0<b--;){var c=new Bf;c.decode(a);this.addChar(c)}0>this.size&&(this.size=-this.size)},addChar:function(a){this._chars.h[a.id]=a},dispose:function(){H.prototype.dispose.call(this);this._chars=null}});var Bf=function(){};Bf.prototype={decode:function(a){this.id=a.readInt();this.x=a.readInt();this.y=a.readInt();this.width=a.readInt();this.height=a.readInt();this.xoffset=
a.readFloat();this.yoffset=a.readFloat();this.xadvance=a.readFloat();this.page=a.readInt()}};var Sd=function(){this.intValues=new K;this.floatValues=new K;this.stringValues=new K};Sd.prototype={};var Ge=function(){this._meta=new K};Ge.prototype={get:function(a){var b=this._meta;return null!=p[a]?b.getReserved(a):b.h[a]},addInfo:function(a,b){var c=this._meta;null!=p[a]?c.setReserved(a,b):c.h[a]=b;"path"==a?this.path=b:"crc"==a?this.crc=b:"size"==a&&(this.size=b)},read:function(a){for(var b=ma.fields(a),
c=b.length;0<c--;){var d=b[c];this.addInfo(d,pa.getValue(a,d))}}};var kd=function(){this._IEND=new jd;this._IEND.type=1229278788;this._chunkList=[];if(null==kd._keepType){kd._keepType=new ba;for(var a=[1229472850,1229209940,1229278788,1665684045,1732332865,1933723988,1347179589,1649100612,1749635924,1951551059],b=a.length;0<b--;)kd._keepType.h[a[b]]=!0}};kd.prototype={dispose:function(){this._IEND.dispose();this._bytes=null;if(null!=this._chunkList){for(var a=this._chunkList.length;0<a--;){var b=
this._chunkList[a];null!=b&&b.dispose()}this._chunkList=null}},decode:function(a){var b=this._chunkList.length;0<b&&this._chunkList.splice(0,b);if(oa.gt(12,a._length-a.position))return!1;a.bigEndian=!0;b=a.position;a.position=b+8;var c=a.readInt();if(100<c&&(a.position=b+8,c=a.readInt(),100<c)||1229472850!=a.readInt())return!1;for(a.position=b+8;oa.gt(a._length-a.position,0);){b=new jd;b.decode(a);c=b.type;if(1>c)break;1229278788==c?this._IEND=b:this.addChunk(b)}a=this.getChunk(1229472850);null!=
a&&(a=a.getContent(),a.bigEndian=!0,this.width=a.readUnsignedInt(),this.height=a.readUnsignedInt(),a.bigEndian=!1);return!0},getChunk:function(a){for(var b=this._chunkList.length;0<b--;){var c=this._chunkList[b];if(c.type==a)return c}return null},addChunk:function(a){this._chunkList.push(a)}};var jd=function(){};jd.prototype={dispose:function(){this._content=null},decode:function(a){var b=a.readUnsignedInt();this.type=a.readUnsignedInt();this._content=La._new();0<b&&a.readBlob(this._content,0,b);
this._crc=a.readInt()},getContent:function(){this._content.bigEndian=!1;return this._content}};var hb=function(){this.instanceID=hb._id++};hb.pop=function(a,b){var c=hb._pool.get();c.set(a,b);return c};hb.push=function(a){hb._pool.set(a)};hb.prototype={set:function(a,b){this.component=a;this.state=b}};var Cf=function(){this.type=0;this.color=new E(0,0,0,0)};Cf.prototype={};var ia=A.lovedna.game.Game=function(){H.call(this);this._running=!0;this._timeScale=1;this._system=new W;this._system.addEventListener(va.init._type,
g(this,this.sysinit));this._system.addEventListener(va.resize._type,g(this,this.resize));Ib.systemDispatcher.addEventListener(B.blur._type,g(this,this.systemBlur));Ib.systemDispatcher.addEventListener(B.focus._type,g(this,this.systemFocus));ia._current=this;null!=ia._args&&null==this._glContext&&this._system.setup(ia._args);this.fps=new Df;Q.init();this._pauseStep=this.isPaused=!1;this.debugFrame=-1;this.backgroundColor=new E(0,0,0,0);this._worldList=T.fromArray([]);this._debugRender=new Ef;this._property=
new sb;this._timeData=new ta;this._sinTimeData=new ta;this._cosTimeData=new ta;this._deltaTimeData=new ta;this._property.setFloat4(k.toString(k.TIME),this._timeData);this._property.setFloat4(k.toString(k.TIME_SIN),this._sinTimeData);this._property.setFloat4(k.toString(k.TIME_COS),this._cosTimeData);this._property.setFloat4(k.toString(k.TIME_DELTA),this._deltaTimeData)};ia.config=function(a){ia._args=a;null!=ia.getParam("version")&&(ia.version=ia.getParam("version"));null!=ia.main&&(ia.main.startGameMain(ia._args),
ia.main=null);null!=ia._current&&ia._current._system.setup(a)};ia.getParam=function(a){return null!=ia._args&&pa.exist(ia._args,a)?pa.getValue(ia._args,a):null};ia.prototype=n(H.prototype,{step:function(){this._running=this._pauseStep=!0},onInit:function(a){this._onInitHandler=a;null!=this._glContext&&null!=this._onInitHandler&&this._onInitHandler()},addWorld:function(a){a.width=this._width;a.height=this._height;this._worldList.remove(a);this._worldList.push(a);a._now=ha._custom()},removeWorld:function(a){this._worldList.remove(a)},
getBufferContext:function(){return this._cmdContext},systemBlur:function(a){C._focused||(a=ha._custom()-C._blurTime,C._offset+=a,C._blurTime=0);C._blurTime=ha._custom()},systemFocus:function(a){a=ha._custom()-C._blurTime;C._offset+=a;C._blurTime=0},sysinit:function(a){this._system.addEventListener(va.update._type,g(this,this.update));this._glContext=new eb(this._system.glcontext);this._property.setFloat4(k.toString(k.SCREEN_PARAMS),this._glContext.screenParams);this._cmdContext=new Ff;this._width=
this._system.width;this._height=this._system.height;null!=this._onInitHandler&&this._onInitHandler();C.init()},update:function(a){q.update();this.dispatchEvent(B.update);if(this._running){C.step(this._timeScale);a=C.time;var b=this._timeData,c=a/20,d=a,e=2*a,f=3*a;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;b=this._sinTimeData;c=Math.sin(a/8);d=Math.sin(a/4);e=Math.sin(a/2);f=Math.sin(a);null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=
d;b.z=e;b.w=f;b=this._cosTimeData;c=Math.cos(a/8);d=Math.cos(a/4);e=Math.cos(a/2);a=Math.cos(a);null==a&&(a=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=a;e=C.smoothDeltaTime;a=this._deltaTimeData;b=e;c=1/e;d=e;e=1/e;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;this._glContext.begin(this._width,this._height);b=S.add();b.setViewport(0,0,this._width,this._height);a=Da.renderBuffer;null!=a&&b.pushRenderTarget(a);b.clearRenderTarget(this.backgroundColor,
1,0);b.setGlobalProperty(this._property);if(null!=this.onUpdate)this.onUpdate();b=0;for(c=this._worldList.get_length();b<c;)d=b++,Ka.reset(),this._worldList.get(d)._update();null!=a&&(b=S.add(),b.popRenderTarget(),b.blit(a,null,Da.renderBufferMaterial));this._debugRender.render(this.debugCamera);this._cmdContext.clear();this._cmdContext.glContext=this._glContext;this._cmdContext.stopActionIndex=this.debugFrame;S.flush(this._cmdContext);this.debugFrame=this._cmdContext.stopActionIndex}D.isPlaying||
(this.isPaused=!0);this._timeScale=-1<this.debugFrame?0:1;this._running=this.isPaused||-1<this.debugFrame?!1:!0;q.lateUpdate();this.fps.step(C.get_now());w._endFrame()},resize:function(a){this._width=a.vintlist[0];this._height=a.vintlist[1];Da.setSize(this._width,this._height);for(a=this._worldList.get_length();0<a--;){var b=this._worldList.getArrayElement(a);b.width=this._width;b.height=this._height;b._resized=!0}}});var Df=function(){this.cacheCount=this.currentFPS=0;this.times=[]};Df.prototype=
{step:function(a){for(this.times.push(a);this.times[0]<a-1;)this.times.shift();a=this.times.length;this.currentFPS=Math.round((a+this.cacheCount)/2);this.cacheCount=a}};var Wa=function(){this.modifier=new $a;this.deviceId=this.deviceType=0;this.type=-1;this.instanceID=Wa._id++};Wa.prototype={copy:function(a){this.deviceId=a.deviceId;this.deviceType=a.deviceType;this.type=a.type;this.keyCode=a.keyCode;this.value=a.value;this.key=a.key;this.modifier.value=a.modifier.value},trigger:function(){var a=
Oa.onUpdate;a.key=this;Wa.onEvent.dispatchEvent(a)},get_id:function(){return 1E4*this.deviceType+1E3*this.deviceId+this.keyCode}};var Ga=function(a){if(null==a)this.data=new $a(-1);else{this.data=new $a(0);for(var b=a.length;0<b--;){var c=Ga.nameToLayer(a[b]);this.data.setArrayElement(c)}0==this.data.value&&(this.data.value=-1)}};Ga.setLayerName=function(a,b){if(null==Ga._names[a]){Ga._names[a]=b;var c=Ga._layers;null!=p[b]?c.setReserved(b,a):c.h[b]=a}};Ga.nameToLayer=function(a){var b=Ga._layers;
return null!=p[a]?b.getReserved(a):b.h[a]};Ga.prototype={add:function(a){this.data.setArrayElement(a)},exist:function(a){return this.data.getArrayElement(a)}};var q=function(){};q.raycastCollider=function(a,b){if(!b.enabled||!a.layerMask.exist(b.actor.layer))return!1;null==a.world&&(a.world=Wc.current);var c=a.maxDistance;a.maxDistance=c*c;b=b.raycast(a);a.maxDistance=c;return b?!0:!1};q.touchDown=function(a,b){null==b&&(b=!1);null==a&&(a=0);0>a&&(a=0);var c=q._touchDown.get_length();if(1>c)return!1;
if(b){if(a>=q._touchsWithIndex.get_length())return!1;b=q._touchsWithIndex.get(a);if(null==b)return!1;a=b.touchId}for(;0<c--;)if(b=q._touchDown.get(c),b.touchId==a)return!0;return!1};q.touchUp=function(a,b){null==b&&(b=!1);null==a&&(a=0);0>a&&(a=0);var c=q._touchUp.get_length();if(1>c)return!1;if(b){if(a>=q._touchsWithIndex.get_length())return!1;b=q._touchsWithIndex.get(a);if(null==b)return!1;a=b.touchId}for(;0<c--;)if(b=q._touchUp.get(c),b.touchId==a)return!0;return!1};q.getTouch=function(a,b){null==
b&&(b=!1);null==a&&(a=0);0>a&&(a=0);if(b){if(a>=q._touchsWithIndex.get_length())return null;a=q._touchsWithIndex.get(a);if(null==a)return null;a=a.touchId}return q._touchsWithTouchId.get(a)};q.wheel=function(){return q._wheeling};q.getWheel=function(){return q._wheelValue};q.getKey=function(a,b){null==b&&(b=-1);for(var c=q._activeKeys.iterator();c.hasNext();){var d=c.next();if(d.keyCode==a&&(-1==b||b==d.deviceId))return d}return null};q.keyDown=function(a,b){null==b&&(b=-1);for(var c=q._keyDownList.get_length();0<
c--;){var d=q._keyDownList.get(c);if(0>a&&0>b||0>b&&d.keyCode==a||0>a&&b==d.deviceId||d.keyCode==a&&b==d.deviceId)return q._currentKey=d,!0}q._currentKey=null;return!1};q.update=function(){q._init||(q._init=!0,q.touchCount=0,q._frame=0,Va.onEvent.addEventListener(Tb.onUpdate._type,q.ontouch),ya.onWheel.addEventListener(Sb.onUpdate._type,q.onWheel),Wa.onEvent.addEventListener(Oa.onUpdate._type,q.onkey),q._wheeling=!1,q._wheelValue=new h);q._frame++;var a=q._touchBuffer.get_length();if(0<a)for(var b=
0;b<a;){var c=b++;c=q._touchBuffer.get(c);5==c.type?q._touchUp.push(c):(q._touchDown.push(c),q._touchsWithIndex.push(c));q._touchsWithTouchId.setArrayElement(c.touchId,c)}q._touchBuffer.clear();q.touchCount=q._touchsWithIndex.get_length();a=0;for(b=q._keyBuffer.get_length();a<b;){c=a++;c=q._keyBuffer.get(c);var d=c.get_id();q._activeKeys.h.hasOwnProperty(d)||(q._activeKeys.h[d]=c);1==c.type?q._keyDownList.push(c):q._keyUpList.push(c)}q._keyBuffer.clear()};q.lateUpdate=function(){var a=q._touchUp.get_length();
if(0<a){for(;0<a--;){var b=q._touchUp.get(a);q.removeTouch(b);q._touchPool.set(b)}q.maxTouchId=0;for(a=q._touchsWithTouchId.get_length();0<a--;)if(null!=q._touchsWithTouchId.get(a)){q.maxTouchId=a+1;break}}q._touchDown.clear();q._touchUp.clear();q._wheeling=!1;q._wheelValue.set(0,0,0);q._keyDownList.clear();for(a=q._keyUpList.get_length();0<a--;)b=q._keyUpList.get(a),q._activeKeys.remove(b.get_id()),q._keyPool.set(b);q._keyUpList.clear()};q.ontouch=function(a){a=Tb.onUpdate.touch;var b=a.type,c=a.touchId;
2==b?(b=q._touchsWithTouchId.getArrayElement(c),null!=b&&b.copy(a)):1==b?(b=q.getTouchFromBuffer(a),null==b&&(b=q._touchPool.get()),b.copy(a),q._touchBuffer.push(b)):5==b&&(b=q.getTouchFromBuffer(a),null==b&&(b=q._touchPool.get()),b.copy(a),q._touchBuffer.push(b))};q.getTouchFromBuffer=function(a){for(var b=q._touchBuffer.get_length();0<b--;){var c=q._touchBuffer.getArrayElement(b);if(c.type==a.type&&c.touchId==a.touchId&&c.device==a.device)return c}return null};q.onWheel=function(a){q._wheelValue.copy(Sb.onUpdate.value);
q._wheeling=!0};q.onkey=function(a){a=Oa.onUpdate.key;if(null!=a){var b=a.get_id();b=q._activeKeys.h[b];if(null==b)if(2==a.type)for(b=q._keyBuffer.get_length();0<b--;){if(q._keyBuffer.get(b).get_id()==a.get_id()){q._keyBuffer.removeAt(b);break}}else b=q._keyPool.get(),b.copy(a),q._keyBuffer.push(b);else 1!=a.type&&(b.copy(a),q._keyBuffer.push(b))}};q.removeTouch=function(a){q._touchsWithTouchId.setArrayElement(a.touchId,null);for(var b=q._touchsWithIndex.get_length();0<b--;)q._touchsWithIndex.getArrayElement(b).touchId==
a.touchId&&q._touchsWithIndex.removeAt(b)};var C=function(){};C.init=function(){C._time=C.get_now();C._fixedTime=0;C.fixedCount=0;C.time=0;C.frame=0;C.smoothDeltaTime=C.fixedTime};C.step=function(a){null==a&&(a=1);var b=C.get_now();C.deltaTime=(b-C._time)*a;C._time=b;C.deltaTime>C.fixedTime?C.deltaTime=C.fixedTime:0>C.deltaTime&&(C.deltaTime=0);b=C.smoothDeltaTime;C.smoothDeltaTime=(b+.05*(C.deltaTime-b))*a;C.time+=C.smoothDeltaTime;C._fixedTime+=C.smoothDeltaTime;for(C.fixedCount=0;C._fixedTime>=
C.fixedTime;)C.fixedCount++,C._fixedTime-=C.fixedTime;C.frame++};C.get_now=function(){return ha._custom()-C._offset};var Ba=function(){this.id=Ba._id--};Ba.deleteGeometryBuffer=function(a){if(Ba._bufferMap.h.hasOwnProperty(a)){var b=Ba._bufferMap.h[a];Ba._bufferMap.remove(a);b.dispose()}};Ba.prototype={check:function(){return null!=this.gpuBuffer&&this.gpuBuffer.enabled?!0:!1},fromBuffer:function(a){this.id=a.instanceID;Ba._bufferMap.h.hasOwnProperty(this.id)?this.gpuBuffer=Ba._bufferMap.h[this.id]:
(this.gpuBuffer=new Cb,Ba._bufferMap.h[this.id]=this.gpuBuffer,this.gpuBuffer.set(a));return this},dispose:function(){this.gpuBuffer=null}};var xd=function(){this.normal=new h;this.point=new h};xd.prototype={};var Gf=function(){this.ray=new tb;this.result=new N;this.layerMask=new Ga;this.maxDistance=9999999};Gf.prototype={add:function(a){this.result.push(a)}};var Da=function(){};Da.setSize=function(a,b){Da.width=a;Da.height=b};var Wc=function(){fb.call(this);this.timeScale=1;this._dirty=this.enabled=
this.visible=!0;this.set_dirty(!0);this._resized=!0;this._now=ha._custom();this.actor=new w;this.actor._connectWorld(this);this._actorList=new N;this._actorMap=new ba;this._fixedList=new N;this._updateList=new N;this._fixedRemoveIds=new N;this._addMap=new ba;this._collectorMap=new K;this._collectorList=[];this.collectorCamera=new Hf(this.instanceID);this.collectorRenderer=new If(this.instanceID);this.collectorCollider=new Jf(this.instanceID);this.collectorLight=new Kf(this.instanceID);this.addCollector(this.collectorCamera);
this.addCollector(this.collectorRenderer);this.addCollector(this.collectorCollider);this.addCollector(this.collectorLight)};Wc.prototype=n(fb.prototype,{addChild:function(a){this.actor.get_transform().addChild(a.get_transform());this.set_dirty(!0)},addCollector:function(a){-1==this._collectorList.indexOf(a)&&this._collectorList.push(a)},_update:function(){if(this.enabled){Wc.current=this;Pa.current=this.collectorCamera.get(0);this.frame=C.frame;var a=C.smoothDeltaTime*this.timeScale,b=C.fixedTime,
c=C.fixedCount,d=this._resized;this._resized=!1;this._fixedList.clear();this._updateList.clear();for(var e=this._actorList.get_length(),f,g=0;g<e;)if(f=g++,f=this._actorList.get(f),f._enabled){f._frameStart(a);if(0<c){var h=t.onFixedUpdate._type;if(null==f.__eventMap)h=!1;else{var k=f.__eventMap;h=null!=p[h]?k.existsReserved(h):k.h.hasOwnProperty(h)}h&&this._fixedList.push(f)}this._updateList.push(f)}e=this._fixedList.get_length();if(0<c)for(;0<c--;)for(a=0,g=e;a<g;)f=a++,f=this._fixedList.get(f),
f._fixedUpdate(b);e=this._updateList.get_length();b=0;for(c=e;b<c;)f=b++,f=this._updateList.getArrayElement(f),f._update();b=0;for(c=e;b<c;)f=b++,f=this._updateList.getArrayElement(f),e=this.frame,f.get_transform().checkChanged(),f.dispatchEvent(t.onLateUpdate),d&&f.dispatchEvent(t.onScreenResize),f.get_transform()._updateTransform(e),f.frame=e;if(this.visible)for(e=this.collectorCamera.count,d=0,f=e;d<f;)b=d++,b=this.collectorCamera.get(b),b.beforeRender(),b.render();this.collectActors()}},collectActors:function(){if(this._dirty){this._dirty=
!1;for(var a=this._actorList.get_length();0<a--;){var b=this._actorList.get(a);this._addMap.h[b.instanceID]=b}this._actorList.clear();this.actor._collectActors(this._actorList);for(a=this._actorList.get_length();0<a--;)b=this._actorList.get(a),b.sortId=a,this._actorMap.h.hasOwnProperty(b.instanceID)||(b._connectWorld(this),this._actorMap.h[b.instanceID]=b),this._addMap.remove(b.instanceID);for(a=this._addMap.iterator();a.hasNext();)b=a.next(),b._disconnectWorld(),this._addMap.remove(b.instanceID),
this._actorMap.remove(b.instanceID)}},addComponent:function(a){this._dirty=!0;var b=a.classType,c=this._collectorMap;if(null!=p[b]?c.existsReserved(b):c.h.hasOwnProperty(b))c=this._collectorMap,(null!=p[b]?c.getReserved(b):c.h[b]).add(a);else for(c=this._collectorList.length;0<c--;){var d=this._collectorList[c];if(d.exist(a)){d.add(a);var e=this._collectorMap;null!=p[b]?e.setReserved(b,d):e.h[b]=d}}},removeComponent:function(a){var b=a.classType,c=this._collectorMap;if(null!=p[b]?c.existsReserved(b):
c.h.hasOwnProperty(b))c=this._collectorMap,(null!=p[b]?c.getReserved(b):c.h[b]).remove(a)},set_dirty:function(a){return this._dirty=!0}});var Hf=function(a){this.id=a;this._dirty=!1;this.count=0;this._cameras=new ba;this._list=[]};Hf.prototype={exist:function(a){return a instanceof Pa},add:function(a){this._cameras.h.hasOwnProperty(a.instanceID)||(this._cameras.h[a.instanceID]=a,this._dirty=!0,this._list.push(a),this.count=this._list.length)},remove:function(a){this._cameras.h.hasOwnProperty(a.instanceID)&&
(this._cameras.remove(a.instanceID),x.remove(this._list,a),this.count=this._list.length)},get:function(a){this._dirty&&this._list.sort(g(this,this.sort));return this._list[a]},sort:function(a,b){return a.depth!=b.depth?a.depth>b.depth?1:-1:0}};var Jf=function(a){this.id=a;this._list=[];this.count=0;this._map=new ba};Jf.prototype={exist:function(a){return a instanceof Hc},add:function(a){this._map.h.hasOwnProperty(a.instanceID)||(this._map.h[a.instanceID]=this._list.length,this._list.push(a),this.count=
this._list.length)},remove:function(a){if(this._map.h.hasOwnProperty(a.instanceID)){var b=this._map.h[a.instanceID];this._list.splice(b,1);this._map.remove(a.instanceID);a=b;for(b=this._list.length;a<b;){var c=a++;this._map.h[this._list[c].instanceID]=c}this.count=this._list.length}}};var Kf=function(a){this.id=a;this._dirty=!1;this.count=0;this._map=new ba;this._list=[]};Kf.prototype={exist:function(a){return a instanceof Yc},add:function(a){this._map.h.hasOwnProperty(a.instanceID)||(this._map.h[a.instanceID]=
a,this._dirty=!0,this._list.push(a),this.count=this._list.length)},remove:function(a){this._map.h.hasOwnProperty(a.instanceID)&&(this._map.remove(a.instanceID),x.remove(this._list,a),this.count=this._list.length)},get:function(a){return this._list[a]}};var If=function(a){this.id=a;this._list=[];this.count=0;this._map=new ba;this._bounds=new ba};If.prototype={exist:function(a){return a instanceof wa},add:function(a){this._map.h.hasOwnProperty(a.instanceID)||(this._map.h[a.instanceID]=this._list.length,
this._list.push(a),this.count=this._list.length)},remove:function(a){if(this._map.h.hasOwnProperty(a.instanceID)){var b=a.instanceID;this._bounds.remove(b);b=this._map.h[b];this._list.splice(b,1);this._map.remove(a.instanceID);a=b;for(b=this._list.length;a<b;){var c=a++;this._map.h[this._list[c].instanceID]=c}this.count=this._list.length}},setCullCamera:function(a){this._camera=a;this._frustum=this._camera.frustum;this._maxDistance=this._camera.farClipPlane*this._camera.farClipPlane},cull:function(a,
b){null==b?this._bounds.h.hasOwnProperty(a)&&(b=this._bounds.h[a]):this._bounds.h[a]=b;if(null==b)return 0;a=this._camera.eye.distanceSquared(b.sphere.center);if(a>this._maxDistance)return-1;var c=b.sphere;return null!=c&&this._frustum.containsPoint(c.center,c.radius)&&this._frustum.intersectsBox(b.box)?a:-1}};var Hc=function(){H.call(this)};Hc.__name__="lovedna.game.components.Collider";Hc.prototype=n(X.prototype,{raycast:function(a){return!1},onAwake:function(){X.prototype.onAwake.call(this);this._transformFrame=
-1;this.enabled=!0},__class__:Hc});var vd=function(){H.call(this)};vd.__name__="lovedna.game.components.BoxCollider";vd.prototype=n(Hc.prototype,{raycast:function(a){var b=this.get_bounds(),c=a.ray.intersectSphere(b.sphere);if(null==c)return!1;c=a.ray.intersectBox(b.box);if(null==c||c.distanceSquared(a.ray.start)>a.maxDistance)return!1;b=xd._pool.get();b.actor=this.actor;b.collider=this;b.point.copy(c);b.distance=c.distance(a.ray.start);a.add(b);return!0},onAwake:function(){Hc.prototype.onAwake.call(this);
this.center=new h;this.size=new h(1,1,1);this._bounds=new yd},get_bounds:function(){if(this.enabled&&this._transformFrame<this.actor.get_transform().transformFrame){this._transformFrame=this.actor.get_transform().transformFrame;this._bounds.reset();var a=h._pool.get().copy(this.size);a.scale(.5);this._bounds.expand(a.add(this.center));a.copy(this.size).scale(-.5);this._bounds.expand(a.add(this.center));this._bounds.multiplyMatrix44(this.actor.get_transform().getLocalToWorld())}return this._bounds},
__class__:vd});var Pa=function(){H.call(this)};Pa.__name__="lovedna.game.components.Camera";Pa.prototype=n(X.prototype,{screenToViewportPoint:function(a){var b=m.lerpTo(0,1,-1,1,a.x),c=m.lerpTo(0,1,1,-1,a.y);return h._pool.get().set(b,c,a.z)},viewportToWorldPoint:function(a){var b=h._pool.get().set(a.x,a.y,-1),c=h._pool.get().copy(b);c.z=1;this.projectionViewInverseMatrix.transformPoint(b,!0);this.projectionViewInverseMatrix.transformPoint(c,!0);a=a.z/(this.farClipPlane-this.nearClipPlane);return c.sub(b).scale(a).add(b)},
screenToWorldPoint:function(a){return this.viewportToWorldPoint(this.screenToViewportPoint(a))},viewportPointToRay:function(a){a=h._pool.get().set(a.x,a.y,-1);var b=h._pool.get().copy(a);b.z=1;this.projectionViewInverseMatrix.transformPoint(a,!0);this.projectionViewInverseMatrix.transformPoint(b,!0);return tb.get_temp().set(a,b)},ScreenPointToRay:function(a){return this.viewportPointToRay(this.screenToViewportPoint(a))},beforeRender:function(){this.enabled&&null!=this._renderPipeline&&this._renderPipeline.collectRenderer()},
render:function(){this.enabled&&null!=this._renderPipeline&&this._renderPipeline.render()},onConstruct:function(){X.prototype.onConstruct.call(this);this.updateFrame=0;Pa.current=this;this.clearFlags=new Cf;this.cullingMask=new Ga;this.orthographic=!1;this.orthographicScale=1;this.depth=0;this.enabled=!0;this.viewMatrix=this.worldToCameraMatrix=new ua;this.viewInverseMatrix=this.cameraToWorldMatrix=new ua;this.projectionMatrix=new ua;this.projectionViewMatrix=new ua;this.projectionViewInverseMatrix=
new ua;this.nearClipPlane=.1;this.farClipPlane=2E3;this.fieldOfView=60;this.projectionParams=new ta(this.nearClipPlane,this.farClipPlane,this.fieldOfView,0);this.frustum=new Lf;this._orthographicParams=new ta;this.eye=new h;this.fog=new ta(80,300,0,.5);this.fogColor=new E(0,0,0,0);this.property=new sb;this.property.setMatrix(k.toString(k.P),this.projectionMatrix);this.property.setMatrix(k.toString(k.V),this.viewMatrix);this.property.setMatrix(k.toString(k.IV),this.viewInverseMatrix);this.property.setMatrix(k.toString(k.VP),
this.projectionViewMatrix);this.property.setMatrix(k.toString(k.IVP),this.projectionViewInverseMatrix);this.property.setMatrix(k.toString(k.IVP),this.projectionViewInverseMatrix);this.property.setFloat4(k.toString(k.PROJECTION_PARAMS),this.projectionParams);this.property.setFloat4(k.toString(k.ORTHOGRAPHIC_PARAMS),this._orthographicParams);this.property.setFloat3(k.toString(k.EYE),this.eye);this.property.setFloat4(k.toString(k.FOG),this.fog);this.property.setFloat4(k.toString(k.FOG_COLOR),this.fogColor);
Pa.current=this;this._renderPipeline=new Mf(this)},onStart:function(){X.prototype.onStart.call(this);this._orthographicParams.x=this.actor.world.width;this._orthographicParams.y=this.actor.world.height;this._aspect=this._orthographicParams.x/this._orthographicParams.y;this.bindEvent(t.onScreenResize,g(this,this.screenResize));this.bindEvent(t.onTransformComplete,g(this,this.transformComplete))},screenResize:function(a){this._orthographicParams.x=this.actor.world.width;this._orthographicParams.y=this.actor.world.height;
this._aspect=this._orthographicParams.x/this._orthographicParams.y},transformComplete:function(a){this.updateCamera()},updateCamera:function(){var a=!1;if(this.projectionParams.x!=this.nearClipPlane||this.projectionParams.y!=this.farClipPlane||this.projectionParams.z!=this.fieldOfView||this.projectionParams.w!=this._aspect||this._orthographicParams.z!=(this.orthographic?1:0)||this._orthographicParams.w!=this.orthographicScale){a=this.projectionParams;var b=this.nearClipPlane,c=this.farClipPlane,d=
this.fieldOfView,e=this._aspect;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;this._orthographicParams.z=this.orthographic?1:0;this._orthographicParams.w=this.orthographicScale;this.orthographic?(a=this._orthographicParams.x,b=this._orthographicParams.y,this.projectionMatrix.setOrtho(-a*this.orthographicScale,a*this.orthographicScale,-b*this.orthographicScale,b*this.orthographicScale,this.nearClipPlane,this.farClipPlane)):this.projectionMatrix.setProjection(this.nearClipPlane,
this.farClipPlane,this.fieldOfView,this._aspect);a=!0}this.transform.transformFrame>this.updateFrame&&(this.updateFrame=this.transform.transformFrame,this.eye.copy(this.actor.get_transform().get_worldPosition()),a=this.actor.get_transform().get_worldRotation().rotate(h.get_forward()),a.scale(this.farClipPlane-this.nearClipPlane).add(this.eye),this.viewMatrix.lookAt(this.eye,a,this.actor.get_transform().get_worldRotation().rotate(h.get_up())),a=!0);a&&(this.projectionViewMatrix.copy(this.projectionMatrix),
this.projectionViewMatrix.append(this.viewMatrix),this.viewInverseMatrix.copy(this.viewMatrix),this.viewInverseMatrix.inverse(),this.frustum.multiplyMatrix44(this.projectionViewMatrix),this.projectionViewInverseMatrix.copy(this.projectionViewMatrix),this.projectionViewInverseMatrix.inverse(),this.updateFrame=this.transform.transformFrame,this.actor.dispatchEvent(t.onCameraUpdate))},__class__:Pa});var Xc=function(){H.call(this)};Xc.__name__="lovedna.game.components.CameraAlignWithView";Xc.prototype=
n(X.prototype,{setView:function(a,b,c){1>a||1>b||(this.scale=1,this._width=a,this._height=b,this.width=this._width,this.height=this._height,this._callback=c,null==this.camera&&(this.camera=this.actor.getComponent(Pa)),this.dirty())},onAwake:function(){X.prototype.onAwake.call(this);this._dirty=!1;this._width=this._height=0;this.scale=1},onStart:function(){X.prototype.onStart.call(this);this.camera=this.actor.getComponent(Pa)},dirty:function(){this._dirty=!0;this.bindEvent(t.onLateUpdate,g(this,this.onUpdate))},
onUpdate:function(a){this.refresh()},refresh:function(){if(this._dirty&&null!=this.camera&&!(1>this._width||1>this._height||1>this.camera.updateFrame)){this._dirty=!1;var a=h._pool.get(),b=h._pool.get(),c=h._pool.get();a.set(-1,-1,1);b.set(1,1,1);c.set(-1,-1,-1);this.camera.projectionViewInverseMatrix.transformPoint(a,!0);this.camera.projectionViewInverseMatrix.transformPoint(b,!0);c.copy(b);c.y=a.y;var d=a.distance(c);c.copy(b);c.x=a.x;b=a.distance(c);a=Da.width/Da.height;c=this.camera.farClipPlane-
this.camera.nearClipPlane;this._width/this._height>a?(d=this._width/d*c,this.camera.transform.position.z=d,this.height=this._width/a,this.scale=Da.width/this._width):(d=this._height/b*c,this.camera.transform.position.z=d,this.width=this._height*a,this.scale=Da.height/this._height);this.camera.transform.position.set(.5*this._width,.5*this._height,d);this.distance=d;null!=this._callback&&(this._callback(this),this._callback=null)}},__class__:Xc});var $d=function(){this.maxy=89.9;this.miny=-89.9;H.call(this)};
$d.__name__="lovedna.game.components.CameraControl";$d.prototype=n(X.prototype,{onAwake:function(){X.prototype.onAwake.call(this);this._touchCount=0;this.target=new h;this._rotationStart=new h;this._rotationEnd=new h;this.distance=this.speed=10;this.miny=-89.9;this.maxy=89.9;this.moveDelta=this.zoomDelta=1;this._rotationCurrent=new h;this.scaleRotationY=this.scaleRotationX=.5;this._distanceCurrent=this._distanceEnd=200;this._rotationTouchStart=new h;this._rotationTouchEnd=new h;this._moveTouchStart=
new h;this._moveTouchEnd=new h;this._positionStart=new h;this._positionEnd=new h;this._position1=new h;this._position2=new h;this._twoDistance=0},onStart:function(){X.prototype.onStart.call(this);this._camera=this.actor.getComponent(Pa);null!=this._camera&&(this._actorRotation=this.actor.get_transform().rotation,this.bindEvent(t.onUpdate,g(this,this.onUpdate2)),this._distanceCurrent=this._distanceEnd=this.distance,this._actorRotation.getEulerAngles(this._rotationCurrent),this._rotationEnd.copy(this._rotationCurrent),
this._rotationStart.copy(this._rotationCurrent),this.actor.get_transform().position.copy(this._actorRotation.rotate(h.get_forward()).scale(-this._distanceCurrent).add(this.target)))},onUpdate2:function(a){var b=q.touchCount;b!=this._touchCount&&(this._touchCount=b,this._twoDistance=this._state=0);if(!(2<this._touchCount)){a=this.actor.deltaTime;var c=h.instance;q.wheel()&&(this._distanceEnd+=0<q.getWheel().y?this.zoomDelta:-this.zoomDelta);if(1==b){b=q.getTouch(0,!0);if(null==b)return;0==this._state&&
(0>=b.pressure&&2==b.touchId||null!=q.getKey(32)?(this._moveTouchStart.copy(b.position),this._positionStart.copy(this.target),this._state=2):(this.actor.get_transform().rotation.getEulerAngles(this._rotationStart),this._rotationCurrent.copy(this._rotationStart),this._rotationTouchStart.copy(b.position),this._state=1));2==this._state?this._moveTouchEnd.copy(b.position):1==this._state&&this._rotationTouchEnd.copy(b.position)}else if(2==b){var d=q.getTouch(0,!0),e=q.getTouch(1,!0);if(0>d.pressure||null==
d||null==e)return;if(0==this._state)if(b=d.position.distance(e.position),0>=this._twoDistance)this._twoDistance=b,this._position1.copy(d.position),this._position2.copy(e.position);else{d=h._pool.get().copy(d.position).lerpTo(e.position,.5);e=h._pool.get().copy(this._position1).lerpTo(this._position2,.5);e=d.distance(e);var f=m.abs(this._twoDistance-b);if(.008<f||.008<e)f>e?(this._state=3,this._touchZoomStart=this._distanceEnd,this._touchZoom=b,this._twoDistance=0):(this._state=2,this._positionStart.copy(this.target),
this._moveTouchStart.copy(d),this._moveTouchEnd.copy(d))}else 3==this._state?(b=d.position.distance(e.position)-this._touchZoom,this._distanceEnd=this._touchZoomStart-b*this.zoomDelta*15):2==this._state&&(b=h._pool.get().copy(d.position).lerpTo(e.position,.5),this._moveTouchEnd.copy(b))}else 1>b&&(this._twoDistance=this._state=0,this._moveTouchEnd.copy(this._moveTouchStart),this._positionStart.copy(this.target));b=this._distanceCurrent;this._distanceCurrent=b+(this._distanceEnd-b)*a*this.speed;c.copy(this._rotationTouchEnd).sub(this._rotationTouchStart);
c.x=360*c.x*this.scaleRotationY;c.y=360*c.y*this.scaleRotationX;this._rotationEnd.copy(this._rotationStart);this._rotationEnd.x+=c.y;this._rotationEnd.y-=c.x;this._rotationCurrent.lerpTo(this._rotationEnd,a*this.speed);this._rotationCurrent.x>this.maxy&&(this._rotationCurrent.x=this.maxy);this._rotationCurrent.x<this.miny&&(this._rotationCurrent.x=this.miny);this._actorRotation.setEulerAngles(this._rotationCurrent.x,this._rotationCurrent.y,this._rotationCurrent.z);c.copy(this._moveTouchEnd).sub(this._moveTouchStart);
this.target.copy(this._positionStart);this.target.add(this.actor.get_transform().get_worldRotation().get_right().scale(c.x*this.moveDelta*this._distanceEnd));this.target.add(this.actor.get_transform().get_worldRotation().get_up().scale(c.y*this.moveDelta*this._distanceEnd));this.actor.get_transform().position.copy(this._actorRotation.rotate(h.get_forward()).scale(-this._distanceCurrent).add(this.target))}},__class__:$d});var Yc=function(){H.call(this)};Yc.__name__="lovedna.game.components.Light";
Yc.prototype=n(X.prototype,{onAwake:function(){X.prototype.onAwake.call(this);this.position=new h;this.ambient=new h(1,1,1);this.specular=new ta(0,0,0,10);this.property=new sb;this.property.enableDefine(k.toString(k.LIGHT));this.property.setFloat3(k.LIGHT_POSITION.name,this.position);this.property.setFloat3(k.LIGHT_AMBIENT.name,this.ambient);this.property.setFloat4(k.LIGHT_SPECULAR.name,this.specular)},onStart:function(){X.prototype.onStart.call(this);this.onTransform();this.bindEvent(t.onTransform,
g(this,this.onTransform))},onTransform:function(a){a=this.actor.get_transform().get_worldRotation().rotate(h.get_forward().scale(-1)).normalize();this.position.copy(a)},__class__:Yc});var zb=function(){H.call(this)};zb.__name__="lovedna.game.components.MeshRenderer";zb.prototype=n(wa.prototype,{cull:function(a){if(null==this.mesh||!this.mesh.check())return!0;if(!this.cameraCull)return!1;if(this._meshId!=this.mesh.id||this._transformFrame<this.actor.get_transform().transformFrame)this._meshId=this.mesh.id,
this._transformFrame=this.actor.get_transform().transformFrame,this.bounds.copy(this.mesh.gpuBuffer.get_bounds()),this.bounds.multiplyMatrix44(this.actor.get_transform().getLocalToWorld());this._distanceToCamera=a.cull(this.instanceID,this.bounds);return 0>this._distanceToCamera?!0:!1},collectRenderObject:function(a){for(var b=0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){d.setMatrixHandler(k.toString(k.M),(M=this.actor.get_transform(),g(M,M.getLocalToWorld)));d.setMatrixHandler(k.toString(k.IM),
(M=this.actor.get_transform(),g(M,M.getWorldToLocal)));null!=this.skinningMatrixList&&0<this.skinningMatrixList.length&&(d.enableDefine(k.toString(k.SKINNING),0),d.setMatrixArray(k.toString(k.BONE),this.skinningMatrixList));var e=this.mesh.gpuBuffer,f=this._distanceToCamera,h=this.actor.sortId;null==h&&(h=0);null==f&&(f=0);d=Xa._pool.get().set(d,e,f,h);a.add(d)}}},onConstruct:function(){wa.prototype.onConstruct.call(this);this._meshId=1E7;this.bounds=new yd;this.skipFrame=0;this._cacheCull=!0},onAwake:function(){this._distanceToCamera=
0;this._transformFrame=-1},onDestroy:function(){wa.prototype.onDestroy.call(this);null!=this.mesh&&this.mesh.dispose();this.mesh=null;null!=this.bounds&&this.bounds.dispose();this.bounds=null},__class__:zb});var Ob=function(){this.instanceID=Ob._id++;this.position=new h;this.speed=new h;this.id=0};Ob.prototype={draw:function(a){a.position.push(this.position);a.position.push(this.position);a.position.push(this.position);a.position.push(this.position);var b=ta.instance,c=this.startTime,d=this.life,
e=this.sizeStart,f=this.sizeEnd;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;a.color.push(b);a.color.push(b);a.color.push(b);a.color.push(b);c=this.speed.x;d=this.speed.y;e=this.speed.z;f=this.angleStart;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;a.color2.push(b);a.color2.push(b);a.color2.push(b);a.color2.push(b);c=this.angleDelta;d=this.id;f=e=0;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;
b.z=e;b.w=f;a.color3.push(b);a.color3.push(b);a.color3.push(b);a.color3.push(b)}};var Fa=function(){H.call(this)};Fa.__name__="lovedna.game.components.Transform";Fa.prototype=n(X.prototype,{localToWorldPoint:function(a){return this.getLocalToWorld().transformPoint(a)},worldToLocalPoint:function(a){return this.getWorldToLocal().transformPoint(a)},addChild:function(a,b){null==b&&(b=!1);this.addChildAt(a,1E7,b)},addChildAt:function(a,b,c){null==c&&(c=!1);null==a||a==this||a.hasChild(this)||(null!=a.parent&&
(a.parent.removeChild(a),a.parent==this&&(c=!1)),null==this._childs&&(this._childs=new N),0>b?this._childs.unshift(a):b>=this._childs.get_length()?this._childs.push(a):this._childs.insert(b,a),c&&(b=ua._pool.get(),b.copy(this.getWorldToLocal()),b.append(a.getLocalToWorld()),a.rotation.copy(b.getRotation()),a.position.copy(b.getTranslation()),a.scale.copy(b.getScale())),a.makeChange(),a.parent=this,a._removeFromParent=!1,a.actor.dispatchEvent(t.onAdded),null!=this.actor.world&&this.actor.world.set_dirty(!0),
this.childCount=this._childs.get_length())},removeFromParent:function(){null!=this.parent&&this.parent.removeChild(this)},removeChild:function(a){null!=a&&a!=this&&a.parent==this&&null!=this._childs&&-1!=this._childs.remove(a)&&(this.childCount=this._childs.get_length(),a.actor.dispatchEvent(t.onRemoved),null!=this.actor.world&&this.actor.world.set_dirty(!0),a._removeFromParent=!0)},getChild:function(a,b){null==b&&(b=!1);return null==this._childs?null:this._childs.get(a,b)},hasChild:function(a){if(null==
a||a==this||null==a.parent)return!1;a=a.parent;for(var b=200;null!=a;){if(a==this)return!0;var c=a.parent;if(c==a)break;a=c;--b;if(1>b)break}return!1},getLocalToWorld:function(){null==this._localToWorld&&(null==this.__localToWorld&&(this.__localToWorld=new ua),this._localToWorld=this.__localToWorld,this._doUpdateTransform());return this._localToWorld},getWorldToLocal:function(){null==this._worldToLocal&&(null==this.__worldToLocal&&(this.__worldToLocal=new ua),this._worldToLocal=this.__worldToLocal,
this._worldToLocal.copy(this.getLocalToWorld()),this._worldToLocal.inverse());return this._worldToLocal},onAwake:function(){X.prototype.onAwake.call(this);this.position=new h(0,0,0);this.scale=new h(1,1,1);this.rotation=new xa;this._localPosition=new h(.1,.2,.3);this._localScale=new h(1.1,1.2,1.3);this._localRotation=new xa;this.childCount=0;this.transformFrame=-1;this._removeFromParent=!1;this.inherit=new $a;this.inherit.setArrayElement(0);this.inherit.setArrayElement(1);this.inherit.setArrayElement(2)},
onDestroy:function(){X.prototype.onDestroy.call(this);if(null!=this._childs)for(var a=this._childs.get_length();0<a--;){var b=this._childs.getArrayElement(a);this.removeChild(b);w.destory(b.actor)}null!=this.parent&&this.parent.removeChild(this);this._worldToLocal=this._localToWorld=this.__worldToLocal=this.__localToWorld=this._localRotation=this._localScale=this._localPosition=this.rotation=this.scale=this.position=this.parent=this._childs=null},_removed:function(){this._removeFromParent&&(this._removeFromParent=
!1,this.parent=null)},checkChanged:function(){if(null!=this.parent&&this.parent._frameChanged)return this.makeChange(),!0;var a=this._localPosition,b=this.position;if(a.x!=b.x||a.y!=b.y||a.z!=b.z)return this._localPosition.copy(this.position),this.makeChange(),!0;a=this._localRotation;b=this.rotation;if(a.x!=b.x||a.y!=b.y||a.z!=b.z||a.w!=b.w)return this._localRotation.copy(this.rotation),this.makeChange(),!0;a=this._localScale;b=this.scale;return a.x!=b.x||a.y!=b.y||a.z!=b.z?(this._localScale.copy(this.scale),
this.makeChange(),!0):!1},makeChange:function(){this._frameChanged=!0;this._worldToLocal=this._localToWorld=this._scale=this._rotation=this._position=null},_updateTransform:function(a){this._frameChanged&&(this.transformFrame=a,this.onTransform(),this.actor.dispatchEvent(t.onTransform));this.actor.dispatchEvent(t.onTransformComplete)},_doUpdateTransform:function(){if(null==this.parent)this._localToWorld.setTRS(this.position,this.rotation,this.scale);else{if(7==this.inherit.value)this._localToWorld.copy(this.parent.getLocalToWorld());
else{var a=this.parent.getLocalToWorld(),b=null,c=null,d=null;this.inherit.getArrayElement(0)&&(b=a.getTranslation());this.inherit.getArrayElement(1)&&(c=a.getRotation());this.inherit.getArrayElement(2)&&(d=a.getScale());this._localToWorld.setTRS(b,c,d)}this._localToWorld.appendTRS(this.position,this.rotation,this.scale)}},onTransform:function(){},get_worldPosition:function(){null==this._position&&(null==this.__position&&(this.__position=new h),this._position=this.__position,this.getLocalToWorld().getTranslation(this._position));
return h._pool.get().copy(this._position)},get_worldScale:function(){null==this._scale&&(null==this.__scale&&(this.__scale=new h),this._scale=this.__scale,this.getLocalToWorld().getScale(this._scale));return h._pool.get().copy(this._scale)},get_worldRotation:function(){null==this._rotation&&(null==this.__rotation&&(this.__rotation=new xa),this._rotation=this.__rotation,this.getLocalToWorld().getRotation(this._rotation));return xa._pool.get().copy(this._rotation)},__class__:Fa});var Mb=function(){H.call(this)};
Mb.__name__="lovedna.game.components.RectTransform";Mb.prototype=n(Fa.prototype,{onAwake:function(){Fa.prototype.onAwake.call(this);this.anchorX=new G(.5,.5);this.anchorY=new G(.5,.5);this.height=this.width=0;this._size=new G;this._anchorX=new G(.5,.5);this._anchorY=new G(.5,.5);this.pivot=new G(.5,.5);this._pivot=new G(.5,.5);this._rectChange=!0;this.bindEvent(t.onAdded,g(this,this.onAdded))},onStart:function(){Fa.prototype.onStart.call(this)},checkChanged:function(){if(this.width!=this._size.x||
this.height!=this._size.y){var a=this._size,b=this.width,c=this.height;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this.makeChange();return this._rectChange=!0}a=this._pivot;b=this.pivot;if(a.x!=b.x||a.y!=b.y)return this._pivot.copy(this.pivot),this.makeChange(),this._rectChange=!0;a=this._anchorY;b=this.anchorY;if(a.x!=b.x||a.y!=b.y)return this._anchorY.copy(this.anchorY),this.makeChange(),this._rectChange=!0;a=this._anchorX;b=this.anchorX;return a.x!=b.x||a.y!=b.y?(this._anchorX.copy(this.anchorX),
this.makeChange(),this._rectChange=!0):Fa.prototype.checkChanged.call(this)?!0:!1},onTransform:function(){this._rectChange&&this.actor.dispatchEvent(t.onRectTransform);this._rectChange=!1},_doUpdateTransform:function(){var a=h._pool.get().copy(this.position);if(null!=this._parent){this.anchorX.clamp(0,1);this.anchorY.clamp(0,1);if(this.anchorX.y>this.anchorX.x){var b=this.anchorX.y-this.anchorX.x;this.width=this._parent.width*b;this.position.x+=(this.anchorX.x+.5*b-.5)*this._parent.width+(this.pivot.x-
.5)*this.width}else this.position.x+=(this.anchorX.x-.5)*this._parent.width;this.anchorY.y>this.anchorY.x?(b=this.anchorY.y-this.anchorY.x,this.height=this._parent.height*b,this.position.y+=(this.anchorY.x+.5*b-.5)*this._parent.height+(this.pivot.y-.5)*this.height):this.position.y+=(this.anchorY.x-.5)*this._parent.height}Fa.prototype._doUpdateTransform.call(this);this.position.copy(a)},onDestroy:function(){Fa.prototype.onDestroy.call(this);this.anchorX=this.anchorY=this.pivot=this._size=this._anchorX=
this._anchorY=this._pivot=this._parent=null},onAdded:function(a){this.parent instanceof Mb&&(this._parent=this.parent)},__class__:Mb});var Na=function(){this.life=0;this.position=new h;this._ins=h.instance};Na.prototype={add:function(a,b){null==b&&(b=.5);this.position.copy(a);this.life=b},update:function(a){this.life-=a},drawTo:function(a,b,c){null!=this.next?(Na._dir.sub(this.next.position,this.position),this._ins.cross(Na._dir,this.normal).normalize().scale(b),Na._temp.copy(this.position).add(this._ins),
a.add(Na._temp),Na._temp.copy(this.position).sub(this._ins),a.add(Na._temp)):null!=this.prev?(Na._dir.sub(this.position,this.prev.position),this._ins.cross(Na._dir,this.normal).normalize().scale(b),Na._temp.copy(this.position).add(this._ins),a.add(Na._temp),Na._temp.copy(this.position).sub(this._ins),a.add(Na._temp)):(a.add(this.position),a.add(this.position))}};var zd=function(){this.position=new h;this.rotation=new xa};zd.prototype={init:function(a){this._particle=a},update:function(){null==this._transform&&
(this._transform=this._particle.transform);this.position.copy(this._particle.getPosition());this.rotation.copy(this._particle.getRotation());this.onUpdate()},onUpdate:function(){}};var Qe=function(a,b){null==b&&(b=1);null==a&&(a=0);zd.call(this);this.minSize=a;this.maxSize=b;this.rangeX=new ib(-1,1);this.rangeY=new ib(-1,1);this.rangeZ=new ib(-1,1)};Qe.prototype=n(zd.prototype,{onUpdate:function(){zd.prototype.onUpdate.call(this);0>this.maxSize&&(this.maxSize=0);this.minSize>this.maxSize&&(this.minSize=
this.maxSize);var a=this.rangeX.get(),b=this.rangeY.get(),c=this.rangeZ.get(),d=xa.instance,e=h.get_zero();a=h._pool.get().set(a,b,c);d=d.setLookAt(h._pool.get().sub(a,e).normalize(),null);this.rotation.mul(d);d=this.maxSize-this.minSize;this.position.add(this.rotation.rotate(h.get_forward()).scale(this.minSize+Math.random()*d))}});var Ka=function(){H.call(this)};Ka.__name__="lovedna.game.components.ui.Canvas";Ka.collect=function(a){null!=Ka._current&&Ka._current._guiList.push(a)};Ka.reset=function(){Ka._list.clear();
Ka._current=null};Ka.prototype=n(wa.prototype,{onAwake:function(){wa.prototype.onAwake.call(this);var a=this.actor.getComponent(Fa);null!=a?(this.actor.removeComponent(Fa),this.rectTransform=this.actor.addComponent(Mb),this.rectTransform.position.copy(a.position),this.rectTransform.scale.copy(a.scale),this.rectTransform.rotation.copy(a.rotation),this.transform=this.rectTransform,null!=a.parent&&a.parent.addChild(this.rectTransform)):this.rectTransform=this.actor.addComponent(Mb);this._guiList=T.fromArray([]);
this.order=this.actor.sortId},onStart:function(){wa.prototype.onStart.call(this);this.bindEvent(t.onCollectChildren,g(this,this.onCollectChildren));this.bindEvent(t.onCollectChildrenComplete,g(this,this.onCollectChildrenComplete))},cull:function(a){return!1},collectRenderObject:function(a){for(var b=1E3*this.order,c=0,d=this._guiList.get_length();c<d;){var e=c++;this._guiList.getArrayElement(e).collectRenderObject(a,b+e)}},onCollectChildren:function(a){this._guiList.clear();Ka._list.push(this);Ka._current=
this},onCollectChildrenComplete:function(a){Ka._current=Ka._list.pop()},__class__:Ka});var Nf=function(){this.rect=new Sc;this.lineIndex=0;this.clearStyle()};Nf.prototype={set_char:function(a){this.char=a;this.clearStyle();return this.char},clearStyle:function(){this.chunk=null;this.customSize=0;this.customColorBottom=this.customColorTop=null},addRichChunk:function(a){this.chunk=a;"size"==this.chunk.name?this.customSize=m.stringToFloat(a.value):"color"==this.chunk.name&&(-1==this.chunk.value.indexOf(",")?
(this.customColorBottom=this.customColorTop=new E,this.customColorTop.parse(this.chunk.value),this.customColorTop.w=1):(this.customColorBottom=this.customColorTop=new E,a=this.chunk.value.split(","),1<a.length&&(this.customColorBottom=new E,this.customColorTop.parse(a[0]),this.customColorBottom.parse(a[1]),this.customColorTop.w=1,this.customColorBottom.w=1)))}};var Of=function(){this.y=this.height=this.width=this.index=0;this.charList=new N};Of.prototype={setDefault:function(a){this._txt=a;this._size=
this._txt._font.fnt.size;this._lineHeight=this._txt._font.fnt.base;this._scale=1;0<this._txt.size&&(this._scale=this._txt.size/this._size,0>=this._scale&&(this._scale=1));this._maxWidth=a.rectTransform.width;this._maxHeight=a.rectTransform.height;this._x=this.y=this.height=this.width=this.index=0;this.charList.clear()},add:function(a){if(null==a.char)return 1;var b=a.char.width,c=a.char.height,d=this._lineHeight,e=this._scale;0<a.customSize&&(e=a.customSize/this._txt._font.fnt.size,0>=e&&(e=1));b*=
e;c*=e;d*=e;if(0<this._maxWidth&&this._x+b+a.char.xoffset*e>this._maxWidth)return 0;a.rect.x=this._x+a.char.xoffset*e;a.rect.y=this._lineHeight-a.char.yoffset-a.char.height+2;a.rect.set_width(b);a.rect.set_height(c);this.width=this._x+=a.char.xadvance*e+this._txt._letterSpace;this.charList.push(a);d>this.height&&(this.height=d);return 1},complete:function(){1>this.charList.get_length()&&(this.height=this._txt._font.fnt.lineHeight);this.y+=this.height;this._txt=null}};var Sc=function(a,b,c,d){null==
d&&(d=1);null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);ta.call(this,a,b,c,d);this.x=a;this.y=b;this.set_width(c);this.set_height(d)};Sc.prototype=n(ta.prototype,{set_width:function(a){return this.z=a},set_height:function(a){return this.w=a},get_right:function(){return this.x+this.z}});var Ub=function(){this._paramKey=new N};Ub.prototype={Parse:function(a,b){this._paramMap=new K;this.next=this.value=this.name=null;this._paramKey.clear();this.start=b;a=ea.replace(a,Ub.tokenLeft,"");a=ea.replace(a,Ub.tokenRight,
"");a=m.trim(a);this.type=-1;b=a.indexOf("/");if(0==b)this.type=1,this.name=x.substr(a,b+1,null);else{b==a.length-1&&(this.type=0,a=m.trim(x.substr(a,0,a.length-1)));b=a.indexOf(" ");var c=a.indexOf("=");-1==b&&-1==c?this.name=a:-1!=b&&-1!=c?c<b?(a=a.split("="),this.name=m.trim(a[0]),1<a.length&&(this.value=a[1])):(this.name=x.substr(a,0,b),this.parseParams(x.substr(a,b+1,null))):-1!=b?(this.name=x.substr(a,0,b),this.parseParams(x.substr(a,b+1,null))):-1!=c&&(this.name=m.trim(x.substr(a,0,c)),this.parseParams(x.substr(a,
c+1,null)))}},setNext:function(a){this.next=a},parseParams:function(a){a=m.trim(a);if(-1==a.indexOf(" ")&&-1==a.indexOf("="))this.value=a;else{a=a.split(" ");var b=a.length;if(0!=b)for(var c=0;c<b;){var d=c++;d=m.trim(a[d]);if(""!=d){var e=d.split("=");d=m.trim(e[0]);var f=null;1<e.length&&(f=m.trim(e[1]));this._paramKey.push(d);e=this._paramMap;null!=p[d]?e.setReserved(d,f):e.h[d]=f}}}}};var Ad=function(){this._chunkList=new N;this._list=new N};Ad.prototype={parse:function(a){this.value=a;this._chunkList.clear();
for(a=a.length;;){var b=this.value.indexOf(Ub.tokenLeft,0),c=this.value.indexOf(Ub.tokenRight,b),d=c-b;if(0<d&&0<=b){if(this.addChunk(b,x.substr(this.value,b,d+1)),this.value=x.substr(this.value,0,b)+x.substr(this.value,c+1,null),this.value.length>a)break}else break;--a;if(0>a)break}this.buildChunk();return this._list},addChunk:function(a,b){var c=Ad._pool.get();c.Parse(b,a);this._chunkList.push(c)},buildChunk:function(){this._list.clear();for(var a,b=0,c=this._chunkList.get_length();b<c;){var d=
b++;a=this._chunkList.getArrayElement(d);if(null==a)break;-1==a.type?(this._list.push(a),a.setNext(this.getNextChunk(d+1,a.name))):0==a.type&&this._list.push(a)}},getNextChunk:function(a,b){for(var c=this._chunkList.get_length();a<c;){var d=a++,e=this._chunkList.getArrayElement(d);if(e.name==b&&1==e.type)return this._chunkList.removeAt(d),e}return null}};var Y=function(){H.call(this)};Y.__name__="lovedna.game.components.ui.Text";Y.prototype=n(ra.prototype,{onAwake:function(){ra.prototype.onAwake.call(this);
this._dirty=this.language=!1;this.size=Y.defaultSize;this._letterSpace=this._lineSpace=0;this._alignmentY=this._alignmentX=-1;this.rectTransform.width=this.rectTransform.height=0;this._charList=new N;this._lineList=new N;this._charLineWidth=new N;this._drawFrame=this._updateFrame=0;this.material.color.setRGBA(-1);this.material.renderQueue=ra.defaultRenderQueue;this._richText=!1;this.textWidth=this.textHeight=0;this.set_font(Y.defaultFnt)},onDestroy:function(){ra.prototype.onDestroy.call(this);Ba.deleteGeometryBuffer(this.geometryBuffer.instanceID);
this.geometryBuffer.dispose();this.geometryBuffer=null;this.material.dispose()},onStart:function(){ra.prototype.onStart.call(this);this.bindEvent(t.onRectTransform,g(this,this.onRectTransform))},onRectTransform:function(a){this.dirty()},dirty:function(){this._dirty||this.bindEvent(t.onTransformComplete,g(this,this.onTransformComplete));this._dirty=!0;this._drawFrame=this._updateFrame=-1},onTransformComplete:function(a){this._dirty=!1;this.bindEvent(t.onTransformComplete,null);null!=this._font&&this._font.enabled&&
this._font.inited&&(this.refresh(),this.drawText1())},fontInit:function(a){null!=this._font.texture&&(this.material.setTexture(this._font.texture),this.material.name=this._font.name,this.dirty())},refresh:function(){if(null!=this._font&&this._font.enabled&&null!=this._text&&0!=this._text.length){var a=this.actor.get_frame();if(this._updateFrame!=a){this._charList.clear();Y._charpool.clear(0);Y._linepool.clear();var b=this._text;this.language&&null!=Y.languageFormat&&(b=Y.languageFormat(b));this._updateFrame=
a;this._lineList.clear();a=null;this._richText&&(a=Y._parse.parse(b),b=Y._parse.value);for(var c=0,d=b.length;c<d;){var e=c++,f=x.cca(b,e),g=this._font.fnt._chars.h[f];null==g&&(g=this._font.fnt._chars.h[32]);var h=Y._charpool.get();h.index=e;h.set_char(g);h.newline=10==f||13==f;this._charList.push(h)}if(null!=a&&(b=a.get_length(),0<b))for(c=0;c<b;)for(d=c++,d=a.getArrayElement(d),f=e=d.start,null!=d.next&&(f=d.next.start);e<f;)g=e++,this._charList.getArrayElement(g).addRichChunk(d);a=this.rectTransform.height;
b=0;c=Y._linepool.get();c.setDefault(this);c.y=b;d=this._charList.get_length();this.textHeight=this.textWidth=0;e=!0;for(f=0;f<d;)if(g=f++,g=this._charList.getArrayElement(g),g.newline)c.complete(),c.width>this.textWidth&&(this.textWidth=c.width),this._lineList.push(c),b+=c.height+this._lineSpace,c=Y._linepool.get(),c.setDefault(this),c.y=b,e=!0;else if(h=c.add(g),0==h){c.complete();c.width>this.textWidth&&(this.textWidth=c.width);this._lineList.push(c);b+=c.height+this._lineSpace;if(b>a){e=!1;break}c=
Y._linepool.get();c.setDefault(this);c.y=b;c.add(g);e=!0}else if(-1==h)break;e&&(c.complete(),c.width>this.textWidth&&(this.textWidth=c.width),this._lineList.push(c));this.textHeight=c.y}}else this.geometryBuffer.update()},drawText1:function(){if(null!=this._font&&this._font.enabled){var a=this.actor.get_frame();if(this._drawFrame!=a&&(this._drawFrame=a,null!=this._text&&0!=this._text.length)){this.geometryBuffer.position.clear();this.geometryBuffer.uv.clear();this.geometryBuffer.color.clear();this.geometryBuffer.group.clear();
a=this.rectTransform.width;var b=this.rectTransform.height,c=-this.rectTransform.pivot.x*a,d=-this.rectTransform.pivot.y*b,e=this._font.texture.width,f=this._font.texture.height,g=0;b=this.textHeight-b;0>=this._alignmentY&&(b=0==this._alignmentY?.5*b:0);for(var h=0,k=0,l=this._lineList.get_length();k<l;){var m=k++;m=this._lineList.getArrayElement(m);h-=m.height;var n=m.charList.get_length(),p=a-m.width;0>=this._alignmentX&&(p=0==this._alignmentX?.5*p:0);for(var q=0;q<n;){var t=q++;t=m.charList.getArrayElement(t);
var u=t.char,v=t.rect,w=v.x+p,x=v.get_right()+p,y=h+v.y+b;v=h+v.y+v.w+b;this.geometryBuffer.position.push(this._vec3.set(w+c,y+d,0));this.geometryBuffer.position.push(this._vec3.set(x+c,y+d,0));this.geometryBuffer.position.push(this._vec3.set(x+c,v+d,0));this.geometryBuffer.position.push(this._vec3.set(w+c,v+d,0));w=u.x/e;y=(u.y+u.height)/f;x=(u.x+u.width)/e;v=u.y/f;u=this._vec2;var z=w,A=y;null==A&&(A=0);null==z&&(z=0);u.x=z;u.y=A;this.geometryBuffer.uv.push(u);u=this._vec2;z=x;null==y&&(y=0);null==
z&&(z=0);u.x=z;u.y=y;this.geometryBuffer.uv.push(u);y=this._vec2;u=v;null==u&&(u=0);null==x&&(x=0);y.x=x;y.y=u;this.geometryBuffer.uv.push(y);x=this._vec2;null==v&&(v=0);null==w&&(w=0);x.x=w;x.y=v;this.geometryBuffer.uv.push(x);null!=t.customColorTop?(w=t.customColorBottom,this.geometryBuffer.color.push(w),this.geometryBuffer.color.push(w),w=t.customColorTop,this.geometryBuffer.color.push(w),this.geometryBuffer.color.push(w)):(null!=this.colorBottom?(this.geometryBuffer.color.push(this.colorBottom),
this.geometryBuffer.color.push(this.colorBottom)):(this.geometryBuffer.color.push(this._color.setRGBA(-1)),this.geometryBuffer.color.push(this._color.setRGBA(-1))),null!=this.colorTop?(this.geometryBuffer.color.push(this.colorTop),this.geometryBuffer.color.push(this.colorTop)):(this.geometryBuffer.color.push(this._color.setRGBA(-1)),this.geometryBuffer.color.push(this._color.setRGBA(-1))));this.geometryBuffer.group.indices.push3(g,g+1,g+2);this.geometryBuffer.group.indices.push3(g,g+2,g+3);g+=4}h-=
this._lineSpace}this.geometryBuffer.update();this.dispatchEvent(B.update)}}},set_text:function(a){this._text!=a&&(this._text=a,this.dirty());return this._text},set_font:function(a){this._font!=a&&(null==this._font||this._font.enabled||this._font.removeEventListener(B.complete._type,g(this,this.fontInit)),this._font=a,null==this._font||this._font.enabled?this.fontInit():this._font.addEventListener(B.complete._type,g(this,this.fontInit)));return this._font},set_alignmentX:function(a){0<a&&(a=1);0>a&&
(a=-1);a!=this._alignmentX&&(this._alignmentX=a,this.dirty());return this._alignmentX},set_alignmentY:function(a){0<a&&(a=1);0>a&&(a=-1);a!=this._alignmentY&&(this._alignmentY=a,this.dirty());return this._alignmentY},__class__:Y});var Bd=function(){H.call(this)};Bd.__name__="lovedna.game.components.ui.UIRoot";Bd.prototype=n(X.prototype,{onAwake:function(){X.prototype.onAwake.call(this);this.planeDistance=60;this.height=this.width=0;this._dirty=!1;this.updatePosition=this.refresh=!0;this._onRefresh=
!1;this.touchInput=this.actor.addComponent(fd);this.bindEvent(t.onAdded,g(this,this.onAdded));Bd.current=this;this.actor.name="uiroot"},onStart:function(){X.prototype.onStart.call(this);this.actor.get_transform().position.set(0,0,this.planeDistance);this.bindEvent(t.onTransformComplete,g(this,this.onTransformComplete));this.touchInput.camera=this._camera},onAdded:function(a){this._dirty=!0},onTransformComplete:function(a){if(null!=this._camera&&this._dirty&&null!=this._camera){if(this._onRefresh&&
(this._onRefresh=!1,null!=this.onRefresh))this.onRefresh();if(this.refresh){this._dirty=this.refresh=!1;var b=h._pool.get(),c=h._pool.get(),d=h._pool.get(),e=1;a=this.planeDistance/(this._camera.farClipPlane-this._camera.nearClipPlane);b.set(-e,-e,1);c.set(e,-e,1);d.set(-e,e,1);this._camera.projectionViewInverseMatrix.transformPoint(b,!0);this._camera.projectionViewInverseMatrix.transformPoint(c,!0);this._camera.projectionViewInverseMatrix.transformPoint(d,!0);e=b.distance(c);d=b.distance(d);b=e*
a;a*=d;e=b/Da.width;0<this.width&&0<this.height&&(e=this.width/this.height>b/a?b/this.width:a/this.height);this.actor.get_transform().scale.set(e,e,e);a=h._pool.get();a.set(0,0,-1);this._camera.actor.get_transform().getLocalToWorld().getRotation().rotate(a);this.actor.get_transform().rotation.setLookAt(a);this.updatePosition&&(this.updatePosition=!1,a.set(0,0,this.planeDistance),this._camera.actor.get_transform().localToWorldPoint(a),this.actor.get_transform().parent.worldToLocalPoint(a),this.actor.get_transform().position.copy(a));
this._onRefresh=!0}}},__class__:Bd});var fd=function(){H.call(this)};fd.__name__="lovedna.game.components.ui.UITouchInput";fd.prototype=n(X.prototype,{onAwake:function(){X.prototype.onAwake.call(this);this.enabled=!1;this._actorList=T.fromArray([]);this._eventList=T.fromArray([]);this._checkActorList=T.fromArray([]);this.touchCount=2;this.layerMask=new Ga;this.layerMask.data.value=0;this.layerMask.add(4)},onStart:function(){X.prototype.onStart.call(this);this._pressed=!1;this.bindEvent(t.onUpdate,
g(this,this.onUpdate));this._hitInfo=new Gf;this._pressList=[]},onUpdate:function(a){if(this.enabled&&null!=this.camera&&null!=this.camera.actor.world){a=0;for(var b=this.touchCount;a<b;){var c=a++;if(q.touchDown(c)){this._currentTouchId=c;var d=t.onTouchBegin;d.downActor=null;d.currentActor=null;d.touch.copy(q.getTouch(c));var e=this.camera.ScreenPointToRay(q.getTouch(c).position);this._hitInfo.ray.copy(e);this._hitInfo.world=this.camera.actor.world;e=this._hitInfo.world.collectorCollider;this._checkActorList.setArrayElement(c,
null);for(var f=e.count;0<f--;){var g=e._list[f];if(this.layerMask.exist(g.actor.layer)&&this.transform.hasChild(g.transform)){var h=this._checkActorList.getArrayElement(c);null!=h&&g.actor.sortId<h.actor.sortId||q.raycastCollider(this._hitInfo,g)&&this._checkActorList.setArrayElement(c,g)}}e=this._checkActorList.getArrayElement(c);null!=e&&(d.downActor=e.actor,d.currentActor=e.actor,this._actorList.push(e.actor),this._eventList.push(d),this._pressList[c]=e.actor);this._actorList.push(this.actor);
this._eventList.push(d)}if(q.touchUp(c)){this._currentTouchId=c;d=t.onTouchEnd;d.downActor=null;d.currentActor=null;d.touch.copy(q.getTouch(c));e=this._pressList[c];f=null;this._pressList[c]=null;g=this.camera.ScreenPointToRay(d.touch.position);this._hitInfo.ray.copy(g);this._hitInfo.world=this.camera.actor.world;g=this._hitInfo.world.collectorCollider;this._checkActorList.setArrayElement(c,null);for(h=g.count;0<h--;){var k=g._list[h],l=this._checkActorList.getArrayElement(c);null!=l&&k.actor.sortId<
l.actor.sortId||q.raycastCollider(this._hitInfo,k)&&this._checkActorList.setArrayElement(c,k)}c=this._checkActorList.getArrayElement(c);null!=c&&(f=c.actor);d.currentActor=f;d.downActor=e;null!=e&&(this._actorList.push(e),this._eventList.push(d));null!=f&&e!=f&&(this._actorList.push(f),this._eventList.push(d));this._actorList.push(this.actor);this._eventList.push(d)}}for(a=this._actorList.get_length();0<a--;)b=this._actorList.getArrayElement(a),c=this._eventList.getArrayElement(a),b.dispatchEvent(c);
this._actorList.clear();this._eventList.clear()}},__class__:fd});var Qc=function(a){B.call(this,a);this.touch=new Va};Qc.__name__="lovedna.game.events.ActorTouchEvent";Qc.prototype=n(B.prototype,{copy:function(a){B.prototype.copy.call(this,a);null!=a&&(this.touch.copy(a.touch),this.downActor=a.downActor,this.currentActor=a.currentActor)},clear:function(){B.prototype.clear.call(this);this.currentActor=this.downActor=null},__class__:Qc});var t=function(a){B.call(this,a)};t.__name__="lovedna.game.events.ActorEvent";
t.prototype=n(B.prototype,{__class__:t});var yd=function(){this.box=new Pf;this.sphere=new Qf};yd.prototype={dispose:function(){this.box.dispose();this.sphere.dispose();this.sphere=this.box=null},copy:function(a){null!=a&&(this.box.copy(a.box),this.sphere.copy(a.sphere));return this},reset:function(){null!=this.box&&(this.box.reset(),this.sphere.radius=0)},expand:function(a){this.box.expand(a)},multiplyMatrix44:function(a){null!=a&&this.box.multiplyMatrix44(a);this.sphere.center.copy(this.box.getCenter());
a=this.box.min.distance(this.box.max);this.sphere.radius=.5*a}};var Cb=function(){this.id=Cb._id++;this.vertexBuffers=new N;this.indexBuffer=new ub;this._buffers=new K;this.enabled=!1;this._bounds=new yd;this._boundsDirty=!1;this.property=new sb};Cb.prototype={set:function(a){this.geometry!=a&&(null!=this.geometry&&this.geometry.removeEventListener(B.update._type,g(this,this.geometryUpdate)),this.enabled=!1,this.geometry=a,null!=this.geometry&&this.geometry.addEventListener(B.update._type,g(this,
this.geometryUpdate)),this.geometryUpdate())},dispose:function(){this.indexBuffer.unload();for(var a=this.vertexBuffers.get_length();0<a--;)this.vertexBuffers.getArrayElement(a).unload();this.vertexBuffers.clear();this.vertexBuffers.dispose();this._buffers=this.vertexBuffers=null;null!=this._bounds&&(this._bounds.dispose(),this._bounds=null)},updateBuffer:function(a,b){if(null==a||1>a.dataLength)this.property.disableDefine(b.name);else if(a.get_changed()){var c=b.name,d=this._buffers;d=null!=p[c]?
d.getReserved(c):d.h[c];if(null==d){d=new Ic;this.vertexBuffers.push(d);d.setLayout([new Rf(c,b.size,a.componentType)]);var e=this._buffers;null!=p[c]?e.setReserved(c,d):e.h[c]=d;b!=k.POSITION?this.property.enableDefine(b.name):this._boundsDirty=!0}d.upload(a)}},geometryUpdate:function(a){if(0>=this.geometry.position.length||0>=this.geometry.group.indices.length)this.enabled=!1;else{if(this.geometry.group.indices.get_changed()){if(1>this.geometry.group.count||null==this.indexBuffer.layouts||this.geometry.group.count<
this.indexBuffer.layouts.length){a=[];for(var b=0,c=this.geometry.group.count;b<c;){var d=b++,e=new Sf;e.length=this.geometry.group.getGroupLength(d);e.offset=this.geometry.group.getGroupOffset(d);a.push(e)}this.indexBuffer.setLayouts(a)}this._boundsDirty=!0;this.indexBuffer.upload(this.geometry.group.indices.data,this.geometry.group.indices.length)}this.updateBuffer(this.geometry.position,k.POSITION);this.updateBuffer(this.geometry.uv,k.UV);this.updateBuffer(this.geometry.uv2,k.UV2);this.updateBuffer(this.geometry.normal,
k.NORMAL);this.updateBuffer(this.geometry.tangent,k.TANGENT);this.updateBuffer(this.geometry.color,k.COLOR);this.updateBuffer(this.geometry.color2,k.COLOR2);this.updateBuffer(this.geometry.color3,k.COLOR3);this.updateBuffer(this.geometry.color4,k.COLOR4);this.updateBuffer(this.geometry.color5,k.COLOR5);this.updateBuffer(this.geometry.color6,k.COLOR6);null!=this.geometry.joint&&this.geometry.joint.get_changed()&&(this.property.enableDefine(k.toString(k.BONE)),this.updateBuffer(this.geometry.joint,
k.BONE_INDEX));null!=this.geometry.weight&&this.geometry.weight.get_changed()&&this.updateBuffer(this.geometry.weight,k.BONE_WEIGHT);1<this.indexBuffer.length&&0<this.vertexBuffers.get_length()&&1<this.geometry.position.length&&(this.enabled=!0)}},get_bounds:function(){if(!this._boundsDirty||null==this.geometry)return this._bounds;this._boundsDirty=!1;var a=m.floatToInt(this.geometry.position.length);this._bounds.reset();for(var b=0;b<a;){var c=b++;this._bounds.expand(this.geometry.position.get(c))}return this._bounds}};
var Xb=function(a){this.game=a;this.debugFrame=!1;this.game.addEventListener(B.update._type,g(this,this.gameUpdate));this._pressTime=0;Xb.instance=this;this._touchDebugFrame=!1};Xb.prototype={gameUpdate:function(a){if(this._touchDebugFrame)q.touchDown()&&(.5<q.getTouch().position.x?(this.game.debugFrame++,this.game.step()):(this.game.debugFrame--,this.game.step(),0>this.game.debugFrame&&(this.game.debugFrame=0)));else{a=ha._custom()-this._now;this._now=ha._custom();if(null!=q.getKey(39)){this._pressTime-=
a;if(0<this._pressTime)return;this._pressTime=Xb.pressDelay;this.game.isPaused&&this.game.step();this.debugFrame&&(this.game.debugFrame++,this.game.step())}if(null!=q.getKey(37)){this._pressTime-=a;if(0<this._pressTime)return;this._pressTime=Xb.pressDelay;this.debugFrame&&(this.game.debugFrame--,this.game.step(),0>this.game.debugFrame&&(this.game.debugFrame=0))}q.keyDown(40)&&q.getKey(40).modifier.getArrayElement(2)&&(this.game.isPaused=!this.game.isPaused,D.pause=this.game.isPaused);q.keyDown(38)&&
q.getKey(38).modifier.getArrayElement(2)&&(this.debugFrame=!this.debugFrame,this.game.debugFrame=this.debugFrame?0:-1)}}};var Ef=function(){this._material=new bd;this._material.debug=3;this._material.renderState.drawMode=1;this._material.renderState.depthState.compareFunction=0;this._material.renderState.depthState.writeEnabled=!1;this._material.renderQueue=40100;this._mesh=new Cb;this._mesh.set(D.getGeometry());var a=new ua;a.setProjection(.1,1E3,60);var b=new ua;b.lookAt(new h(0,0,100));a.append(b);
this._material.setMatrix(k.toString(k.VP),a);this._material.setMatrix(k.toString(k.M),new ua)};Ef.prototype={render:function(a){D.update(C.smoothDeltaTime);if(this._mesh.enabled){var b=S.add();b.name="debug";null!=a&&b.setProperty(a.property);a=this._material;var c=this._mesh;b.draw(Xa._pool.get().set(a,c,0,0))}}};var sb=function(){this._shaderDefineMap=new K;this._uniformMap=new K;this._defineDirty=!1};sb.prototype={enableDefine:function(a,b){null==b&&(b=1);if(!m.stringEmpty(a)){var c=this._shaderDefineMap;
if(null!=p[a]?c.existsReserved(a):c.h.hasOwnProperty(a))this._defineDirty=!0;c=this._shaderDefineMap;null!=p[a]?c.setReserved(a,b):c.h[a]=b}},disableDefine:function(a){this._shaderDefineMap.remove(a)&&(this._defineDirty=!0)},clear:function(){for(var a=this._shaderDefineMap.keys();a.hasNext();){var b=a.next();this._shaderDefineMap.remove(b);this._defineDirty=!0}for(a=this._uniformMap.keys();a.hasNext();)b=a.next(),this.removeProperty(b)},copyProperties:function(a){this.clear();for(var b=a._shaderDefineMap.keys();b.hasNext();){var c=
b.next(),d=this._shaderDefineMap;this.enableDefine(c,null!=p[c]?d.getReserved(c):d.h[c])}for(b=a._uniformMap.keys();b.hasNext();){c=b.next();d=this.getUniform(c);var e=a._uniformMap;d.copy(null!=p[c]?e.getReserved(c):e.h[c])}},addProperties:function(a){for(var b=a._uniformMap.keys();b.hasNext();){var c=b.next(),d=this._uniformMap,e=null!=p[c]?d.getReserved(c):d.h[c];d=null==e||e.temp;e=a._uniformMap;var f=null!=p[c]?e.getReserved(c):e.h[c];e=this.getUniform(c);e.copy(f);e.temp=d}},removeProperty:function(a){var b=
this._uniformMap;if(null!=p[a]?b.existsReserved(a):b.h.hasOwnProperty(a))b=this._uniformMap,b=null!=p[a]?b.getReserved(a):b.h[a],b.temp=!1,Sa.pool.set(b),this._uniformMap.remove(a)},setColor:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setFloat4(b)},setFloat3:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setFloat3(b)},setFloat4:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setFloat4(b)},setMatrix:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setMatrix(b)},
setMatrixArray:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setMatrixArray(b)},setMatrixHandler:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setMatrixHandler(b)},setTexture:function(a,b){null==b&&(b=k.toString(k.BASECOLORMAP));null==a?(this.removeProperty(b),this.disableDefine(b)):(this.getUniform(b).setTexture(a),this.enableDefine(b));b+=k.toString(k._REGION);this.disableDefine(b);this.removeProperty(b)},setAtlas:function(a,b){null==b&&(b=k.toString(k.BASECOLORMAP));
null==a?(this.removeProperty(b),this.disableDefine(b),b+=k.toString(k._REGION),this.disableDefine(b),this.removeProperty(b)):(this.getUniform(b).setTexture(a.texture.texture),this.enableDefine(b),b+=k.toString(k._REGION),this.enableDefine(b),this.getUniform(b).setFloat4(a.data.normalzedFrame))},getUniform:function(a){var b=this._uniformMap;if(null!=p[a]?b.existsReserved(a):b.h.hasOwnProperty(a))return b=this._uniformMap,null!=p[a]?b.getReserved(a):b.h[a];b=Sa.pool.get();b.name=a;var c=this._uniformMap;
null!=p[a]?c.setReserved(a,b):c.h[a]=b;return b}};var bd=function(a){sb.call(this);this.debug=2;this.subMesh=-1;this._shaderDefines=T.fromArray([]);this._shaderId=-1;this.shader=new Ha;null==a&&(a="default");this.shader.loadCode(a);this.renderQueue=1E4;this.color=new E;this.setColor(k.toString(k.COLOR),this.color);this.renderState=new qa};bd.prototype=n(sb.prototype,{dispose:function(){this.shader=null},loadShader:function(a){a!=this.shader.name&&(this.shader.loadCode(a),this._shaderId=-1)},addDefineProperty:function(a,
b){null==b&&(b=0);for(a=a._shaderDefineMap.keys();a.hasNext();){var c=a.next(),d=this._shaderDefineMap;if(null!=p[c]?d.existsReserved(c):d.h.hasOwnProperty(c))if(d=this._shaderDefineMap,0<(null!=p[c]?d.getReserved(c):d.h[c]))continue;this.enableDefine(c,b);this._defineDirty=!0}},compile:function(){if(0==this.shader.codeId)return!1;if(this._defineDirty||this.shader.codeId!=this._shaderId){this._shaderId=this.shader.codeId;this._shaderDefines.clear();this._defineDirty=!1;for(var a=this._shaderDefineMap.keys();a.hasNext();){var b=
a.next();this.shader.hasDefine(b)&&this._shaderDefines.push(b);var c=this._shaderDefineMap;0==(null!=p[b]?c.getReserved(b):c.h[b])&&(this._shaderDefineMap.remove(b),this._defineDirty=!0)}}for(a=this._shaderDefines.get_length();0<a--;)this.shader.addDefine(this._shaderDefines.getArrayElement(a));a=this.shader.compile();null!=this._overrideShader&&(this.shader.loadCode(this._overrideShader),this._overrideShader=null);return a},upload:function(){var a=this._uniformMap;for(a=new Hb(a,a.arrayKeys());a.hasNext();){var b=
a.next();this.shader.addUniform(b);b.temp&&this.removeProperty(b.name)}return this.shader.upload(0<this.debug--)}});var Tf=function(){};Tf.getQueue=function(a){a=m.floatToInt(1E-4*a);0>a&&(a=0);4<a&&(a=4);return 1E4*a};var Cd=function(){this.instanceID=Cd._id++};Cd.prototype={init:function(a,b){this.input=a;this.index=b},clear:function(){this.value=null}};var Dd=function(){this.instanceID=Dd._id++};Dd.prototype={init:function(a,b){this.input=a;this.index=b;this.defaultValue=null;this._uploaded=!1},
clear:function(){this._uploaded=!1;this.value=this.defaultValue;return null!=this.value},upload:function(){if(this._uploaded)return!0;this._uploaded=!0;return null!=this.value&&this.value.bind(this.input)?this.value.upload():!1}};var Ha=function(){this.id=this.codeId=0;this._uploadUniforms=new K;this._uniformUploadedBit=new $a(1);this._uniformUploadedBitValue=0;this._uploadAttribute=new K;this._attributeUploadedBit=new $a(1);this._attributeUploadedBitValue=0;this._attributes=T.fromArray([]);this._defineBit=
new $a;this._defineList=T.fromArray([])};Ha.prototype={loadCode:function(a){if(null==a)this.codeId=0;else{var b=Q.get(a);null==b?this.codeId=0:(this.name=a,b!=this.code&&(this.code=b,this.codeId=this.code.id,this._defineValue=-1))}},addDefine:function(a){var b=this.code,c=b._defines;(null!=p[a]?c.existsReserved(a):c.h.hasOwnProperty(a))?(b=b._defines,b=null!=p[a]?b.getReserved(a):b.h[a]):b=-1;-1==b||this._defineBit.getArrayElement(b)||(this._defineBit.setArrayElement(b,!0),this._defineList.push(a))},
compile:function(){if(this._defineBit.value!=this._defineValue){this._defineValue=this._defineBit.value;this._defineList.sort(g(this,this.sortDefine));var a="",b=this._defineList.get_length();Ha._fnv.reset();Ha._fnv.addInt(this.codeId);for(Ha._fnv.addInt(b);0<b--;){var c=this._defineList.getArrayElement(b);Ha._fnv.addString(c);a+="#define ";a+=null==c?"null":""+c;a+="\n"}b=Ha._fnv.getCode();if(this.id!=b||null==this._program){this.id=b;Ha._programMap.h.hasOwnProperty(this.id)?this._program=Ha._programMap.h[this.id]:
(this._program=new Jc(this.code.getVert(a),this.code.getFrag(a)),Ha._programMap.h[this.id]=this._program);if(!this._program.enabled)return!1;for(a=this._uploadUniforms.keys();a.hasNext();)b=a.next(),c=this._uploadUniforms,c=null!=p[b]?c.getReserved(b):c.h[b],Ha.uniformPool.set(c),this._uploadUniforms.remove(b);a=this._program._uniformList;b=a.length;if(31<=b)return!1;for(this._uniformUploadedBit.value=0;0<b--;){this._uniformUploadedBit.setArrayElement(b,!0);var d=a[b];c=Ha.uniformPool.get();c.init(d,
b);var e=this._uploadUniforms,f=d.name;null!=p[f]?e.setReserved(f,c):e.h[f]=c;d=this.code.getUniformInfo(d.name);null!=d&&(c.defaultValue=d.defaultValue,d=d.alias,null!=d&&(e=this._uploadUniforms,null!=p[d]?e.setReserved(d,c):e.h[d]=c))}this._uniformUploadedBitValue=this._uniformUploadedBit.value;for(a=this._uploadAttribute.keys();a.hasNext();)b=a.next(),c=this._uploadAttribute,c=null!=p[b]?c.getReserved(b):c.h[b],Ha.attributePool.set(c),this._uploadAttribute.remove(b);a=this._program._attributeList;
b=a.length;if(31<=b)return!1;for(this._attributeUploadedBit.value=0;0<b--;)this._attributeUploadedBit.setArrayElement(b,!0),d=a[b],c=Ha.attributePool.get(),c.init(d,b),e=this._uploadAttribute,f=d.name,null!=p[f]?e.setReserved(f,c):e.h[f]=c,d=this.code.getAttributeInfo(d.name),null!=d&&(d=d.alias,null!=d&&(e=this._uploadAttribute,null!=p[d]?e.setReserved(d,c):e.h[d]=c));this._attributeUploadedBitValue=this._attributeUploadedBit.value}}if(null==this._program)return!1;this._defineBit.value=0;this._defineList.clear();
this._uniformUploadedBit.value=this._uniformUploadedBitValue;this._attributeUploadedBit.value=this._attributeUploadedBitValue;a=this._uploadUniforms;for(a=new Hb(a,a.arrayKeys());a.hasNext();)b=a.next(),b.clear()&&this._uniformUploadedBit.setArrayElement(b.index,!1);this._attributes.clear();a=this._uploadAttribute;for(a=new Hb(a,a.arrayKeys());a.hasNext();)a.next().clear();return!0},addUniform:function(a){var b=a.name,c=this._uploadUniforms;if(null!=p[b]?c.existsReserved(b):c.h.hasOwnProperty(b))c=
this._uploadUniforms,b=null!=p[b]?c.getReserved(b):c.h[b],b.value=a,this._uniformUploadedBit.setArrayElement(b.index,!1)},addAttribute:function(a){for(var b=!1,c=a.layouts,d=0,e=c.length;d<e;){var f=d++;f=c[f];var g=f.name,h=this._uploadAttribute;if(null!=p[g]?h.existsReserved(g):h.h.hasOwnProperty(g))b=this._uploadAttribute,b=null!=p[g]?b.getReserved(g):b.h[g],f.location=b.input.location,b.value=a,this._attributeUploadedBit.setArrayElement(b.index,!1),b=!0}b&&this._attributes.push(a)},upload:function(a){if(0==
this.id||oa.gt(this._uniformUploadedBit.value,0)||oa.gt(this._attributeUploadedBit.value,0))return!1;this._program.bind();a=this._uploadUniforms;for(a=new Hb(a,a.arrayKeys());a.hasNext();)if(!a.next().upload())return!1;for(a=this._attributes.get_length();0<a--;)if(!this._attributes.getArrayElement(a).bind())return!1;return!0},hasDefine:function(a){var b=this.code,c=b._defines;(null!=p[a]?c.existsReserved(a):c.h.hasOwnProperty(a))?(b=b._defines,a=null!=p[a]?b.getReserved(a):b.h[a]):a=-1;return 0<=
a},sortDefine:function(a,b){return a>b?1:-1}};var Uf=function(){this._frag=this._vert="precision highp float;\nprecision mediump int;\nprecision lowp sampler2D;\nprecision lowp samplerCube;\n"};Uf.prototype={getVertPrecision:function(){return this._vert},getFragPrecision:function(){return this._frag}};var Q=function(a,b,c){var d=Q._map;if(null!=p[a]?d.existsReserved(a):d.h.hasOwnProperty(a))throw new u(""+a+" exist");null==Q._keymap&&(Q._keymap=new K,d=Q._keymap,null!=p.highp?d.setReserved("highp",
!0):d.h.highp=!0,d=Q._keymap,null!=p.mediump?d.setReserved("mediump",!0):d.h.mediump=!0,d=Q._keymap,null!=p.lowp?d.setReserved("lowp",!0):d.h.lowp=!0);d=Q._map;null!=p[a]?d.setReserved(a,this):d.h[a]=this;this._attributes=new K;this._uniforms=new K;this._defines=new K;this._mapping=[];Q._extension.clear();Q._ifdef.clear();gb.instance.reset();this._vert=this.parse(b);this._vertExt=Q._extension.join("\n");Q._extension.clear();this._frag=this.parse(c);this.pauseMapping();this.id=gb.instance.getCode();
this._fragExt=Q._extension.join("\n");if(null==Q._common){Q._common=l.getEmbed("shader_common");a=new Zd(Q._common);b=a._length;for(c="";0<b--;)c+=da.string(a.readLine()),c+="\n";Q._common=c}a=0;for(b=this._defines.keys();b.hasNext();){c=b.next();d=this._defines;var e=a++;null!=p[c]?d.setReserved(c,e):d.h[c]=e}};Q.get=function(a){var b=Q._map;return null!=p[a]?b.getReserved(a):b.h[a]};Q.init=function(){new Q("default",l.getEmbed("shader_default_vert"),l.getEmbed("shader_default_frag"));new Q("ui",
l.getEmbed("shader_ui_vert"),l.getEmbed("shader_ui_frag"));new Q("sky",l.getEmbed("shader_skymap_vert"),l.getEmbed("shader_skymap_frag"));new Q("pbr",l.getEmbed("shader_pbr_vert"),l.getEmbed("shader_pbr_frag"));new Q("particle",l.getEmbed("shader_particle_vert"),l.getEmbed("shader_particle_frag"))};Q.prototype={getVert:function(a){return this._vertExt+"\n"+Q._precision.getVertPrecision()+a+Q._common+this._vert},getFrag:function(a){return this._fragExt+"\n"+Q._precision.getFragPrecision()+a+Q._common+
this._frag},getUniformInfo:function(a){var b=this._uniforms;return null!=p[a]?b.getReserved(a):b.h[a]},getAttributeInfo:function(a){var b=this._attributes;return null!=p[a]?b.getReserved(a):b.h[a]},parse:function(a){var b="";a=new Zd(a);for(var c=a._length;0<c--;){var d=a.readLine();""!=d&&(-1!=d.indexOf("//mapping ")?this._mapping.push(d):ea.startsWith(m.trim(d),"//")||""==m.trim(d)||(-1!=d.toLowerCase().indexOf("#extension ")?(Q._extension.push(d),gb.instance.addString(d)):(d=this.readLine(d),gb.instance.addString(d),
b+=null==d?"null":""+d,b+="\n")))}return b},readLine:function(a){if(-1!=a.indexOf("attribute")){var b=a.split(" ");var c=b.length;a=0;for(var d=c;a<d;)if(c=a++,"attribute"==b[c]){a=new Vf;d=2;var e=b[c+1],f=b[c+2],g=Q._keymap;if(null!=p[e]?g.existsReserved(e):g.h.hasOwnProperty(e))d=3,f=b[c+d];f=ea.replace(f,";","");-1!=f.indexOf(":")&&(e=f.split(":"),2==e.length&&(f=m.trim(e[0]),e=m.trim(e[1]),a.alias=e));b[c+d]=f+";";a.name=f;c=this._attributes;d=a.name;null!=p[d]?c.setReserved(d,a):c.h[d]=a;null!=
a.alias&&(c=this._attributes,d=a.alias,null!=p[d]?c.setReserved(d,a):c.h[d]=a);c=Q._ifdef.get_length();if(0<c)for(;0<c--;)a.addDefine(Q._ifdef.getArrayElement(c));break}return b.join(" ")}if(-1!=a.indexOf("uniform")){b=a.split(" ");f=b.length;a=0;for(c=f;a<c;)if(f=a++,"uniform"==b[f]){g=2;a=b[f+1];e=b[f+g];c=Q._keymap;if(null!=p[a]?c.existsReserved(a):c.h.hasOwnProperty(a))a=e,g=3,e=b[f+g];e=ea.replace(e,";","");c=new Wf;d=null;-1!=e.indexOf("=")&&(d=e.split("="),e=m.trim(d[0]),d=m.trim(d[1]));if(-1!=
e.indexOf(":")){var h=e.split(":");2==h.length&&(e=m.trim(h[0]),h=m.trim(h[1]),c.alias=h)}b[f+g]=e+";";f=e.indexOf("[");-1!=f&&(e=e.substring(0,f));c.name=e;f=this._uniforms;e=c.name;null!=p[e]?f.setReserved(e,c):f.h[e]=c;null!=c.alias&&(f=this._uniforms,e=c.alias,null!=p[e]?f.setReserved(e,c):f.h[e]=c);f=Q._ifdef.get_length();if(0<f)for(;0<f--;)c.addDefine(Q._ifdef.getArrayElement(f));c.addDefaultValue(a,d);break}return b.join(" ")}if(-1!=a.indexOf("#ifdef"))for(b=a.split(" "),c=0,d=b.length;c<d;){if(f=
c++,"#ifdef"==b[f]){b=m.trim(b[f+1]);Q._ifdef.push(b);c=this._defines;null!=p[b]?c.setReserved(b,0):c.h[b]=0;break}}else if(-1!=a.indexOf("#endif"))for(b=a.split(" "),c=0,d=b.length;c<d;)if(f=c++,"#endif"==b[f]){Q._ifdef.pop();break}return a},pauseMapping:function(){var a=this._mapping.length;if(!(1>a)){for(;0<a--;){var b=this._mapping[a];b=b.split("//mapping ").pop();b=m.stringToArray(b);for(var c=b.length;0<c--;){var d=b[c].split(":");if(!(2>d.length)){var e=m.trim(d[0]);d=d[1];var f=null;if(-1!=
d.indexOf("=")){var g=d.split("=");2==g.length&&(d=g[0],f=g[1])}g=this._attributes;if(null!=p[e]?g.existsReserved(e):g.h.hasOwnProperty(e)){g=this._attributes;g=null!=p[e]?g.getReserved(e):g.h[e];var h=this._attributes;(null!=p[d]?h.existsReserved(d):h.h.hasOwnProperty(d))||(h=this._attributes,null!=p[d]?h.setReserved(d,g):h.h[d]=g)}g=this._uniforms;if(null!=p[e]?g.existsReserved(e):g.h.hasOwnProperty(e))g=this._uniforms,e=null!=p[e]?g.getReserved(e):g.h[e],g=this._uniforms,(null!=p[d]?g.existsReserved(d):
g.h.hasOwnProperty(d))||(g=this._uniforms,null!=p[d]?g.setReserved(d,e):g.h[d]=e),null==e.defaultValue&&e.addDefaultValue("",f)}}}this._mapping=null}}};var Vf=function(){};Vf.prototype={addDefine:function(a){m.stringEmpty(a)||(null==this.defines&&(this.defines=[]),this.defines.push(a))}};var Wf=function(){};Wf.prototype={addDefine:function(a){m.stringEmpty(a)||(null==this.defines&&(this.defines=[]),this.defines.push(a))},addDefaultValue:function(a,b){m.stringEmpty(b)||(b=ea.replace(b,")",""),b=b.split("("),
2==b.length&&(a=m.trim(b[0]),b=m.trim(b[1]),this.defaultValue=new Sa,this.defaultValue.name=this.name,"float"==a?this.defaultValue.setFloat(m.stringToFloat(b)):"int"==a?this.defaultValue.setInt(m.stringToInt(b)):"bool"==a?this.defaultValue.setInt(0==m.stringToInt(b)?0:1):"vec2"==a||"float2"==a||"fixed2"==a||"half2"==a?this.defaultValue.setFloat2((new G).parse(b)):"vec3"==a||"float3"==a||"fixed3"==a||"half3"==a?this.defaultValue.setFloat3((new h).parse(b)):"vec4"==a||"float4"==a||"fixed4"==a||"half4"==
a||"color"==a?this.defaultValue.setFloat4((new ta).parse(b)):this.defaultValue=null))}};var Sa=function(){this.instanceID=Sa._id++;this._bindType=this._dataType=0;this.temp=!1};Sa.getData=function(a){a=m.intToNextPow2(a);var b=m.pow2Count(a),c=Sa._tempList[b];null==c&&(c=new Float32Array(a),Sa._tempList[b]=c);return c};Sa.prototype={clear:function(){this._bindType=this._dataType=0;this._matrix4HandlerValue=this._matrix4ArrayValue=this._texture=this._float4ArrayValue=this._matrix4Value=this._float4Value=
this._float3Value=this._float2Value=this._floatArrayValue=null},copy:function(a){this.clear();switch(a._bindType){case 1:this.setInt(a._intValue);break;case 2:this.setFloat(a._floatValue);break;case 3:this.setFloatArray(a._floatArrayValue);break;case 4:this.setFloat2(a._float2Value);break;case 5:this.setFloat3(a._float3Value);break;case 6:this.setFloat4(a._float4Value);break;case 7:this.setMatrix(a._matrix4Value);break;case 8:this.setMatrixArray(a._matrix4ArrayValue);break;case 9:this.setTexture(a._texture);
break;case 11:this.setFloat4Array(a._float4ArrayValue);break;case 12:this.setMatrixHandler(a._matrix4HandlerValue)}},setInt:function(a){this._intValue=a;this._handler=g(this,this.bindInt);this._dataType=5124;this._bindType=1;return this},setFloat:function(a){this._floatValue=a;this._handler=g(this,this.bindFloat);this._dataType=5126;this._bindType=2;return this},setFloatArray:function(a){this._floatArrayValue=a;this._handler=g(this,this.bindFloatArray);this._dataType=5126;this._bindType=3;return this},
setFloat2:function(a){this._float2Value=a;this._handler=g(this,this.bindFloat2);this._dataType=35664;this._bindType=4;return this},setFloat3:function(a){this._float3Value=a;this._handler=g(this,this.bindFloat3);this._dataType=35665;this._bindType=5;return this},setFloat4:function(a){this._float4Value=a;this._handler=g(this,this.bindFloat4);this._dataType=35666;this._bindType=6;return this},setFloat4Array:function(a){this._float4ArrayValue=a;this._handler=g(this,this.bindFloat4Array);this._dataType=
35666;this._bindType=11;return this},setMatrix:function(a){this._matrix4Value=a;this._handler=g(this,this.bindMatrix4);this._dataType=35676;this._bindType=7;return this},setMatrixArray:function(a){this._matrix4ArrayValue=a;this._handler=g(this,this.bindMatrix4Array);this._dataType=35676;this._bindType=8;return this},setTexture:function(a){this._texture=a;this._handler=g(this,this.bindTexture);3553==a.params.type?(this._dataType=35678,this._bindType=9):34067==a.params.type&&(this._dataType=35680,this._bindType=
9);return this},setMatrixHandler:function(a){this._matrix4HandlerValue=a;this._handler=g(this,this.bindMatrix4Handler);this._dataType=35676;this._bindType=12;return this},bind:function(a){if(null==this._handler||a.type!=this._dataType)return!1;this._input=a;this._size=this._input.size;return!0},upload:function(){this._success=!0;null==this._gl&&(this._gl=eb.current.gl);this._handler();return this._success},bindInt:function(){this._gl.gl.uniform1i(this._input.location,this._intValue)},bindFloat:function(){this._gl.gl.uniform1f(this._input.location,
this._floatValue)},bindFloat2:function(){this._gl.gl.uniform2f(this._input.location,this._float2Value.x,this._float2Value.y)},bindFloat3:function(){this._gl.gl.uniform3f(this._input.location,this._float3Value.x,this._float3Value.y,this._float3Value.z)},bindFloat4:function(){this._gl.gl.uniform4f(this._input.location,this._float4Value.x,this._float4Value.y,this._float4Value.z,this._float4Value.w)},bindFloatArray:function(){for(var a=this._floatArrayValue.length,b=Sa.getData(a);0<a--;)b[a]=this._floatArrayValue[a];
this._gl.gl.uniform1fv(this._input.location,b)},bindFloat4Array:function(){for(var a=this._float4ArrayValue.length,b=Sa.getData(4*a);0<a--;){var c=4*a,d=this._float4ArrayValue[a];null!=d?(b[c]=d.x,b[c+1]=d.y,b[c+2]=d.z,b[c+3]=d.w):(b[c]=0,b[c+1]=0,b[c+2]=0,b[c+3]=0)}this._gl.gl.uniform4fv(this._input.location,b)},bindMatrix4:function(){var a=this._gl,b=this._input.location,c=this._matrix4Value.get_data();a.gl.uniformMatrix4fv(b,!1,c)},bindMatrix4Handler:function(){var a=this._matrix4HandlerValue(),
b=this._gl,c=this._input.location;a=a.get_data();b.gl.uniformMatrix4fv(c,!1,a)},bindMatrix4Array:function(){for(var a=this._matrix4ArrayValue.length,b=Sa.getData(16*a);0<a--;){var c=this._matrix4ArrayValue[a];null!=c&&c.fillFloat32Array(b,16*a)}this._gl.gl.uniformMatrix4fv(this._input.location,!1,b)},bindTexture:function(){(this._success=this._texture.bind(this._input.id))&&this._gl.gl.uniform1i(this._input.location,this._input.id)}};var jb=function(){};jb.prototype={execute:function(a){this.context=
a;this.onExecute()},onExecute:function(){}};var sa=function(){};sa.prototype=n(jb.prototype,{set:function(a,b,c,d,e){null==e&&(e=!0);this.source=a;this.dest=b;this.material=c;this.rect=d;this.clear=e;return this},onExecute:function(){if(this.source!=this.dest){if(null==sa._gbuffer){sa._material=new bd;sa._material.renderState.depthState.writeEnabled=!1;sa._material.renderState.depthState.compareFunction=0;sa._mat=new ua;sa._material.setMatrix(k.toString(k.M),sa._mat);sa._material.setMatrix(k.toString(k.V),
sa._mat);sa._material.setMatrix(k.toString(k.P),sa._mat);sa._material.setMatrix(k.toString(k.VP),sa._mat);sa._gbuffer=new Cb;var a=new bb;a.position.push(h.instance.set(-1,-1,0));a.position.push(h.instance.set(1,-1,0));a.position.push(h.instance.set(1,1,0));a.position.push(h.instance.set(-1,1,0));a.uv=new cb;var b=G.instance,c=0,d=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.uv.push(b);b=G.instance;c=1;d=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.uv.push(b);b=G.instance;d=c=1;null==d&&(d=0);null==
c&&(c=0);b.x=c;b.y=d;a.uv.push(b);b=G.instance;c=0;d=1;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.uv.push(b);a.group.indices.push3(0,1,2);a.group.indices.push3(0,2,3);sa._gbuffer.set(a)}null==this.material?this.material=sa._material:this.material.addProperties(sa._material);this.material.setTexture(this.source);a=this.context.commandBuffer;a.pushRenderTarget(this.dest);this.clear&&a.clearRenderTarget(sa._clearColor,1,0);null!=this.rect&&a.setViewport(this.rect.x,this.rect.y,this.rect.z,this.rect.w);
b=sa._material;c=sa._gbuffer;a.draw(Xa._pool.get().set(b,c,0,0));a.popRenderTarget();this.context.actionIndex++}}});var Xf=function(){};Xf.prototype=n(jb.prototype,{set:function(a){this.value=a;return this},onExecute:function(){jb.prototype.onExecute.call(this);this.value()}});var Yf=function(){};Yf.prototype=n(jb.prototype,{set:function(a,b,c){null==c&&(c=0);null==b&&(b=1);this.clearColor=a;this.clearDepth=b;this.clearStencil=c;return this},onExecute:function(){this.context.glContext.clear(this.clearColor,
this.clearDepth,this.clearStencil);this.context.actionIndex++}});var Zf=function(){};Zf.prototype=n(jb.prototype,{set:function(a,b){this.global=b;this.value=a;return this},onExecute:function(){this.global?null==this.context.globalProperty?this.value.clear():this.value.copyProperties(this.context.globalProperty):null==this.context.property?this.value.clear():this.value.copyProperties(this.context.property)}});var $f=function(){};$f.prototype=n(jb.prototype,{set:function(a){this.value=a;return this},
onExecute:function(){var a=this.value.material;if(0!=a.shader.id){null!=this.context.globalProperty&&a.addProperties(this.context.globalProperty);null!=this.context.property&&a.addProperties(this.context.property);for(var b=this.value.mesh.vertexBuffers.get_length();0<b--;){var c=this.value.mesh.vertexBuffers.getArrayElement(b);a.shader.addAttribute(c)}null!=this.context.glContext.currentRenderTarget&&a.setTexture(this.context.glContext.currentRenderTarget,k.toString(k.RENDER_BUFFER));a.upload()&&
(this.context.glContext.setRenderState(a.renderState),this.value.mesh.indexBuffer.draw(a.renderState.drawMode),this.context.actionIndex++,a.removeProperty(k.toString(k.RENDER_BUFFER)))}}});var ag=function(){};ag.prototype=n(jb.prototype,{onExecute:function(){this.context.glContext.popRenderTarget()}});var bg=function(){};bg.prototype=n(jb.prototype,{set:function(a){this.target=a;return this},onExecute:function(){this.context.glContext.pushRenderTarget(this.target)}});var cg=function(){};cg.prototype=
n(jb.prototype,{set:function(a,b,c){this.global=b;this.value=a;this.append=c;return this},onExecute:function(){this.global?null!=this.context.globalProperty&&this.append?this.context.globalProperty.addProperties(this.value):this.context.globalProperty=this.value:null!=this.context.property&&this.append?this.context.property.addProperties(this.value):this.context.property=this.value}});var dg=function(){};dg.prototype=n(jb.prototype,{set:function(a,b,c,d){null==d&&(d=640);null==c&&(c=1138);null==b&&
(b=0);null==a&&(a=0);this.x=a;this.y=b;this.width=c;this.height=d;return this},onExecute:function(){this.context.glContext.setViewport(this.x,this.y,this.width,this.height)}});var S=function(){this._commands=T.fromArray([]);this._key=!1};S.add=function(a){null==a&&(a=!0);var b=S._pool.get();a?(b._added=!0,S._buffers.push(b)):b._added=!1;return b};S.flush=function(a){a.actionIndex=1;for(var b=0;!a.isPause();){var c=S._buffers.getArrayElement(b++);if(null==c)break;c.execute(a)}S._buffers.clear();0<=
a.stopActionIndex&&(a.stopActionIndex=a.actionIndex-1);a.glContext.end()};S.prototype={execute:function(a){a.property=null;a.commandBuffer=this;for(var b=0;!a.isPause();){var c=this._commands.getArrayElement(b++);if(null==c)break;c.execute(a)}this._commands.clear();this._key=!1;a.commandBuffer=null},pushRenderTarget:function(a){this._commands.push(S._pushRenderTarget.get().set(a))},popRenderTarget:function(){this._commands.push(S._popRenderTarget.get())},clearRenderTarget:function(a,b,c){null==c&&
(c=0);null==b&&(b=1);this._commands.push(S._clearRenderTarget.get().set(a,b,c))},setViewport:function(a,b,c,d){null==d&&(d=640);null==c&&(c=1138);null==b&&(b=0);null==a&&(a=0);this._commands.push(S._setViewport.get().set(a,b,c,d))},blit:function(a,b,c,d,e){null==e&&(e=!0);a!=b&&(this._commands.push(S._blit.get().set(a,b,c,d,e)),this._key=!0)},callback:function(a){this._commands.push(S._callback.get().set(a))},draw:function(a){a.enabled&&(this._commands.push(S._draw.get().set(a)),this._key=!0)},setProperty:function(a){this._commands.push(S._setProperty.get().set(a,
!1,!1))},setGlobalProperty:function(a){this._commands.push(S._setProperty.get().set(a,!0,!1))},addGlobalProperty:function(a){this._commands.push(S._setProperty.get().set(a,!0,!0))},copyGlobalProperty:function(a){this._commands.push(S._copyProperty.get().set(a,!0))}};var Ff=function(){this.stopActionIndex=-1;this.actionIndex=0};Ff.prototype={clear:function(){this.property=this.globalProperty=null},isPause:function(){return 0<=this.stopActionIndex&&this.actionIndex>this.stopActionIndex?!0:!1}};var Xa=
function(){};Xa.prototype={set:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);this.material=a;null!=Xa.globalDefine&&a.addDefineProperty(Xa.globalDefine,0);this.mesh=b;this.material.addDefineProperty(b.property,2);this.distance=c;this.enabled=a.compile();this.order=d;return this}};var eg=function(){this.background=T.fromArray([]);this.geometry=T.fromArray([]);this.transparent=T.fromArray([]);this.ui=T.fromArray([]);this.overlay=T.fromArray([])};eg.prototype={clear:function(){this.background.clear();
this.geometry.clear();this.transparent.clear();this.ui.clear();this.overlay.clear();this.count=0},sort:function(){this.geometry.sort(g(this,this.sortByNear2Far));this.transparent.sort(g(this,this.sortByNear2Far));this.ui.sort(g(this,this.sortByOrder));this.overlay.sort(g(this,this.sortByNear2Far))},add:function(a){if(a.enabled){var b=Tf.getQueue(a.material.renderQueue);1E4==b?this.geometry.push(a):3E4==b?this.ui.push(a):2E4==b?this.transparent.push(a):0==b?this.background.push(a):4E4==b&&this.overlay.push(a);
this.count++}},sortByNear2Far:function(a,b){var c=a.material.renderQueue,d=b.material.renderQueue;if(c!=d)return c>d?1:-1;c=a.material.shader.id;d=b.material.shader.id;return c!=d?c>d?1:-1:a.distance>b.distance?1:-1},sortByOrder:function(a,b){var c=a.material.renderQueue,d=b.material.renderQueue;if(c!=d)return c>d?1:-1;c=a.order;d=b.order;if(c!=d)return c>d?1:-1;c=a.material.shader.id;d=b.material.shader.id;return c!=d?c>d?1:-1:a.distance>b.distance?-1:1}};var Mf=function(a){this._camera=a;this._cullmask=
this._camera.cullingMask;this._copyProperty=new sb;this._defineProperty=new sb;this._uniformProperty=new sb;this._renderObjectCollector=new eg;this.background=this._renderObjectCollector.background;this.geometry=this._renderObjectCollector.geometry;this.transparent=this._renderObjectCollector.transparent;this.ui=this._renderObjectCollector.ui;this.overlay=this._renderObjectCollector.overlay};Mf.prototype={collectRenderer:function(){var a=this._camera.actor.world;if(null!=a){this._renderObjectCollector.clear();
this._defineProperty.disableDefine(k.toString(k.LIGHT));if(0<a.collectorLight.count){var b=a.collectorLight.get(0);this._defineProperty.enableDefine(k.toString(k.LIGHT));this._uniformProperty.addProperties(b.property)}a=a.collectorRenderer;a.setCullCamera(this._camera);b=a.count;Xa.globalDefine=this._defineProperty;for(var c=0;c<b;){var d=c++;d=a._list[d];if(d.visible){var e=d.actor;this._cullmask.exist(e.layer)||e._setVisible(!1);d.cull(a)?e._setVisible(!1):(e._setVisible(!0),d.collectRenderObject(this._renderObjectCollector))}}this._renderObjectCollector.sort()}},
render:function(){var a=S.add();a.callback(g(this,this.onPreRender));a.copyGlobalProperty(this._copyProperty);this._uniformProperty.addProperties(this._camera.property);a.setGlobalProperty(this._uniformProperty);a.addGlobalProperty(this._copyProperty);null!=this._camera.renderTarget&&a.pushRenderTarget(this._camera.renderTarget);a=this.background.get_length();if(0<a)for(var b=0,c=a;b<c;)a=b++,a=this.background.getArrayElement(a),S.add().draw(a);a=this.geometry.get_length();if(0<a)for(b=0,c=a;b<c;)a=
b++,a=this.geometry.getArrayElement(a),S.add().draw(a);a=this.transparent.get_length();if(0<a)for(b=0,c=a;b<c;)a=b++,a=this.transparent.getArrayElement(a),S.add().draw(a);a=this.ui.get_length();if(0<a)for(b=0,c=a;b<c;)a=b++,a=this.ui.getArrayElement(a),S.add().draw(a);a=this.overlay.get_length();if(0<a)for(b=0,c=a;b<c;)a=b++,a=this.overlay.getArrayElement(a),S.add().draw(a);a=S.add();null!=this._camera.renderTarget&&a.popRenderTarget();a.setGlobalProperty(this._copyProperty);a.callback(g(this,this.onPostRender))},
onPreRender:function(){this._camera.actor.dispatchEvent(t.onPreRender)},onPostRender:function(){this._camera.actor.dispatchEvent(t.onPostRender)}};var Af=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);ta.call(this,a,b,c,d)};Af.prototype=n(ta.prototype,{setBorder:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d;return this},hasBorder:function(){return 0<this.x||0<this.y||0<this.z?!0:0<this.w}});var Pf=function(){this.min=
new h;this.max=new h;this._centerHelp=new h;this._dirty=null;this.points=[];this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h)};Pf.prototype={dispose:function(){this.points=this._centerHelp=this.max=this.min=null},update:function(){this._dirty=null;this.enabled=!0},reset:function(){this.min.set(1.79769313486231E308,1.79769313486231E308,1.79769313486231E308);
this.max.set(-1.79769313486231E308,-1.79769313486231E308,-1.79769313486231E308);this.enabled=!1;return this},copy:function(a){this.max.copy(a.max);this.min.copy(a.min);this.update();return this},expand:function(a){this.min.min(a);this.max.max(a);this.update();return this},multiplyMatrix44:function(a){var b=h.get_one(),c=h.get_one();b.copy(this.min);c.copy(this.max);this.reset();this.expand(a.transformPoint(this.points[0].copy(b)));this.expand(a.transformPoint(this.points[1].set(b.x,b.y,c.z)));this.expand(a.transformPoint(this.points[2].set(c.x,
b.y,c.z)));this.expand(a.transformPoint(this.points[3].set(c.x,b.y,b.z)));this.expand(a.transformPoint(this.points[4].set(b.x,c.y,b.z)));this.expand(a.transformPoint(this.points[5].set(b.x,c.y,c.z)));this.expand(a.transformPoint(this.points[6].copy(c)));this.expand(a.transformPoint(this.points[7].set(c.x,c.y,b.z)));return this},getCenter:function(){null==this._dirty&&(this._dirty=this._centerHelp,this._dirty.copy(this.min).add(this.max).scale(.5));return this._dirty}};var Lf=function(){this.planes=
[];this.near=new Kc;this.far=new Kc;this.left=new Kc;this.right=new Kc;this.top=new Kc;this.bottom=new Kc;this.planes.push(this.near);this.planes.push(this.far);this.planes.push(this.left);this.planes.push(this.right);this.planes.push(this.top);this.planes.push(this.bottom)};Lf.prototype={containsPoint:function(a,b){null==b&&(b=0);for(var c=6;0<c--;)if(this.planes[c].distanceToPoint(a)<-b)return!1;return!0},intersectsBox:function(a){if(null==a)return!1;for(var b=h.get_one(),c=h.get_one(),d=6;0<d--;){var e=
this.planes[d],f=e.normal.x,g=e.normal.y,k=e.normal.z;b.set(0<f?a.min.x:a.max.x,0<g?a.min.y:a.max.y,0<k?a.min.z:a.max.z);c.set(0<f?a.max.x:a.min.x,0<g?a.max.y:a.min.y,0<k?a.max.z:a.min.z);if(0>e.distanceToPoint(b)&&0>e.distanceToPoint(c))return!1}return!0},multiplyMatrix44:function(a){if(null==a)return this;var b=a.m0,c=a.m1,d=a.m2,e=a.m3,f=a.m4,g=a.m5,h=a.m6,k=a.m7,l=a.m8,m=a.m9,n=a.m10,p=a.m11,q=a.m12,t=a.m13,u=a.m14;a=a.m15;this.planes[0].set(e+d,k+h,p+n,a+u);this.planes[1].set(e-d,k-h,p-n,a-u);
this.planes[2].set(e+b,k+f,p+l,a+q);this.planes[3].set(e-b,k-f,p-l,a-q);this.planes[4].set(e-c,k-g,p-m,a-t);this.planes[5].set(e+c,k+g,p+m,a+t);return this}};var Kc=function(){this.normal=new h(0,0,1);this.distance=0};Kc.prototype={distanceToPoint:function(a){return this.normal.dot(a)+this.distance},set:function(a,b,c,d){this.normal.set(a,b,c);this.distance=d;this.normalize()},normalize:function(){var a=this.normal;a=1/Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);this.normal.scale(a);this.distance*=a}};var tb=
function(){this.start=new h;this.direction=new h};tb.get_temp=function(){return tb._pool.get()};tb.prototype={copy:function(a){if(a==this)return this;this.start.copy(a.start);this.direction.copy(a.direction);return this},set:function(a,b){this.start.copy(a);this.direction.sub(b,a);this.direction.normalize();return this},at:function(a){var b=tb._v30;b.copy(this.direction);b.scale(a);b.add(this.start);return b},intersectSphere:function(a){var b=tb._v30;b.sub(a.center,this.start);var c=this.direction.dot(b);
b=b.dot(b)-c*c;a=a.radius*a.radius;if(b>a)return null;b=Math.sqrt(a-b);a=c-b;c+=b;return 0>a&&0>c?null:0>a?this.at(c):this.at(a)},intersectBox:function(a){var b=0!=this.direction.x?1/this.direction.x:0;var c=0!=this.direction.y?1/this.direction.y:0;var d=0!=this.direction.z?1/this.direction.z:0,e=this.start;if(0<=b){var f=(a.min.x-e.x)*b;b*=a.max.x-e.x}else f=(a.max.x-e.x)*b,b*=a.min.x-e.x;if(0<=c){var g=(a.min.y-e.y)*c;c*=a.max.y-e.y}else g=(a.max.y-e.y)*c,c*=a.min.y-e.y;if(f>c||g>b)return null;
if(g>f||f!=f)f=g;if(c<b||b!=b)b=c;0<=d?(g=(a.min.z-e.z)*d,a=(a.max.z-e.z)*d):(g=(a.max.z-e.z)*d,a=(a.min.z-e.z)*d);if(f>a||g>b)return null;if(g>f||f!=f)f=g;if(a<b||b!=b)b=a;return 0>b?null:this.at(0<=f?f:b)}};var Qf=function(){this.radius=0;this.center=new h(0,0,0);this.enabled=!0};Qf.prototype={dispose:function(){this.center=null},set:function(a,b){this.center.copy(a);this.radius=b;return this},copy:function(a){return a==this?this:this.set(a.center,a.radius)}};var fg=function(){this.enabled=!0;this.writeMask=
4;this.colorBlendOperation=this.alphaBlendOperation=32774;this.sourceColorBlendMode=770;this.destinationColorBlendMode=771;this.destinationAlphaBlendMode=this.sourceAlphaBlendMode=1};fg.prototype={};var gg=function(){this.compareFunction=513;this.writeEnabled=!0};gg.prototype={};var ub=function(){this.id=ub._id++;this.enabled=!1;this.type=5123};ub.prototype={setLayouts:function(a){null==this.layouts?this.layouts=[]:this.layouts.splice(0,this.layouts.length);for(var b=0,c=a.length;b<c;){var d=b++;
this.layouts.push(a[d])}},upload:function(a,b){null==b&&(b=0);this.enabled=!1;if(null!=a&&1<a.length){this.enabled=!0;this._data=a;if(0==b||b>=this._data.length)b=this._data.length;this._dataLength=this.length=b}},draw:function(a,b){null==b&&(b=-1);this._time=ha._custom();var c=eb.current.gl;if(null!=this._data){null==this._buffer&&(this._buffer=c.gl.createBuffer());c.gl.bindBuffer(34963,this._buffer);var d=this.getData();c.gl.bufferData(34963,d,35044);this._data=null}else null!=this._buffer&&this!=
ub.current&&(ub.current=this,c.gl.bindBuffer(34963,this._buffer));0<=b?(b=this.layouts[b],c.gl.drawElements(a,b.length,5123,b.offset)):c.gl.drawElements(a,this.length,5123,0)},unload:function(){null!=this._buffer&&(eb.current.gl.gl.deleteBuffer(this._buffer),this._buffer=null);this._data=this.layouts=null},getData:function(){var a=this._dataLength,b=m.intToNextPow2(a),c=m.pow2Count(b),d=ub._tempList[c];null==d&&(d=new Uint16Array(b),ub._tempList[c]=d);for(;0<a--;)d[a]=this._data[a];return d}};var Sf=
function(){};Sf.prototype={};var eb=function(a){eb.current=this;this.gl=a;this._state=0;this._renderTargetList=T.fromArray([]);this.screenParams=new ta;this._defaultState=new qa};eb.prototype={begin:function(a,b){this._width=a;this._height=b;this.screenParams.x=this._width;this.screenParams.y=this._height;this._state=0;eb.current=this;this._renderTargetList.clear();this.end()},end:function(){this.currentRenderTarget=null;ub.current=null;Jc.current=null;this.gl.gl.bindFramebuffer(36160,null);this.gl.gl.bindRenderbuffer(36161,
null);this.gl.gl.bindTexture(3553,null);this.gl.gl.bindBuffer(34963,null);this.gl.gl.bindBuffer(34962,null);this.setRenderState(this._defaultState)},setViewport:function(a,b,c,d){this.gl.gl.viewport(a,b,c,d)},setRenderState:function(a){this._state!=a.get_id()&&(this._state=a.get_id(),0==a.cullMode?this.gl.gl.disable(2884):(this.gl.gl.enable(2884),this.gl.gl.cullFace(a.cullMode)),0==a.depthState.compareFunction?this.gl.gl.disable(2929):(this.gl.gl.enable(2929),this.gl.gl.depthFunc(a.depthState.compareFunction)),
this.gl.gl.depthMask(a.depthState.writeEnabled),a.blendState.enabled?(this.gl.gl.enable(3042),this.gl.gl.blendEquationSeparate(a.blendState.colorBlendOperation,a.blendState.alphaBlendOperation),this.gl.gl.blendFuncSeparate(a.blendState.sourceColorBlendMode,a.blendState.destinationColorBlendMode,a.blendState.sourceAlphaBlendMode,a.blendState.destinationAlphaBlendMode)):this.gl.gl.disable(3042),0==a.stencilState.compareFunction?this.gl.gl.disable(2960):(this.gl.gl.enable(2960),this.gl.gl.stencilFunc(a.stencilState.compareFunction,
a.stencilReference,a.stencilState.readMask),this.gl.gl.stencilOp(a.stencilState.failOperation,a.stencilState.zFailOperation,a.stencilState.passOperation)))},clear:function(a,b,c){null==c&&(c=0);null==b&&(b=1);var d=0;null!=a&&(d|=16384,this.gl.gl.clearColor(a.x,a.y,a.z,a.w));0<=b&&(d|=256,this.gl.gl.clearDepth(b));0<=c&&(d|=1024,this.gl.gl.clearStencil(c));this.gl.gl.colorMask(!0,!0,!0,!0);this.gl.gl.clear(d)},pushRenderTarget:function(a){null!=a?(a.bindBuffer(),this.setViewport(0,0,a.width,a.height),
this.screenParams.z=a.width,this.screenParams.w=a.height):(this.gl.gl.bindFramebuffer(36160,null),this.gl.gl.bindRenderbuffer(36161,null),this.setViewport(0,0,this._width,this._height),this.screenParams.z=this._width,this.screenParams.w=this._height);this._renderTargetList.push(a);this.currentRenderTarget=a},popRenderTarget:function(){this._renderTargetList.pop();this.currentRenderTarget=this._renderTargetList.get(-1);null!=this.currentRenderTarget?(this.currentRenderTarget.bindBuffer(),this.setViewport(0,
0,this.currentRenderTarget.width,this.currentRenderTarget.height),this.screenParams.z=this.currentRenderTarget.width,this.screenParams.w=this.currentRenderTarget.height):(this.gl.gl.bindFramebuffer(36160,null),this.gl.gl.bindRenderbuffer(36161,null),this.setViewport(0,0,this._width,this._height),this.screenParams.z=this._width,this.screenParams.w=this._height)}};var Jc=function(a,b,c){this.id=Jc._id++;this.enabled=!1;c=eb.current.gl;var d=c.gl.createShader(35633);c.gl.shaderSource(d,a);c.gl.compileShader(d);
a=c.gl.createShader(35632);c.gl.shaderSource(a,b);c.gl.compileShader(a);this._glprogram=c.gl.createProgram();c.gl.attachShader(this._glprogram,d);c.gl.attachShader(this._glprogram,a);c.gl.linkProgram(this._glprogram);c.gl.deleteShader(d);c.gl.deleteShader(a);this.enabled=!0;this._bufferAttribs=new K;this._uniforms=new K;this._uniformList=[];this._attributeList=[];b=c.gl.getProgramParameter(this._glprogram,35721);a=0;for(d=b;a<d;){var e=a++;var f=c.gl.getActiveAttrib(this._glprogram,e);b=f.name;e=
new hg(e,c.gl.getAttribLocation(this._glprogram,b),f,this.id);f=this._bufferAttribs;null!=p[b]?f.setReserved(b,e):f.h[b]=e;this._attributeList.push(e)}b=c.gl.getProgramParameter(this._glprogram,35718);d=a=0;for(e=b;d<e;){b=d++;f=c.gl.getActiveUniform(this._glprogram,b);b=f.name;var g=f.type;35678==g||35680==g?(f=new ae(a,c.gl.getUniformLocation(this._glprogram,b),f),g=this._uniforms,null!=p[b]?g.setReserved(b,f):g.h[b]=f,++a,this._uniformList.push(f)):(g=b.indexOf("["),0<g&&(b=x.substr(b,0,g)),f=
new ae(-1,c.gl.getUniformLocation(this._glprogram,b),f),g=this._uniforms,null!=p[b]?g.setReserved(b,f):g.h[b]=f,this._uniformList.push(f))}};Jc.prototype={bind:function(){this._time=ha._custom();this.enabled&&Jc.current!=this&&(eb.current.gl.gl.useProgram(this._glprogram),Jc.current=this)}};var hg=function(a,b,c,d){this.id=a;this.location=b;this.name=c.name;this.type=c.type;this.size=c.size};hg.prototype={};var ae=function(a,b,c){this.id=a;this.location=b;this._info=c;this.name=c.name;a=this.name.indexOf("[");
0<a&&(this.name=x.substr(this.name,0,a));this.type=c.type;this.size=c.size};ae.prototype={};var qa=function(){this._id=0;this.drawMode=4;this.cullMode=1029;this.blendState=new fg;this.depthState=new gg;this.stencilState=new ig;this.stencilReference=0};qa.prototype={get_id:function(){if(0!=this._id)return this._id;qa._fnv.reset();qa._fnv.addInt(this.cullMode);qa._fnv.addInt(this.blendState.alphaBlendOperation);qa._fnv.addInt(this.blendState.colorBlendOperation);qa._fnv.addInt(this.blendState.destinationAlphaBlendMode);
qa._fnv.addInt(this.blendState.destinationColorBlendMode);qa._fnv.addBool(this.blendState.enabled);qa._fnv.addInt(this.blendState.sourceAlphaBlendMode);qa._fnv.addInt(this.blendState.sourceColorBlendMode);qa._fnv.addInt(this.blendState.writeMask);qa._fnv.addInt(this.depthState.compareFunction);qa._fnv.addBool(this.depthState.writeEnabled);qa._fnv.addInt(this.stencilState.compareFunction);qa._fnv.addInt(this.stencilState.failOperation);qa._fnv.addInt(this.stencilState.passOperation);qa._fnv.addInt(this.stencilState.readMask);
qa._fnv.addInt(this.stencilState.writeMask);qa._fnv.addInt(this.stencilState.zFailOperation);qa._fnv.addInt(this.stencilReference);return this._id=qa._fnv.getCode()}};var ig=function(){this.writeMask=this.readMask=255;this.compareFunction=0;this.passOperation=this.failOperation=this.zFailOperation=7680};ig.prototype={};var jg={_new:function(a){null==a&&(a=-1);return 0>a?6408:a},fromString:function(a){switch(m.trim(a).toLowerCase()){case "alpha":a=6406;break;case "luminance":a=6409;break;case "luminancealpha":a=
6410;break;case "rgb565":a=36194;break;case "rgb888":a=6407;break;case "rgba4444":a=32854;break;case "rgba8888":a=6408;break;default:a=6408}return jg._new(a)}},ee=function(){this.type=3553;this.filterMin=this.filterMag=9729;this.wrapT=this.wrapS=10497;this.dirty=this.mipmap=!0;this.format=jg.fromString("");this._ispow2=!1;this._height=this._width=0};ee.prototype={setSize:function(a,b){this._width=a;this._height=b},bind:function(){if(this.dirty){this.dirty=!1;-1==this.filterMag&&(this.filterMag=9729);
-1==this.filterMin&&(this.filterMin=9729);-1==this.wrapS&&(this.wrapS=10497);-1==this.wrapT&&(this.wrapT=10497);var a=this.wrapS,b=this.wrapT,c=this.filterMin,d=this.filterMag,e=this.mipmap;var f=this._width;0<f&&0==(f&f-1)?(f=this._height,f=0<f&&0==(f&f-1)):f=!1;f?9729>=c&&(e=!1):(b=a=33071,9729<c&&(c=9729),9729<d&&(d=9729),e=!1);f=eb.current.gl;f.gl.texParameteri(this.type,10240,d);f.gl.texParameteri(this.type,10241,c);f.gl.texParameteri(this.type,10242,a);f.gl.texParameteri(this.type,10243,b);
e&&W.gl.gl.generateMipmap(this.type)}}};var Ic=function(){this.id=Ic._id++;this.length=this._time=0};Ic.prototype={setLayout:function(a){if(null==this.layouts)this.layouts=[],this._layoutMap=new K;else{for(var b=this.layouts.length;0<b--;)this._layoutMap.remove(this.layouts[b].name);this.layouts.splice(0,this.layouts.length)}b=this.stride=0;for(var c=a.length;b<c;){var d=b++;d=a[d];d.offset=this.stride;this.stride+=d.size*d.getDataSize();this.layouts.push(d);var e=this._layoutMap,f=d.name;null!=p[f]?
e.setReserved(f,d):e.h[f]=d}this.enabled=0<this.stride},upload:function(a){this._data=a;this.length=this._data.dataLength},bind:function(){this._time=ha._custom();if(!this.enabled)return!1;var a=this.layouts.length;if(1>a)return!1;var b=eb.current.gl;null!=this._data&&(null==this._buffer&&(this._buffer=b.gl.createBuffer()),b.gl.bindBuffer(34962,this._buffer),a=this.getData(),b.gl.bufferData(34962,a,35044),this._data=null);var c=0;b.gl.bindBuffer(34962,this._buffer);for(a=this.layouts.length;0<a--;){var d=
this.layouts[a];0>d.location||(b.gl.enableVertexAttribArray(d.location),b.gl.vertexAttribPointer(d.location,d.size,d.type,!1,this.stride,d.offset),++c)}return 1>c?!1:!0},unload:function(){null!=this._buffer&&(eb.current.gl.gl.deleteBuffer(this._buffer),this._buffer=null);this.layouts=this._layoutMap=this._data=null},getData:function(){var a=this._data.dataLength,b=m.intToNextPow2(a),c=m.pow2Count(b);switch(this._data.componentType){case 5120:case 5121:var d=5120;break;case 5122:case 5123:d=5122;break;
default:d=this._data.componentType}var e=d+"_"+c;c=Ic._tempList;c=null!=p[e]?c.getReserved(e):c.h[e];if(null==c){switch(d){case 5120:c=new Uint8Array(b);break;case 5122:c=new Uint16Array(b);break;case 5124:c=new Int32Array(b);break;case 5126:c=new Float32Array(b);break;default:c=new Float32Array(b)}b=Ic._tempList;null!=p[e]?b.setReserved(e,c):b.h[e]=c}if(5120==d)for(d=c;0<a--;)d[a]=this._data.data[a]|0;else if(5122==d)for(d=c;0<a--;)d[a]=this._data.data[a]|0;else if(5126==d)for(d=c;0<a--;)d[a]=this._data.data[a];
else if(5124==d)for(d=c;0<a--;)d[a]=this._data.data[a]|0;return c}};var Rf=function(a,b,c){null==c&&(c=5126);this.type=c;this.name=a;this.size=b;this.offset=0;this.location=-1};Rf.prototype={getDataSize:function(){return 4}};var ib=function(a,b){null==b&&(b=1);null==a&&(a=0);G.call(this,a,b)};ib.prototype=n(G.prototype,{get:function(){var a=this.x,b=this.y-a;return 0==b?a:b*m.randomInstance.getFloat()+a}});var Kb=function(a){this._data={};this._dirty=this.dirty=!1;this.name=a};Kb.getObject=function(a){if(m.stringEmpty(a))return null;
var b=Kb._map;if(null!=p[a]?b.existsReserved(a):b.h.hasOwnProperty(a))return b=Kb._map,null!=p[a]?b.getReserved(a):b.h[a];b=new Kb(a);var c=Kb._map;null!=p[a]?c.setReserved(a,b):c.h[a]=b;return b};Kb.prototype={readFromFile:function(a){try{this._data=(new db(a)).unserialize(),this._dirty=!1}catch(b){this._data={}}},writeToFile:function(){return Ta.run(this._data)},get:function(a){return null!=this._data?ma.field(this._data,a):null},set:function(a,b){null!=this._data&&this.get(a)!=b&&(this._data[a]=
b,this._dirty=!0)},get_dirty:function(){var a=this._dirty;this._dirty=!1;return a}};var Yb=function(){H.call(this);this.type=ob.NULL;this.done=this.forceBytes=!1};Yb.prototype=n(H.prototype,{dispose:function(){H.prototype.dispose.call(this);this.callback=this.key=this.path=this.customData=this.video=this.image=this.text=this.bytes=null},setType:function(a){this.type=a;a==ob.BYTES&&(this.forceBytes=!0);return this},setPath:function(a){this.path=a;if(null==this.type)switch(this.type=ob.BYTES,a.split(".").pop().toLowerCase()){case "gif":case "jpeg":case "jpg":case "png":this.type=
ob.IMAGE;break;case "mp2":case "mp3":break;case "m4a":case "ogg":case "wav":break;case "otf":case "ttf":break;case "css":case "json":case "plist":case "svg":case "text":case "txt":case "xml":this.type=ob.TEXT;this.forceBytes=!0;break;default:this.type=ob.BYTES,this.forceBytes=!0}return this},setUrl:function(a){this.url=a;return this},complete:function(){this.done=!0},get_key:function(){if(null!=this._key)return this._key;Yb._fnv.reset();Yb._fnv.addString(this.url);Yb._fnv.addInt(this.type._hx_index);
return this._key=Yb._fnv.getString()},get_enabled:function(){return null==this.bytes&&null==this.text&&null==this.image?null!=this.video:!0}});var ff=function(){this._list=T.fromArray([]);this._checkDelay=new aa(g(this,this.complete));this.total=this.loaded=0};ff.prototype={start:function(){this._list.clear();I.onLoadEvent.addEventListener(Bb.onLoad._type,g(this,this.onLoad))},end:function(a,b){this._callback=a;this._progress=b;I.onLoadEvent.removeEventListener(Bb.onLoad._type,g(this,this.onLoad));
1>this._list.get_length()?this.complete():this.check(null)},onLoad:function(a){a.file.get_enabled()||(a.file.addEventListener(B.complete._type,g(this,this.fileComplete)),this._list.push(a.file),this.total++)},fileComplete:function(a){this.check(a.target)},check:function(a){var b=this._list.get_length();if(!(1>b)){for(;0<b--;){var c=this._list.getArrayElement(b);if(c.get_enabled()||c==a)this._list.removeAt(b),this.loaded++,null!=this._progress&&this._progress()}b=this._list.get_length();1>b&&null!=
this._callback&&this._checkDelay.start(.1)}},complete:function(){this._callback()}};var ob=Ma["lovedna.net.FileType"]={__ename__:"lovedna.net.FileType",__constructs__:"NULL BYTES IMAGE TEXT VIDEO AUDIO".split(" "),NULL:{_hx_index:0,__enum__:"lovedna.net.FileType",toString:Z},BYTES:{_hx_index:1,__enum__:"lovedna.net.FileType",toString:Z},IMAGE:{_hx_index:2,__enum__:"lovedna.net.FileType",toString:Z},TEXT:{_hx_index:3,__enum__:"lovedna.net.FileType",toString:Z},VIDEO:{_hx_index:4,__enum__:"lovedna.net.FileType",
toString:Z},AUDIO:{_hx_index:5,__enum__:"lovedna.net.FileType",toString:Z}},kg=function(){};kg.prototype={};var Ne=function(){this.name="files";this._list=[];this._map=new K};Ne.prototype={createTableItem:function(){var a=new kg;null!=this._list&&this._list.push(a);return a},tableInit:function(){if(null!=this._list){for(var a=0,b=this._list.length;a<b;){var c=a++;this.addItem(this._list[c])}this._list=null}},addItem:function(a){var b=this._map,c=a.name;null!=p[c]?b.setReserved(c,a):b.h[c]=a},get:function(a){var b=
this._map;if(null!=p[a]?!b.existsReserved(a):!b.h.hasOwnProperty(a))return null;b=this._map;a=null!=p[a]?b.getReserved(a):b.h[a];return null==a.bytes?a.string:a.bytes}};var V=function(){H.call(this);this.unloaded=this.inited=this.enabled=!1};V.delayCall=function(){V._list.clear();for(var a=V._map.keys();a.hasNext();){var b=a.next();V._list.push(V._map.h[b])}a=0;for(b=V._list.get_length();a<b;){var c=a++;c=V._list.getArrayElement(c);V._map.remove(c.getInstanceID());c.inited=!0;c.dispatchEvent(B.complete)}V._list.clear()};
V.prototype=n(H.prototype,{unload:function(){this._file=null;this.enabled=!1;this.unloaded=!0;this.dispose()},fileComplete:function(){this.enabled=!0;this.onFileComplete();this.doComplete()},onFileComplete:function(){},doComplete:function(){var a=V._map,b=this.getInstanceID();a.h[b]=this;null==V._delayCall&&(V._delayCall=new aa(V.delayCall));V._delayCall.start(.02)},set_file:function(a){return this._file=a}});var Jd=function(){V.call(this);this.data=new Ca};Jd.prototype=n(V.prototype,{init:function(a){if(null!=
this.texture)if(this.enabled=!0,null==a){this.packed=!1;a=this.texture.texture.width;var b=this.texture.texture.height;if(0!=a&&0!=b){var c=this.data.frame,d=0,e=0,f=a,g=b;null==g&&(g=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c.w=g;c=this.data.originalSize;d=a;e=b;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;this.data.page=new Kd;this.data.page.name=this.atlasName;this.data.page.width=m.floatToInt(a);this.data.page.height=m.floatToInt(b);this.data.postInit();this.dispatchEvent(B.init)}}else this.packed=
!0,a=a.getRegion(this.name),null==a?this.enabled=!1:(this.data.copy(a),null==this.data.page&&(this.enabled=!1),this.dispatchEvent(B.init))},set_atlasName:function(a){return null!=this.atlasName?this.atlasName:this.atlasName=a},set_name:function(a){return null!=this.name?this.name:this.name=a},set_texture:function(a){return null!=this.texture?this.texture:this.texture=a}});var Ie=function(){V.call(this);this.audio=new nd};Ie.prototype=n(V.prototype,{unload:function(){V.prototype.unload.call(this);
null!=this.audio&&(this.audio.dispose(),this.audio=null)},onFileComplete:function(){V.prototype.onFileComplete.call(this);null==this._file.bytes?this.audio.fromUrl(this._file.url):this.audio.fromBytes(this._file.bytes)}});var Ke=function(){V.call(this);this.bytes=La._new()};Ke.prototype=n(V.prototype,{unload:function(){V.prototype.unload.call(this);null!=this.bytes&&(this.bytes.dispose(),this.bytes=null)},onFileComplete:function(){V.prototype.onFileComplete.call(this);this.enabled=null!=this._file.bytes;
null!=this._file.bytes&&(this.bytes.writeBytes(this._file.bytes),this.bytes.position=0)}});var be=function(a,b){V.call(this);this.name=a;this.texture=b};be.prototype=n(V.prototype,{unload:function(){V.prototype.unload.call(this);this.texture=null;null!=this.fnt&&(this.fnt.dispose(),this.fnt=null)},setfnt:function(a){this.fnt=a;this.enabled=!0;this.doComplete()}});var lg=function(){V.call(this);this._table=new Ld;this._tableMap=new K};lg.prototype=n(V.prototype,{add:function(a){var b=this._tableMap,
c=a.name;null!=p[c]?b.setReserved(c,a):b.h[c]=a},unload:function(){V.prototype.unload.call(this);this._tableMap=this._table=null},onFileComplete:function(){V.prototype.onFileComplete.call(this);if(null!=this._file.bytes){try{var a=La.fromBytes(this._file.bytes);a=La.fromBytes(pd.uncompress(La.toBytes(a)));for(var b=a.readUnsignedShort();0<b--;){var c=a.readUnsignedInt(),d=La._new();a.readBytes(d,0,c);var e=this._table.readName(d);if(null!=e){var f=this._tableMap;if(null!=p[e]?f.existsReserved(e):
f.h.hasOwnProperty(e)){this._table.name=e;var h=this._tableMap,k=null!=p[e]?h.getReserved(e):h.h[e];this._table.onCreateItem=g(k,k.createTableItem);this._table.decode(d)}}}for(var l=this._tableMap,m=new Hb(l,l.arrayKeys());m.hasNext();)m.next().tableInit()}catch(ug){}this._tableMap=this._table=null}}});var Me=function(){V.call(this);this.texture=new Uc};Me.prototype=n(V.prototype,{unload:function(){V.prototype.unload.call(this);null!=this.texture&&(this.texture.unload(),this.texture=null)},onFileComplete:function(){V.prototype.onFileComplete.call(this);
if(null==this._file.image)this.enabled=!1;else try{0!=this._file.image.width&&(this.texture.setData(this._file.image),this.parsePng())}catch(a){}null!=this._file.bytes&&null==this._file.image&&(this._file.image=new Lc,this._file.image.fromBytes(this._file.bytes,g(this,this.onImageComplete)))},onImageComplete:function(a){this.onFileComplete()},parsePng:function(){l.texture.res=this;l.texture.tag=0;l.texture.bytes=null;var a=0;if(null!=this._file.bytes){var b=new kd;b.decode(La.fromBytes(this._file.bytes));
var c=b.getChunk(jd.TYPE_USER);if(null!=c&&(c=c.getContent(),null!=c))for(c.position=0;oa.gt(c._length-c.position,0);){var d=new Oc(0),e=d.decode(c);e.position=0;l.texture.tag=d.type;l.texture.bytes=e;l.texture.dispatchEvent(B.data);++a}b.dispose()}1>a&&(l.texture.tag=0,l.texture.bytes=null,l.texture.dispatchEvent(B.data))}});var fe=function(){na.call(this);Oc.map.h[id.TYPE]="fnt"};fe.prototype=n(na.prototype,{getRes:function(a){var b=this._map;if(null!=p[a]?b.existsReserved(a):b.h.hasOwnProperty(a))b=
this._map,b=null!=p[a]?b.getReserved(a):b.h[a];else{var c=l.texture.get(a);c._file.forceBytes=!0;b=new be(a,c.texture);b.set_file(c._file);c=this._map;null!=p[a]?c.setReserved(a,b):c.h[a]=b;c=this._fntMap;if(null!=p[a]?c.existsReserved(a):c.h.hasOwnProperty(a))c=this._fntMap,b.setfnt(null!=p[a]?c.getReserved(a):c.h[a])}return b},onConstruct:function(){na.prototype.onConstruct.call(this);this._fntMap=new K},init:function(){na.prototype.init.call(this);l.texture.addEventListener(B.data._type,g(this,
this.ondata))},ondata:function(a){if(l.texture.tag==id.TYPE){var b=l.texture.bytes;a=new id;a.decode(b);b=l.texture.res._file.path;var c=this._fntMap;null!=p[b]?c.setReserved(b,a):c.h[b]=a;c=this._map;c=null!=p[b]?c.getReserved(b):c.h[b];if(null==c){c=new be(b,l.texture.get(b).texture);var d=this._map;null!=p[b]?d.setReserved(b,c):d.h[b]=c}c.enabled||c.setfnt(a)}}});var ge=function(){na.call(this)};ge.prototype=n(na.prototype,{createRes:function(){return new lg},onLoadBefore:function(a){na.prototype.onLoadBefore.call(this,
a);a._file.forceBytes=!0}});var ce=function(a,b,c){null==c&&(c=!1);this.isStatic=c;this.priority=0;this._name=b;this._metaList=[];this._metaMap=new K;b=ma.fields(a);for(c=b.length;0<c--;){var d=b[c];if("t"!=d&&"f"!=d){this._metaList.push(d);var e=ma.field(a,d);null!=e&&1==e.length&&U.__instanceof(e[0],Xd)&&(this.priority=e[0]);var f=this._metaMap;null!=p[d]?f.setReserved(d,e):f.h[d]=e}}b=ma.field(a,"t");null!=b&&0<b.length?(this._type=Ya[b[b.length-1]],this.isFunction=!1):(this.isFunction=!0,this._funArgs=
[]);a=ma.field(a,"f");if(null!=a)for(b=0,c=a.length;b<c;)d=b++,d=ma.field(a[d],"type"),this._funArgs.push(Ya[d])};ce.prototype={};var yb=function(){};yb.get=function(a){if(null==a)return null;if(null!=yb._infoMap.h.__keys__[a.__id__])return yb._infoMap.h[a.__id__];var b=new yb;b.classPath=a.__name__;b.parse(a);yb._infoMap.set(a,b);b.parseClassMeta(rb.getType(a));return b};yb.prototype={getClassMeta:function(a,b,c){null==c&&(c=!1);null==b&&(b=!1);var d=this._classMetaMap;if(null!=p[a]?d.existsReserved(a):
d.h.hasOwnProperty(a))return b=this._classMetaMap,null!=p[a]?b.getReserved(a):b.h[a];if(c)for(var e=a.toLowerCase(),f=this._classMetaMap.keys();f.hasNext();)if(d=f.next(),d.toLowerCase()==e)return a=this._classMetaMap,null!=p[d]?a.getReserved(d):a.h[d];return b&&(d=yb.get(this._super),null!=d)?d.getClassMeta(a,b,c):null},parseClassMeta:function(a){this._classMetaMap=new K;for(var b=ma.fields(a),c=b.length;0<c--;){var d=b[c],e=pa.getValue(a,d);null==e&&(e=[]);var f=this._classMetaMap;null!=p[d]?f.setReserved(d,
e):f.h[d]=e}},parse:function(a){this._super=a.__super__;var b=rb.getFields(a);this._metaMap=new K;this._fields=[];for(var c=ma.fields(b),d=c.length,e=[];0<d--;){var f=c[d],h=new ce(ma.field(b,f),f),k=this._metaMap;null!=p[f]?k.setReserved(f,h):k.h[f]=h;null!=h._type?this._fields.push(f):e.push(h)}d=e.length;if(0<d)for(e.reverse(),e.sort(g(this,this.sort)),b=0;b<d;)c=b++,this._fields.push(e[c]._name);b=rb.getStatics(a);c=ma.fields(b);for(d=c.length;0<d--;)a=c[d],f=new ce(ma.field(b,a),a,!0),h=this._metaMap,
null!=p[a]?h.setReserved(a,f):h.h[a]=f,null!=f._type?this._fields.push(a):e.push(f)},sort:function(a,b){return a.priority<b.priority?1:a.priority>b.priority?-1:0}};var aa=function(a){null==aa._id&&(aa._id=0);this.id=aa._id++;this.handler=a;this.running=!1;this.time=0};aa.add=function(a,b){if(null!=a)if(0>=b){if(null!=a.handler)a.onExecute()}else{var c=ha._custom();a.time=b+c;null==aa._delayTask&&(aa._delayTask=new mg);aa._delayTask.running||ja.add(aa._delayTask);aa._delayTask.add(a)}};aa.remove=function(a){null!=
a&&null!=aa._delayTask&&aa._delayTask.remove(a)};aa.prototype={start:function(a){aa.add(this,a)},stop:function(){aa.remove(this)},onStart:function(){this.running=!0},onExecute:function(){this.running=!1;null!=this.handler&&this.handler()},onEnd:function(){}};var mg=function(){this._map=new ba;this._list=new xf(g(this,this.compare));this._callList=new N;this._doList=new N;this._changed=!1};mg.prototype={add:function(a){this._map.h.hasOwnProperty(a.id)?this._changed=!0:(this._changed=!0,this._map.h[a.id]=
a,a.onStart())},remove:function(a){this._map.h.hasOwnProperty(a.id)&&(this._changed=!0,this._map.remove(a.id),a.onEnd())},onTaskStart:function(a){this.running=!0},onTaskExecute:function(a){if(this._changed){this._changed=!1;this._list.Clear();for(a=this._map.iterator();a.hasNext();){var b=a.next();null!=b&&b.running&&this._list.push(b)}this._current=this._list.shift()}a=this._list.count;if(null!=this._current)for(b=ha._custom();null!=this._current&&!(0>a);){if(b>=this._current.time){this._map.remove(this._current.id);
var c=this._list.shift();this._callList.push(this._current);this._current=c}else break;--a}a=this._callList.get_length();if(0<a){for(this._doList.clear();0<a--;)this._doList.push(this._callList.get(a));this._callList.clear();for(a=this._doList.get_length();0<a--;)b=this._doList.getArrayElement(a),b.onExecute(),b.onEnd()}return null!=this._current||this._changed?!0:this.running=!1},onTaskEnd:function(a){},compare:function(a,b){return a.time>b.time?1:-1}};var ja=function(){};ja.add=function(a){-1==
ja._triggerList.indexOf(a)&&-1==ja._addList.indexOf(a)&&(ja._addList.push(a),null==ja._timer&&(ja._timer=new Tc(15),ja._timer.run=ja.run))};ja.remove=function(a){-1==ja._triggerList.remove(a)&&ja._addList.remove(a);-1==ja._endList.indexOf(a)&&ja._endList.push(a)};ja.run=function(){var a=ha._custom(),b=ja._endList.get_length();if(0<b){for(;0<b--;)ja._endList.get(b).onTaskEnd(a);ja._endList.clear()}b=ja._triggerList.get_length();if(0<b)for(;0<b--;){var c=ja._triggerList.get(b);c.onTaskExecute(a)||ja.remove(c)}b=
ja._addList.get_length();if(0<b){for(;0<b--;)c=ja._addList.get(b),ja._triggerList.push(c),c.onTaskStart(a);ja._addList.clear()}};var Vb=function(){this._keys=new ba};Vb.getInstance=function(){null==Vb._instance&&(Vb._instance=new Vb);return Vb._instance};Vb.prototype={keyTrigger:function(a){var b=a.get_id();if(this._keys.h.hasOwnProperty(b))var c=this._keys.h[b];else c=new Wa,this._keys.h[b]=c;b=!0;c.type==a.type&&0==c.deviceType&&(b=!1);c.copy(a);b&&c.trigger()}};var ya=function(a){null==a&&(a=!1);
this._immediately=a;this.touchType=0;this._list=[];for(a=20;0<a--;)this._list.push(new Va);this._keyMap=new K;this._deviceMap=new ba;this._activeList=new N;this.activeCount=0;this._immediately||ja.add(this);this._wheelEvent=Sb.onUpdate};ya.prototype={begin:function(a){if(ya.focus){var b=this.getTouch(a.device,a.touchId);null!=b&&(a.touchId=b.touchId,b.begin(a),this._immediately&&this.execute())}},move:function(a){if(ya.focus){var b=this.getTouch(a.device,a.touchId);null!=b&&(a.touchId=b.touchId,b.move(a),
this._immediately&&this.execute())}},end:function(a){var b=this.getTouch(a.device,a.touchId);null!=b&&(a.touchId=b.touchId,b.end(a),this._immediately&&this.execute(),ya.focus||b.has(2)||(ya.focus=!0,ya.onBegin.dispatchEvent(B.focus)))},cancel:function(a){if(ya.focus){var b=this.getTouch(a.device,a.touchId);null!=b&&(a.touchId=b.touchId,b.cancel(a),this._immediately&&this.execute())}},wheel:function(a,b){this._wheelEvent.deltaMode=a;this._wheelEvent.value.copy(b);ya.onWheel.dispatchEvent(this._wheelEvent)},
execute:function(){this._activeList.clear();for(var a=ha._custom(),b=20;0<b--;){var c=this._list[b];c._alive&&(c.execute(a),5==c.type&&(this._activeList.push(c),this.unset(c)))}this.activeCount=this._activeList.get_length();1>this.activeCount&&(this.touchType=0)},onTaskStart:function(a){},onTaskExecute:function(a){this.execute();return!0},onTaskEnd:function(a){},getTouch:function(a,b){b=""+a+"|"+b;var c=this._keyMap;if(null!=p[b]?c.existsReserved(b):c.h.hasOwnProperty(b))return a=this._keyMap,null!=
p[b]?a.getReserved(b):a.h[b];c=this.getUnused();if(null==c)return null;var d=this._keyMap;null!=p[b]?d.setReserved(b,c):d.h[b]=c;d=this._deviceMap.h[a];null==d&&(d=new ng(a),this._deviceMap.h[a]=d);d.add(c);c._key=b;return c},getUnused:function(){for(var a=0;20>a;){var b=a++,c=this._list[b];if(null==c._key)return c.touchId=b,c}return null},unset:function(a){var b=a._key,c=b.split("|");c=m.stringToInt(c[0]);a._key=null;this._keyMap.remove(b);b=this._deviceMap.h[c];null!=b&&(b.remove(a),1>b.count&&
this._deviceMap.remove(c))}};var ng=function(a){this.id=a;this._list=[];this.count=0};ng.prototype={add:function(a){a.device=this.id;for(var b=0,c=this._list.length;b<c;){var d=b++;if(null==this._list[d]){a.touchId=d;this._list[d]=a;this.count++;return}}a.touchId=this._list.length;this._list.push(a);this.count++},remove:function(a){var b=this._list.length;for(this.count=b;0<b--;)this._list[b]==a&&(this._list[b]=null,this.count--)}};var pd=function(){};pd.uncompress=function(a,b){null==b&&(b="zlib");
var c=null;try{if("deflate"==b)c=pako.inflateRaw(a.b.bufferValue);else{if("lzma"==b)return a;"zlib"==b&&(c=pako.inflate(a.b.bufferValue))}}catch(d){}return Aa.ofData(c)};var pa=function(){};pa.getValue=function(a,b){return a instanceof K?null!=p[b]?a.getReserved(b):a.h[b]:ma.getProperty(a,b)};pa.getInt=function(a,b,c){null==c&&(c=0);a=pa.getValue(a,b);return null==a?c:"string"==typeof a?da.parseInt(a):U.__cast(a,Xd)};pa.getFloat=function(a,b,c){null==c&&(c=0);a=pa.getValue(a,b);return null==a?c:"string"==
typeof a?parseFloat(a):U.__cast(a,of)};pa.getBool=function(a,b,c){null==c&&(c=!1);a=pa.getValue(a,b);return null==a?c:a};pa.exist=function(a,b){var c=Object.prototype.hasOwnProperty.call(a,b);return c||null==ma.field(a,b)?c:!0};var dd=function(){};dd.quadInOut=function(a){return.5>a?2*a*a:-2*--a*a+1};dd.backOut=function(a){return 0==a?0:1==a?1:--a*a*(2.70158*a+1.70158)+1};var vb=Ma["lovedna.utils._StringTable.ValueType"]={__ename__:"lovedna.utils._StringTable.ValueType",__constructs__:"string float double int array map value2 value3 bytes file".split(" "),
string:{_hx_index:0,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z},float:{_hx_index:1,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z},double:{_hx_index:2,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z},int:(M=function(a){return{_hx_index:3,size:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z}},M.__params__=["size"],M),array:(M=function(a){return{_hx_index:4,type:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z}},M.__params__=["type"],M),
map:(M=function(a){return{_hx_index:5,value:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z}},M.__params__=["value"],M),value2:(M=function(a,b){return{_hx_index:6,x:a,y:b,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z}},M.__params__=["x","y"],M),value3:(M=function(a,b,c){return{_hx_index:7,x:a,y:b,z:c,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z}},M.__params__=["x","y","z"],M),bytes:{_hx_index:8,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z},file:(M=
function(a){return{_hx_index:9,type:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:Z}},M.__params__=["type"],M)},og=function(){this._stringTable=[];this._stringMap=new K};og.prototype={readType:function(a){switch(a.readUnsignedByte()){case 2:return vb.float;case 3:return vb.double;case 4:return a=a.readUnsignedByte(),vb.int(a);case 5:return a=this.readType(a),vb.array(a);case 6:return a=this.readType(a),vb.map(a);case 7:return vb.bytes;case 8:var b=this.readType(a);a=this.readType(a);
return vb.value2(b,a);case 9:b=this.readType(a);var c=this.readType(a);a=this.readType(a);return vb.value3(b,c,a)}return vb.string},readValue:function(a,b){switch(b._hx_index){case 0:a=a.readUnsignedShort();if(65534!=a){if(65533==a)return"";if(a>=this._stringTable.length)throw this.error="string id error",new u(this.error);return this._stringTable[a]}break;case 1:return a.readFloat();case 2:return a.readFloat();case 3:var c=b.size;if(8==c)return a.readByte();if(16==c)return a.readShort();if(32==c)return a.readInt();
if(64==c)return new hf(a.readInt(),a.readInt());break;case 4:c=b.type;var d=[];for(b=a.readUnsignedShort();0<b--;)d.push(this.readValue(a,c));return d;case 5:c=b.value;d=new K;for(b=a.readUnsignedByte();0<b--;){var e=this.readValue(a,vb.string),f=this.readValue(a,c);null!=p[e]?d.setReserved(e,f):d.h[e]=f}return d;case 6:c=b.y;d=b.x;if(0==a.readUnsignedByte())break;return new yf(this.readValue(a,d),this.readValue(a,c));case 7:c=b.z;d=b.y;b=b.x;if(0==a.readUnsignedByte())break;b=this.readValue(a,b);
d=this.readValue(a,d);a=this.readValue(a,c);return new zf(b,d,a);case 8:if(c=a.readUnsignedInt(),!(1>c)){if(oa.gt(c,a._length-a.position))throw this.error="error length",new u(this.error);d=La._new();a.readBytes(d,0,c);return d}}return null},readStringTable:function(a){this._stringMap=null;this._stringTable=[];for(var b=a.readUnsignedShort();0<b--;)this._stringTable.push(a.readUTF())}};var pg=function(a,b,c){this.name=a;this.type=b;this.disable=c};pg.prototype={};var Ld=function(){this.parser=new og};
Ld.prototype={readName:function(a){this.name=null;return"TABLE"!=a.readUTFBytes(5)?(a.position-=5,this.name):this.name=a.readTinyUTF()},decode:function(a){var b=a.readUnsignedInt(),c=a.readUnsignedShort(),d=a.readUnsignedShort(),e=a.position;a.position=b;this.parser.readStringTable(a);a.position=e;this.fields=[];for(b=0;b<c;){b++;e=a.readTinyUTF();var f=this.parser.readType(a);e=new pg(e,f,!1);this.fields.push(e)}for(;0<d--;)for(b=null,null!=this.onCreateItem&&(b=this.onCreateItem()),e=0,f=c;e<f;){var g=
e++;g=this.fields[g];var h=this.parser.readValue(a,g.type);null!=b&&(b[g.name]=h)}}};var Pe=function(){this.scale=1;this.keys=new N;this.length=0;this._timeList=[];this._sort=!1;this.postWrapMode=this.preWrapMode=1;this._min=1.79769313486231E308;this._max=-1.79769313486231E308};Pe.prototype={clear:function(){this.length=0;this.keys.clear();this._min=1.79769313486231E308;this._max=-1.79769313486231E308;this.minValue=1.79769313486231E308;this.maxValue=-1.79769313486231E308},addValue:function(a,b,c,
d){null==d&&(d=0);null==c&&(c=0);a=new sd(a,b,c,d);this.add(a)},add:function(a){0<this.keys.get_length()&&a.time<this.keys.getArrayElement(this.length-1).time&&(this._sort=!0);this.keys.push(a);this.length=this.keys.get_length();this._timeList.push(a.time);a.time<this._min&&(this._min=a.time);a.time>this._max&&(this._max=a.time);var b=this.minValue,c=a.value;this.minValue=b<c?b:c;b=this.maxValue;a=a.value;this.maxValue=b>a?b:a},evaluate:function(a){if(2>this.length)return 0;if(this._sort){this._sort=
!1;this.keys.sort(g(this,this.sort));for(var b=0,c=this.length;b<c;){var d=b++;this._timeList[d]=this.keys.getArrayElement(d).time}}a>this._max?1==this.postWrapMode?a%=this._max:0==this.postWrapMode?a=this._max:2==this.postWrapMode&&(a%=this._max,0!=(m.floatToInt(a/this._max)&1)&&(a=this._max-a)):a<this._min&&(1==this.postWrapMode?(a%=this._max,a+=this._max):0==this.postWrapMode?a=this._min:2==this.postWrapMode&&(a%=this._max,a+=this._max,0!=(m.floatToInt(a/this._max)&1)&&(a=this._max-a)));c=m.binarySearchLow(this._timeList,
a);if(-1==c)return 0;if(c>=this.length-1)return this.keys.getArrayElement(this.length-1).value;b=c+1;var e=this.keys.getArrayElement(c),f=this.keys.getArrayElement(b);a-=e.time;d=e.time;b=e.value;c=e.time-d;var h=f.time-d,k=h-c,l=h*h-c*c;d=e.value-b;e=e.outTangent;var n=f.inTangent;f=((f.value-b-d-e*k)/(l-2*k*c*c)-(n-e)/(2*k))/((h*h*h-c*c*c-3*k*c*c)/(l-2*k*c)-3*l/(2*k));k=(n-e)/(2*k)-3*l/(2*k)*f;e-=2*k*c+3*f*c*c;return(d-(e*c+k*c*c+f*c*c*c)+e*a+k*a*a+f*a*a*a+b)*this.scale},sort:function(a,b){return a.time>
b.time?1:a.time<b.time?-1:0}};var Ed=function(a,b){this.time=a;this.value=b};Ed.prototype={};var sd=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);Ed.call(this,a,b);this.inTangent=c;this.outTangent=d};sd.prototype=n(Ed.prototype,{});var Oe=function(){this._keys=new N;this.length=0;this._timeList=[];this._sort=!1;this.postWrapMode=this.preWrapMode=1;this._min=1.79769313486231E308;this._max=-1.79769313486231E308};Oe.prototype={add:function(a,b){a=new Ed(a,b);0<this._keys.get_length()&&a.time<this._keys.getArrayElement(this.length-
1).time&&(this._sort=!0);this._keys.push(a);this.length=this._keys.get_length();this._timeList.push(a.time);a.time<this._min&&(this._min=a.time);a.time>this._max&&(this._max=a.time)},evaluate:function(a){if(1>this.length)return!1;if(this._sort){this._sort=!1;this._keys.sort(g(this,this.sort));for(var b=this._keys.get_length(),c=1.79769313486231E308;0<b--;){var d=this._keys.get(b);d.time==c&&(this._keys.removeAt(b),this._timeList.pop());c=d.time}b=this._keys.get_length();for(c=0;c<b;)d=c++,this._timeList[d]=
this._keys.getArrayElement(d).time}a>this._max?1==this.postWrapMode?a%=this._max:0==this.postWrapMode?a=this._max:2==this.postWrapMode&&(a%=this._max,0!=(m.floatToInt(a/this._max)&1)&&(a=this._max-a)):a<this._min&&(1==this.postWrapMode?(a%=this._max,a+=this._max):0==this.postWrapMode?a=this._min:2==this.postWrapMode&&(a%=this._max,a+=this._max,0!=(m.floatToInt(a/this._max)&1)&&(a=this._max-a)));c=m.binarySearchLow(this._timeList,a);if(-1==c)return!1;if(c>=this.length-1)return this.end=this.start=
this._keys.getArrayElement(this.length-1).value,this.ratio=0,!0;b=this._keys.getArrayElement(c);c=this._keys.getArrayElement(c+1);this.start=b.value;this.end=c.value;c=c.time-b.time;if(0>=c)return this.ratio=0,!0;this.ratio=(a-b.time)/c;return!0},sort:function(a,b){return a.time>b.time?1:a.time<b.time?-1:0}};"undefined"==typeof O.$haxeUID&&(O.$haxeUID=0);null==String.fromCodePoint&&(String.fromCodePoint=function(a){return 65536>a?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&
1023)+56320)});String.prototype.__class__=Ya.String=String;Date.prototype.__class__=Ya.Date=Date;var Xd={},rg={},of=Number,qg=Boolean,jf={},kf={},p={};gd.count=0;Object.defineProperty(u.prototype,"message",{get:function(){return String(this.val)}});U.__toStr={}.toString;Ga._names=[];Ga._layers=new K;Ga.setLayerName(0,"Default");Ga.setLayerName(1,"Transparent");Ga.setLayerName(2,"IgnoreRaycast");Ga.setLayerName(3,"Water");Ga.setLayerName(4,"UI");v.Element=0;v.PCData=1;v.CData=2;v.Comment=3;v.DocType=
4;v.ProcessingInstruction=5;v.Document=6;fb._id=0;H._temp=[];Jb._id=1;nd.focused=!1;Vc.workerEnable=!1;Lb._map=new K;L.trapPath="image/pack/actor_";L.effectPath="image/pack/";L.uiPath="image/pack/";Ea.mapData=new Mc;Nc.springUpTime=Math.sqrt(.3958518518518519);Nc.springJumpUpVelocity=(167+.5*Nc.springUpTime*Nc.springUpTime*843.7499999999999)/Nc.springUpTime;ab._inited=!1;xb.b32=new $a;mb.pool=new J(function(){return new mb});mb._id=1;Qa._id=1;Qa.pool=new J(function(){return new Qa});w._destoryCount=
0;ka._pools=[];ta.instance=new ta;E.BLACK=new E(0,0,0,1);E.WHITE=(new E).setRGBA(-1);E.GRAY=(new E).setRGBA(2139062271);E.BLUE=new E(0,0,1,1);E.GREEN=(new E).setRGBA(16711935);E.YELLOW=(new E).setRGBA(-65281);E.RED=(new E).setRGBA(-16776961);E.instance=new E;G._pool=new ka(function(){return new G});G.instance=new G;h._pool=new ka(function(){return new h});h.instance=new h;Ra._v3=h.instance;Ra._v2=G.instance;Ra._c4=E.instance;ra.defaultRenderQueue=30010;na._all=new K;Oc.map=new ba;cd.TYPE=1149700628;
gb.instance=new gb;qd.TYPE=-433249250;I.onLoadEvent=new H;I._list=new N;I._fileMap=new K;I._version=new K;I._defaultRoot="";I._loading=!1;I._path=new nb;I.meta=new qd;I.enableVersion=!0;l.bytes=new Je;l.texture=new Le;l.atlas=new Fe;l.audio=new He;l.version="";l._init=!1;Zb.pool=new J(function(){return new Zb});$b.pool=new J(function(){return new $b});ac.pool=new J(function(){return new ac});bc.pool=new J(function(){return new bc});cc.pool=new J(function(){return new cc});dc.pool=new J(function(){return new dc});
ec.pool=new J(function(){return new ec});ua._pool=new ka(function(){return new ua});fc._worldMat=new ua;gc.pool=new J(function(){return new gc});hc.pool=new J(function(){return new hc});ic.pool=new J(function(){return new ic});jc.pool=new J(function(){return new jc});kc.pool=new J(function(){return new kc});lc.pool=new J(function(){return new lc});mc.pool=new J(function(){return new mc});Pc._worldMat=new ua;Nb.__meta__={obj:{allowMulti:null}};Nb._worldMat=new ua;k._id=0;k._nameMap=new K;k.POSITION=
k._new("POSITION",3,k._id++);k.UV=k._new("UV",2,k._id++);k.UV2=k._new("UV2",2,k._id++);k.NORMAL=k._new("NORMAL",3,k._id++);k.TANGENT=k._new("TANGENT",4,k._id++);k.COLOR=k._new("COLOR",4,k._id++);k.COLOR2=k._new("COLOR2",4,k._id++);k.COLOR3=k._new("COLOR3",4,k._id++);k.COLOR4=k._new("COLOR4",4,k._id++);k.COLOR5=k._new("COLOR5",4,k._id++);k.COLOR6=k._new("COLOR6",4,k._id++);k.BONE_INDEX=k._new("BONE_INDEX",4,k._id++);k.BONE_WEIGHT=k._new("BONE_WEIGHT",4,k._id++);k.P=k._new("P",16);k.V=k._new("V",16);
k.VP=k._new("VP",16);k.IV=k._new("IV",16);k.IVP=k._new("IVP",16);k.M=k._new("M",16);k.IM=k._new("IM",16);k.BASECOLORMAP=k._new("BASECOLORMAP");k.NORMALMAP=k._new("NORMALMAP");k._REGION=k._new("_REGION");k.EYE=k._new("EYE",3);k.FOG=k._new("FOG",4);k.FOG_COLOR=k._new("FOG_COLOR",4);k.TIME=k._new("TIME",4);k.TIME_SIN=k._new("TIME_SIN",4);k.TIME_COS=k._new("TIME_COS",4);k.TIME_DELTA=k._new("TIME_DELTA",4);k.SCREEN_PARAMS=k._new("SCREEN_PARAMS",4);k.PROJECTION_PARAMS=k._new("PROJECTION_PARAMS",4);k.ORTHOGRAPHIC_PARAMS=
k._new("ORTHOGRAPHIC_PARAMS",4);k.RENDER_BUFFER=k._new("renderBuffer");k.BONE=k._new("BONE");k.SKINNING=k._new("SKINNING");k.LIGHT=k._new("LIGHT");k.LIGHT_POSITION=k._new("LIGHT_POSITION");k.LIGHT_AMBIENT=k._new("LIGHT_AMBIENT");k.LIGHT_SPECULAR=k._new("LIGHT_SPECULAR");nc.pool=new J(function(){return new nc});oc.pool=new J(function(){return new oc});pc.pool=new J(function(){return new pc});qc.pool=new J(function(){return new qc});z._id=1;z._changed=new ba;z._v20=new G;z._v21=new G;pb._id=1;pb.pool=
new J(function(){return new pb});rc.pool=new J(function(){return new rc});Qb.pool=new J(function(){return new Qb});Rb.pool=new J(function(){return new Rb});sc.pool=new J(function(){return new sc});Eb.pool=new J(function(){return new Eb});tc.pool=new J(function(){return new tc});uc.pool=new J(function(){return new uc});vc.pool=new J(function(){return new vc});Db.pool=new J(function(){return new Db});xc.pool=new J(function(){return new xc});wc.pool=new J(function(){return new wc});qb._helperVec2=new G;
yc.pool=new J(function(){return new yc});zc.pool=new J(function(){return new zc});Ac.pool=new J(function(){return new Ac});Bc.pool=new J(function(){return new Bc});xa._pool=new ka(function(){return new xa});xa.instance=new xa;Cc.pool=new J(function(){return new Cc});Pb.pool=new J(function(){return new Pb});Dc.pool=new J(function(){return new Dc});Ec.pool=new J(function(){return new Ec});Fc.pool=new J(function(){return new Fc});F._layer=[];F._history=[];la.SCALE_PRESS=.95;la.TIME_PRESS=.1;la.TIME_RELEASE=
.2;Rc.success=!1;Ta.USE_CACHE=!1;Ta.USE_ENUM_INDEX=!1;Ta.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:";db.DEFAULT_RESOLVER=new Vd;db.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:";kb.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";kb.BYTES=Aa.ofString(kb.CHARS);hd.helper=new DataView(new ArrayBuffer(8));Gb.escapes=function(a){a=new K;null!=p.lt?a.setReserved("lt","<"):a.h.lt="<";null!=p.gt?a.setReserved("gt",">"):a.h.gt=
">";null!=p.amp?a.setReserved("amp","&"):a.h.amp="&";null!=p.quot?a.setReserved("quot",'"'):a.h.quot='"';null!=p.apos?a.setReserved("apos","'"):a.h.apos="'";return a}(this);Ua._id=0;Ua._c=new E(1,0,0,1);wd.instance=new wd;m.randomInstance=new md;D._lines=new J(function(){return new qf});D._triangles=new J(function(){return new sf});D._planes=new J(function(){return new rf});D._circles=new J(function(){return new pf});D.editorMode=!1;D.isPlaying=!0;D.buffer=new tf;D._enabled=!1;D._list=new N;D._cleared=
!0;Ib.systemDispatcher=new H;Ib.focus=!0;ha._custom=ha.getnow;ha._offset=0;B.complete=new B("complete");B.init=new B("init");B.data=new B("data");B.update=new B("update");B.delete=new B("delete");B.focus=new B("focus");B.blur=new B("blur");Bb.onLoad=new Bb("onLoad");Oa.onUpdate=new Oa("onUpdate");Wb.onUpdate=new Wb("onUpdate");Sb.onUpdate=new Sb("onUpdate");va.init=new va("init");va.update=new va("update");va.resize=new va("resize");va.fullScreen=new va("fullScreen");Va.holdTime=.7;Va.onEvent=new H;
Va._id=1;Tb.onUpdate=new Tb("touchUpdate");id.TYPE=-1629174247;jd.TYPE_USER=1716666723;hb._pool=new J(function(){return new hb});ia.buildVersion=(new Date(2019,8,26,19,1,27)).getTime()|0;ia.version=(new Date(2019,8,26,19,1,27)).getTime()|0;Wa.onEvent=new H;Wa._id=1;q.touchCount=0;q.maxTouchId=-1;q._init=!1;q._touchBuffer=new N;q._touchsWithIndex=new N;q._touchsWithTouchId=new N;q._touchDown=new N;q._touchUp=new N;q._touchPool=new J(function(){return new Va});q._keyPool=new J(function(){return new Wa});
q._keyBuffer=new N;q._activeKeys=new ba;q._keyDownList=new N;q._keyUpList=new N;C.fixedTime=.02;C.frame=0;C.time=0;C.deltaTime=0;C.smoothDeltaTime=C.fixedTime;C.fixedCount=0;C._offset=0;C._blurTime=0;C._focused=!0;C._time=0;C._fixedTime=0;Ba._bufferMap=new ba;Ba._id=0;xd._pool=new ka(function(){return new xd});Da.width=1138;Da.height=640;Hc.__meta__={obj:{allowMulti:null}};Ob._id=0;Ob.temp=new J(function(){return new Ob});Fa.__meta__={obj:{once:null}};Na._dir=new h;Na._temp=new h;Ka._list=T.fromArray([]);
Sc.instance=new Sc;Ub.tokenLeft="[";Ub.tokenRight="]";Ad._pool=new ka(function(){return new Ub});Y.defaultSize=20;Y._parse=new Ad;Y._charpool=new ka(function(){return new Nf});Y._linepool=new ka(function(){return new Of});t.onUpdate=new t("onUpdate");t.onLateUpdate=new t("onLateUpdate");t.onFixedUpdate=new t("onFixedUpdate");t.onTransform=new t("onTransform");t.onRectTransform=new t("onRectTransform");t.onTransformComplete=new t("onTransformComplete");t.onEnable=new t("onEnable");t.onDisable=new t("onDisable");
t.onAdded=new t("onAdded");t.onRemoved=new t("onRemoved");t.onCollectChildren=new t("onCollectChildren");t.onCollectChildrenComplete=new t("onCollectChildrenComplete");t.onScreenResize=new t("onScreenResize");t.onCameraUpdate=new t("onCameraUpdate");t.onPreRender=new t("onPreRender");t.onPostRender=new t("onPostRender");t.onTouchBegin=new Qc("onTouchBegin");t.onTouchEnd=new Qc("onTouchEnd");Cb._id=0;Xb.pressDelay=.04;Cd._id=0;Dd._id=0;Ha._fnv=gb.instance;Ha._programMap=new ba;Ha.uniformPool=new J(function(){return new Dd});
Ha.attributePool=new J(function(){return new Cd});Q._map=new K;Q._precision=new Uf;Q._extension=new N;Q._ifdef=new N;Sa.pool=new J(function(){return new Sa});Sa._id=0;Sa._tempList=[];sa._clearColor=new E(0,0,0,0);S._pool=new ka(function(){return new S});S._clearRenderTarget=new ka(function(){return new Yf});S._setViewport=new ka(function(){return new dg});S._pushRenderTarget=new ka(function(){return new bg});S._popRenderTarget=new ka(function(){return new ag});S._blit=new ka(function(){return new sa});
S._callback=new ka(function(){return new Xf});S._draw=new ka(function(){return new $f});S._setProperty=new ka(function(){return new cg});S._copyProperty=new ka(function(){return new Zf});S._buffers=T.fromArray([]);Xa._pool=new ka(function(){return new Xa});tb._pool=new ka(function(){return new tb});tb._v30=new h;ub._tempList=[];ub._id=1;Jc._id=1;qa._fnv=gb.instance;Ic._id=1;Ic._tempList=new K;Kb._map=new K;Yb._fnv=new gb;V._list=T.fromArray([]);V._map=new ba;yb._infoMap=new gd;aa._id=0;ja._addList=
new N;ja._triggerList=new N;ja._endList=new N;ya.onBegin=new H;ya.focus=!1;ya.onWheel=new H;od.main()})("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
