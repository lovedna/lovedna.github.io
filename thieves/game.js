var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(B,W,n){B!=Array.prototype&&B!=Object.prototype&&(B[W]=n.value)};$jscomp.getGlobal=function(B){return"undefined"!=typeof window&&window===B?B:"undefined"!=typeof global&&null!=global?global:B};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(B,W,n,g){if(W){n=$jscomp.global;B=B.split(".");for(g=0;g<B.length-1;g++){var gb=B[g];gb in n||(n[gb]={});n=n[gb]}B=B[B.length-1];g=n[B];W=W(g);W!=g&&null!=W&&$jscomp.defineProperty(n,B,{configurable:!0,writable:!0,value:W})}};
$jscomp.polyfill("String.fromCodePoint",function(B){return B?B:function(B){for(var n="",g=0;g<arguments.length;g++){var W=Number(arguments[g]);if(0>W||1114111<W||W!==Math.floor(W))throw new RangeError("invalid_code_point "+W);65535>=W?n+=String.fromCharCode(W):(W-=65536,n+=String.fromCharCode(W>>>10&1023|55296),n+=String.fromCharCode(W&1023|56320))}return n}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var B=0;return function(W){return $jscomp.SYMBOL_PREFIX+(W||"")+B++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var B=$jscomp.global.Symbol.iterator;B||(B=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[B]&&$jscomp.defineProperty(Array.prototype,B,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(B){var W=0;return $jscomp.iteratorPrototype(function(){return W<B.length?{done:!1,value:B[W++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(B){$jscomp.initSymbolIterator();B={next:B};B[$jscomp.global.Symbol.iterator]=function(){return this};return B};$jscomp.iteratorFromArray=function(B,W){$jscomp.initSymbolIterator();B instanceof String&&(B+="");var n=0,g={next:function(){if(n<B.length){var gb=n++;return{value:W(gb,B[gb]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill("Array.prototype.keys",function(B){return B?B:function(){return $jscomp.iteratorFromArray(this,function(B){return B})}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(B){return B?B:function(B,n,g){var W=this.length||0;0>n&&(n=Math.max(0,W+n));if(null==g||g>W)g=W;g=Number(g);0>g&&(g=Math.max(0,W+g));for(n=Number(n||0);n<g;n++)this[n]=B;return this}},"es6","es3");
$jscomp.checkStringArgs=function(B,W,n){if(null==B)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(W instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return B+""};
$jscomp.polyfill("String.prototype.endsWith",function(B){return B?B:function(B,n){var g=$jscomp.checkStringArgs(this,B,"endsWith");B+="";void 0===n&&(n=g.length);n=Math.max(0,Math.min(n|0,g.length));for(var W=B.length;0<W&&0<n;)if(g[--n]!=B[--W])return!1;return 0>=W}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(B){return B?B:function(B,n){var g=$jscomp.checkStringArgs(this,B,"startsWith");B+="";var W=g.length,ha=B.length;n=Math.max(0,Math.min(n|0,g.length));for(var Ra=0;Ra<ha&&n<W;)if(g[n++]!=B[Ra++])return!1;return Ra>=ha}},"es6","es3");
(function(B,W){function n(a,b){a=Object.create(a);for(var c in b)a[c]=b[c];b.toString!==Object.prototype.toString&&(a.toString=b.toString);return a}function g(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=W.$haxeUID++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=b.bind(a),a.hx__closures__[b.__id__]=c);return c}B.lovedna=B.lovedna||{};B.lovedna.game=B.lovedna.game||{};var gb={},ha=function(){return aa.__string_rec(this,"")},Ra=Ra||{},P,y=function(){};
y.strDate=function(a){switch(a.length){case 8:a=a.split(":");var b=new Date;b.setTime(0);b.setUTCHours(a[0]);b.setUTCMinutes(a[1]);b.setUTCSeconds(a[2]);return b;case 10:return a=a.split("-"),new Date(a[0],a[1]-1,a[2],0,0,0);case 19:return b=a.split(" "),a=b[0].split("-"),b=b[1].split(":"),new Date(a[0],a[1]-1,a[2],b[0],b[1],b[2]);default:throw new w("Invalid date format : "+a);}};y.cca=function(a,b){a=a.charCodeAt(b);if(a==a)return a};y.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==
b)c=a.length+c;else return"";return a.substr(b,c)};y.remove=function(a,b){b=a.indexOf(b);if(-1==b)return!1;a.splice(b,1);return!0};y.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var ja=function(){};ja.field=function(a,b){try{return a[b]}catch(c){return null}};ja.getProperty=function(a,b){var c;if(null==a)return null;var d=a.__properties__?c=a.__properties__["get_"+b]:!1;return d?a[c]():a[b]};ja.setProperty=function(a,
b,c){var d;var e=a.__properties__?d=a.__properties__["set_"+b]:!1;if(e)a[d](c);else a[b]=c};ja.fields=function(a){var b=[];if(null!=a){var c=Object.prototype.hasOwnProperty,d;for(d in a)"__id__"!=d&&"hx__closures__"!=d&&c.call(a,d)&&b.push(d)}return b};ja.isFunction=function(a){return"function"==typeof a?!(a.__name__||a.__ename__):!1};ja.isObject=function(a){if(null==a)return!1;var b=typeof a;return"string"==b||"object"==b&&null==a.__enum__?!0:"function"==b?null!=(a.__name__||a.__ename__):!1};ja.deleteField=
function(a,b){if(!Object.prototype.hasOwnProperty.call(a,b))return!1;delete a[b];return!0};var ma=function(){};ma.string=function(a){return aa.__string_rec(a,"")};ma.parseInt=function(a){a=parseInt(a,!a||"0"!=a[0]||"x"!=a[1]&&"X"!=a[1]?10:16);return isNaN(a)?null:a};var Nb=function(){this.b=""};Nb.prototype={};var ia=function(){};ia.htmlEscape=function(a,b){for(var c="",d=0;d<a.length;){var e=a,f=d++,l=e.charCodeAt(f);55296<=l&&56319>=l&&(l=l-55232<<10|e.charCodeAt(f+1)&1023);e=l;65536<=e&&++d;switch(e){case 34:c=
b?c+"&quot;":c+String.fromCodePoint(e);break;case 38:c+="&amp;";break;case 39:c=b?c+"&#039;":c+String.fromCodePoint(e);break;case 60:c+="&lt;";break;case 62:c+="&gt;";break;default:c+=String.fromCodePoint(e)}}return c};ia.startsWith=function(a,b){return a.length>=b.length?0==a.lastIndexOf(b,0):!1};ia.endsWith=function(a,b){var c=b.length,d=a.length;return d>=c?a.indexOf(b,d-c)==d-c:!1};ia.isSpace=function(a,b){a=y.cca(a,b);return 8<a&&14>a?!0:32==a};ia.ltrim=function(a){for(var b=a.length,c=0;c<b&&
ia.isSpace(a,c);)++c;return 0<c?y.substr(a,c,b-c):a};ia.rtrim=function(a){for(var b=a.length,c=0;c<b&&ia.isSpace(a,b-c-1);)++c;return 0<c?y.substr(a,0,b-c):a};ia.trim=function(a){return ia.ltrim(ia.rtrim(a))};ia.replace=function(a,b,c){return a.split(b).join(c)};ia.hex=function(a,b){for(var c="";c="0123456789ABCDEF".charAt(a&15)+c,a>>>=4,0<a;);if(null!=b)for(;c.length<b;)c="0"+c;return c};var hb=Ra.ValueType={__ename__:"ValueType",__constructs__:"TNull TInt TFloat TBool TObject TFunction TClass TEnum TUnknown".split(" "),
TNull:{_hx_index:0,__enum__:"ValueType",toString:ha},TInt:{_hx_index:1,__enum__:"ValueType",toString:ha},TFloat:{_hx_index:2,__enum__:"ValueType",toString:ha},TBool:{_hx_index:3,__enum__:"ValueType",toString:ha},TObject:{_hx_index:4,__enum__:"ValueType",toString:ha},TFunction:{_hx_index:5,__enum__:"ValueType",toString:ha},TClass:(P=function(a){return{_hx_index:6,c:a,__enum__:"ValueType",toString:ha}},P.__params__=["c"],P),TEnum:(P=function(a){return{_hx_index:7,e:a,__enum__:"ValueType",toString:ha}},
P.__params__=["e"],P),TUnknown:{_hx_index:8,__enum__:"ValueType",toString:ha}},Cb=function(){};Cb.createInstance=function(a,b){return new (Function.prototype.bind.apply(a,[null].concat(b)))};Cb.createEnum=function(a,b,c){var d=ja.field(a,b);if(null==d)throw new w("No such constructor "+b);if(ja.isFunction(d)){if(null==c)throw new w("Constructor "+b+" need parameters");return d.apply(a,c)}if(null!=c&&0!=c.length)throw new w("Constructor "+b+" does not need parameters");return d};Cb.typeof=function(a){switch(typeof a){case "boolean":return hb.TBool;
case "function":return a.__name__||a.__ename__?hb.TObject:hb.TFunction;case "number":return Math.ceil(a)==a%2147483648?hb.TInt:hb.TFloat;case "object":if(null==a)return hb.TNull;var b=a.__enum__;if(null!=b)return hb.TEnum(Ra[b]);a=aa.getClass(a);return null!=a?hb.TClass(a):hb.TObject;case "string":return hb.TClass(String);case "undefined":return hb.TNull;default:return hb.TUnknown}};Cb.enumParameters=function(a){var b=Ra[a.__enum__];b=b[b.__constructs__[a._hx_index]].__params__;if(null!=b){for(var c=
[],d=0;d<b.length;){var e=b[d];++d;c.push(a[e])}return c}return[]};var ta={gt:function(a,b){var c=0>a;return c!=0>b?c:a>b},gte:function(a,b){var c=0>a;return c!=0>b?c:a>=b},toFloat:function(a){return 0>a?4294967296+a:a+0}},ka={toString:function(a){switch(a){case 0:return"Element";case 1:return"PCData";case 2:return"CData";case 3:return"Comment";case 4:return"DocType";case 5:return"ProcessingInstruction";case 6:return"Document"}}},x=function(a){this.nodeType=a;this.children=[];this.attributeMap=new L};
x.parse=function(a){return Ob.parse(a)};x.createElement=function(a){var b=new x(x.Element);if(b.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(b.nodeType));b.nodeName=a;return b};x.createPCData=function(a){var b=new x(x.PCData);if(b.nodeType==x.Document||b.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(b.nodeType));b.nodeValue=a;return b};x.createCData=function(a){var b=new x(x.CData);if(b.nodeType==x.Document||b.nodeType==x.Element)throw new w("Bad node type, unexpected "+
ka.toString(b.nodeType));b.nodeValue=a;return b};x.createComment=function(a){var b=new x(x.Comment);if(b.nodeType==x.Document||b.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(b.nodeType));b.nodeValue=a;return b};x.createDocType=function(a){var b=new x(x.DocType);if(b.nodeType==x.Document||b.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(b.nodeType));b.nodeValue=a;return b};x.createProcessingInstruction=function(a){var b=new x(x.ProcessingInstruction);
if(b.nodeType==x.Document||b.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(b.nodeType));b.nodeValue=a;return b};x.createDocument=function(){return new x(x.Document)};x.prototype={get:function(a){if(this.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(this.nodeType));var b=this.attributeMap;return null!=q[a]?b.getReserved(a):b.h[a]},set:function(a,b){if(this.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+
ka.toString(this.nodeType));var c=this.attributeMap;null!=q[a]?c.setReserved(a,b):c.h[a]=b},exists:function(a){if(this.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(this.nodeType));var b=this.attributeMap;return null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a)},attributes:function(){if(this.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(this.nodeType));return this.attributeMap.keys()},elements:function(){if(this.nodeType!=
x.Document&&this.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+ka.toString(this.nodeType));for(var a=[],b=0,c=this.children;b<c.length;){var d=c[b];++b;d.nodeType==x.Element&&a.push(d)}return y.iter(a)},firstElement:function(){if(this.nodeType!=x.Document&&this.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+ka.toString(this.nodeType));for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;if(c.nodeType==x.Element)return c}return null},
addChild:function(a){if(this.nodeType!=x.Document&&this.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+ka.toString(this.nodeType));null!=a.parent&&a.parent.removeChild(a);this.children.push(a);a.parent=this},removeChild:function(a){if(this.nodeType!=x.Document&&this.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+ka.toString(this.nodeType));return y.remove(this.children,a)?(a.parent=null,!0):!1},toString:function(){return yd.print(this)}};
var mb=function(){this.__constructed=!1;this.__constructed||(this.__constructed=!0,this.instanceID=mb._id++,this.onConstruct())};mb.prototype={getInstanceID:function(){return this.instanceID},onConstruct:function(){}};var I=function(a){mb.call(this);null!=a&&(this.__targetDispatcher=a)};I.prototype=n(mb.prototype,{dispose:function(){this.__targetDispatcher=null;if(null!=this.__eventMap){var a=this.__eventMap;for(a=new Pb(a,a.arrayKeys());a.hasNext();)for(var b=a.next(),c=0;c<b.length;){var d=b[c];
++c;d.dispose()}this.__eventMap=null}},addEventListener:function(a,b,c){null==c&&(c=0);if(null!=b){null==this.__eventMap&&(this.__eventMap=new L);var d=this.__eventMap;if(null!=q[a]?d.existsReserved(a):d.h.hasOwnProperty(a)){d=this.__eventMap;a=null!=q[a]?d.getReserved(a):d.h[a];d=0;for(var e=a.length;d<e;){var f=d++;if(a[f].callback==b)return}this.__addListenerByPriority(a,new Td(b,c))}else d=[],d.push(new Td(b,c)),b=this.__eventMap,null!=q[a]?b.setReserved(a,d):b.h[a]=d}},dispatchEvent:function(a){if(null==
this.__eventMap||null==a)return!0;var b=a._type,c=this.__eventMap;if(null!=q[b]?!c.existsReserved(b):!c.h.hasOwnProperty(b))return!1;c=this.__eventMap;c=null!=q[b]?c.getReserved(b):c.h[b];if(null==c)return!0;null==a.target&&(a.target=null!=this.__targetDispatcher?this.__targetDispatcher:this);b=this.__getTempList();b.fromList(c);c=0;for(var d=b.get_length();c<d;){var e=c++;e=b.getArrayElement(e);null!=e&&null!=e.callback&&(a.currentTarget=this,a.target=this,e.callback(a))}I._temp.push(b);return!0},
removeEventListener:function(a,b){if(null!=this.__eventMap&&null!=b){var c=this.__eventMap;c=null!=q[a]?c.getReserved(a):c.h[a];if(null!=c){for(var d=c.length;0<d--;)c[d].callback==b&&c.splice(d,1);0==c.length&&this.__eventMap.remove(a)}}},__addListenerByPriority:function(a,b){for(var c=a.length,d=c,e=0;e<c;){var f=e++;if(a[f].priority<b.priority){d=f;break}}a.splice(d,0,b)},__getTempList:function(){return 0<I._temp.length?I._temp.pop():new S}});var da=function(){I.call(this);this.glcontext=new ue;
da.gl=this.glcontext;this.devicePixelRatio=1;this.frameTime=.01639344262295082;this.stencil=this.depth=!0;this._capture={capture:!1,passive:!1};this._initDelay=new ba(g(this,this.init));this._inited=!1;this._focusDelay=new ba(g(this,this.focus1));this._touchManager=new Ua(!1);this._touch=new db;for(var a=["blur","focus","beforeunload","resize"],b=0;b<a.length;){var c=a[b];++b;window.addEventListener(c,g(this,this.handleWindowEvent),this._capture)}this._keyManager=cc.getInstance();this._key=new Va;
window.addEventListener("keydown",g(this,this.handleKeyEvent),this._capture);window.addEventListener("keyup",g(this,this.handleKeyEvent),this._capture);a=["ms","moz","webkit","o"];for(b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];this._frame=0;this._active=!0;this._now=oa._custom();this._setTimeoutMode=null!=window.requestAnimationFrame?
!1:!0;this.tick();window.oncontextmenu=function(a){a.preventDefault()};this.requestedFullscreen=this.isFullscreen=!1;this._wheelDelta=new h;this._mouseEventB32=new ib(0);da.frame=0};da.prototype=n(I.prototype,{setup:function(a){if(null!=a){if(Q.exist(a,"canvas")){var b=Q.getValue(a,"canvas");if(null!=b){this._canvas_webgl=b;this.setupTouchInput(this._canvas_webgl);this.depth=Q.getBool(a,"depth",!0);this.stencil=Q.getBool(a,"stencil",!0);this.devicePixelRatio=Q.getFloat(a,"devicePixelRatio",1);b={alpha:Q.getBool(a,
"alpha",!0),antialias:Q.getBool(a,"alpha",!1),depth:this.depth,premultipliedAlpha:Q.getBool(a,"premultipliedAlpha",!0),stencil:this.stencil,preserveDrawingBuffer:Q.getBool(a,"preserveDrawingBuffer",!1)};var c=["webgl","experimental-webgl"];2==Q.getInt(a,"webgl")&&c.unshift("webgl2");for(var d=null,e=1,f=0,l=c.length;f<l;){d=f++;var g=c[d];d=this._canvas_webgl.getContext(g,b);if(null!=d){"webgl2"==g&&(e=2);break}}null!=d&&(this._inited||ba.add(this._initDelay,.1),da.gl.setup(d,e),d.getExtension("OES_standard_derivatives"),
d.getExtension("GL_EXT_shader_texture_lod"),d.pixelStorei(37441,1))}}Q.exist(a,"input")&&(a=Q.getValue(a,"input"),this.setupTouchInput(a))}},setFPS:function(a){this.frameTime=0>=a?0:1/a},setFullscreen:function(a){var b=window.document;a?this.requestedFullscreen||this.isFullscreen||(this.requestedFullscreen=!0,(P=this._inputElement,g(P,P.requestFullscreen))?(b.addEventListener("fullscreenchange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("fullscreenerror",g(this,this.handleFullscreenEvent),
this._capture),this._inputElement.requestFullscreen()):this._inputElement.mozRequestFullScreen?(b.addEventListener("mozfullscreenchange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("mozfullscreenerror",g(this,this.handleFullscreenEvent),this._capture),this._inputElement.mozRequestFullScreen()):this._inputElement.webkitRequestFullscreen?(b.addEventListener("webkitfullscreenchange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("webkitfullscreenerror",
g(this,this.handleFullscreenEvent),this._capture),this._inputElement.webkitRequestFullscreen()):this._inputElement.msRequestFullscreen&&(b.addEventListener("MSFullscreenChange",g(this,this.handleFullscreenEvent),this._capture),b.addEventListener("MSFullscreenError",g(this,this.handleFullscreenEvent),this._capture),this._inputElement.msRequestFullscreen())):this.isFullscreen&&(this.requestedFullscreen=!1,g(b,b.exitFullscreen)?b.exitFullscreen():b.mozCancelFullScreen?b.mozCancelFullScreen():b.webkitExitFullscreen?
b.webkitExitFullscreen():b.msExitFullscreen&&b.msExitFullscreen())},blur:function(){this._active=!1;this._frame=0;Sa.focus=!1;Sa.systemDispatcher.dispatchEvent(C.blur);this._focusDelay.stop();Ua.focus=!1},focus:function(){this._focusDelay.stop();this._focusDelay.start(.1)},init:function(){this._inited||(this._inited=!0,this.height=this.width=da.frame=0,Ua.focus=!0,this.checkSize(),this.dispatchEvent(ua.init))},setupTouchInput:function(a){null!=a&&this._inputElement!=a&&(null!=this._inputElement&&
this.touchdisconnect(),this._inputElement=a,this.touchconnect())},touchconnect:function(){var a=new jb,b=this._inputElement.id;null==b&&(b=(new fd).get()+"");a.addString(b);this._touch.device=a.getCode();a="mousedown mouseenter mouseleave mousemove mouseup wheel".split(" ");for(b=0;b<a.length;){var c=a[b];++b;this._inputElement.addEventListener(c,g(this,this.handleMouseEvent),this._capture)}a=["touchstart","touchmove","touchend","touchcancel"];for(b=0;b<a.length;)c=a[b],++b,this._inputElement.addEventListener(c,
g(this,this.handleTouchEvent),this._capture)},touchdisconnect:function(){for(var a="mousedown mouseenter mouseleave mousemove mouseup wheel".split(" "),b=0;b<a.length;){var c=a[b];++b;this._inputElement.removeEventListener(c,g(this,this.handleMouseEvent))}a=["touchstart","touchmove","touchend","touchcancel"];for(b=0;b<a.length;)c=a[b],++b,this._inputElement.removeEventListener(c,g(this,this.handleTouchEvent))},handleMouseEvent:function(a){null!=a.stopImmediatePropagation&&a.stopImmediatePropagation();
a.stopPropagation();a.preventDefault();0==this._touchManager.touchType&&(this._touchManager.touchType=1);if(1==this._touchManager.touchType){var b=a.type;this._touch.position.set(0,0,0);this._touch.pressure=-1;this._mouseEventB32.value=a.buttons;if("wheel"!=b){var c=this._inputElement.getBoundingClientRect();this._touch.position.set(a.offsetX/c.width,a.offsetY/c.height,0);"mousemove"==b?ta.gt(this._mouseEventB32.value,0)&&(this._mouseEventB32.getArrayElement(0)&&(this._touch.touchId=0,this._touchManager.move(this._touch)),
this._mouseEventB32.getArrayElement(1)&&(this._touch.touchId=2,this._touchManager.move(this._touch)),this._mouseEventB32.getArrayElement(2)&&(this._touch.touchId=1,this._touchManager.move(this._touch))):"mouseenter"==b&&(this._touch.touchId=0);"mousedown"==b&&(this._touch.touchId=a.button,this._touchManager.begin(this._touch));"mouseup"==b&&(this._touch.touchId=a.button,this._touchManager.end(this._touch));"mouseleave"==b&&(this._mouseEventB32.getArrayElement(0)&&(this._touch.touchId=0,this._touchManager.cancel(this._touch)),
this._mouseEventB32.getArrayElement(1)&&(this._touch.touchId=2,this._touchManager.cancel(this._touch)),this._mouseEventB32.getArrayElement(2)&&(this._touch.touchId=1,this._touchManager.cancel(this._touch)))}else null!=a&&(this._wheelDelta.set(a.deltaX,a.deltaY,a.deltaZ),this._touchManager.wheel(a.deltaMode,this._wheelDelta))}},handleTouchEvent:function(a){this._active||this._focusDelay.start(.1);a.stopPropagation();a.preventDefault();null!=a.stopImmediatePropagation&&a.stopImmediatePropagation();
0==this._touchManager.touchType&&(this._touchManager.touchType=2);if(2==this._touchManager.touchType){var b=a.type,c=this._inputElement.getBoundingClientRect();this._touch.position.set(0,0);var d=this._touch.touchId=0;for(a=a.changedTouches;d<a.length;){var e=a[d];++d;this._touch.position.set((e.clientX-c.left)/c.width,(e.clientY-c.top)/c.height,0);this._touch.touchId=e.identifier;this._touch.pressure=e.force;"touchmove"==b?this._touchManager.move(this._touch):"touchstart"==b?this._touchManager.begin(this._touch):
"touchend"==b?this._touchManager.end(this._touch):"touchcancel"==b&&this._touchManager.cancel(this._touch)}}},handleWindowEvent:function(a){a=a.type;"focus"==a?this.focus():"resize"!=a&&"blur"==a&&this.blur()},focus1:function(){Sa.focus=!0;Sa.systemDispatcher.dispatchEvent(C.focus);this._active=!0},tick:function(){var a=!0;if(0<this.frameTime){var b=oa._custom(),c=b-this._now;c>=this.frameTime&&(this._now=b-c%this.frameTime,a=!0)}this._active&&a&&(this._frame++,da.frame++,this.checkSize(),this.dispatchEvent(ua.update));
this._setTimeoutMode?gd.delay(g(this,this.tick),p.floatToInt(1E3*this.frameTime)):window.requestAnimationFrame(g(this,this.tick));ra.reset()},checkSize:function(){if(this._inited){if(null!=this._canvas_webgl){var a=this._canvas_webgl.width;var b=this._canvas_webgl.height}else a=window.innerWidth,b=window.innerHeight;if(this.width!=a||this.height!=b)this.width=p.floatToInt(a),this.height=p.floatToInt(b),ua.resize.vintlist[0]=this.width,ua.resize.vintlist[1]=this.height,this.dispatchEvent(ua.resize),
Sa.systemDispatcher.dispatchEvent(ua.resize)}},handleFullscreenEvent:function(a){a=window.document;this.requestedFullscreen=!1;if(null!=(a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement))a=!0;else{a=!1;for(var b=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],c=["fullscreenerror","mozfullscreenerror","webkitfullscreenerror","MSFullscreenError"],d=0,e=b.length;d<e;){var f=d++;window.document.removeEventListener(b[f],
g(this,this.handleFullscreenEvent),this._capture);window.document.removeEventListener(c[f],g(this,this.handleFullscreenEvent),this._capture)}}a!=this.isFullscreen&&(this.isFullscreen=a,ua.resize.vbool=this.isFullscreen,this.dispatchEvent(ua.fullScreen))},handleKeyEvent:function(a){this._key.deviceType=0;this._key.deviceId=0;this._key.keyCode=a.keyCode;this._key.key=a.key;this._key.value=0;this._key.modifier.value=0;this._key.modifier.setArrayElement(3,a.altKey);this._key.modifier.setArrayElement(2,
a.ctrlKey);this._key.modifier.setArrayElement(1,a.shiftKey);this._key.modifier.setArrayElement(4,a.metaKey);this._key.type="keydown"==a.type?1:2;this._keyManager.keyTrigger(this._key)}});var ue=function(){};ue.prototype={setup:function(a,b){this.gl=a;this.version=b}};var Qb=function(){this.enabled=!1;this.id=Qb._id++;this.params=new ve};Qb.prototype={unload:function(){this.enabled=!1;this.data=null},setData:function(a){this.data=a;this.enabled=!0;this._time=oa._custom()},bind:function(a){this._time=
oa._custom();return!1}};var hd=function(){Qb.call(this);this.params.type=3553;this._uploadFrame=0};hd.prototype=n(Qb.prototype,{setData:function(a){Qb.prototype.setData.call(this,a);null!=this.data&&(this.data instanceof Zc&&(a=this.data,this.width=a.width,this.height=a.height),this.data instanceof HTMLImageElement?(a=this.data,this.width=a.width,this.height=a.height):this.data instanceof HTMLCanvasElement?(a=this.data,this.width=a.width,this.height=a.height):this.data instanceof HTMLVideoElement&&
(a=this.data,this.width=a.width,this.height=a.height))},unload:function(){Qb.prototype.unload.call(this);null!=this._texture&&(da.gl.gl.deleteTexture(this._texture),this._texture=null)},bind:function(a){null==a&&(a=0);Qb.prototype.bind.call(this,a);if(!this.enabled||0==this.width||0==this.height)return!1;if(null!=this.data)return this._uploadFrame=da.frame,this.upload(),!1;if(null!=this._texture){if(this._uploadFrame==da.frame)return!1;da.gl.gl.activeTexture(33984+a);da.gl.gl.bindTexture(this.params.type,
this._texture);this.params.bind();return!0}return!1},upload:function(){null==this._texture&&(this._texture=da.gl.gl.createTexture());da.gl.gl.bindTexture(this.params.type,this._texture);var a=null;if(null!=this.data){var b=!1;this.data instanceof Zc&&(a=this.data,this.data=a.data);if(this.data instanceof HTMLImageElement){var c=this.data;this.width=c.width;this.height=c.height;0!=this.width&&0!=this.height&&(da.gl.gl.texImage2D(this.params.type,0,this.params.format,this.params.format,5121,c),b=!0)}else this.data instanceof
HTMLCanvasElement?(c=this.data,this.width=c.width,this.height=c.height,0!=this.width&&0!=this.height&&(da.gl.gl.texImage2D(this.params.type,0,this.params.format,this.params.format,5121,c),b=!0)):this.data instanceof HTMLVideoElement&&(c=this.data,this.width=c.width,this.height=c.height,0!=this.width&&0!=this.height&&(da.gl.gl.texImage2D(this.params.type,0,this.params.format,this.params.format,5121,c),b=!0));this.updateParams();this.data=null;null!=a&&a.dispose();return b}return!1},updateParams:function(){this.params.dirty=
!0;this.params.setSize(this.width,this.height)}});var id=function(a,b,c){null==c&&(c=16);null==b&&(b=0);null==a&&(a=256);this._depth=16;hd.call(this);this.width=a;this.height=b;0>=this.height&&(this.height=this.width);this.enabled=!0;this._depth=c};id.prototype=n(hd.prototype,{bindBuffer:function(){if(null==this._frameBuffer){this._frameBuffer=da.gl.gl.createFramebuffer();da.gl.gl.bindFramebuffer(36160,this._frameBuffer);this._renderBuffer=da.gl.gl.createRenderbuffer();da.gl.gl.bindRenderbuffer(36161,
this._renderBuffer);24==this._depth?(da.gl.gl.renderbufferStorage(36161,34041,this.width,this.height),da.gl.gl.framebufferRenderbuffer(36160,33306,36161,this._renderBuffer)):16==this._depth&&(da.gl.gl.renderbufferStorage(36161,33189,this.width,this.height),da.gl.gl.framebufferRenderbuffer(36160,36096,36161,this._renderBuffer));this.params.mipmap=!1;this.upload();da.gl.gl.framebufferTexture2D(36160,36064,3553,this._texture,0);da.gl.gl.texImage2D(3553,0,6408,this.width,this.height,0,6408,5121,null);
da.gl.gl.bindRenderbuffer(36161,null);this.updateParams();da.gl.gl.clearDepth(1);da.gl.gl.clearStencil(0);da.gl.gl.clearColor(1,1,1,0);var a=16384;0<this._depth&&(a|=256);16<this._depth&&(a|=1024);da.gl.gl.clear(a)}da.gl.gl.bindFramebuffer(36160,this._frameBuffer);da.gl.gl.bindRenderbuffer(36161,this._renderBuffer)},bind:function(a){null==a&&(a=0);return hd.prototype.bind.call(this,a)},unload:function(){null!=this._frameBuffer&&(da.gl.gl.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null);
null!=this._renderBuffer&&(da.gl.gl.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null)}});var ab=function(){I.call(this);this._loaded=this.enabled=!1};ab.prototype=n(I.prototype,{fromUrl:function(a){this._loaded=!1;this.setup();this.enabled=!1;this.audio.src=a},play:function(){this.enabled&&this.audio.play()},pause:function(){this.enabled&&this.audio.pause()},setRate:function(a){},setLoop:function(a){this.enabled&&(this.audio.loop=a)},setVolume:function(a){this.enabled&&(this.audio.volume=
a)},setSeek:function(a){!this.enabled||a>this.audio.duration||(this.audio.currentTime=a)},getPlaying:function(){return this.enabled?!1:!this.audio.paused},setup:function(){if(null==this.audio){this.audio=new Audio;this.audio.crossOrigin="Anonymous";for(var a=ab._elist.length;0<a--;)this.audio.addEventListener(ab._elist[a],g(this,this.onEvent));if(null==ab._emap)for(ab._emap=new L,a=ab._elist.length;0<a--;){var b=ab._eaction[a];if(!(0>b)){var c=ab._emap,d=ab._elist[a];null!=q[d]?c.setReserved(d,b):
c.h[d]=b}}}},onEvent:function(a){a=a.type;if("canplaythrough"==a){this.length=this.audio.duration;this.enabled=!0;if(this._loaded)return;this._loaded=!0}var b=ab._emap;if(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a)){b=Db.onUpdate;var c=ab._emap;b.action=null!=q[a]?c.getReserved(a):c.h[a];this.dispatchEvent(b)}}});(function(){mb.call(this)}).prototype=n(mb.prototype,{dispose:function(){null!=this._howl&&(this._howl.off("end",g(this,this._end),this.id),this._howl.off("play",g(this,this._play),
this.id),this._howl.off("pause",g(this,this._pause),this.id),this._howl.off("stop",g(this,this._stop),this.id),this._howl.off("rate",g(this,this._rate),this.id),this._howl.off("seek",g(this,this._seek),this.id),this.clip=this._howl=null,this.id=-1)},_end:function(){this._event.id=this.id;this._event.action=2;this.clip.dispatchEvent(this._event)},_play:function(){this._event.id=this.id;this._event.action=1;this.clip.dispatchEvent(this._event)},_pause:function(){this._event.id=this.id;this._event.action=
3;this.clip.dispatchEvent(this._event)},_stop:function(){this._event.id=this.id;this._event.action=4;this.clip.dispatchEvent(this._event)},_rate:function(){this._event.id=this.id;this._event.action=5;this.clip.dispatchEvent(this._event)},_seek:function(){this._event.id=this.id;this._event.action=6;this.clip.dispatchEvent(this._event)}});var M=function(a){this._create=a;this._idleList=new S;this._activeList=new S;this._activeMap=new X;this.length=0};M.prototype={get:function(){if(0<this._idleList.get_length())var a=
this._idleList.pop();else M.current=this,a=this._create(),this.length++;this._activeList.push(a);return this._activeMap.h[a.instanceID]=a},set:function(a){this._activeMap.h.hasOwnProperty(a.instanceID)&&(this._idleList.push(a),this._activeList.remove(a),this._activeMap.remove(a.instanceID))}};var S=function(){this._index=this._length=0};S.prototype={clear:function(){if(null!=this._buffer&&!(1>this._length)){var a=this._length,b=this._buffer.length;for(a=a<b?a:b;0<a--;)this._buffer[a]=null;this._length=
0}},dispose:function(){this._buffer=null;this._length=0},copyFastArray:function(a){this.clear();if(null!=a)for(var b=a.get_length();0<b--;)this.setArrayElement(b,a.getArrayElement(b))},fromList:function(a){if(null==a)return this;null==this._buffer&&(this._buffer=[],this._length=0);for(var b=a.length,c=0;c<b;){var d=c++;this._buffer[d]=a[d]}this._length=b;return this},push:function(a){null==this._buffer&&(this._buffer=[]);this._buffer[this._length++]=a},pop:function(){if(null==this._buffer||1>this._length)return null;
var a=this._buffer[--this._length];this._buffer[this._length]=null;return a},shift:function(){if(null==this._buffer||1>this._length)return null;this._length--;return this._buffer.shift()},get:function(a,b){null==b&&(b=!1);if(b||0>a)a%=this._length,0>a&&(a+=this._length);return this.getArrayElement(a)},getArrayElement:function(a){return 1>this._length||null==this._buffer||a>=this._length?null:this._buffer[a]},setArrayElement:function(a,b){null==this._buffer&&(this._buffer=[]);this._buffer[a]=b;++a;
this._length<a&&(this._length=a)},indexOf:function(a,b){null==b&&(b=0);return null==this._buffer||1>this._length?-1:this._buffer.indexOf(a,b)},insert:function(a,b){null==this._buffer&&(this._buffer=[]);this._buffer.splice(a,0,b);this._length++},remove:function(a,b){null==b&&(b=0);if(null==this._buffer||1>this._length)return-1;a=this.indexOf(a,b);if(-1==a)return-1;this._buffer.splice(a,1);this._length--;return a},removeAt:function(a,b){null==b&&(b=1);null==this._buffer||1>this._length||1>b||(a+b>=
this._length&&(b=this._length-a),1>b||(this._length-=b,this._buffer.splice(a,b)))},unshift:function(a){null==this._buffer&&(this._buffer=[]);this._buffer.unshift(a);this._length++},sort:function(a){if(null!=this._buffer&&!(2>this._length)){var b=this._buffer.length-this._length;0<this.get_length()&&this._buffer.splice(this._length,b);this._buffer.sort(a)}},join:function(a){null==a&&(a="");for(var b="",c=0,d=this._length;c<d;){var e=c++;0<e&&""!=a&&(b+=null==a?"null":""+a);b+=ma.string(this.getArrayElement(e))}return b},
hasNext:function(){if(this._index<this._length)return!0;this._index=0;return!1},next:function(){return this.getArrayElement(this._index++)},get_length:function(){return this._length},set_length:function(a){this._length=a;if(null==this._buffer)return this._length;var b=this._buffer.length;a<b&&this._buffer.splice(a,b-a);return this._length}};var X=function(){this.h={}};X.prototype={get:function(a){return this.h[a]},remove:function(a){if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},
keys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)?a.push(b|0):null;return y.iter(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var a=this.it.next();return this.ref[a]}}}};(function(){I.call(this,null);this.enabled=!1;this._duration=-1;this._list=new X}).prototype=n(I.prototype,{dispose:function(){I.prototype.dispose.call(this);null!=this._src&&this._src.unload();for(var a=this._list.iterator();a.hasNext();)a.next().dispose();
this._list=null;this.enabled=!1}});var jd=function(){this._workerState=0;this.method="GET";this.timeout=10};jd.prototype={load:function(a){null==this._delay&&(this._delay=new ba(g(this,this.timeoutHandler)));this._url=a;this.bytes=null;null!=this._xmlHttpRequest&&(this._xmlHttpRequest.onreadystatechange=null,this._xmlHttpRequest.abort(),this._xmlHttpRequest=null);jd.workerEnable&&0==this._workerState&&(this._workerState=null==window.Worker?-1:1);if(jd.workerEnable&&1==this._workerState)this._worker=
new Worker("worker.js"),this._worker.postMessage(a),this._worker.onmessage=g(this,this.onWorkerMessage);else{null==this._xmlHttpRequest&&(this._xmlHttpRequest=new XMLHttpRequest);this._xmlHttpRequest.responseType="arraybuffer";this._xmlHttpRequest.onreadystatechange=g(this,this.readyStateChange);this._xmlHttpRequest.open(this.method,a,!0);ba.add(this._delay,this.timeout);if(null!=this.headers){a=0;for(var b=this.headers;a<b.length;){var c=b[a];++a;this._xmlHttpRequest.setRequestHeader(c.name,c.value)}}try{null!=
this.data?this._xmlHttpRequest.send(this.data.b.bufferValue):this._xmlHttpRequest.send("")}catch(d){}this.bytes=null}},readyStateChange:function(a){this.bytes=null;if(4==this._xmlHttpRequest.readyState){a=this._xmlHttpRequest.status;if(200<=a&&400>a||0==a&&""==this._xmlHttpRequest.statusText)if(a=this._xmlHttpRequest.response,null!=a)this.bytes=Ea.ofData(a);else try{if(null!=this._xmlHttpRequest.responseText){var b=VBArray(request.responseText).toArray();this.bytes=new Ea(new ArrayBuffer(b.length));
a=0;for(var c=b.length;a<c;){var d=a++;this.bytes.b[d]=b[d]}}}catch(e){this.bytes=null}ba.remove(this._delay);this.headers=this._xmlHttpRequest=null;if(null!=this.onComplete)this.onComplete(this);this.data=this.bytes=null}},onWorkerMessage:function(a){this.bytes=Ea.ofData(a.data);if(null!=this.onComplete)this.onComplete(this)},timeoutHandler:function(){this.bytes=null;if(null!=this.onComplete)this.onComplete(this);this.data=null}};var L=function(){this.h={}};L.prototype={get:function(a){return null!=
q[a]?this.getReserved(a):this.h[a]},setReserved:function(a,b){null==this.rh&&(this.rh={});this.rh["$"+a]=b},getReserved:function(a){return null==this.rh?null:this.rh["$"+a]},existsReserved:function(a){return null==this.rh?!1:this.rh.hasOwnProperty("$"+a)},remove:function(a){if(null!=q[a]){a="$"+a;if(null==this.rh||!this.rh.hasOwnProperty(a))return!1;delete this.rh[a]}else{if(!this.h.hasOwnProperty(a))return!1;delete this.h[a]}return!0},keys:function(){return y.iter(this.arrayKeys())},arrayKeys:function(){var a=
[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(b);if(null!=this.rh)for(b in this.rh)36==b.charCodeAt(0)&&a.push(b.substr(1));return a},iterator:function(){return new Pb(this,this.arrayKeys())}};var nb=function(a){this._path=a;this._success=!1};nb.clear=function(){var a=kd.getLocalStorage();null!=a&&a.clear()};nb.getStorage=function(a){if(null==a||""==a)throw new w("name is empty");for(var b=" ~%&\\;:\"',<>?#/".split(""),c=0;c<b.length;){var d=b[c];++c;if(-1<a.indexOf(d))throw new w("name is not allowed");
}b=nb._map;if(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))return b=nb._map,null!=q[a]?b.getReserved(a):b.h[a];b=new nb(a);c=nb._map;null!=q[a]?c.setReserved(a,b):c.h[a]=b;return b};nb.prototype={connect:function(a){this._success?a(this):(null==this._callbacks&&(this._callbacks=[]),this._callbacks.push(a),this.cache=Rb.getObject(this._path),a=kd.getLocalStorage(),null!=a&&(a=a.getItem(this.cache.name),null!=a&&""!=a&&this.read(a)),this._success=!0,this.ready())},set:function(a,b){this.cache.set(a,
b);this.cache.get_dirty()&&this.update()},get:function(a){return this.cache.get(a)},"delete":function(){var a=kd.getLocalStorage();null!=a&&a.removeItem(this.cache.name)},flush:function(){this.write()},ready:function(){if(null!=this._callbacks){for(var a=this._callbacks.length;0<a--;)(0,this._callbacks[a])(this);this._callbacks=null}},update:function(){},read:function(a){var b=a.substring(0,8);a=a.substring(8);var c=wa._new();c.writeUTFBytes(a);c=ia.hex(dc.getCRC32(wa.toBytes(c)),8);this.cache.readFromFile(a);
c!=b&&this.delete();return!0},write:function(){var a=this.cache.writeToFile(),b=wa._new();b.writeUTFBytes(a);b=dc.getCRC32(wa.toBytes(b));var c=ia.hex(b,8);b=wa._new();b.writeUTFBytes(c+a);a=kd.getLocalStorage();null!=a&&(a.removeItem(this.cache.name),a.setItem(this.cache.name,wa.toStr(b)))}};var Zc=function(){this.data=new Image;this.data.onload=g(this,this._onload);this.data.onerror=g(this,this._onerror)};Zc.prototype={fromBytes:function(a,b){if(null==this.data)throw new w("image has destory");
this._complete=b;null==a?this._onerror():(this.height=this.width=0,a="data:image/png;base64,"+Eb.encode(a),this.data.src=a,this.data.crossOrigin="Anonymous")},fromUrl:function(a,b){if(null==this.data)throw new w("image has destory");this._complete=b;this.height=this.width=0;this.data.src=a;this.data.crossOrigin="Anonymous"},dispose:function(){this.removeCallback();null!=this.data&&(this.data.src="",this.data=null)},removeCallback:function(){null!=this.data&&(this.data.onload=null,this.data.onerror=
null)},_onload:function(){this.removeCallback();this.width=this.data.width;this.height=this.data.height;null!=this._complete&&(this._complete(this),this._complete=null)},_onerror:function(){this.removeCallback();null!=this._complete&&(this.width=this.height=0,this._complete(this),this._complete=null)}};var zd=function(){};zd.main=function(){la.main=new zd};zd.prototype={startGameMain:function(a){m.fnt=new we;m.table=new xe;m.version="";m.init("assets");ec.pressDelay=.2;this._game=new la;this._game.backgroundColor.setRGBA(-1412567041);
this._game.onInit(g(this,this.onGameInit));new ec(this._game);Ia.game=this._game},onGameInit:function(){var a=la.getParam("init");null!=a&&a();ea.width<=ea.height?Sa.systemDispatcher.addEventListener(ua.resize._type,g(this,this.create)):this.create(null)},create:function(a){if(!(ea.width<ea.height)){Sa.systemDispatcher.removeEventListener(ua.resize._type,g(this,this.create));ea.renderBuffer=new id(ea.width,ea.height);this._world=new ld;this._world.name="game";this._game.addWorld(this._world);a=new v;
a.get_transform().rotation.setEulerAngles(0,-180,0);this._world.addChild(a);a.name="camera 3d";var b=a.addComponent(md);this._worldCamera=a.addComponent(Wa);this._worldCamera.clearFlags.type=3;this._worldCamera.clearFlags.color.setRGBA(-1412567296);this._worldCamera.farClipPlane=6E3;b.setView(800,500);a=new v;this._world.addChild(a);a.get_transform().position.set(0,50,20);b=a.get_transform().rotation;var c=a.get_transform().position,d=h.get_zero();b.setLookAt(h._pool.get().sub(d,c).normalize(),null);
a=a.addComponent(nd);this._uiWorld=new ld;this._uiWorld.name="ui";this._game.addWorld(this._uiWorld);b=new v;b.get_transform().rotation.setEulerAngles(0,-180,0);this._uiWorld.addChild(b);b.name="camera ui";this._alignView=b.addComponent(md);this._uiCamera=b.addComponent(Wa);this._uiCamera.clearFlags.type=2;this._uiCamera.clearFlags.color.setRGBA(-1412567296);this._uiCamera.farClipPlane=6E3;this._alignView.setView(800,500,g(this,this.viewInit));Ia.world3D=this._world;Ia.camera3D=this._worldCamera;
Ia.worldUI=this._uiWorld;Ia.cameraUI=this._uiCamera;Ia.light=a;this._game.debugCamera=this._uiCamera}},viewInit:function(a){Sb.init();na.init();J.init();t.init();t.align=a;t.camera=a.camera;t.distance=a.distance;t.viewHeight=a.height;t.viewWidth=a.width;D.init(this._uiWorld,this._uiCamera,this._world);(new ye).setParent(D.root)}};var Ia=function(){},A=function(){},ze=function(a){this.name=a;this._tables=new L};ze.prototype={getTable:function(a){var b="-"+this.name+"-"+a+"-db",c=this._tables;if(null!=
q[b]?c.existsReserved(b):c.h.hasOwnProperty(b))return a=this._tables,null!=q[b]?a.getReserved(b):a.h[b];a=new Ae(a,b);c=this._tables;null!=q[b]?c.setReserved(b,a):c.h[b]=a;return a}};var fc=function(){this.width=16;this.height=10;this.tplId=-1;this.objects=V.fromArray([]);this.map=new Ud(16,10);this.wallGroupList=V.fromArray([])};fc.prototype={set:function(a){this.reset();this.resize(a.width,a.height);for(var b=0,c=this.width;b<c;)for(var d=b++,e=0,f=this.height;e<f;){var l=e++,g=sb.get();this.map.set(d,
l,g);var h=this.map.getIndex(d,l);g.init(h,d,l);a.getWall(d,l)&&(g.type=1,0==d||d>=this.width-1||0==l||l>=this.height-1)&&(g.type=4)}for(b=a.objects.get_length();0<b--;)c=a.objects.getArrayElement(b).clone(),c.disabled=!1,this.objects.push(c);this.postInit()},getByPosition:function(a,b){a=p.floatToInt(a/50);b=p.floatToInt(b/50);var c=this.width,d=this.height;return this.map.get(0>a?0:a>c?c:a,0>b?0:b>d?d:b)},clearRuntime:function(){for(var a=this.map.length;0<a--;){var b=this.map.getArrayElement(a);
null!=b&&b.clearRuntime()}},reset:function(){for(var a=this.objects.get_length();0<a--;)this.objects.getArrayElement(a).dispose();this.objects.clear();this.wallGroupList.clear();for(a=this.map.length;0<a--;){var b=this.map.getArrayElement(a);null!=b&&b.dispose()}},resize:function(a,b){this.width=a;this.height=b;this.map.resize(a,b);this.map.clear();for(var c=0;c<a;)for(var d=c++,e=0,f=b;e<f;){var l=e++,g=sb.get();this.map.set(d,l,g);var h=this.map.getIndex(d,l);g.init(h,d,l)}},postInit:function(){for(var a=
this.map.length;0<a--;){var b=this.map.getArrayElement(a);if(-1==b.group&&(1==b.type||4==b.type)&&4!=b.type){var c=this.map.get(b.x+1,b.y);if(null!=c&&-1==c.group&&(1==c.type||4==c.type)&&4!=c.type){var d=this.map.get(b.x,b.y+1);if(null!=d&&-1==d.group&&(1==d.type||4==d.type)&&4!=d.type){var e=this.map.get(b.x+1,b.y+1);null==e||-1!=e.group||1!=e.type&&4!=e.type||4==e.type||(b.group=e.group=d.group=c.group=0,this.wallGroupList.push(b))}}}}}};var V={fromArray:function(a){for(var b=new S,c=a.length;0<
c--;)b.setArrayElement(c,a[c]);return b}},Ud=function(a,b){this._list=[];this.resize(a,b)};Ud.prototype={fill:function(a){for(var b=this.length;0<b--;)this._list[b]=a},clear:function(){this.fill(null)},resize:function(a,b){if(1>a*b)throw new w("error size ");this.width=a;this.height=b;this.length=a*b},getIndex:function(a,b){return 0>a||0>b||a>=this.width||b>=this.height?-1:b*this.width+a},get:function(a,b){a=this.getIndex(a,b);return 0<=a?this.getArrayElement(a):null},set:function(a,b,c){a=this.getIndex(a,
b);0<=a&&this.setArrayElement(a,c)},getArrayElement:function(a){return this._list[a]},setArrayElement:function(a,b){this._list[a]=b}};var J=function(){};J.init=function(){J.userData=new Ad;J.bagData=new Bd;J.pveData=new Cd};var Be=function(){};Be.get=function(a){return"["+a+"]"};var Fa=function(){},Sb=function(){};Sb.init=function(){};var na=function(){};na.init=function(){na._inited||(na._inited=!0,na.update=new Ce,na.dataWatch=new De,na.update.add(na.dataWatch),na.response=new Ee,na.update.add(na.response),
na.autoAdd=new Fe,na.update.add(na.autoAdd),na.sound=new Ge,na.update.add(na.sound),na.request=new He,gc.service=na.request,na.update.add(na.request),new Ie)};var N=function(){};N.init=function(a){N.skin=new Je;a.add(N.skin);N.level=new Ke;a.add(N.level);N.item=new Le;a.add(N.item);N.newuserItem=new Me;a.add(N.newuserItem);N.itemLevelEffect=new Ne;a.add(N.itemLevelEffect);N.trapSound=new Oe;a.add(N.trapSound);N.shader=new Pe;a.add(N.shader)};var t=function(){};t.postInit=function(){null==t.game&&
(t.loading=new Qe,t.map=new Re,t.game=new Se,t.test=new Te,t.home=new Ue,t.edit=new Ve,t.save=new We,t.mode_single=new Xe,t.mode_match=new Ye,t.mode_replay=new Ze,t.openDoor=new $e,t.itemInfo1=new af,t.hpInfo=new bf,t.alert=new cf,t.settingInfo=new df)};t.init=function(){};var hc=function(){this.type=0;this._data={};this._test________name="-----------------<>"};hc.prototype={update:function(){na.dataWatch.dataUpdate(this)},syncData:function(){},get_data:function(){this.syncData();Q.copyFieldTo(this,
this._data);return this._data}};var Bd=function(){hc.call(this);this.type=2;this.list=[];this._map=new X};Bd.prototype=n(hc.prototype,{from:function(a){for(var b=a.length;0<b--;){var c=a[b];this.list.push(c);this._map.h[c.id]=c}this.update()},getItem:function(a){return this._map.h[a]},updateItem:function(a){this._map.h[a.id]=a;this.update()},addItemCount:function(a,b){var c=this.getItem(a);null==c&&(c={id:a,count:0});var d=N.item.get(a);a=b;0<d.max&&(d=this.getItem(d.max),null!=d&&(d=N.itemLevelEffect.getEffect(d.id,
d.count),ta.gt(c.count+b,d.count)&&(a=d.count-c.count,0>a&&(a=0))));c.count+=a;this.updateItem(c)},syncData:function(){this.list.splice(0,this.list.length);for(var a=new tb(this._map);a.hasNext();){var b=a.next();this.list.push(b.value)}}});var ef=function(a){this.self=a;this._map=new X;this._enterMap=new X;this.triggerEnterList=V.fromArray([]);this.triggerExitList=V.fromArray([])};ef.prototype={clear:function(){this.triggerEnterList.clear();this.triggerExitList.clear();for(var a=this._enterMap.keys();a.hasNext();){var b=
a.next();this._enterMap.remove(b)}},add:function(a){this._map.h[a.instanceID]=a},update:function(){this.triggerEnterList.clear();this.triggerExitList.clear();for(var a=this._enterMap.keys();a.hasNext();){var b=a.next();this._map.h.hasOwnProperty(b)||(this.triggerExitList.push(this._enterMap.h[b]),this._enterMap.remove(b))}for(a=this._map.keys();a.hasNext();){b=a.next();var c=this._map.h[b];this._map.remove(b);this._enterMap.h.hasOwnProperty(b)||(this._enterMap.h[b]=c,this.triggerEnterList.push(c))}}};
var ff=function(){this._count=new X;this._trap=new X;this._disabled=V.fromArray([]);this.failCountToRemove=3;this._failCount=0};ff.prototype={clear:function(){for(var a=new tb(this._count);a.hasNext();){var b=a.next();this._count.remove(b.key)}for(a=new tb(this._trap);a.hasNext();)b=a.next(),this._trap.remove(b.key);this._disabled.clear();this._failCount=0},count:function(a){var b=a.instanceID;this._trap.h.hasOwnProperty(b)?this._count.h[b]+=1:(this._trap.h[b]=a,this._count.h[b]=1);this._failCount++;
if(this._failCount<this.failCountToRemove)return null;a=this.disableOne();this._failCount=0;return a},hasDisabled:function(a){return-1!=this._disabled.indexOf(a)},disableOne:function(){for(var a=0,b=0,c=new tb(this._count);c.hasNext();){var d=c.next(),e=d.key;d.value>a&&!this.hasDisabled(e)&&(a=b=e)}if(0==a)return null;this._disabled.push(b);return this._trap.h[b]}};var ib=function(a){null==a&&(a=0);this.value=0;this.value=a};ib.prototype={getArrayElement:function(a){ta.gt(0,a)?(a=ta.toFloat(a)%ta.toFloat(32)|
0,a+=32):ta.gte(a,32)&&(a=ta.toFloat(a)%ta.toFloat(32)|0);a=1<<a;return(this.value&a)==a},setArrayElement:function(a,b){null==b&&(b=!0);0>a?a=a%32+32:32<=a&&(a%=32);this.value=b?this.value|1<<a:this.value&~(1<<a)}};var Fb=function(){this.walls=V.fromArray([]);this.objects=V.fromArray([]);this.width=this.height=this.version=this.id=0;this.params=new Vd};Fb.prototype={clear:function(){this.walls.clear();for(var a=this.objects.get_length();0<a--;)this.objects.getArrayElement(a).dispose();this.objects.clear();
this.width=this.height=0;this.params.clear()},decode:function(a){this.clear();this.id=a.readUnsignedInt();this.version=a.readUnsignedInt();this.width=a.readUnsignedShort();this.height=a.readUnsignedShort();for(var b=p.ceilToInt(this.width*this.height/32);0<b--;)this.walls.push(a.readInt());for(b=a.readUnsignedByte();0<b--;){var c=Xa.get();c.x=a.readUnsignedByte();c.y=a.readUnsignedByte();c.type=a.readUnsignedByte();c.params.decode(a);this.objects.push(c)}this.params.decode(a)},getWall:function(a,
b){if(0>a||0>b||a>=this.width||b>=this.height)return!0;b=a+b*this.width;a=p.floatToInt(b/32);b%=32;a=this.walls.getArrayElement(a);Fb.b32.value=a;return Fb.b32.getArrayElement(b)},setWall:function(a,b,c){if(!(0>a||0>b||a>=this.width||b>=this.height)){b=a+b*this.width;a=p.floatToInt(b/32);b%=32;a>=this.walls.get_length()&&this.walls.setArrayElement(a,0);var d=this.walls.getArrayElement(a);Fb.b32.value=d;Fb.b32.setArrayElement(b,c);this.walls.setArrayElement(a,Fb.b32.value)}}};var sb=function(){this.type=
0;this.instanceID=sb._id++;this.shapes=V.fromArray([])};sb.get=function(){return sb.pool.get()};sb.prototype={init:function(a,b,c){this.index=a;this.x=b;this.y=c;this.type=0;this.shapes.clear();this.group=-1},dispose:function(){sb.pool.set(this)},clearRuntime:function(){1!=this.type&&4!=this.type&&(this.type=0)},setTypeIfNotWall:function(a){1!=this.type&&4!=this.type&&(this.type=a)},check:function(a){a.spring=0;if(1==this.type||4==this.type)a.density=1;else{if(2==this.type||3==this.type){if(!a.ignoreBoard&&
0>a.offsety&&a.currentCell.y>this.y){a.density=1;3==this.type&&(a.spring=1);return}}else if(0<a.offsety&&this.y>a.currentCell.y&&(3==a.currentCell.type||2==a.currentCell.type)&&!a.crossBoard&&a.currentCell.y<this.y){a.density=1;return}a.density=0}},getLeft:function(a){null==a&&(a=0);return 50*this.x+a},getRight:function(a){null==a&&(a=0);return 50*(this.x+1)-1E-5+a},getTop:function(a){null==a&&(a=0);return 50*(this.y+1)-1E-5+a},getBottom:function(a){null==a&&(a=0);return 50*this.y+a},addShape:function(a){this.shapes.push(a)},
removeShape:function(a){this.shapes.remove(a)}};var Vd=function(){this._intMap=new X};Vd.prototype={copy:function(a){if(null!=a)for(a=new tb(a._intMap);a.hasNext();){var b=a.next();this.setValue(b.key,b.value)}},setValue:function(a,b){this._intMap.h[a]=b},getValue:function(a,b){null==b&&(b=0);return this._intMap.h.hasOwnProperty(a)?this._intMap.h[a]:b},decode:function(a){this.clear();for(var b=a.readUnsignedByte();0<b--;)this.setValue(a.readUnsignedByte(),a.readInt())},clear:function(){for(var a=
new tb(this._intMap);a.hasNext();){var b=a.next();this._intMap.remove(b.key)}}};var Xa=function(){this.params=new Vd;this.instanceID=Xa._id++;this.disabled=!1};Xa.get=function(){return Xa.pool.get()};Xa.prototype={copy:function(a){this.x=a.x;this.y=a.y;this.params=a.params},clone:function(){var a=Xa.get();a.type=this.type;a.x=this.x;a.y=this.y;a.params.copy(this.params);this.disabled=!1;return a},dispose:function(){Xa.pool.set(this);this.disabled=!1;this.params.clear()}};var Cd=function(){hc.call(this);
this.type=3;this.states=[];this.currentLevel=1};Cd.prototype=n(hc.prototype,{getState:function(a){return a<this.states.length?this.states[a]:a==this.states.length?-1:-3}});var fd=function(){this._seed=2147483647*Math.random()|0;this.running=!0};fd.prototype={setSeed:function(a){0>this._seed&&(this._seed=2147483647*Math.random()|0);this._seed=a},get:function(){var a=this._seed;a^=a>>11;a^=a<<7&-1658038656;a^=a<<15&-272236544;this.running&&(this._seed=a^a>>18);return this._seed},getFloat:function(){return p.fixed(this.get()/
2147483646,9)},randomFloat:function(a,b){null==b&&(b=1);null==a&&(a=0);return b<=a?a:a+(b-a)*this.getFloat()}};var Ad=function(){hc.call(this);this.type=1;this.id="";this.seed=0};Ad.prototype=n(hc.prototype,{});var Pa=function(a,b,c){this.boardOffset=0;this.crossBoard=!0;this.size=a;this.spring=this.density=0;this.currentPoint=new H;this.nextPoint=new H;this.velocity=new h;this.offsetx=b*a;this.offsety=c*a;this.ignoreBoard=!1};Pa.prototype={reset:function(){this.density=this.prevDesity=0},setCurrent:function(a){var b=
this.currentPoint,c=a.x+this.offsetx;a=a.y+this.offsety;null==a&&(a=0);null==c&&(c=0);b.x=c;b.y=a},update:function(a,b,c){this.prevCell=this.nextCell;this.prevDesity=this.density;this.density=0;this.currentCell=c.getByPosition(this.currentPoint.x,this.currentPoint.y);if(null!=this.currentCell){var d=this.nextPoint,e=a.x+this.offsetx;a=a.y+this.offsety;null==a&&(a=0);null==e&&(e=0);d.x=e;d.y=a;this.velocity.copy(b);this.nextCell=c.getByPosition(this.nextPoint.x,this.nextPoint.y);this.nextCell.check(this);
0==this.density&&0>this.offsety&&(b=c.getByPosition(this.nextPoint.x+this.boardOffset*(0<this.offsetx?1:-1),this.nextPoint.y),b==this.nextCell||2!=b.type&&3!=b.type||(b.check(this),this.nextCell=this.currentCell=b))}},getChangeType:function(){var a=this.currentCell.x!=this.nextCell.x,b=this.currentCell.y!=this.nextCell.y;return a&&b?3:a?1:2}};var v=function(){this._destorying=!1;I.call(this);this._dontDestroy=this._destorying=!1;this.visible=this._enabled=!0;this.frame=0;this.timeScale=1;this.layer=
this.deltaTime=0;this._timeScale=1;this.sortId=0};v.destory=function(a){if(null!=a){if(null==v._destoryed){v._destoryed=new X;var b=new S;v._destoryList=b}a._destorying||v._destoryed.h.hasOwnProperty(a.instanceID)||(a._destorying=!0,v._destoryed.h[a.instanceID]=a,v._destoryCount++,a.set_enabled(!1))}};v._endFrame=function(){if(!(1>v._destoryCount)){v._destoryCount=0;for(var a=v._destoryed.iterator();a.hasNext();){var b=a.next();v._destoryed.remove(b.instanceID);v._destoryList.push(b)}for(a=v._destoryList.get_length();0<
a--;)v._destoryList.getArrayElement(a)._destory();v._destoryList.clear()}};v.prototype=n(I.prototype,{setParent:function(a){null!=a&&a.get_transform().addChild(this.get_transform())},addComponentIfNotExist:function(a){var b=this.getComponent(a);null==b&&(b=this.addComponent(a));return b},addComponent:function(a){null==this._components&&(this._components=new S);for(var b=this._components.get_length();0<b--;){var c=this._components.get(b);if(aa.__instanceof(c,a)&&null==this.getComponentState(a,1)&&
null!=Gb.get(a).getClassMeta("once",!0))return c}c=od.createInstance(a);if(null==c)return null;this._components.push(c);c.__connectActor(this);null==this._componentStates&&(this._componentStates=new S);this._componentStates.push(ob.pop(c,0));c instanceof La&&(this._transform=c);return c},removeComponent:function(a){if(null!=this._components)for(var b=this._components.get_length();0<b--;){var c=this._components.get(b);aa.__instanceof(c,a)&&(null==this._componentStates&&(this._componentStates=new S),
this._componentStates.push(ob.pop(c,1)),this._components.removeAt(b),c instanceof La&&(this._transform=null))}},getComponent:function(a){if(null==this._components)return null;for(var b=this._components.get_length();0<b--;){var c=this._components.get(b);if(aa.__instanceof(c,a))return c}return null},getComponentState:function(a,b){if(null==this._componentStates)return null;var c=this._componentStates.get_length();if(1>c)return null;for(;0<c--;){var d=this._componentStates.getArrayElement(c);if(null!=
d&&d.state==b&&aa.__instanceof(d.component,a))return d}return null},componentUpdate:function(){if(null!=this._componentStates){var a=this._componentStates.get_length();if(!(1>a)){null==this._componentStatesTemp&&(this._componentStatesTemp=new S);this._componentStatesTemp.copyFastArray(this._componentStates);this._componentStates.clear();for(var b=0;b<a;){var c=b++;c=this._componentStatesTemp.get(c);ob.push(c);0==c.state?(c.component.__init(),this.world.addComponent(c.component)):1==c.state&&(c.component.__disconnectActor(),
this._components.remove(c.component),this.world.removeComponent(c.component))}this._componentStatesTemp.clear()}}},_collectActors:function(a){var b=this.get_transform().childCount;this.dispatchEvent(u.onCollectChildren);if(0<b)for(var c=0;c<b;){var d=c++;d=this.get_transform().getChild(d).actor;d._enabled&&(a.push(d),d._collectActors(a))}this.dispatchEvent(u.onCollectChildrenComplete)},_collectComponent:function(a){if(null!=this.world&&null!=this._components)for(var b=this._components.get_length();0<
b--;)null!=this._components.get(b).classType&&(a?this.world.addComponent(this._components.get(b)):this.world.removeComponent(this._components.get(b)))},_connectWorld:function(a){this.world=a;this.componentUpdate();this._collectComponent(!0);this.onEnable();this.dispatchEvent(u.onEnable)},_disconnectWorld:function(){this._collectComponent(!1);this.onDisable();this.dispatchEvent(u.onDisable);this.world=null;this.get_transform()._removed()},onEnable:function(){},onDisable:function(){},onUpdate:function(){},
_frameStart:function(a){this.componentUpdate();this.get_transform()._frameChanged=!1;null!=this.get_transform().parent?this._timeScale=this.get_transform().parent.actor._timeScale*this.timeScale:this._timeScale=this.timeScale;this.deltaTime=a*this._timeScale},_fixedUpdate:function(a){var b=this.deltaTime;this.deltaTime=a*this._timeScale;this.get_transform().checkChanged();this.dispatchEvent(u.onFixedUpdate);this.deltaTime=b},_update:function(){this.get_transform().checkChanged();this.dispatchEvent(u.onUpdate);
this.onUpdate()},_destory:function(){if(!this._dontDestroy){this.dispose();this.onDestory();null!=this.get_transform().parent&&this.dispatchEvent(u.onRemoved);if(null!=this._components){this._collectComponent(!1);for(var a=this._components.get_length();0<a--;)this._components.getArrayElement(a).__disconnectActor()}this.transform=this._componentStates=this._components=null}},onDestory:function(){},_setVisible:function(a){this.visible!=a&&(this.visible=a)},get_transform:function(){null==this._transform&&
(this._transform=this.getComponent(La),null==this._transform&&(this._transform=this.addComponent(La)));return this._transform},set_enabled:function(a){this._enabled!=a&&null!=this.world&&this.world.set_dirty(!0);return this._enabled=a},get_frame:function(){return this.world.frame}});var T=function(){v.call(this);this._positionOffset=new h(0,0,0);this._renderQueue=10001};T.prototype=n(v.prototype,{begin:function(a){this.shape=a;this.get_transform().position.copy(a.position).add(this._positionOffset);
this.get_transform().rotation.setEulerAngles(0,0,a.rotation);this.get_transform().scale.copy(a.scale)},udpate:function(){this.syncTransform()},end:function(){},syncTransform:function(){this.get_transform().position.copy(this.shape.position).add(this._positionOffset);this.get_transform().rotation.setEulerAngles(0,0,this.shape.rotation);this.get_transform().scale.copy(this.shape.scale)}});var fa=function(){I.call(this)};fa.__name__="lovedna.game.components.Component";fa.prototype=n(I.prototype,{onConstruct:function(){I.prototype.onConstruct.call(this);
this.classType=od.getClassName(this);this.__inited=!1},onAwake:function(){},onStart:function(){},onDestroy:function(){},__connectActor:function(a){this.actor=a;this.onAwake();this.transform=this.actor.get_transform()},__init:function(){this.__inited=!0;if(null!=this.__calbacks)for(var a=this.__calbacks.keys();a.hasNext();){var b=a.next(),c=this.__calbacks;this.actor.addEventListener(b,null!=q[b]?c.getReserved(b):c.h[b]);b==u.onAdded._type&&this.actor.dispatchEvent(u.onAdded)}this.onStart()},__disconnectActor:function(){if(null!=
this.__calbacks){for(var a=this.__calbacks.keys();a.hasNext();){var b=a.next(),c=this.__calbacks;this.actor.removeEventListener(b,null!=q[b]?c.getReserved(b):c.h[b]);this.__calbacks.remove(b)}this.__calbacks=null}this.onDestroy();this.actor=null},bindEvent:function(a,b){if(null!=b){null==this.__calbacks&&(this.__calbacks=new L);var c=this.__calbacks,d=a._type;(null!=q[d]?c.existsReserved(d):c.h.hasOwnProperty(d))||(c=this.__calbacks,d=a._type,null!=q[d]?c.setReserved(d,b):c.h[d]=b,this.__inited&&
this.actor.addEventListener(a._type,b))}else null!=this.__calbacks&&(b=this.__calbacks,c=a._type,null!=q[c]?b.existsReserved(c):b.h.hasOwnProperty(c))&&(b=this.__calbacks,c=a._type,b=null!=q[c]?b.getReserved(c):b.h[c],this.__calbacks.remove(a._type),this.__inited&&this.actor.removeEventListener(a._type,b))},__class__:fa});var ra=function(a,b,c){null==c&&(c=!0);this._list=[];this._index=0;this._create=a;this._opts=b;this.count=0;c&&ra._pools.push(this);this._avacount=10};ra.reset=function(){for(var a=
oa._custom(),b=ra._pools.length;0<b--;)ra._pools[b].clear(a)};ra.prototype={get:function(){if(this._index<this._list.length){var a=this._list[this._index++];null!=this._opts&&null!=this._opts.reset&&this._opts.reset(a)}else a=this._create(),this._list[this._index++]=a,null!=this._opts&&null!=this._opts.init&&this._opts.init(a);this.count=this._list.length;return a},clear:function(a){this._index=0}};var H=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b};H.prototype={copy:function(a){if(null==
a||a==this)return this;var b=a.x;a=a.y;null==a&&(a=0);null==b&&(b=0);this.x=b;this.y=a;return this},scale:function(a){var b=this.x*a;a*=this.y;null==a&&(a=0);null==b&&(b=0);this.x=b;this.y=a;return this},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(0!=a)return this.scale(1/a);var b=a=0;null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;return this},distanceSquared:function(a,b){var c=null==b,d=c?this:a;b=c?a:b;a=d.x-b.x;d=d.y-b.y;return a*a+d*d},clamp:function(a,b){var c=this.x;
this.x=c<a?a:c>b?b:c;c=this.y;this.y=c<a?a:c>b?b:c;return this},setArrayElement:function(a,b){0>a?a=a%2+2:2<=a&&(a%=2);0==a?this.x=b:this.y=b},fillArray:function(a,b){null==b&&(b=0);a[b++]=this.x;a[b++]=this.y},fromArray:function(a,b){null==b&&(b=0);if(null==a)return this;var c=a.length;b<c&&(this.x=a[b++]);b<c&&(this.y=a[b++]);return this},parse:function(a){if(null==a)return this;a=a.split(",");for(var b=a.length,c=2;0<c--;)if(c>=b)this.setArrayElement(c,0);else{var d=a[c];0<d.length?this.setArrayElement(c,
p.stringToFloat(d)):this.setArrayElement(c,0)}return this},get_angle:function(){return 0==this.y&&0==this.x?0:57.29577951308232*Math.atan2(this.y,this.x)},set_angle:function(a){var b=Math.sqrt(this.x*this.x+this.y*this.y);0==b&&(b=1);a*=.017453292519943295;this.x=Math.cos(a)*b;this.y=Math.sin(a)*b;return a}};var h=function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c};h.get_forward=function(){return h._pool.get().set(0,0,1)};h.get_up=function(){return h._pool.get().set(0,
1,0)};h.get_right=function(){return h._pool.get().set(1,0,0)};h.get_zero=function(){return h._pool.get().set(0,0,0)};h.get_one=function(){return h._pool.get().set(1,1,1)};h.prototype={set:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;return this},copy:function(a){return null==a||a==this?this:this.set(a.x,a.y,a.z)},add:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return this.set(d.x+a.x,d.y+a.y,d.z+a.z)},sub:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;
return this.set(d.x-a.x,d.y-a.y,d.z-a.z)},mul:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return this.set(d.x*a.x,d.y*a.y,d.z*a.z)},dot:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return d.x*a.x+d.y*a.y+d.z*a.z},cross:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return this.set(d.y*a.z-d.z*a.y,d.z*a.x-d.x*a.z,d.x*a.y-d.y*a.x)},min:function(a,b){var c=null==b,d=c?this:a,e=c?a:b;a=d.x;b=e.x;c=d.y;var f=e.y;d=d.z;e=e.z;return this.set(a<b?a:b,c<f?c:f,d<e?d:e)},max:function(a,b){var c=null==b,
d=c?this:a,e=c?a:b;a=d.x;b=e.x;c=d.y;var f=e.y;d=d.z;e=e.z;return this.set(a>b?a:b,c>f?c:f,d>e?d:e)},scale:function(a){return this.set(this.x*a,this.y*a,this.z*a)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0!=a?this.scale(1/a):this.set(0,0,0)},distanceSquared:function(a,b){var c=null==b,d=c?this:a;c=c?a:b;a=d.x-c.x;b=d.y-c.y;d=d.z-c.z;return a*a+b*b+d*d},distance:function(a,b){return Math.sqrt(this.distanceSquared(a,b))},angle:function(a,b,c){null==c&&
(c=!0);var d=this.x*this.x+this.y*this.y+this.z*this.z,e=a.x*a.x+a.y*a.y+a.z*a.z;return 0<d&&0<e?(null==b&&(b=h.get_up()),d=this.dot(a)/Math.sqrt(d*e),d=57.29577951308232*Math.acos(-1>d?-1:1<d?1:d),c?(a=h.instance.cross(this,a).mul(b),a=a.x+a.y+a.z,(0<a?1:0>a?-1:0)*d):d):0},lerpTo:function(a,b){if(null==a||0>=b)return this;if(1<=b)return this.copy(a);0<=b&&1>=b&&(this.x+=b*(a.x-this.x),this.y+=b*(a.y-this.y),this.z+=b*(a.z-this.z));return this},parse:function(a){if(null==a)return this;a=a.split(",");
for(var b=a.length,c=3;0<c--;)if(c>=b)this.setArrayElement(c,0);else{var d=a[c];0<d.length?this.setArrayElement(c,parseFloat(d)):this.setArrayElement(c,0)}return this},setArrayElement:function(a,b){0>a?a=a%3+3:3<=a&&(a%=3);0==a?this.x=b:1==a?this.y=b:this.z=b},fillArray:function(a,b){null==b&&(b=0);a[b++]=this.x;a[b++]=this.y;a[b++]=this.z},fromArray:function(a,b){null==b&&(b=0);if(null==a)return this;var c=a.length;b<c&&(this.x=a[b++]);b<c&&(this.y=a[b++]);b<c&&(this.z=a[b++]);return this}};var Ya=
function(){I.call(this)};Ya.__name__="lovedna.game.components.ui.UIRect";Ya.prototype=n(fa.prototype,{onAwake:function(){fa.prototype.onAwake.call(this);this._vec3=Ya._v3;this._vec2=Ya._v2;this.rectTransform=this.actor.getComponent(Tb);if(null==this.rectTransform){var a=this.actor.getComponent(La);null!=a&&this.actor.removeComponent(La);this.rectTransform=this.actor.addComponent(Tb);if(null!=a){this.rectTransform.position.copy(a.position);this.rectTransform.scale.copy(a.scale);this.rectTransform.rotation.copy(a.rotation);
null!=a.parent&&a.parent.addChild(this.rectTransform);for(var b=0,c=a.childCount;b<c;){var d=b++;this.rectTransform.addChild(a.getChild(d))}}this.transform=this.rectTransform}this.actor.layer=4},__class__:Ya});var xa=function(){I.call(this)};xa.__name__="lovedna.game.components.ui.GUI";xa.prototype=n(Ya.prototype,{addMeshRenderer:function(){var a=this.actor.addComponent(Ub);a.mesh=this.mesh;a.materials[0]=this.material;this._hasRenderer=!0;return a},collectRenderObject:function(a,b,c){this.canvas=
c;if(this.actor.visible&&!this._hasRenderer&&!this.transform.removed){this.material.setMatrixHandler(k.toString(k.M),(P=this.actor.get_transform(),g(P,P.getLocalToWorld)));this.material.setMatrixHandler(k.toString(k.IM),(P=this.actor.get_transform(),g(P,P.getWorldToLocal)));this._color.copy(this.material.color);this._color.mul(c.color);this.material.setColor(k.toString(k.COLOR),this._color);c=this.material;var d=this.mesh.gpuBuffer,e=0;null==b&&(b=0);null==e&&(e=0);b=eb._pool.get().set(c,d,e,b);a.add(b)}},
onAwake:function(){Ya.prototype.onAwake.call(this);this._hasRenderer=!1;this.material=new Hb("ui");this.material.renderState.depthState.compareFunction=0;this.material.renderState.depthState.writeEnabled=!1;this.material.renderState.cullMode=0;this.material.renderQueue=xa.defaultRenderQueue;this.geometryBuffer=new Za;this.geometryBuffer.uv=new fb;this.geometryBuffer.color=new Ib;this.mesh=new Ma;this.mesh.fromBuffer(this.geometryBuffer);this.bindEvent(u.onCollectChildren,g(this,this.onCollectChildren));
this.batch=!0;this.actor.layer=4;this._color=new F(1,1,1,1)},onDestroy:function(){Ya.prototype.onDestroy.call(this);this.rectTransform=null},onCollectChildren:function(a){Qa.collect(this)},__class__:xa});var O=function(){I.call(this)};O.__name__="lovedna.game.components.ui.Image";O.prototype=n(xa.prototype,{reset:function(){this.rectTransform.width=this.rectTransform.height=-1;var a=this.rectTransform.pivot,b=.5,c=.5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c},onAwake:function(){xa.prototype.onAwake.call(this);
this.imageType=-1;this.fillAmount=1;this.fillOrigin=this.fillMothod=0;this.rectTransform.width=this.rectTransform.height=-1},onStart:function(){xa.prototype.onStart.call(this);this.bindEvent(u.onRectTransform,g(this,this.onRectTransform))},onDestroy:function(){xa.prototype.onDestroy.call(this);Ma.deleteGeometryBuffer(this.geometryBuffer.instanceID);this.geometryBuffer.dispose();this.geometryBuffer=null;this.material.dispose();null!=this.resource&&this.resource.removeEventListener(C.init._type,g(this,
this.onSpriteInit));this.set_resource(null)},onSpriteInit:function(a){this.resource.removeEventListener(C.init._type,g(this,this.onSpriteInit));this.resource.enabled&&(this.material.setAtlas(this.resource),this.material.name=this.resource.name,null==this.actor.name&&(this.actor.name=this.resource.name),0>this.rectTransform.width&&(this.rectTransform.width=this.resource.data.originalSize.x),0>this.rectTransform.height&&(this.rectTransform.height=this.resource.data.originalSize.y),.5==this.rectTransform.pivot.x&&
(this.rectTransform.pivot.x=this.resource.data.pivot.x),.5==this.rectTransform.pivot.y&&(this.rectTransform.pivot.y=this.resource.data.pivot.y),this.onRectTransform(),this.dispatchEvent(C.init))},onRectTransform:function(a){this.draw()},draw:function(){if(null!=this.resource&&this.resource.enabled&&(null==this._uvBuffer&&(this._uvBuffer=new fb),this.geometryBuffer.position.clear(),0!=this.rectTransform.width&&0!=this.rectTransform.height)){var a=this.imageType;-1==a&&(a=0,this.resource.data.border.hasBorder()?
a=1:null!=this.border&&this.border.hasBorder()&&(a=1));0==a?this.simpleFill():1==a?this.slicedFill():2==a?this.filledFill():this.simpleFill();this.geometryBuffer.update();this.dispatchEvent(C.update)}},clearBuffer:function(){this.geometryBuffer.position.clear();this.geometryBuffer.uv.clear();this.geometryBuffer.color.clear();this.geometryBuffer.group.indices.clear()},simpleFill:function(){var a=this.rectTransform.width,b=this.rectTransform.height,c=a/this.resource.data.originalSize.x,d=b/this.resource.data.originalSize.y,
e=this.resource.data.offset.x,f=this.resource.data.originalSize.y-this.resource.data.offset.y-this.resource.data.frame.w;e=e*c-this.rectTransform.pivot.x*a;f=f*d-this.rectTransform.pivot.y*b;a=this.resource.data.frame.z*c;b=this.resource.data.frame.w*d;this.clearBuffer();0!=a&&0!=b&&this.drawQuad(0,0,a,b,this.resource.data.getRectUvs(0,0,1,1),0,e,f)},filledFill:function(){0>=this.fillAmount||(1<=this.fillAmount?this.simpleFill():0!=this.fillMothod&&1!=this.fillMothod||this.fillHorizontalVertical())},
fillHorizontalVertical:function(){var a=this.rectTransform.width,b=this.rectTransform.height,c=a/this.resource.data.originalSize.x,d=b/this.resource.data.originalSize.y,e=this.resource.data.offset.x,f=this.resource.data.originalSize.y-this.resource.data.offset.y-this.resource.data.frame.w;e=e*c-this.rectTransform.pivot.x*a;f=f*d-this.rectTransform.pivot.y*b;a=this.resource.data.frame.z*c;b=this.resource.data.frame.w*d;this.clearBuffer();0==this.fillMothod?1==this.fillOrigin?this.drawQuad(a*(1-this.fillAmount),
0,a*this.fillAmount,b,this.resource.data.getRectUvs(1-this.fillAmount,0,this.fillAmount,1),0,e,f):this.drawQuad(0,0,a*this.fillAmount,b,this.resource.data.getRectUvs(0,0,this.fillAmount,1),0,e,f):3==this.fillOrigin?this.drawQuad(0,0,a,b*this.fillAmount,this.resource.data.getRectUvs(0,0,1,this.fillAmount),0,e,f):this.drawQuad(0,b*(1-this.fillAmount),a,b*this.fillAmount,this.resource.data.getRectUvs(0,1-this.fillAmount,1,this.fillAmount),0,e,f)},slicedFill:function(){var a=this.border;null==a&&(a=this.resource.data.border);
if(1E-5>p.abs(a.x)&&1E-5>p.abs(a.y)&&1E-5>p.abs(a.z)&&1E-5>p.abs(a.w))this.simpleFill();else{var b=this.rectTransform.width,c=this.rectTransform.height;if(!(0>=b||0>=c)){var d=this.resource.data.originalSize.x,e=this.resource.data.originalSize.y,f=a.x,l=a.z;l=0<l?l:0;var g=a.y,h=a.w;h=0<h?h:0;if(f+l>=d||g+h>=e)this.simpleFill();else{var k=this.resource.data.originalSize.y,n=this.resource.data.offset.x,q=this.resource.data.originalSize.y-this.resource.data.offset.y-this.resource.data.frame.w;n-=this.rectTransform.pivot.x*
b;q-=c-(1-this.rectTransform.pivot.y)*k;k=b-f-l;k=0<k?k:0;var m=c-g-h;m=0<m?m:0;var r=a.x+a.z;0<r&&b<r&&(r=b/r,f*=r,l*=r);r=a.y+a.w;0<r&&c<r&&(a=c/r,g*=a,h*=a);this.clearBuffer();a=0;0<g&&0<f&&this.drawQuad(0,c-g,f,g,this.resource.data.getRectUvs(0,e-g,f,g),a++,n,q);0<g&&0<l&&this.drawQuad(b-l,c-g,l,g,this.resource.data.getRectUvs(d-l,e-g,l,g),a++,n,q);0<h&&0<f&&this.drawQuad(0,0,f,h,this.resource.data.getRectUvs(0,0,f,h),a++,n,q);0<h&&0<l&&this.drawQuad(b-l,0,l,h,this.resource.data.getRectUvs(d-
l,0,l,h),a++,n,q);0<k&&0<g&&this.drawQuad(f,h+m,k,g,this.resource.data.getRectUvs(f,e-g,d-f-l,g),a++,n,q);0<k&&0<h&&this.drawQuad(f,0,k,h,this.resource.data.getRectUvs(f,0,d-f-l,h),a++,n,q);0<m&&0<f&&this.drawQuad(0,h,f,m,this.resource.data.getRectUvs(0,h,f,h),a++,n,q);0<m&&0<l&&this.drawQuad(b-l,h,l,m,this.resource.data.getRectUvs(d-l,h,l,h),a++,n,q);0<m&&0<k&&this.drawQuad(f,h,k,m,this.resource.data.getRectUvs(f,h,d-f-l,e-g-h),a++,n,q)}}}},drawQuad:function(a,b,c,d,e,f,l,g){null==g&&(g=0);null==
l&&(l=0);this.geometryBuffer.position.push(this._vec3.set(a+l,b+g,0));this.geometryBuffer.position.push(this._vec3.set(a+c+l,b+g,0));this.geometryBuffer.position.push(this._vec3.set(a+c+l,b+d+g,0));this.geometryBuffer.position.push(this._vec3.set(a+l,b+d+g,0));this.geometryBuffer.uv.add(e);a=this._color;e=d=c=b=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;this.geometryBuffer.color.push(this._color);this.geometryBuffer.color.push(this._color);this.geometryBuffer.color.push(this._color);
this.geometryBuffer.color.push(this._color);f*=4;this.geometryBuffer.group.indices.push3(f,f+1,f+2);this.geometryBuffer.group.indices.push3(f,f+2,f+3)},set_resource:function(a){null!=this.resource&&this.resource.removeEventListener(C.init._type,g(this,this.onSpriteInit));this.resource=a;if(null!=this.resource)if(this.resource.enabled)this.onSpriteInit(null);else this.resource.addEventListener(C.init._type,g(this,this.onSpriteInit));return this.resource},__class__:O});var sa=function(){I.call(this);
this._map=new L;this._instanceMap=new X;this._loader=new K};sa.prototype=n(I.prototype,{get:function(a){return this.getRes(a)},getRes:function(a){var b=this._map;if(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))if(b=this._map,!(null!=q[a]?b.getReserved(a):b.h[a]).unloaded)return b=this._map,null!=q[a]?b.getReserved(a):b.h[a];this._current=this.createRes();b=this._map;var c=this._current;null!=q[a]?b.setReserved(a,c):b.h[a]=c;b=sa._all;null!=q[a]?b.setReserved(a,this):b.h[a]=this;this._instanceMap.h[this._current.instanceID]=
a;this.innerLoad(a);return this._current},innerLoad:function(a){var b=this._loader.load(a);b.name=a;this._current.set_file(b);this.onLoadBefore(this._current);b.get_enabled()||b.addEventListener(C.complete._type,g(this,this.fileComplete))},createRes:function(){return null},onLoadBefore:function(a){},init:function(){},fileComplete:function(a){var b=a.target;b.removeEventListener(C.complete._type,g(this,this.fileComplete));a=this._map;b=b.name;a=null!=q[b]?a.getReserved(b):a.h[b];a.fileComplete();this.onComplete(a)},
onComplete:function(a){}});var gf=function(){sa.call(this);$c.map.h[pd.TYPE]="atlas"};gf.prototype=n(sa.prototype,{get:function(a){return sa.prototype.get.call(this,a)},addAtlas:function(a){this._path.set(a);a=this._atlasMap;var b=this._path.getPathWithoutExt(),c=this._path.getExt().toLowerCase();null!=q[b]?a.setReserved(b,c):a.h[b]=c},getRes:function(a){var b=this._regions;if(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))return b=this._regions,null!=q[a]?b.getReserved(a):b.h[a];b=new Wd;var c=
this._regions;null!=q[a]?c.setReserved(a,b):c.h[a]=b;this._path.set(a);c=this.getAtlasPath(this._path);if(null==c&&null!=this._path.getDir()){var d=this._path.getDir()+".png";d=m.meta.getMeta(d);null!=d&&1==d.get("isAtlas")&&(this.addAtlas(d.path),c=d.path)}null!=c?(b.set_name(a.split(this._path.set(c).getPathWithoutExt()+"/").join("")),b.set_atlasName(c),b.set_texture(m.texture.get(c)),b.texture._file.forceBytes=!0,a=this._atlas,a=null!=q[c]?a.getReserved(c):a.h[c],null!=a&&b.init(a)):(b.set_texture(m.texture.get(a)),
b.texture.enabled&&b.init(null));return b},createRes:function(){return new Wd},onConstruct:function(){sa.prototype.onConstruct.call(this);this._atlasMap=new L;this._regions=new L;this._path=new ub;this._atlas=new L},init:function(){sa.prototype.init.call(this);m.texture.addEventListener(C.data._type,g(this,this.ondata))},getAtlasPath:function(a){var b=a.getPathWithoutExt();if(null==b){b=this._atlasMap;var c=a.getFileWithoutExt();return(null!=q[c]?b.existsReserved(c):b.h.hasOwnProperty(c))?a.toString():
null}for(c=this._atlasMap.keys();c.hasNext();)if(a=c.next(),-1!=b.indexOf(a))return b=this._atlasMap,a+"."+(null!=q[a]?b.getReserved(a):b.h[a]);return null},ondata:function(a){var b=m.texture.res._file.path;a=this._regions;var c=null!=q[b]?a.getReserved(b):a.h[b];null!=c&&(c.data.name=b,c.init(null));if(m.texture.tag==pd.TYPE){this._path.set(m.texture.res._file.path);a=this._path.getPathWithoutExt();var d=m.texture.bytes,e=new pd;m.texture.res.texture.params.mipmap=!1;e.decode(d);d=this._atlas;null!=
q[b]?d.setReserved(b,e):d.h[b]=e;b=e.regions;for(d=b.length;0<d--;){c=ub.combine(a,b[d].name);var f=this._regions;c=null!=q[c]?f.getReserved(c):f.h[c];null!=c&&c.init(e)}}}});var $c=function(a){this.type=a;this.compress=!0};$c.prototype={decode:function(a){if(ta.gt(1,a._length-a.position)||ta.gt(2,a._length-a.position)||ta.gt(13,a._length-a.position)||ta.gte(a.position+13,a._length))return null;if(-199789115==a.readUnsignedInt()){this.type=a.readUnsignedInt();var b=0!=a.readUnsignedByte(),c=a.readInt(),
d=wa._new();a.readBlob(d,0,c);return b?wa.fromBytes(dc.uncompress(wa.toBytes(d))):d}a.position-=4;return null}};var pd=function(){this._regions=new L;this.pages=[];this.regions=[];this.rotate=-1};pd.prototype={getRegion:function(a){var b=this._regions;return null!=q[a]?b.getReserved(a):b.h[a]},addRegion:function(a){this.regions.push(a);var b=this._regions,c=a.name;null!=q[c]?b.setReserved(c,a):b.h[c]=a;a.postInit()},decode:function(a){this._regions=new L;this.pages=[];this.regions=[];for(var b=a.readUnsignedByte();0<
b--;){var c=new Xd;c.decode(a);this.pages.push(c)}for(b=a.readUnsignedShort();0<b--;)c=new Ja,c.decode(a),c.page=this.pages[c.index],this.addRegion(c)}};var jb=function(){this._lasttype=0;this.reset()};jb.prototype={reset:function(){this._lasttype=this._index=this._value=0},getCode:function(){return this._value},getString:function(){return ia.hex(this._value,null)},addInt:function(a){2!=this._lasttype&&(this._lasttype=2,this._addInt(this._lasttype));this._addInt(a)},addString:function(a){4!=this._lasttype&&
(this._lasttype=4,this._addInt(this._lasttype));var b=a.length;for(this._addInt(b);0<b--;)this._addInt(y.cca(a,b))},addBool:function(a){16!=this._lasttype&&(this._lasttype=16,this._addInt(this._lasttype));this._addInt(a?1:0)},_addInt:function(a){this._value*=16777619;this._value^=a}};var ub=function(a){this.set(a)};ub.combine=function(a,b){return""==a||null==a?b:null==b||""==b?a:""==a?b:ub.addSlash(a)+ub.removeSlash(b)};ub.addSlash=function(a){if(0==a.length)return"/";var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");
return b<c?c!=a.length-1?a+"\\":a:b!=a.length-1?a+"/":a};ub.removeSlash=function(a){a:for(;;){var b=y.cca(a,a.length-1);if(null==b)break;else switch(b){case 47:case 92:a=y.substr(a,0,-1);break;default:break a}}a:for(;b=y.cca(a,0),null!=b;)switch(b){case 47:case 92:a=y.substr(a,1,null);break;default:break a}return a};ub.prototype={toString:function(){return(null==this._dir?"":this._dir+(this._leftslash?"/":"\\"))+(null==this._file?"":this._file)+(null==this._ext?"":"."+this._ext)},getDir:function(){return this._dir},
getPathWithoutExt:function(){return ub.combine(this._dir,this._file)},getExt:function(){return this._ext},getFileWithoutExt:function(){return this._file},isHttp:function(){var a=y.substr(this._value,0,7);return"http://"!=a?"https:/"==a:!0},set:function(a){this._value=a;this.clear();if(""==a||null==a)return this;switch(a){case ".":case "..":return this._dir=a,this._file="",this}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this._dir=y.substr(a,0,c),a=y.substr(a,c+1,null),this._leftslash=!1):
c<b?(this._dir=y.substr(a,0,b),a=y.substr(a,b+1,null),this._leftslash=!0):this._dir=null;-1!=a.indexOf("?")&&(b=a.split("?"),a=b.shift(),this._param=b.join("?"));b=a.lastIndexOf(".");-1!=b?(this._ext=y.substr(a,b+1,null),this._file=y.substr(a,0,b)):(this._ext=null,this._file=a);return this},clear:function(){this._param=this._ext=this._file=this._dir=null;this._leftslash=!1}};var Dd=function(){I.call(this);this.list=V.fromArray([]);this._map=new L};Dd.prototype=n(I.prototype,{addMeta:function(a){this.list.push(a);
if(null!=a.path){var b=this._map,c=a.path;null!=q[c]?b.setReserved(c,a):b.h[c]=a}},getMeta:function(a){var b=this._map;return(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))?(b=this._map,null!=q[a]?b.getReserved(a):b.h[a]):null},decode:function(a){this.list.clear();for(var b=new tb(this._map);b.hasNext();){var c=b.next();this._map.remove(c.key)}if(null!=a&&(b=a.readUnsignedInt(),!(6E4<b)))for(;0<b--;)c=new hf,c.read(JSON.parse(a.readUTF())),null!=c.path&&this.addMeta(c)}});var K=function(){I.call(this);
this._bytesLoader=new jd;this._bytesLoader.onComplete=g(this,this.onBytesComplete);this._fileList=new S};K.setGlobalRoot=function(a){null==a&&(a="");K._defaultRoot=a;K._path.set(K._defaultRoot);K._path.isHttp()&&(K._defaultRoot=K._path.toString()+"/");!ia.endsWith(K._defaultRoot,"/")&&0<K._defaultRoot.length&&(K._defaultRoot+="/")};K.setVersion=function(a,b){var c=K._version;null!=q[a]?c.setReserved(a,b):c.h[a]=b};K.getVersion=function(a){var b=K._version;if(null!=q[a]?!b.existsReserved(a):!b.h.hasOwnProperty(a))return"";
b=K._version;return null!=q[a]?b.getReserved(a):b.h[a]};K.prototype=n(I.prototype,{load:function(a,b){var c=this,d=new ic;K._path.set(a);var e=K._path.toString();d.setType(b).setPath(e);if(K._path.isHttp())d.setUrl(a);else{b="";if(K.enableVersion)if(b=K._version,null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))b=K._version,b=null!=q[a]?b.getReserved(a):b.h[a];else{b=K.meta.getMeta(a);b=null!=b?ia.hex(b.crc,null):"";var f=K._version;null!=q[a]?f.setReserved(a,b):f.h[a]=b}a=K._defaultRoot+e;""!=
b&&(a+="?"+b);d.setUrl(a)}a=d.get_key();e=K._fileMap;(null!=q[a]?e.existsReserved(a):e.h.hasOwnProperty(a))?(d=K._fileMap,d=null!=q[a]?d.getReserved(a):d.h[a]):(e=K._fileMap,null!=q[a]?e.setReserved(a,d):e.h[a]=d,this._fileList.push(d),K._list.push(this),K._loading||(null==K._delayCall&&(K._delayCall=new ba(function(){c._loadnext()})),K._delayCall.running||ba.add(K._delayCall,.1)));Jb.onLoad.file=d;K.onLoadEvent.dispatchEvent(Jb.onLoad);return d},_loadnext:function(){K._loading||0!=K._list.get_length()&&
K._list.shift()._load()},_load:function(){if(1>this._fileList.get_length())this._loadnext();else if(this._current=this._fileList.shift(),this._current.type==vb.NULL){if(null!=this._current.callback){var a=this._current.callback;a();this._current.dispose()}this._loadnext()}else if(this._current.done)this._loadnext();else if(null!=K.onLoadBefore)K.onLoadBefore(this._current,g(this,this.doLoad));else this.doLoad()},doLoad:function(){var a=this;K._loading=!0;if(this._current.forceBytes)null==this._current.bytes?
this._bytesLoader.load(this._current.url):this.completeFile();else if(this._current.type==vb.IMAGE){var b=new Zc;null!=this._current.bytes?b.fromBytes(this._current.bytes,function(b){a._current.image=b;a.completeFile()}):b.fromUrl(this._current.url,function(b){a._current.image=b;a.completeFile()})}else this.completeFile()},onBytesComplete:function(a){var b=this;this._current.bytes=a.bytes;this._current.type==vb.IMAGE?(new Zc).fromUrl(this._current.url,function(a){b._current.image=a;b.completeFile()}):
this.completeFile()},completeFile:function(){K._loading=!1;if(this._current.type!=vb.NULL){for(var a=K._fileMap.keys();a.hasNext();){var b=a.next(),c=K._fileMap;(null!=q[b]?c.getReserved(b):c.h[b])==this._current&&K._fileMap.remove(b)}this._current.dispatchEvent(C.complete);this._current.complete()}this._loadnext()}});var jf=function(){sa.call(this)};jf.prototype=n(sa.prototype,{get:function(a){return sa.prototype.get.call(this,a)},createRes:function(){return new kf},onLoadBefore:function(a){sa.prototype.onLoadBefore.call(this,
a)}});var lf=function(){sa.call(this)};lf.prototype=n(sa.prototype,{createRes:function(){return new mf},onLoadBefore:function(a){sa.prototype.onLoadBefore.call(this,a);a._file.forceBytes=!0}});var nf=function(){sa.call(this)};nf.prototype=n(sa.prototype,{get:function(a){return sa.prototype.get.call(this,a)},createRes:function(){return new of},onLoadBefore:function(a){sa.prototype.onLoadBefore.call(this,a);if(!a.enabled&&!a._file.forceBytes){var b=m.meta.getMeta(a._file.name);null!=b&&1==b.get("isAtlas")&&
(a._file.forceBytes=!0)}}});var m=B.lovedna.Assets=function(){};m.init=function(a){null==a&&(a="");K.setGlobalRoot(a);if(!m._init){m._init=!0;a=[m.bytes,m.texture,m.atlas,m.audio,m.fnt,m.cube,m.gltf,m.spine,m.table];for(var b=a.length;0<b--;){var c=a.pop();null!=c&&c.init()}m.meta=K.meta;a=wa.fromBytes(Eb.decode("eNrtPEtvI0d6mqy9zs7u7Cb7SHJsZC/dVIukSMkzEkMElIbSCEtSgkjRDgyDaZJNqmGym+5uvmT4kg0QB/CuNwGSQwwEeVw32QBZBM7GG59yyJ/IacZ2Tj7lmCBfPbuqukhJM2PvBggHmiar6nvUV1Xfq6r6zob3+xsbrcpBrfriwBu50TsbGxtf2vjaxgu+M3bvfDmKQ88f3nmxu4zd6KWNjTsb6PMr0AR9Xth4ET+/vPESfv7qxlfw8+7GV/Hzaxv38PPrG9/Az1/b+HX8/ObGt/Dz2xvfwc/f2PhN/PwtaB9dOn037PSC8Tjw//0r3+27A893jbMTo5jd3tne3Su8vFvc3bt3N6kpGC9nCw+K2w92i/n72w+SqsEocOKCMXN7BaWwiAqLSuEOKtxJCi+d0aBgjN2+Nx1PFCyorijWFeW6HbFOwcmrMFWBCW/h9gvGKJir1HBNkdcUlZodXrOj1JAKhc7IDSfG2FskJU7s+AX8vwAfOj38nwDZ7y+M/lF/IZYsUckyKYndReEh+j+ehm7hoVRxeHFQZVWH066bVEYOlDmxazqW0Rs544lpOLaRz+ZtYzubN6x7d3EnjEkwL5hGL/Cj2PB80jNjYVjGW0boAgrfWGQWJeNtoX3x2vYqxM4KCPq9YJQJFYahkFkUMAY0AgA6nkxjt9kLXdc/CyITl06CCDrx1r27BnxwSVCGskw+u1sihUF2sSyjcTfhmx1kl9ZmkJ3zyqs5ag8PWkKJB/CTUZ7AkI+avjMhJHsjbwL0bfwjwuw0vStXYqNgXE565aQSeBBYwg1idzwpmxQZ1OfY17mVAeBNzDLA2PBniYCYHWhYBrkFoYnwsPoEW5m1ygGuDEctd5IWk67eu3vpDS/prDZCx+8Lw4UJT2douCglXCNCODB824Xs3oO9B7bRhR/3H2QLxaJt9OD7TvH+7oPs7s5ukXIgQvZjaNEPYhMoAOs2poYmahfoWbYR+VA/DoCffmwjlWXJ3cCryYw834x8y8gYPYv0aIwUUgw9iWCE3Tr8EnqEK8dGMmqk9XhCccO314y88TqQRqrBNMb4J0wh9G2bfyugb5wjDLWdhlpyqCWHWspQhTTUFYe64lBXau8Jy2Sugi6DVe+EreDYGY+d5sTpuSYuD4fdpKvwozx2FiY8bUwQFIKloEX1sGbFNjvbL+PPfcvKgPbY3d1iwLu7loyIL3vCz1EwPIIxgtlKR9yLQCn23FZQXbqGTefBIBg2YyeMhd9Vv8+nHC8kqEBYJmlhbMkILSMnVDGsrH8iAujFFlGLvDTRjuosYy3E7rmLSeC7fuw5o7V9tDnzD10/8uLlml4hxZxDmE1ZTBkRPN2Z59mX5ptTJ3Q/hx6hGbW6V7ZRECbi8+kb1lxjZzIBh6s5Cb0Y6F60TarQiBIP3V6crA7C/7RsIm20heqyCyuHn1clsckMN1mSJkvaRFGxWJVN7ZnFlKzIz0W7FRCe1vFDMU1nGcLDfJPwtEQov8U8OzD4znQUd2ZuGP/bi04MHmYXzCVWKMhKerEX+Ptnp82T1slpA0CnvjcIwjHSezvGENzSDmjI0Fu0z/bbZ2vq6/t1qP2uNwCKxkX73l2JFurE/kUbWsyccAl9JIWz6QwBuX7fGyApUPDG6Xm9UlNQFA0f6DqjfVIrowIPk9Tq0LUqjeNqo6Xg2zFgug1hYu/T+hRGWq9DeXhaOz1PIewFoyDcx3UyMvB1cZ0O1cFpo8p/NL930micNI4VOU87XViD0Wv386/vo/alFGmn4wHenhvh+s5J42H1VV2ruQsWNqatXqmeHD9C/cZGEYbTjQ+ADhnQlFfmyVZxx0A8wTJmzEHL2PQs43V5qqNKMstZ1xMRSPKeB+Gof0anJGZqFnh9IAUWHH2zRNpg990RMGqUxTlIKZP/hbmInaTprIynG66jLKRa04HFAHjIysStIYO3FpQMpFCQDCZnO3rD8zHXyVCAm5BRJM8HEzQMpcoAN0XI5RrI5VrIqzWQV2sh52sg5wySjU6ZotCILi1GPEPnkzIDzqACk+koW1Dp0kwpzyeg9K6koR+OOqwaRC1pMWB/PtHNE6Z0MCtEmQAs+QKuOnbyzWTeZQxSQBpgs4PcUsSKdd1M4QoJ06JqRiJGyyyhZwxbWreDozv83a/mctR8GN7YGbrnYAz2DyrNKp7R9cpZ57x6DCq+jNnO23l72962bEE2J/X9k/pqBY+rBQOA12wP6kOHyXq/+ntVuQVgkJUiWysCYwlABKYcwmUIaFskas1LPRC0pzRm63Fs7/NWaQRIOdzEIlG1cEOVzqaS1kCR2bDaSN3YBtWQ8l45haVhGqG1y0cJA3YEm69vXxl3PWQeSfNK/eCEGEl964feYDCNXNr64cnR0UWzmm69Q1o3J25vOnJC2rx5Vj28qFXOlametpXp+axMt1vM/dIzWyJMsetE7iG2FBg7qClb+OO6QDfvDfpRLFWiL9iHelDlGTdgCqhWMIbyAVexzOWTpDbkJptCE+xLStQEjcY+Sf95Fspky9eezqxSqp/HlXq9sgJJFgJL0IQoIJDKbINFmxBUSjgVliiNSu3sUaXTqjZbMiFvIOB1fidpZsnt3krLBgKUnhP2NVIjno5S8fZ60a23hWlvRBY1/5aZrfJNdI2HYuOVqoPOOLqwG1htlRP/Oj1F09pYmbxFoyHbUvLVKmlatuSWVAFu4UwQhbNZqZXhmHK5Jz/559anH73/6V+/+/ijv//47/72sw/fffL+Xz3+4Getxx/88ODJn77bePLeTz79/s8ff/CDJ3/5B5+8/1MN8QMg3guDKDIbdktlD6eCWgeNMv5mtuwDu6HtQt2ZNJgDgadtamVs28jSwEQ2crnH//LDj//xzz752UdP3v/Xj9/70ZP3/vyTv/jDJz/6k//8o/c0uLlnAjFxhhMiKRdJ7wDmT3/+449/8Defvvv9J+//9Mk7//DZh+9sgeL77MM/lvEKwyzJHrqaSQ+UOpFT00CwS+zDEgXYRCAR46AdjahA25bNlIV8qqKoQ5OFiPGUo3EQxJdR7E5QgsnOZ1+2aZVmVHYYGF4JZGB2TFpmq08NVSx9iHFmKD1hSIKSvCTmGcquEXYQLdGfk/GinYpaVcErycPYpMRVxohwI2pRqfJcIWFCxhKyJLZskBMfXkaPdEhlNLl0yoL6LK2yBInGEYW+ieWCZyrj1srI1LGm57TQqiZAokNi5+XB0WhPoQRCgSPwj9moc84kJQhe9deZVz31cLLkf+58kcmSp0uXPNd0xP+ZcPu20eJThITKfEABVuaFLyCsuXVcIvl9F+1Os9pSHOLpLHIVZ5i0W+MM3y7o+QV4x7f3iZlsdD4xFtFqf5hUfzG+cC5H1O0Q7dOgFHmukC2Uns5Xxqj/31d+jr7yTW3JN5jumHRDbEz+4yXFmDhcGYnmJJVAQPhSkA0lDb46lZACRxngVirrrdU+KdgCwF60iVVKIJQ0dfuMKFWN+Zt26lRVo/p6KRV1zzpCyC0rvw6mqhWPrs9YPVAE2GmfdcCX5eM+itx0O8pCQ4xyVuch9Dl7MdexKm+vHRNt7l7bclX+nlvqG+TwlTV7k1x+Op9Pl60mp8+NgbJdkPgQ0lQo3T6V/uzp9GdLqT9bWv3ZUuvPll4H/4gcmpCS2Ik2Eo3yTHSYsEWZ4DMkV2gjfUKPjaxNIqxam0ow+4qaZy+aaQ7JwkTkaSiljc9oXuBGGKkiXIOSYdNk5l8hCQnaAZuVWjRgfuV5JSS6nrZLJEfBqHNG0TGXpGOpUA6rQYOmLxiMLdCwDc6+aH1BYaoJyU5Du0Ny65HTzVltPEGoXrTxWsfmQKfMSQN6RiovRooycjkaSOwWcA0zG+VODN91+5ExN0CbG5MwmLjwcEMUuMbezAXFGqL9dkCgGnwULfz3b+dy3wXHDx1gABLHtU711VaHNqK+YWcU9PcN13e6I3Q0T2p9Wm120HGIPjhRHYDxZg6iGhkJQC53GceTaD+XG3rx5bSb7QXj3Pcuw8APouMwmE5yw1HraOsVt3tc2zo7ANdoAgx7mIJwzKqUnAqsVxoXlVqneX58kBSiX52jSrPVqZydnZ++elKvtNS0exEkWCObAFQm6T0GXXPsPKX2F+jAnxzUUiEUOsUIwHSvoerPmqR8v9posz0HElHpAVmeQYFk2w9aUAjbwCqG/UHtorV/cP7wCJ7pjaTrIr9p54B5i4zyM2xtTemiYqjEHS7Wmp5XYS17zshN2nWah5VatYzbmFTnKwxU6yfN5km7upKF6tiLIpiUXJIJQHq8WWNyBkdsC5PrsHV6XmYHxcTYUGGpXm1VauenF8ePGtVmcyVjdTd2RiOvdx5Mh5fgzUSMwxR8msTp4WHtoglTdiX2015vNEWriGEVQTTyT9rHoesP40sJoNNsnVcbx61H+rEQpFjQ9aztjKbgN6Y6Jgi1wIRqqVuzwpykwyKFzAkKbdyuDPAhTnfefAf46PRYZWcQDPehuKQpJ5oCKjscDZVQjnxuG0v8giOJKA6nvdgAtXziDwLljFkDPItayUh9wCj1wH8DWz1yja4bz13XZ/sBYCpIIhdCb26XZJTtp0A589z5aoyPngIjPpIPIoLpJqKr3Qad0tF1eNu3wSv3dh1a8AR67iSeOiO+FEsUbcgKYELA4rQNB8hM48sgdPtGd2nEly5xwI1e6DroHKPp+ZNpbMSBQRwES6Q0Rkue45c6MKbagBCCWBHjjqbhwOm53OkvQuA2GEEP0OHKfEnBMZiORmIDkns1qGsJYWDP67uoHEvK0mPdk9AiGaQQopxW6Fyh9YExiV10UK5flqOREiY63AICBCE5IL7QpUeIjd4l8l1RhIs6n7Q3kc8WRETmrxVeF1kXNyVKqVmB2IWwmQTeaB4MwmDMN6/w3INuCOjYZkYK3xp0fLsmwfc26AoSrhOx1DtnJ+CcihdxHuzd3ysqzXqduudz6QEAqPudEr2jgLy3OKidNKqVc3JNIQqH3RM/Cc2ZaRV9PyV+W+kCpqIVGJPTaUxzkoQS9vuxbS9kC1YqrtCFPDXSD7yxx7yCnfzOrmUnKLXRHyc/RqmPpHGO7I4WsnsFy8a8CcxtCqfVrRzbR+VH1wvZHQuACFPrkqnJyV60XYUYYexCHKa3GBSENFOPedGT+0OXbt6Z0pj5elNFN6o6/QWL2dEFIjMxh9mFZatFy3TRlTRSCdqlgHaZRrtMo11egxaCoTS3F22BT/jBOBQvJMgYVMY4hqWIYbkCA7o0QNBkYxICIp62KHNJ2RLfIaClEZRyoC32lZcCmCbfr6ZIklTIUI6lqf9wkwWDQUlGgHBuM27XTFflvCF0ANBkSFJjaBtxWkpdXQYi1ZTcl+n6PM0Aa8cG3JZ+CQjNZddKSAusPF1Ceg+gyW6LEhnZ2N+z0K6IwKMv9x2oZwwTVnoenj5IAnm4JH9RNKUAyjaUn9tiPkP1Bxl3EikwRavOiFJ14NPT0kIYzDQB/DgUTIlJ/Udj0g1PkA8R2ZSqLdlodJpC8THH3uQwmOJTp3vZvHR/YRT00XrgOLMaZwekwzAIl9BgjkCcDMCS2REHh8bR9C5XQgL7p+Ty4ZaxljKIWxhN0ZzjlMIK4ij+NzWJA5iZHB9LODWrnVb11U7t9KHGxl9HpBb0q6+2TF2qwRaGw0ZSTignE+dWxK4lI1BIppkoM3TDTpReRhC+5CVpuEMmWmI0I04aySmCKjTy2YWxSb4slds5jJ1NjlK+MiDynJ71qUsx+k6A7kY+lXAtjhE75xK7FXLRsQbWTW3NnjylRRgL2xV2WEed/Dh0kU7q7JLIm1/NGroBxACh1+M5hnXsC8El8tCktVcrpaLFVJu21CaU6hUXXvLu49j1pw4Sbo0cW4NeEy7AlpIvMOxvhrGJ5kmIBElEgX8iGdFWFCxRuCkCbYlAmxFo34hAm4FZ6qVHqQsZiaA4HGMPjCKKveKHXrRGSatDwoOW5ptrhCqtzTXyHsjKG8fpqJ8CkS1lZB9ZEnICsokmnSwHEQeIFgcoGSAIf3Re6jb/VkbMOPO+IqWVXZZSUTAKddeBLErrMoV8D2xMM7CK37Aqa0hdCMqOvhsMZRa5ULrcAN0GTXrBIbrIlNJyRVHraRFloamzlVBQugUpkCYIWEH6wqQuKEfzUusF6Du78jyPfCZonaegpsvpMKCZmspbpkyoTEPfXnP6I1OWDn1gEzHIs8gCRaFWaUUaQTwOgs/lgFJhsaSFrhtz8UpQmTL1eYQpoM8r0Kh2kLcN5bAPA5XHT0zBlPG1bfQnocyCUOWCoaWWdFdi3cvzuSTSyhiFXTSh1Fkl9Qi8FS8M/LHrx+d5wY/gvboOaI+PyjalYzOvXc5LCXjwub8kmtYkBeXUDUtaxiylBrba82MB40xy7lkOHEYzCXkTMoCxjfOINAEk4kRpLXJeWMA+UrDLO2wK/9dhx2kmAfmlfNB4c7ZOHoD8UZIH5enSbhBfGjRPnE4Mkq3VrYQILTdn2Oku6ZyS5NQy8pDJMeX8tkY7MQ+FADjdiAHNrGugHqlkLq1VKrCWaj5a17ydaj7TN085BABEy8wkfMQyseXfbeX3I+F3TfndVn7rLIYQhzNzIJxR0S3Wa+r3xAayCREqRBWoQYjLSbGkPY4ETSF47IlfJQ3HMV7uKQd5ReuHWL9q/bcUhKz8cTiOfC6iyI+QDmKRih4U9SGBO4L2x/D3ELlUO4J3zLxREbRHTQFpgW1hspOObI7C1qZIzFI21/lRa3QMSZNdELIKvhRVXrdtKngRgeJlqbunPEFTEvkhtg5/t2kRuN2BrdtOvW7rmsvOpVvQ67wOZU+bOR3Uoqvb2CVFhoyC4l/Ie57CfZiCW2ZvvRCypDYzJPIM5S+wKKsvTwE8NtokzS7IgwfX5ES9IEq+lUo8B45SPv6tOepKD9fPKSJmeXM4py96JJjpt7/JzsNEbyzHzgSfgX18kwsV17zx4fpLEkV6Ul4u0m8GQwXfpJWObY6FSxqaCvV2h/DGp/1W5fy42uqcVc4r9eaaq6PyAaRxchPBpMTZ+Sl+o4HkGunI5nIyguRdVEK5TZniGoRfmWdENJcmxCtKVDzlxIZLcPQynnixKTXy6DBU7Y7uNE5n1WWI5ziauJiuJoDSnU4AtYbeE4VDyP3WSb3aaZ6gmagftlyOuThlCmgKOXvG2FZC0rIpV7ZIKDkMqqwzMbnHBWSznuG19W1+1swJY683cvHqevmlG6yuXC72xq4dBnNFCIDKGefZjZBt+Jc+4uH0ei6MHU570MM6dl5ul7oGtd9eU3u2f/0VqdvdjEq/7yQcRnl+8mRFg23SoLAKQYHUF0vSlasVN66f62V0mjkJg2FI4mrdpER/0llJ4eaV+EcPgPfLuE80v0LvDi5o4ZVYuKSFc6Fw0UMp/zKZLxKOpVRzlSKPOSPjFwwGkRuTs0no/W1e3yZ4rRx52uQVdl4/x8oJdrJoKJYI7cAQJMgSUUj0VWxMBYIv+SCAEi1A13oIHyVFiCuv0s9W3J+faS/NJw6A+ifXUGGjV5G1YHFimeezC0GyI2/AiqVBA5WD32BG666UuqrfpzXzkjoLJk4UYWp0uBZbnAHalk26MmuaQ2yUJJ6BSBm93dLkrNiUsM3A+Yhhr9clHG1zE0OdRHQghNbMN8mkW2QYYe1MQn+5XG9SnmzO4s18djfjZOJMzImRc+7ixdz1to56G3P0/kRosomZ5SxsirovY7JiXp/h72IkdshzESKFgTaz6IQMteeYA3GBIB8/9N0QcUI2IGdZtBWNXvmI/ttC7xYjB6kBIZJ3SYIOg9iJ3f4hRoKrpJIs2mo3OQl8W6IXRCY53gN0kqolxu/TKisTLTTolml0CQyEHzK6hBKgW2rQXZHzK0mXiCg3y+luiX8rL3eeMaFTRMn9BvKnsabIY/mnLz3bW26e/4XQp3/TjWS1kgPA2renEF8GWyy15fXXRa+9s7rGsN32Dik93J++5vv090nX3t2cKZc3te9AuOnVxPUXm29w6IHceyVHe7cVXat/I0fqnTCAIP22wenMTmbAuv4KV4HF8J6/3EKW1vO9irnmEubb32GrGZvjuhO9gZfzf73wy75Y5UPjEU1tlMm7geXK7mgaQgVxV7UvMErc4c/9tUlfiGL55b2H/rQ6Q3O8SdARn/trfvT6RLpHf5P3SiU6RHyDKigRPptucPn8c1VRY9AAK8ZHVVI0yQbao8yheFZSvJovrD8Oi6BI2n8LByOoDXg4dBlv8rItNNcyqPnmdtqCyZf7nUwZNbzmNRjrtOH/AqQItss="));
m._embedMap=new pf;try{a=wa.fromBytes(dc.uncompress(wa.toBytes(a)));for(var d=a.readUnsignedShort(),e=new Yd;0<d--;){var f=a.readUnsignedInt(),l=wa._new();a.readBytes(l,0,f);var h=e.readName(l);null!=h&&(e.name=h,e.onCreateItem=(P=m._embedMap,g(P,P.createTableItem)),e.decode(l))}m._embedMap.tableInit();var k=m.getEmbed("image_ui");null!=k&&(m.atlas.addAtlas("lovedna/ui.png"),m.texture.getRes("lovedna/ui.png")._file.bytes=wa.toBytes(k));k=m.getEmbed("font_en");null!=k&&(m.texture.getRes("lovedna/font_en.png")._file.bytes=
wa.toBytes(k))}catch(ch){}}};m.setVersion=function(a,b){K.setVersion(a,b)};m.disableVersion=function(){K.enableVersion=!1};m.getEmbed=function(a){return null==m._embedMap?null:m._embedMap.get(a)};m.loadMeta=function(a,b){if(m._init){""==K.getVersion(a)&&m.setVersion(a,m.version);var c=m.bytes.get(a);null==m._metasuccess&&(m._metasuccess=new L);if(null!=b){var d=m._metasuccess;null!=q[a]?d.setReserved(a,b):d.h[a]=b}c.addEventListener(C.complete._type,m.metaComplete)}};m.metaComplete=function(a){a=
a.target;if(a.enabled){var b=new $c(0),c=b.decode(a.bytes);b.type==Dd.TYPE&&m.meta.decode(c)}b=m._metasuccess;c=a._file.name;if(null!=q[c]?b.existsReserved(c):b.h.hasOwnProperty(c))b=m._metasuccess,c=a._file.name,b=null!=q[c]?b.getReserved(c):b.h[c],null!=b&&b(),m._metasuccess.remove(a._file.name)};m.prototype={};var jc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+10;a.set_resource(m.atlas.get(A.trapPath+"demonBlue.png"));a.addMeshRenderer()};jc.get=
function(){return jc.pool.get()};jc.prototype=n(T.prototype,{end:function(){jc.pool.set(this)}});var qf=function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.name=a;this.size=b;this.index=c};qf.prototype={};var k={_new:function(a,b,c){null==c&&(c=0);null==b&&(b=0);b=new qf(a,b,c);c=k._nameMap;null!=q[a]?c.setReserved(a,b):c.h[a]=b;return b},toString:function(a){return a.name},add:function(a,b){return k._new(a.name+b.name)}},kc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=
this._renderQueue+9;a.set_resource(m.atlas.get(A.trapPath+"board.png"));a.addMeshRenderer();a.material.loadShader(A.lightShader);a.material.setTexture(A.normal,k.toString(k.NORMALMAP))};kc.get=function(){return kc.pool.get()};kc.prototype=n(T.prototype,{end:function(){kc.pool.set(this)}});var lc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+9;a.set_resource(m.atlas.get(A.trapPath+"board2.png"));a.addMeshRenderer();a.material.loadShader(A.lightShader);
a.material.setTexture(A.normal,k.toString(k.NORMALMAP))};lc.get=function(){return lc.pool.get()};lc.prototype=n(T.prototype,{end:function(){lc.pool.set(this)}});var mc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+9;a.set_resource(m.atlas.get(A.trapPath+"gravity.png"));a.addMeshRenderer();a.material.loadShader(A.lightShader);a.material.setTexture(A.normal,k.toString(k.NORMALMAP))};mc.get=function(){return mc.pool.get()};mc.prototype=n(T.prototype,{end:function(){mc.pool.set(this)}});
var nc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+10;a.set_resource(m.atlas.get(A.trapPath+"bullet.png"));a.addMeshRenderer()};nc.get=function(){return nc.pool.get()};nc.prototype=n(T.prototype,{end:function(){nc.pool.set(this)}});var Ed=function(){I.call(this)};Ed.__name__="client.displays.objects.Keyholes";Ed.prototype=n(xa.prototype,{onAwake:function(){xa.prototype.onAwake.call(this)},onStart:function(){xa.prototype.onStart.call(this);this.addMeshRenderer()},
set:function(a,b){this.geometryBuffer.position.clear();this.geometryBuffer.uv.clear();this.geometryBuffer.group.clear();if(0<a){switch(b){case 1:b=1;break;case 3:b=2;break;case 6:b=3;break;default:b=1}b=m.atlas.get(A.trapPath+"keyHole"+b+".png");this.material.setAtlas(b);this.material.loadShader(A.lightShader);this.material.setTexture(A.normal,k.toString(k.NORMALMAP));if(b.enabled)for(var c=b.data.frame.z,d=b.data.frame.w,e=h._pool.get(),f=0,l=0;l<a;){var g=l++,n=g%4;g=p.floatToInt(g/4);e.set(n*(c-
1.5),-g*d,0);this.geometryBuffer.position.push(h.instance.set(0,0,0).add(e));this.geometryBuffer.position.push(h.instance.set(c,0,0).add(e));this.geometryBuffer.position.push(h.instance.set(c,d,0).add(e));this.geometryBuffer.position.push(h.instance.set(0,d,0).add(e));this.geometryBuffer.uv.push(b.data.getUV(0,0));this.geometryBuffer.uv.push(b.data.getUV(1,0));this.geometryBuffer.uv.push(b.data.getUV(1,1));this.geometryBuffer.uv.push(b.data.getUV(0,1));this.geometryBuffer.group.indices.push3(f,f+
1,f+2);this.geometryBuffer.group.indices.push3(f,f+2,f+3);f+=4}}this.geometryBuffer.update()},__class__:Ed});var oc=function(){T.call(this);this._positionOffset.set(0,-25,0);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+1;a.set_resource(m.atlas.get(A.trapPath+"door.png"));a.addMeshRenderer();a.material.loadShader(A.lightShader);a.material.setTexture(A.normal,k.toString(k.NORMALMAP));a=new v;this._holes=a.addComponent(Ed);this._holes.material.renderQueue=this._renderQueue+2;a.get_transform().position.set(-17,
40);a.setParent(this)};oc.get=function(){return oc.pool.get()};oc.prototype=n(T.prototype,{end:function(){oc.pool.set(this)},begin:function(a){T.prototype.begin.call(this,a);var b=a.data.params.getValue(4),c=a.data.params.getValue(5);this._holes.set(c,b);Ia.light.transform.position.copy(a.position)}});var pc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+9;a.set_resource(m.atlas.get(A.trapPath+"dragon.png"));a.addMeshRenderer()};pc.get=function(){return pc.pool.get()};
pc.prototype=n(T.prototype,{end:function(){pc.pool.set(this)}});var Ba=function(){I.call(this)};Ba.__name__="lovedna.game.components.Renderer";Ba.prototype=n(fa.prototype,{cull:function(a){return!0},collectRenderObject:function(a){},onConstruct:function(){fa.prototype.onConstruct.call(this);this.visible=!0;this.materials=[new Hb];this.cameraCull=!0},onDestroy:function(){fa.prototype.onDestroy.call(this);if(null!=this.materials){for(var a=this.materials.length;0<a--;)this.materials[a].dispose(),this.materials[a]=
null;this.materials=null}},get_material:function(){return this.materials[0]},__class__:Ba});var za=function(){this.identity()};za.prototype={copy:function(a){return null==a?this:this.set(a.m0,a.m1,a.m2,a.m3,a.m4,a.m5,a.m6,a.m7,a.m8,a.m9,a.m10,a.m11,a.m12,a.m13,a.m14,a.m15)},set:function(a,b,c,d,e,f,l,g,h,k,n,p,q,m,r,t){this.m0=a;this.m1=b;this.m2=c;this.m3=d;this.m4=e;this.m5=f;this.m6=l;this.m7=g;this.m8=h;this.m9=k;this.m10=n;this.m11=p;this.m12=q;this.m13=m;this.m14=r;this.m15=t;this._dirty=!0;
return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},append:function(a,b){null==b&&(b=!1);if(null==a)return this;var c=this,d=a;b&&(c=a,d=this);return this.set(c.m0*d.m0+c.m4*d.m1+c.m8*d.m2+c.m12*d.m3,c.m1*d.m0+c.m5*d.m1+c.m9*d.m2+c.m13*d.m3,c.m2*d.m0+c.m6*d.m1+c.m10*d.m2+c.m14*d.m3,c.m3*d.m0+c.m7*d.m1+c.m11*d.m2+c.m15*d.m3,c.m0*d.m4+c.m4*d.m5+c.m8*d.m6+c.m12*d.m7,c.m1*d.m4+c.m5*d.m5+c.m9*d.m6+c.m13*d.m7,c.m2*d.m4+c.m6*d.m5+c.m10*d.m6+c.m14*d.m7,c.m3*d.m4+c.m7*d.m5+c.m11*
d.m6+c.m15*d.m7,c.m0*d.m8+c.m4*d.m9+c.m8*d.m10+c.m12*d.m11,c.m1*d.m8+c.m5*d.m9+c.m9*d.m10+c.m13*d.m11,c.m2*d.m8+c.m6*d.m9+c.m10*d.m10+c.m14*d.m11,c.m3*d.m8+c.m7*d.m9+c.m11*d.m10+c.m15*d.m11,c.m0*d.m12+c.m4*d.m13+c.m8*d.m14+c.m12*d.m15,c.m1*d.m12+c.m5*d.m13+c.m9*d.m14+c.m13*d.m15,c.m2*d.m12+c.m6*d.m13+c.m10*d.m14+c.m14*d.m15,c.m3*d.m12+c.m7*d.m13+c.m11*d.m14+c.m15*d.m15)},inverse:function(){var a=this.getDeterminant();if(0==a)throw new w("non-invertible matrix");a=1/a;var b=this.m12*this.m10*this.m7-
this.m8*this.m14*this.m7-this.m12*this.m6*this.m11+this.m4*this.m14*this.m11+this.m8*this.m6*this.m15-this.m4*this.m10*this.m15,c=this.m8*this.m13*this.m7-this.m12*this.m9*this.m7+this.m12*this.m5*this.m11-this.m4*this.m13*this.m11-this.m8*this.m5*this.m15+this.m4*this.m9*this.m15,d=this.m12*this.m9*this.m6-this.m8*this.m13*this.m6-this.m12*this.m5*this.m10+this.m4*this.m13*this.m10+this.m8*this.m5*this.m14-this.m4*this.m9*this.m14,e=this.m13*this.m10*this.m3-this.m9*this.m14*this.m3-this.m13*this.m2*
this.m11+this.m1*this.m14*this.m11+this.m9*this.m2*this.m15-this.m1*this.m10*this.m15,f=this.m8*this.m14*this.m3-this.m12*this.m10*this.m3+this.m12*this.m2*this.m11-this.m0*this.m14*this.m11-this.m8*this.m2*this.m15+this.m0*this.m10*this.m15,l=this.m12*this.m9*this.m3-this.m8*this.m13*this.m3-this.m12*this.m1*this.m11+this.m0*this.m13*this.m11+this.m8*this.m1*this.m15-this.m0*this.m9*this.m15,g=this.m8*this.m13*this.m2-this.m12*this.m9*this.m2+this.m12*this.m1*this.m10-this.m0*this.m13*this.m10-this.m8*
this.m1*this.m14+this.m0*this.m9*this.m14,h=this.m5*this.m14*this.m3-this.m13*this.m6*this.m3+this.m13*this.m2*this.m7-this.m1*this.m14*this.m7-this.m5*this.m2*this.m15+this.m1*this.m6*this.m15,k=this.m12*this.m6*this.m3-this.m4*this.m14*this.m3-this.m12*this.m2*this.m7+this.m0*this.m14*this.m7+this.m4*this.m2*this.m15-this.m0*this.m6*this.m15,n=this.m4*this.m13*this.m3-this.m12*this.m5*this.m3+this.m12*this.m1*this.m7-this.m0*this.m13*this.m7-this.m4*this.m1*this.m15+this.m0*this.m5*this.m15,p=this.m12*
this.m5*this.m2-this.m4*this.m13*this.m2-this.m12*this.m1*this.m6+this.m0*this.m13*this.m6+this.m4*this.m1*this.m14-this.m0*this.m5*this.m14,q=this.m9*this.m6*this.m3-this.m5*this.m10*this.m3-this.m9*this.m2*this.m7+this.m1*this.m10*this.m7+this.m5*this.m2*this.m11-this.m1*this.m6*this.m11,m=this.m4*this.m10*this.m3-this.m8*this.m6*this.m3+this.m8*this.m2*this.m7-this.m0*this.m10*this.m7-this.m4*this.m2*this.m11+this.m0*this.m6*this.m11,r=this.m8*this.m5*this.m3-this.m4*this.m9*this.m3-this.m8*this.m1*
this.m7+this.m0*this.m9*this.m7+this.m4*this.m1*this.m11-this.m0*this.m5*this.m11,t=this.m4*this.m9*this.m2-this.m8*this.m5*this.m2+this.m8*this.m1*this.m6-this.m0*this.m9*this.m6-this.m4*this.m1*this.m10+this.m0*this.m5*this.m10;this.m0=(this.m9*this.m14*this.m7-this.m13*this.m10*this.m7+this.m13*this.m6*this.m11-this.m5*this.m14*this.m11-this.m9*this.m6*this.m15+this.m5*this.m10*this.m15)*a;this.m4=b*a;this.m8=c*a;this.m12=d*a;this.m1=e*a;this.m5=f*a;this.m9=l*a;this.m13=g*a;this.m2=h*a;this.m6=
k*a;this.m10=n*a;this.m14=p*a;this.m3=q*a;this.m7=m*a;this.m11=r*a;this.m15=t*a;this._dirty=!0;return this},setProjection:function(a,b,c,d){null==d&&(d=1.78);null==c&&(c=60);null==b&&(b=1E3);null==a&&(a=.1);c=1/Math.tan(.008726646259971648*c);this.m0=c/d;this.m4=this.m3=this.m2=this.m1=0;this.m5=c;this.m9=this.m8=this.m7=this.m6=0;this.m10=(b+a)/(a-b);this.m11=-1;this.m13=this.m12=0;this.m14=2*b*a/(a-b);this.m15=0;this._dirty=!0;return this},setOrtho:function(a,b,c,d,e,f){this.m0=2/(b-a);this.m4=
this.m3=this.m2=this.m1=0;this.m5=2/(d-c);this.m9=this.m8=this.m7=this.m6=0;this.m10=-2/(f-e);this.m11=0;this.m12=-(b+a)/(b-a);this.m13=-(d+c)/(d-c);this.m14=-(f+e)/(f-e);this.m15=1;this._dirty=!0;return this},lookAt:function(a,b,c){null==b&&(b=h._pool.get().set(0,0,0));null==c&&(c=h.get_up());var d=h._pool.get(),e=h._pool.get(),f=h._pool.get(),l=h._pool.get();b=d.copy(b).sub(a);l.copy(b).normalize();e.copy(b).normalize();e.cross(c).normalize();f.copy(e).cross(l).normalize();this.identity();this.m0=
e.x;this.m4=e.y;this.m8=e.z;this.m1=f.x;this.m5=f.y;this.m9=f.z;this.m2=-l.x;this.m6=-l.y;this.m10=-l.z;this.appendTranslation(d.copy(a).scale(-1));return this},setTranslation:function(a){this.m12=a.x;this.m13=a.y;this.m14=a.z;this._dirty=!0;return this},getTranslation:function(a){null==a&&(a=h._pool.get());return a.set(this.m12,this.m13,this.m14)},setScale:function(a){this.m0=a.x;this.m5=a.y;this.m10=a.z;this._dirty=!0;return this},getScale:function(a){null==a&&(a=h._pool.get());return a.set(1E-5>
p.abs(this.m4)&&1E-5>p.abs(this.m8)?p.abs(this.m0):Math.sqrt(this.m0*this.m0+this.m4*this.m4+this.m8*this.m8),1E-5>p.abs(this.m1)&&1E-5>p.abs(this.m9)?p.abs(this.m5):Math.sqrt(this.m1*this.m1+this.m5*this.m5+this.m9*this.m9),1E-5>p.abs(this.m2)&&1E-5>p.abs(this.m6)?p.abs(this.m10):Math.sqrt(this.m2*this.m2+this.m6*this.m6+this.m10*this.m10))},setRotation:function(a){var b=a.x*a.x,c=a.x*a.y,d=a.x*a.z,e=a.x*a.w,f=a.y*a.y,l=a.y*a.z,g=a.y*a.w,h=a.z*a.z;a=a.z*a.w;this.m0=1-2*(f+h);this.m1=2*(c+a);this.m2=
2*(d-g);this.m4=2*(c-a);this.m5=1-2*(b+h);this.m6=2*(l+e);this.m8=2*(d+g);this.m9=2*(l-e);this.m10=1-2*(b+f);this._dirty=!0;return this},getRotation:function(a){null==a&&(a=Ca._pool.get());var b=this.getRotationMatrix();return a.setFromAxes(b.m0,b.m4,b.m8,b.m1,b.m5,b.m9,b.m2,b.m6,b.m10)},getRotationMatrix:function(a){null==a&&(a=za._pool.get());var b=0>this.m4*this.m5*this.m6*this.m7?-1:1,c=0>this.m8*this.m9*this.m10*this.m11?-1:1,d=Math.sqrt,e=(0>this.m0*this.m1*this.m2*this.m3?-1:1)*d(this.m0*this.m0+
this.m1*this.m1+this.m2*this.m2);b*=d(this.m4*this.m4+this.m5*this.m5+this.m6*this.m6);c*=d(this.m8*this.m8+this.m9*this.m9+this.m10*this.m10);0==c&&(c=1);return a.set(this.m0/e,this.m1/e,this.m2/e,0,this.m4/b,this.m5/b,this.m6/b,0,this.m8/c,this.m9/c,this.m10/c,0,0,0,0,1)},appendTranslation:function(a){1E-5>p.abs(a.x)&&1E-5>p.abs(a.y)&&1E-5>p.abs(a.z)||this.append(za._pool.get().identity().setTranslation(a));return this},appendScale:function(a){1E-5>p.abs(a.x-1)&&1E-5>p.abs(a.y-1)&&1E-5>p.abs(a.z-
1)||this.append(za._pool.get().identity().setScale(a));return this},appendRotation:function(a){0==a.x&&0==a.y&&0==a.z&&1==a.w||this.append(za._pool.get().identity().setRotation(a));return this},appendTRS:function(a,b,c){null!=a&&this.appendTranslation(a);null!=b&&this.appendRotation(b);null!=c&&this.appendScale(c);return this},setTRS:function(a,b,c){return this.identity().appendTRS(a,b,c)},transformPoint:function(a,b){null==b&&(b=!1);var c=a.x,d=a.y,e=a.z,f=1;b&&(f=1/(c*this.m3+d*this.m7+e*this.m11+
this.m15));return a.set((c*this.m0+d*this.m4+e*this.m8+this.m12)*f,(c*this.m1+d*this.m5+e*this.m9+this.m13)*f,(c*this.m2+d*this.m6+e*this.m10+this.m14)*f)},fillFloat32Array:function(a,b){null==b&&(b=0);a[b++]=this.m0;a[b++]=this.m1;a[b++]=this.m2;a[b++]=this.m3;a[b++]=this.m4;a[b++]=this.m5;a[b++]=this.m6;a[b++]=this.m7;a[b++]=this.m8;a[b++]=this.m9;a[b++]=this.m10;a[b++]=this.m11;a[b++]=this.m12;a[b++]=this.m13;a[b++]=this.m14;a[b++]=this.m15},getDeterminant:function(){return this.m3*this.m6*this.m9*
this.m12-this.m2*this.m7*this.m9*this.m12-this.m3*this.m5*this.m10*this.m12+this.m1*this.m7*this.m10*this.m12+this.m2*this.m5*this.m11*this.m12-this.m1*this.m6*this.m11*this.m12-this.m3*this.m6*this.m8*this.m13+this.m2*this.m7*this.m8*this.m13+this.m3*this.m4*this.m10*this.m13-this.m0*this.m7*this.m10*this.m13-this.m2*this.m4*this.m11*this.m13+this.m0*this.m6*this.m11*this.m13+this.m3*this.m5*this.m8*this.m14-this.m1*this.m7*this.m8*this.m14-this.m3*this.m4*this.m9*this.m14+this.m0*this.m7*this.m9*
this.m14+this.m1*this.m4*this.m11*this.m14-this.m0*this.m5*this.m11*this.m14-this.m2*this.m5*this.m8*this.m15+this.m1*this.m6*this.m8*this.m15+this.m2*this.m4*this.m9*this.m15-this.m0*this.m6*this.m9*this.m15-this.m1*this.m4*this.m10*this.m15+this.m0*this.m5*this.m10*this.m15},get_data:function(){null==this._data&&(this._data=new Float32Array(16));if(this._dirty){var a=0;this._data[a++]=this.m0;this._data[a++]=this.m1;this._data[a++]=this.m2;this._data[a++]=this.m3;this._data[a++]=this.m4;this._data[a++]=
this.m5;this._data[a++]=this.m6;this._data[a++]=this.m7;this._data[a++]=this.m8;this._data[a++]=this.m9;this._data[a++]=this.m10;this._data[a++]=this.m11;this._data[a++]=this.m12;this._data[a++]=this.m13;this._data[a++]=this.m14;this._data[a++]=this.m15}return this._data}};var qc=function(){I.call(this)};qc.__name__="lovedna.game.components.LineRenderer";qc.prototype=n(Ba.prototype,{setWidth:function(a,b){this.startWidth=a;this.endWidth=b},clear:function(){this._count=0;this._dirty=!0;this.bindEvent(u.onUpdate,
null)},setPosition:function(a,b){var c=this._points.getArrayElement(a);null==c&&(c=new h,this._points.setArrayElement(a,c));c.copy(b);++a;a>this._count&&(this._count=a);this._dirty=!0;1<this._count&&this.bindEvent(u.onUpdate,g(this,this.onUpdate))},cull:function(a){return!this.visible||!this._gbuffer.enabled||3>this._gbuffer.indexBuffer.length?!0:!1},collectRenderObject:function(a){for(var b=0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){0==this.space?d.setMatrix(k.toString(k.M),
this.transform.getLocalToWorld()):d.setMatrix(k.toString(k.M),qc._worldMat);var e=this._gbuffer;a.add(eb._pool.get().set(d,e,0,0))}}},onAwake:function(){Ba.prototype.onAwake.call(this);this._dirty=this.additive=!1;this._points=V.fromArray([]);this.endWidth=this.startWidth=2;this._count=0;this._gbuffer=new Kb;this._buffer=new Za;this._buffer.uv=new fb;this._gbuffer.set(this._buffer);this.space=this.get_material().renderState.cullMode=0},onStart:function(){Ba.prototype.onStart.call(this);this.additive?
this.get_material().renderState.blendState.destinationColorBlendMode=1:this.get_material().renderState.blendState.destinationColorBlendMode=771;this.get_material().renderState._id=0},onUpdate:function(a){if(this._dirty)if(this._dirty=!1,this._buffer.clear(this._buffer.position),this._buffer.clear(this._buffer.uv),this._buffer.group.clear(),2>this._count)this._buffer.update();else if(null!=Wa.current){var b=h.get_forward();Wa.current.transform.get_worldRotation().rotate(b);var c=h._pool.get(),d=h._pool.get(),
e=h._pool.get();a=H._pool.get();for(var f=0,l=1/(this._count-1),g=(this.endWidth-this.startWidth)*l,k=0,n=this._count-1;k<n;){var p=k++,q=this._points.getArrayElement(p),m=this._points.getArrayElement(p+1);c.sub(m,q);d.cross(c,b).normalize().scale(this.startWidth+g*p);e.copy(q).add(d);this._buffer.position.push(e);e.copy(q).sub(d);this._buffer.position.push(e);q=p*l;m=0;null==m&&(m=0);null==q&&(q=0);a.x=q;a.y=m;this._buffer.uv.push(a);p*=l;q=1;null==q&&(q=0);null==p&&(p=0);a.x=p;a.y=q;this._buffer.uv.push(a);
this._buffer.group.indices.push3(f,f+1,f+3);this._buffer.group.indices.push3(f,f+3,f+2);f+=2}b=this._points.getArrayElement(this._count-1);e.copy(b).add(d);this._buffer.position.push(e);e.copy(b).sub(d);this._buffer.position.push(e);d=1;e=0;null==e&&(e=0);null==d&&(d=0);a.x=d;a.y=e;this._buffer.uv.push(a);e=d=1;null==e&&(e=0);null==d&&(d=0);a.x=d;a.y=e;this._buffer.uv.push(a);this._buffer.update()}},__class__:qc});var rc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+
10;a.set_resource(m.atlas.get(A.trapPath+"editTarget.png"));a.addMeshRenderer();this._line=this.addComponent(qc);this._line.space=1;this._line.get_material().renderQueue=this._renderQueue+9;this._line.get_material().color.w=.5;this._line.setWidth(2,2);this._start=new h;this._end=new h};rc.get=function(){return rc.pool.get()};rc.prototype=n(T.prototype,{end:function(){rc.pool.set(this)},begin:function(a){T.prototype.begin.call(this,a);this._target=a;this._line.clear();this._start.copy(this._target.position);
this._end.copy(this._target.owner.position);this._line.setPosition(0,this._start);this._line.setPosition(1,this._end)},syncTransform:function(){T.prototype.syncTransform.call(this);this._start.copy(this._target.position);this._line.setPosition(0,this._start);this._end.copy(this._target.owner.position);this._line.setPosition(1,this._end)}});var sc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+10;a.set_resource(m.atlas.get(A.trapPath+"fire.png"));a.material.renderState.blendState.destinationColorBlendMode=
1;a.addMeshRenderer()};sc.get=function(){return sc.pool.get()};sc.prototype=n(T.prototype,{end:function(){sc.pool.set(this)},begin:function(a){T.prototype.begin.call(this,a);this._r=0},udpate:function(){T.prototype.udpate.call(this);this._r+=1800*this.deltaTime;this.get_transform().rotation.setEulerAngles(0,0,this._r)}});var tc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+10;a.set_resource(m.atlas.get(A.trapPath+"bird.png"));a.addMeshRenderer()};tc.get=
function(){return tc.pool.get()};tc.prototype=n(T.prototype,{end:function(){tc.pool.set(this)}});var uc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+9;a.set_resource(m.atlas.get(A.trapPath+"gear.png"));a.addMeshRenderer();a.material.loadShader(A.lightShader);a.material.setTexture(A.normal,k.toString(k.NORMALMAP))};uc.get=function(){return uc.pool.get()};uc.prototype=n(T.prototype,{end:function(){uc.pool.set(this)}});var vc=function(){T.call(this);var a=
this.addComponent(O);a.material.renderQueue=this._renderQueue+10;a.set_resource(m.atlas.get(A.trapPath+"gravity.png"));a.addMeshRenderer()};vc.get=function(){return vc.pool.get()};vc.prototype=n(T.prototype,{end:function(){vc.pool.set(this)}});var wc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+9;a.rectTransform.pivot.x=.4;a.set_resource(m.atlas.get(A.trapPath+"gun.png"));a.addMeshRenderer()};wc.get=function(){return wc.pool.get()};wc.prototype=n(T.prototype,
{end:function(){wc.pool.set(this)}});var xc=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=this._renderQueue+9;a.rectTransform.pivot.x=.4;a.set_resource(m.atlas.get(A.trapPath+"gunHoming.png"));a.addMeshRenderer()};xc.get=function(){return xc.pool.get()};xc.prototype=n(T.prototype,{end:function(){xc.pool.set(this)}});var ad=function(){I.call(this)};ad.__name__="lovedna.game.components.TrailRenderer";ad.prototype=n(Ba.prototype,{clear:function(){for(var a=this._capacity;0<
a--;)this._points.get(a).life=0;this._index=0;this._gbuffer.indexBuffer.length=0},onConstruct:function(){Ba.prototype.onConstruct.call(this);this.additive=!0;this.capacity=50;this.life=5;this.minDistance=.2;this.width=.5;this._color=new F(1,1,1,1);this._index=0;this.alignRotation=new h(0,0,0);this.emiting=!0},onAwake:function(){Ba.prototype.onAwake.call(this);this._gbuffer=new Kb;this._buffer=new Za;this.get_material().renderQueue=20001;this.get_material().renderState.depthState.writeEnabled=!1;this.align=
this.textureMode=this.get_material().renderState.cullMode=0;this.colors=new rf;this.colors.add(0,new F(1,1,1,1));this.colors.add(.5,new F(1,1,1,.8));this.colors.add(1,new F(1,1,1,0));this.sizes=new sf;this.sizes.add(new Fd(0,1));this.sizes.add(new Fd(1,0))},onStart:function(){Ba.prototype.onStart.call(this);3>this.capacity&&(this.capacity=3);this._capacity=this.capacity;this._distance=this.minDistance*this.minDistance;this._points=new S;this._buffer.color=new Ib;this._buffer.uv=new fb;for(var a=0,
b=this._capacity;a<b;){var c=a++;this._points.push(new Ta);var d=0;0==this.textureMode?d=1-c/(this._capacity-1):1==this.textureMode&&(d=0==(c&1)?0:1);var e=H.instance,f=d,l=0;null==l&&(l=0);null==f&&(f=0);e.x=f;e.y=l;this._buffer.uv.push(e);e=H.instance;f=1;null==f&&(f=0);null==d&&(d=0);e.x=d;e.y=f;this._buffer.uv.push(e);d=2*c;c>=this._capacity-1||(this._buffer.group.indices.push3(d,d+2,d+3),this._buffer.group.indices.push3(d,d+3,d+1))}this._gbuffer.set(this._buffer);this.bindEvent(u.onLateUpdate,
g(this,this.onUpdate));this._transform=this.actor.get_transform();this._frameId=this._transform.transformFrame;0>=this.life&&(this.life=1);0>=this.width&&(this.width=1);this.additive?this.get_material().renderState.blendState.destinationColorBlendMode=1:this.get_material().renderState.blendState.destinationColorBlendMode=771;this.get_material().renderState._id=0},cull:function(a){return!this.visible||!this._gbuffer.enabled||3>this._gbuffer.indexBuffer.length?!0:!1},collectRenderObject:function(a){for(var b=
0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){d.setMatrix(k.toString(k.M),ad._worldMat);var e=this._gbuffer;a.add(eb._pool.get().set(d,e,0,0))}}},onUpdate:function(a){if(this.visible){this._frameId<this._transform.transformFrame&&(this._frameId=this._transform.transformFrame,a=this._transform.get_worldPosition(),null==this._lastPosition&&(this._lastPosition=(new h).copy(a)),a.distanceSquared(this._lastPosition)>this._distance&&(this._lastPosition.copy(a),this.emiting&&
(this._points.get(this._index++,!0).add(a,this.life),this._index>=this._points.get_length()&&(this._index=0))));0>=this.life&&(this.life=1);var b=this.actor.deltaTime,c=this._capacity;a=this._index-1;for(var d=0;0<c--;){var e=this._points.get(a--,!0);e.update(b);if(0>=e.life)break;++d}if(!(2>d)&&(a=this._index-1,b=h.get_forward(),0==this.align?(b.add(this.alignRotation),Wa.current.actor.get_transform().get_worldRotation().rotate(b)):1==this.align?(b.add(this.alignRotation),this._transform.get_worldRotation().rotate(b)):
2==this.align&&b.copy(this.alignRotation),c=d,--d,this._buffer.position.clear(),this._buffer.color.clear(),0<c)){for(e=this.transform.get_worldScale().x;0<c--;){var f=this._points.get(a--,!0);f.normal=b;0<c?(f.next=this._points.get(a,!0),f.next.prev=f):f.next=null;var l=1-c/d;this.colors.evaluate(l)&&(this._color.copy(this.colors.start),this._color.lerpTo(this.colors.end,this.colors.ratio));l=this.sizes.evaluate(l)*this.width*e;f.drawTo(this,l,this.align)}this._buffer.update();c=6*p.floatToInt(.5*
this._buffer.position.length-1);this._gbuffer.indexBuffer.length=c}}},add:function(a){this._buffer.position.push(a);this._buffer.color.push(this._color)},__class__:ad});var Vb=function(){I.call(this)};Vb.__name__="lovedna.game.components.ParticleRenderer";Vb.prototype=n(Ba.prototype,{getPosition:function(){return 1==this.space?this.transform.get_worldPosition():h.instance.set(0,0,0)},getRotation:function(){return 1==this.space?this.transform.get_worldRotation():this.transform.rotation},clear:function(){for(var a=
this._list.get_length();0<a--;){var b=this._list.getArrayElement(a);this._list.removeAt(a);Wb.temp.set(b)}this._dirty=!0},emit:function(a){null==a&&(a=1);if(1>a)return!1;if(this._list.get_length()<this._capacity){for(var b=this.transform.get_worldScale().x;0<a--;){this.shape.life=this._life;this.shape.update();var c=Wb.temp.get();c.startTime=this._life;c.life=this.life.get();c.time=c.life;c.sizeStart=this.sizeStart.get()*b;c.sizeEnd=this.sizeEnd.get()*b;c.position.copy(this.shape.position);var d=
(1==this.space?this.shape.rotation:this.transform.get_worldRotation()).rotate(h.get_forward()).scale(this.speed.get()*b);c.speed.copy(d);c.angleStart=.017453292519943295*this.angle.get();c.angleDelta=.017453292519943295*this.angleDelta.get();c.scaleX=this.scaleX;c.scaleY=this.scaleY;c.id=p.floatToInt(this.partId.get());c.id>=this._partSize&&(c.id=this._partSize);this._list.push(c);this._dirty=!0;if(this._list.get_length()>=this._capacity)return!1}return!0}return!1},cull:function(a){return!this.visible||
!this._gbuffer.enabled||3>this._gbuffer.indexBuffer.length?!0:!1},collectRenderObject:function(a){for(var b=0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){1==this.space?d.setMatrix(k.toString(k.M),Vb._worldMat):d.setMatrixHandler(k.toString(k.M),(P=this.transform,g(P,P.getLocalToWorld)));var e=this._gbuffer;a.add(eb._pool.get().set(d,e,0,0))}}},onConstruct:function(){Ba.prototype.onConstruct.call(this);this.additive=!0;this.capacity=50;this.life=new pb(4,5);this.sizeStart=
new pb(1,1);this.sizeEnd=new pb(0,0);this.rateTime=.2;this.speed=new pb(1,1);this._life=0;this.emiting=this.playing=!0;this.delay=0;this.angle=new pb(0,0);this.angleDelta=new pb(-100,100);this.space=1;this.partId=new pb(0,0);this.scaleX=this.scaleY=this._partSize=1},onAwake:function(){Ba.prototype.onAwake.call(this);this.get_material().loadShader("particle");this.get_material().renderQueue=20002;this.get_material().renderState.depthState.writeEnabled=!1;this.get_material().renderState.cullMode=0;
this._param0=new ya(0,1,1,0);this.acceleration=new h(0,0,0);this.get_material().setFloat3("acceleration",this.acceleration);this.get_material().setFloat4("param0",this._param0);this.set_shape(new tf(0,0));this._list=V.fromArray([])},onStart:function(){Ba.prototype.onStart.call(this);this._gbuffer=new Kb;this._capacity=this.capacity;this._time=-this.delay;1>this._capacity&&(this._capacity=1);this._buffer=new Za;this._buffer.uv=new fb;this._buffer.tangent=new Ib;this._buffer.color=new Ib;this._buffer.color2=
new Ib;this._buffer.color3=new Ib;for(var a=0,b=this._capacity;a<b;){var c=a++,d=H.instance,e=0,f=1;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);d=H.instance;f=e=1;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);d=H.instance;e=1;f=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);d=H.instance;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;this._buffer.uv.push(d);c*=4;this._buffer.group.indices.push3(c,c+1,c+2);this._buffer.group.indices.push3(c,
c+2,c+3)}this._gbuffer.set(this._buffer);this.bindEvent(u.onUpdate,g(this,this.onUpdate));this._gbuffer.indexBuffer.length=0;this.additive?this.get_material().renderState.blendState.destinationColorBlendMode=1:this.get_material().renderState.blendState.destinationColorBlendMode=771;this.get_material().renderState._id=0},onUpdate:function(a){if(this.playing){this._gbuffer.indexBuffer.length=0;var b=this.actor.deltaTime;this._life+=b;this._param0.x=this._life;this._time+=b;for(a=this._list.get_length();0<
a--;){var c=this._list.getArrayElement(a);c.time-=b;0>=c.time&&(this._list.removeAt(a),Wb.temp.set(c),this._dirty=!0)}0>=this.rateTime&&(this.rateTime=.01);for(;this._time>=this.rateTime;)this._time-=this.rateTime,this.emiting&&this.emit();if(this._dirty&&(a=this._list.get_length(),this._dirty=!1,this.count=a,0<a)){this._buffer.clear(this._buffer.position);this._buffer.clear(this._buffer.color);this._buffer.clear(this._buffer.color2);this._buffer.clear(this._buffer.color3);b=0;for(c=a;b<c;){var d=
b++;this._list.getArrayElement(d).draw(this._buffer)}this._gbuffer.indexBuffer.length=6*a;this._buffer.update()}this._gbuffer.indexBuffer.length=6*this.count}},set_shape:function(a){if(null==a)return this.shape;this.shape=a;this.shape.init(this);return this.shape},__class__:Vb});var yc=function(){T.call(this);this._shake=new h;this._skin=new v;this._skin.setParent(this);this._image=this._skin.addComponent(O);this._skin.get_transform().position.y=-10;this._image.set_resource(m.atlas.get(A.trapPath+
"hero0.png"));this._image.addMeshRenderer();this._image.material.renderQueue=this._renderQueue+11;this._position=new h;var a=new v;a.setParent(this);this._trail=a.addComponent(ad);this._trail.additive=!1;this._trail.get_material().setAtlas(m.atlas.get(A.effectPath+"type0_2.png"));this._trail.get_material().renderQueue=this._renderQueue+10;this._trail.width=10;this._trail.life=.6;this._trail.minDistance=1;this._trail.capacity=30;this._trail.sizes.clear();this._trail.sizes.addValue(0,1);this._trail.sizes.addValue(1,
.8);this._trail.get_material().color.w=.8;a=new v;a.setParent(this);this._particle=a.addComponent(Vb);this._particle.get_material().renderQueue=this._renderQueue+10;this._particle.additive=!1;this._particle.capacity=10;a=this._particle.life;var b=.5,c=.8;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._particle.emiting=!1;a=this._particle.sizeStart;c=b=32;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._particle.sizeEnd;c=b=25;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._particle.angle;c=b=0;
null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._particle.angleDelta;c=b=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=new v;a.get_transform().position.y=10;a.setParent(this);a.name="test";this._smokeParticle=a.addComponent(Vb);this._smokeParticle.get_material().renderQueue=this._renderQueue+4;this._smokeParticle.get_material().color.setRGBA(-858993409);this._smokeParticle.additive=!1;this._smokeParticle.capacity=20;a=this._smokeParticle.life;b=.2;c=.8;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._smokeParticle.emiting=
!1;this._smokeParticle.get_material().setAtlas(m.atlas.get(A.effectPath+"circle.png"));this._smokeParticle.get_material().setAtlas(m.atlas.get(A.effectPath+"mask1.png"),k.toString(k.NORMALMAP));a=this._smokeParticle.sizeStart;b=1;c=4;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._smokeParticle.sizeEnd;b=6;c=10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._smokeParticle.speed;b=40;c=70;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._smokeShape=this._smokeParticle.shape;this._smokeShape.minSize=
5;this._smokeShape.maxSize=10;a=this._smokeShape.rangeY;b=-.2;c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._smokeParticle.transform.position.y=-10};yc.get=function(){return yc.pool.get()};yc.prototype=n(T.prototype,{end:function(){yc.pool.set(this)},begin:function(a){T.prototype.begin.call(this,a);this._hero=a;this._smokeParticle.clear();this._trail.clear();this._particle.clear();this._shakeTime=this._partDistance=0;this._hero.self?(this._image.material.color.w=1,this._trail.get_material().color.w=
.5,this._particle.get_material().color.w=.8):(this._image.material.color.w=.5,this._trail.get_material().color.w=.2,this._particle.get_material().color.w=.2);this._fly=0;this._position.copy(a.position);this.get_transform().rotation.setEulerAngles(0,0,0);this._skin.get_transform().scale.set(1,1,1);a=N.skin.get(2).base;this._image.rectTransform.width=this._image.rectTransform.height=-1;this._image.set_resource(m.atlas.get(A.trapPath+""+a+".png"));a=m.atlas.get(A.trapPath+""+a+".png");this._particle.get_material().setAtlas(a);
this._particle.transform.position.y=a.data.originalSize.y*a.data.pivot.y;this._particleAngleOffset=90*a.data.rotate;this._particle.get_material().setAtlas(m.atlas.get(A.effectPath+"mask1.png"),k.toString(k.NORMALMAP));this._enableSmoke=this._enableTrail=!0;this._trail.emiting=this._enableTrail},syncTransform:function(){if(null!=this._hero&&(this._hero.self&&Ia.light.transform.position.copy(this._hero.position),this._hero.playing)){this._position.copy(this.shape.position);var a=!1,b=0;this._hero.running?
(this._shakeTime+=20*this.deltaTime,this._shake.y=.8*Math.sin(this._shakeTime),this._trail.transform.position.copy(this._shake),a=!0):this._hero.flying&&this._enableSmoke&&(b=1,a=!0);if(a&&this._enableTrail&&(this._partDistance+=this.get_transform().position.distance(this._position),100<this._partDistance)){this._partDistance-=100;this._particle.scaleX=this.shape.scale.x;this._particle.scaleY=this.shape.scale.y;a=this._particle.angle;var c=this.shape.rotation+this._particleAngleOffset,d=this.shape.rotation+
this._particleAngleOffset;null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;this._particle.emit()}this._enableSmoke&&(this._hero.flyCount<this._fly||13==this._hero.flyCount)&&(b=6);if(0<b)for(this._smokeParticle.transform.position.x=10*(0<this._hero.velocity.x?1:-1),0<this.shape.scale.x?(a=this._smokeShape.rangeX,c=-.5,d=-.1,null==d&&(d=0),null==c&&(c=0),a.x=c,a.y=d):(a=this._smokeShape.rangeX,c=.1,d=.5,null==d&&(d=0),null==c&&(c=0),a.x=c,a.y=d),a=0;a<b;)a++,this._smokeParticle.emit();this.get_transform().position.copy(this._position).add(this._positionOffset);
this.get_transform().rotation.setEulerAngles(0,0,this.shape.rotation);this._skin.get_transform().scale.copy(this.shape.scale);this._fly=this._hero.flyCount}}});var zc=function(){T.call(this);var a=this.addComponent(O);a.set_resource(m.atlas.get(A.trapPath+"demonRed.png"));a.material.renderQueue=this._renderQueue+10;a.addMeshRenderer()};zc.get=function(){return zc.pool.get()};zc.prototype=n(T.prototype,{end:function(){zc.pool.set(this)}});var Ac=function(){T.call(this);var a=this.addComponent(O);a.material.renderQueue=
this._renderQueue+10;a.set_resource(m.atlas.get(A.trapPath+"ricochet.png"));a.addMeshRenderer()};Ac.get=function(){return Ac.pool.get()};Ac.prototype=n(T.prototype,{end:function(){Ac.pool.set(this)}});var Bc=function(){T.call(this);this._image=this.addComponent(O);this._image.addMeshRenderer();this._image.material.renderQueue=this._renderQueue+10};Bc.get=function(){return Bc.pool.get()};Bc.prototype=n(T.prototype,{end:function(){Bc.pool.set(this)},begin:function(a){T.prototype.begin.call(this,a);
this._image.reset();this._image.set_resource(m.atlas.get(A.uiPath+"ui_tips1.png"))}});var uf=function(){this.rect=new bd;this.lineIndex=0;this.clearStyle()};uf.prototype={set_char:function(a){this.char=a;this.clearStyle();return this.char},clearStyle:function(){this.chunk=null;this.customSize=0;this.customColorBottom=this.customColorTop=null},addRichChunk:function(a){this.chunk=a;"size"==this.chunk.name?this.customSize=p.stringToFloat(a.value):"color"==this.chunk.name&&(-1==this.chunk.value.indexOf(",")?
(this.customColorBottom=this.customColorTop=new F,this.customColorTop.parse(this.chunk.value),this.customColorTop.w=1):(this.customColorBottom=this.customColorTop=new F,a=this.chunk.value.split(","),1<a.length&&(this.customColorBottom=new F,this.customColorTop.parse(a[0]),this.customColorBottom.parse(a[1]),this.customColorTop.w=1,this.customColorBottom.w=1)))}};var ya=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};ya.prototype={copy:function(a){if(null==
a||a==this)return this;var b=a.x,c=a.y,d=a.z;a=a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);this.x=b;this.y=c;this.z=d;this.w=a;return this},mul:function(a,b){var c=null==b,d=c?this:a,e=c?a:b;a=d.x*e.x;b=d.y*e.y;c=d.z*e.z;d=d.w*e.w;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d;return this},parse:function(a){if(null==a)return this;a=a.split(",");for(var b=a.length,c=4;0<c--;)if(c>=b)this.setArrayElement(c,0);else{var d=a[c];0<d.length?
this.setArrayElement(c,parseFloat(d)):this.setArrayElement(c,0)}return this},lerpTo:function(a,b){if(0>=b)return this;if(1<=b)return this.copy(a);this.x+=b*(a.x-this.x);this.y+=b*(a.y-this.y);this.z+=b*(a.z-this.z);this.w+=b*(a.w-this.w);return this},setArrayElement:function(a,b){0>a?a=a%4+4:4<=a&&(a%=4);switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b}},fillArray:function(a,b){null==b&&(b=0);a[b++]=this.x;a[b++]=this.y;a[b++]=this.z;a[b++]=this.w}};var bd=
function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);ya.call(this,a,b,c,d);this.x=a;this.y=b;this.set_width(c);this.set_height(d)};bd.prototype=n(ya.prototype,{set_width:function(a){return this.z=a},set_height:function(a){return this.w=a},get_right:function(){return this.x+this.z}});var vf=function(){this.y=this.height=this.width=this.index=0;this.charList=new S};vf.prototype={setDefault:function(a){this._txt=a;this._size=this._txt._font.fnt.size;this._lineHeight=this._txt._font.fnt.base;
this._scale=1;0<this._txt.size&&(this._scale=this._txt.size/this._size,0>=this._scale&&(this._scale=1));this._maxWidth=a.rectTransform.width;this._maxHeight=a.rectTransform.height;this._x=this.y=this.height=this.width=this.index=0;this.charList.clear()},add:function(a){if(null==a.char)return 1;var b=a.char.width,c=a.char.height,d=this._lineHeight,e=this._scale;0<a.customSize&&(e=a.customSize/this._txt._font.fnt.size,0>=e&&(e=1));b*=e;c*=e;d*=e;if(0<this._maxWidth&&this._x+b+a.char.xoffset*e>this._maxWidth)return 0;
a.rect.x=this._x+a.char.xoffset*e;a.rect.y=this._lineHeight-a.char.yoffset-a.char.height+2;a.rect.set_width(b);a.rect.set_height(c);this.width=this._x+=a.char.xadvance*e+this._txt._letterSpace;this.charList.push(a);d>this.height&&(this.height=d);return 1},complete:function(){1>this.charList.get_length()&&(this.height=this._txt._font.fnt.lineHeight);this.y+=this.height;this._txt=null}};var Xb=function(){this._paramKey=new S};Xb.prototype={Parse:function(a,b){this._paramMap=new L;this.next=this.value=
this.name=null;this._paramKey.clear();this.start=b;a=ia.replace(a,Xb.tokenLeft,"");a=ia.replace(a,Xb.tokenRight,"");a=p.trim(a);this.type=-1;b=a.indexOf("/");if(0==b)this.type=1,this.name=y.substr(a,b+1,null);else{b==a.length-1&&(this.type=0,a=p.trim(y.substr(a,0,a.length-1)));b=a.indexOf(" ");var c=a.indexOf("=");-1==b&&-1==c?this.name=a:-1!=b&&-1!=c?c<b?(a=a.split("="),this.name=p.trim(a[0]),1<a.length&&(this.value=a[1])):(this.name=y.substr(a,0,b),this.parseParams(y.substr(a,b+1,null))):-1!=b?
(this.name=y.substr(a,0,b),this.parseParams(y.substr(a,b+1,null))):-1!=c&&(this.name=p.trim(y.substr(a,0,c)),this.parseParams(y.substr(a,c+1,null)))}},setNext:function(a){this.next=a},parseParams:function(a){a=p.trim(a);if(-1==a.indexOf(" ")&&-1==a.indexOf("="))this.value=a;else{a=a.split(" ");var b=a.length;if(0!=b)for(var c=0;c<b;){var d=c++;d=p.trim(a[d]);if(""!=d){var e=d.split("=");d=p.trim(e[0]);var f=null;1<e.length&&(f=p.trim(e[1]));this._paramKey.push(d);e=this._paramMap;null!=q[d]?e.setReserved(d,
f):e.h[d]=f}}}}};var Gd=function(){this._chunkList=new S;this._list=new S};Gd.prototype={parse:function(a){this.value=a;this._chunkList.clear();for(a=a.length;;){var b=this.value.indexOf(Xb.tokenLeft,0),c=this.value.indexOf(Xb.tokenRight,b),d=c-b;if(0<d&&0<=b){if(this.addChunk(b,y.substr(this.value,b,d+1)),this.value=y.substr(this.value,0,b)+y.substr(this.value,c+1,null),this.value.length>a)break}else break;--a;if(0>a)break}this.buildChunk();return this._list},addChunk:function(a,b){var c=Gd._pool.get();
c.Parse(b,a);this._chunkList.push(c)},buildChunk:function(){this._list.clear();for(var a,b=0,c=this._chunkList.get_length();b<c;){var d=b++;a=this._chunkList.getArrayElement(d);if(null==a)break;-1==a.type?(this._list.push(a),a.setNext(this.getNextChunk(d+1,a.name))):0==a.type&&this._list.push(a)}},getNextChunk:function(a,b){for(var c=this._chunkList.get_length();a<c;){var d=a++,e=this._chunkList.getArrayElement(d);if(e.name==b&&1==e.type)return this._chunkList.removeAt(d),e}return null}};var Y=function(){I.call(this)};
Y.__name__="lovedna.game.components.ui.Text";Y.prototype=n(xa.prototype,{onAwake:function(){xa.prototype.onAwake.call(this);this._dirty=this.language=!1;this.size=Y.defaultSize;this._letterSpace=this._lineSpace=0;this._alignmentY=this._alignmentX=-1;this.rectTransform.width=this.rectTransform.height=0;this._charList=new S;this._lineList=new S;this._charLineWidth=new S;this._drawFrame=this._updateFrame=0;this.material.color.setRGBA(-1);this.material.renderQueue=xa.defaultRenderQueue;this._richText=
!1;this.textWidth=this.textHeight=0;this.set_font(Y.defaultFnt)},onDestroy:function(){xa.prototype.onDestroy.call(this);Ma.deleteGeometryBuffer(this.geometryBuffer.instanceID);this.geometryBuffer.dispose();this.geometryBuffer=null;this.material.dispose()},onStart:function(){xa.prototype.onStart.call(this);this.bindEvent(u.onRectTransform,g(this,this.onRectTransform))},onRectTransform:function(a){this.dirty()},dirty:function(){this._dirty||this.bindEvent(u.onTransformComplete,g(this,this.onTransformComplete));
this._dirty=!0;this._drawFrame=this._updateFrame=-1},onTransformComplete:function(a){this._dirty=!1;this.bindEvent(u.onTransformComplete,null);null!=this._font&&this._font.enabled&&this._font.inited&&(this.refresh(),this.drawText1())},fontInit:function(a){null!=this._font.texture&&(this.material.setTexture(this._font.texture),this.material.name=this._font.name,this.dirty())},refresh:function(){if(null!=this._font&&this._font.enabled&&null!=this._text&&0!=this._text.length){var a=this.actor.get_frame();
if(this._updateFrame!=a){this._charList.clear();Y._charpool.clear(0);Y._linepool.clear();var b=this._text;this.language&&null!=Y.languageFormat&&(b=Y.languageFormat(b));this._updateFrame=a;this._lineList.clear();a=null;this._richText&&(a=Y._parse.parse(b),b=Y._parse.value);for(var c=0,d=b.length;c<d;){var e=c++,f=y.cca(b,e),l=this._font.fnt._chars.h[f];null==l&&(l=this._font.fnt._chars.h[32]);var g=Y._charpool.get();g.index=e;g.set_char(l);g.newline=10==f||13==f;this._charList.push(g)}if(null!=a&&
(b=a.get_length(),0<b))for(c=0;c<b;)for(d=c++,d=a.getArrayElement(d),f=e=d.start,null!=d.next&&(f=d.next.start);e<f;)l=e++,this._charList.getArrayElement(l).addRichChunk(d);a=this.rectTransform.height;b=0;c=Y._linepool.get();c.setDefault(this);c.y=b;d=this._charList.get_length();this.textHeight=this.textWidth=0;e=!0;for(f=0;f<d;)if(l=f++,l=this._charList.getArrayElement(l),l.newline)c.complete(),c.width>this.textWidth&&(this.textWidth=c.width),this._lineList.push(c),b+=c.height+this._lineSpace,c=
Y._linepool.get(),c.setDefault(this),c.y=b,e=!0;else if(g=c.add(l),0==g){c.complete();c.width>this.textWidth&&(this.textWidth=c.width);this._lineList.push(c);b+=c.height+this._lineSpace;if(0<a&&b>a){e=!1;break}c=Y._linepool.get();c.setDefault(this);c.y=b;c.add(l);e=!0}else if(-1==g)break;e&&(c.complete(),c.width>this.textWidth&&(this.textWidth=c.width),this._lineList.push(c));this.textHeight=c.y}}else this.geometryBuffer.update()},drawText1:function(){if(null!=this._font&&this._font.enabled){var a=
this.actor.get_frame();if(this._drawFrame!=a&&(this._drawFrame=a,null!=this._text&&0!=this._text.length)){this.geometryBuffer.position.clear();this.geometryBuffer.uv.clear();this.geometryBuffer.color.clear();this.geometryBuffer.group.clear();a=this.rectTransform.width;var b=this.rectTransform.height,c=-this.rectTransform.pivot.x*a,d=-this.rectTransform.pivot.y*b,e=this._font.texture.width,f=this._font.texture.height,l=0;b=this.textHeight-b;0>=this._alignmentY&&(b=0==this._alignmentY?.5*b:0);for(var g=
0,h=0,k=this._lineList.get_length();h<k;){var n=h++;n=this._lineList.getArrayElement(n);g-=n.height;var p=n.charList.get_length(),q=a-n.width;0>=this._alignmentX&&(q=0==this._alignmentX?.5*q:0);for(var m=0;m<p;){var r=m++;r=n.charList.getArrayElement(r);var t=r.char,v=r.rect,u=v.x+q,w=v.get_right()+q,x=g+v.y+b;v=g+v.y+v.w+b;this.geometryBuffer.position.push(this._vec3.set(u+c,x+d,0));this.geometryBuffer.position.push(this._vec3.set(w+c,x+d,0));this.geometryBuffer.position.push(this._vec3.set(w+c,
v+d,0));this.geometryBuffer.position.push(this._vec3.set(u+c,v+d,0));u=t.x/e;x=(t.y+t.height)/f;w=(t.x+t.width)/e;v=t.y/f;t=this._vec2;var y=u,z=x;null==z&&(z=0);null==y&&(y=0);t.x=y;t.y=z;this.geometryBuffer.uv.push(t);t=this._vec2;y=w;null==x&&(x=0);null==y&&(y=0);t.x=y;t.y=x;this.geometryBuffer.uv.push(t);x=this._vec2;t=v;null==t&&(t=0);null==w&&(w=0);x.x=w;x.y=t;this.geometryBuffer.uv.push(x);w=this._vec2;null==v&&(v=0);null==u&&(u=0);w.x=u;w.y=v;this.geometryBuffer.uv.push(w);null!=r.customColorTop?
(u=r.customColorBottom,this.geometryBuffer.color.push(u),this.geometryBuffer.color.push(u),u=r.customColorTop,this.geometryBuffer.color.push(u),this.geometryBuffer.color.push(u)):(null!=this.colorBottom?(this.geometryBuffer.color.push(this.colorBottom),this.geometryBuffer.color.push(this.colorBottom)):(this.geometryBuffer.color.push(this._color.setRGBA(-1)),this.geometryBuffer.color.push(this._color.setRGBA(-1))),null!=this.colorTop?(this.geometryBuffer.color.push(this.colorTop),this.geometryBuffer.color.push(this.colorTop)):
(this.geometryBuffer.color.push(this._color.setRGBA(-1)),this.geometryBuffer.color.push(this._color.setRGBA(-1))));this.geometryBuffer.group.indices.push3(l,l+1,l+2);this.geometryBuffer.group.indices.push3(l,l+2,l+3);l+=4}g-=this._lineSpace}this.geometryBuffer.update();this.dispatchEvent(C.update)}}},set_text:function(a){this._text!=a&&(this._text=a,this.dirty());return this._text},set_font:function(a){this._font!=a&&(null==this._font||this._font.enabled||this._font.removeEventListener(C.complete._type,
g(this,this.fontInit)),this._font=a,null==this._font||this._font.enabled?this.fontInit():this._font.addEventListener(C.complete._type,g(this,this.fontInit)));return this._font},set_alignmentX:function(a){0<a&&(a=1);0>a&&(a=-1);a!=this._alignmentX&&(this._alignmentX=a,this.dirty());return this._alignmentX},set_alignmentY:function(a){0<a&&(a=1);0>a&&(a=-1);a!=this._alignmentY&&(this._alignmentY=a,this.dirty());return this._alignmentY},__class__:Y});var Cc=function(){T.call(this);this._positionOffset.set(0,
-25,0);var a=this.addComponent(O);this._img=a;a.material.renderQueue=this._renderQueue+2;this._img.set_resource(m.atlas.get(A.trapPath+"treasure2.png"));a.addMeshRenderer();a.material.loadShader(A.lightShader);a.material.setTexture(A.normal,k.toString(k.NORMALMAP));a=new v;this._txt=a.addComponent(Y);this._txt.material.renderQueue=this._renderQueue+3;this._txt.set_alignmentX(0);this._txt.set_alignmentY(-1);this._txt.size=14;a.get_transform().position.y=34;a.setParent(this);this._txt.addMeshRenderer();
this._txt.set_text("0")};Cc.get=function(){return Cc.pool.get()};Cc.prototype=n(T.prototype,{end:function(){Cc.pool.set(this)},begin:function(a){T.prototype.begin.call(this,a);var b=a.data.params.getValue(7);a=a.data.params.getValue(6);this._txt.set_text(a+"");this._img.reset();1<b?this._img.set_resource(m.atlas.get(A.trapPath+"treasure"+b+".png")):this._img.set_resource(m.atlas.get(A.trapPath+"treasure.png"))}});var wf=function(){v.call(this);this._points=V.fromArray([]);this._index=0;var a=new v;
a.setParent(this);this._backgroundRenderer=a.addComponent(Ub);this._backgroundRenderer.mesh=new Ma;this._backGeom=new Za;this._backGeom.uv=new fb;this._backgroundRenderer.mesh.fromBuffer(this._backGeom);this._backgroundRenderer.get_material().renderQueue=0;this._backgroundRenderer.get_material().renderState.cullMode=0;this._backgroundRenderer.get_material().renderState.depthState.compareFunction=0;this._backgroundRenderer.get_material().renderState.depthState.writeEnabled=!1;this._backgroundRenderer.get_material().setTexture(m.texture.get("image/map/back_castle.jpg").texture);
this._wallRenderer=a.addComponent(Ub);this._wallRenderer.mesh=new Ma;this._wallGeom=new Za;this._wallGeom.uv=new fb;this._wallRenderer.mesh.fromBuffer(this._wallGeom);this._wallRenderer.get_material().renderQueue=10004;this._wallRenderer.get_material().renderState.depthState.compareFunction=0;this._wallRenderer.get_material().renderState.depthState.writeEnabled=!1;this._wallRenderer.get_material().setTexture(m.texture.get("image/map/wall_castle.jpg").texture);this._wallRenderer.get_material().renderState.cullMode=
0;a=new v;a.setParent(this);this._decalRenderer=a.addComponent(Ub);this._decalRenderer.mesh=new Ma;this._decalGeom=new Za;this._decalGeom.uv=new fb;this._decalRenderer.mesh.fromBuffer(this._decalGeom);this._decalRenderer.get_material().renderQueue=2E4;a=new v;a.setParent(this);this._gridRenderer=a.addComponent(Ub);this._gridRenderer.visible=!1;this._gridRenderer.mesh=new Ma;this._gridGeom=new Za;this._gridGeom.uv=new fb;this._gridRenderer.mesh.fromBuffer(this._gridGeom);this._gridRenderer.get_material().renderQueue=
10002;this._gridRenderer.get_material().renderState.depthState.writeEnabled=!1;this._gridGeom.position.push(h.instance.set(0,0,0));this._gridGeom.position.push(h.instance.set(800,0,0));this._gridGeom.position.push(h.instance.set(800,500,0));this._gridGeom.position.push(h.instance.set(0,500,0));a=H.instance;var b=0,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);a=H.instance;b=1;c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);a=H.instance;c=b=1;null==
c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);a=H.instance;b=0;c=1;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this._gridGeom.uv.push(a);this._gridGeom.group.indices.push3(0,1,2);this._gridGeom.group.indices.push3(0,2,3);this._gridGeom.update();this._gridRenderer.get_material().setTexture(m.texture.get("image/map/grid.png").texture);this._gridRenderer.get_material().setFloat4(k.toString(k.add(k.BASECOLORMAP,k._REGION)),new ya(0,0,16,10));this._gridRenderer.get_material().enableDefine(k.toString(k.add(k.BASECOLORMAP,
k._REGION)));this._gridRenderer.get_material().renderState.blendState.destinationColorBlendMode=1;this._uiOffset=new H};wf.prototype=n(v.prototype,{showGrid:function(a){this._gridRenderer.visible=a},load:function(a){this._map=a;this._gridRenderer.visible=!1;this._backGeom.position.clear();this._backGeom.uv.clear();this._backGeom.group.clear();this._wallGeom.position.clear();this._wallGeom.uv.clear();this._wallGeom.group.clear();this._decalGeom.position.clear();this._decalGeom.uv.clear();this._decalGeom.group.clear();
this._index=0;var b=1*p.randomInstance.getFloat();this._uiOffset.x=b;b=1*p.randomInstance.getFloat();this._uiOffset.y=b;var c=ea.width;b=ea.height;var d=ea.width/ea.height;1.6<d?c=500*d:b=800/d;d=.5*(c-50*a.width);for(var e=.5*(b-50*a.height),f=this._map.map,l=f.length;0<l--;){var g=f.getArrayElement(l);if(1==g.type||4==g.type){var k=g.x,n=g.y,q=50*g.x,m=q+50,r=50*g.y;g=r+50;0<d&&(0==k&&(q=-d-100),k+1==a.width&&(m=c+100));0<e&&(0==n&&(r=-e-200),n+1==a.height&&(g=b+200));var t=this._map.map.get(k-
1,n);(null==t?0:1!=t.type&&4!=t.type)?(t=this._map.map.get(k,n-1),t=null==t?!1:!(1==t.type||4==t.type)):t=!1;t?(t=this._map.map.get(k-1,n-1),t=null==t?!1:!(1==t.type||4==t.type)):t=!1;t?(this._points.push(h._pool.get().set(q,r+2)),this._points.push(h._pool.get().set(q+2,r))):this._points.push(h._pool.get().set(q,r));t=this._map.map.get(k+1,n);(null==t?0:1!=t.type&&4!=t.type)?(t=this._map.map.get(k,n-1),t=null==t?!1:!(1==t.type||4==t.type)):t=!1;t?(t=this._map.map.get(k+1,n-1),t=null==t?!1:!(1==t.type||
4==t.type)):t=!1;t?(this._points.push(h._pool.get().set(m-2,r)),this._points.push(h._pool.get().set(m,r+2))):this._points.push(h._pool.get().set(m-0,r));r=this._map.map.get(k+1,n);(null==r?0:1!=r.type&&4!=r.type)?(r=this._map.map.get(k,n+1),r=null==r?!1:!(1==r.type||4==r.type)):r=!1;r?(r=this._map.map.get(k+1,n+1),r=null==r?!1:!(1==r.type||4==r.type)):r=!1;r?(this._points.push(h._pool.get().set(m,g-2)),this._points.push(h._pool.get().set(m-2,g))):this._points.push(h._pool.get().set(m-0,g-0));m=this._map.map.get(k-
1,n);(null==m?0:1!=m.type&&4!=m.type)?(m=this._map.map.get(k,n+1),m=null==m?!1:!(1==m.type||4==m.type)):m=!1;m?(k=this._map.map.get(k-1,n+1),k=null==k?!1:!(1==k.type||4==k.type)):k=!1;k?(this._points.push(h._pool.get().set(q+2,g)),this._points.push(h._pool.get().set(q,g-2))):this._points.push(h._pool.get().set(q,g-0));this.drawPoints(this._points)}}this._wallGeom.update();this._index=0;f=-d-100;c+=100;l=-e-100;b+=100;0>d&&(f=-100,c=50*a.width);0>e&&(l=0,b=50*a.height);this._points.push(h._pool.get().set(f,
l));this._points.push(h._pool.get().set(c,l));this._points.push(h._pool.get().set(c,b));this._points.push(h._pool.get().set(f,b));this.drawPoints(this._points,this._backGeom);this._backGeom.update()},drawPoints:function(a,b){var c=a.get_length();if(!(3>c)){null==b&&(b=this._wallGeom);for(var d=0;d<c;){var e=d++,f=a.get(e);b.position.push(f);e=H.instance;var l=f.x/512;f=1-f.y/512;null==f&&(f=0);null==l&&(l=0);e.x=l;e.y=f;b.uv.push(e)}d=c-2;for(e=0;0<d--;)b.group.indices.push3(this._index,this._index+
e+1,this._index+e+2),++e;this._index+=c;a.clear()}}});var xf=function(){this._successList=V.fromArray([]);this._hitList=V.fromArray([])};xf.prototype={clear:function(){this._hitList.clear();this._successList.clear()},success:function(a){this._successList.push(a)},enter:function(a,b){var c=wb.get();c.phase=1;c.target=a;c.trap=b;this._hitList.push(c)},exit:function(a,b){var c=wb.get();c.phase=2;c.target=a;c.trap=b;this._hitList.push(c)},readHit:function(){if(0<this._hitList.get_length()){var a=this._hitList.pop();
a.dispose();return a}return null}};var z=function(){this.overWall=!1;this.editCheckWall=new H(0,0);this.owner=this;this.drawLine=!0;this.instanceID=z._id++;this.enabled=!0;this._positionOffset=new h;this.position=new h;this.size=13;this._mapCellList=V.fromArray([]);this.rotation=this._colliderRadius=0;this.scale=new h(1,1,1);this.ignoreCollision=!1;this._min=new H;this._max=new H};z.prototype={dispose:function(){},setGrid:function(a,b){this.position.set(50*(a+.5)+this._positionOffset.x,50*(b+.5)+
this._positionOffset.y,0);null!=this.world&&this.updatePosition()},setMapObject:function(a){this.data=a;0==this._colliderRadius&&(this._colliderRadius=this.size);this.onSetEditSize();null!=this.data&&this.setGrid(this.data.x,this.data.y)},onAdd:function(a){this.world=a;this.enabled=!0;this.clearMapCell();this.updatePosition()},onRemove:function(a){this.rotation=0;this.scale.set(1,1,1);this.clearMapCell();this.dispose()},begin:function(a){},update:function(a){},lateUpdate:function(a){},onTriggerEnter:function(a,
b){this.enabled&&this.world.event.enter(a,this)},onTriggerExit:function(a,b){this.enabled&&this.world.event.exit(a,this)},render:function(){G.drawCircle(this.position,this._colliderRadius,null,this.enabled?F.RED:F.BLACK)},colliderWith:function(a){if(this.ignoreCollision||a.ignoreCollision||0>this._colliderRadius||0>a._colliderRadius)return!1;var b=z._v20,c=this.position.x,d=this.position.y;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b=z._v21;c=a.position.x;d=a.position.y;null==d&&(d=0);null==c&&(c=
0);b.x=c;b.y=d;b=z._v20.distanceSquared(z._v21);a=this._colliderRadius+a._colliderRadius;return b<a*a},getColliderShapes:function(a){for(var b=this._mapCellList.get_length();0<b--;)for(var c=this._mapCellList.getArrayElement(b).shapes,d=c.get_length();0<d--;){var e=c.getArrayElement(d);e!=this&&e.colliderWith(this)&&a.add(e)}a.update()},editBegin:function(){},editUpdate:function(a,b){this.data.x=a;this.data.y=b;this.setMapObject(this.data);return!0},editChange:function(a){},onSetEditSize:function(){var a=
this._min,b=-this._colliderRadius,c=-this._colliderRadius;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;c=b=this._colliderRadius;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c},onDispose:function(){this.editMode=!1;this.drawLine=!0;this.enabled=!1},clearMapCell:function(){for(var a=this._mapCellList.get_length();0<a--;)this._mapCellList.getArrayElement(a).removeShape(this);this._mapCellList.clear()},innerRender:function(){var a=h.get_up().copy(this.position);a.y+=4;var b=h.get_right().copy(this.position);
b.y-=4;G.drawLine(a,b,F.WHITE);a.copy(this.position);b.copy(this.position);a.x+=4;b.x-=4;G.drawLine(a,b,F.WHITE)},onSetup:function(a){},updatePosition:function(){for(var a=this._mapCellList.get_length();0<a--;){var b=this._mapCellList.getArrayElement(a);z._changed.h[b.index]=-1}this._mapCellList.clear();a=this.world.mapData.getByPosition(this.position.x+this._min.x,this.position.y+this._min.y);b=this.world.mapData.getByPosition(this.position.x+this._max.x,this.position.y+this._max.y);if(null!=a&&
null!=b)if(a!=b)for(var c=a.x,d=b.x+1;c<d;)for(var e=c++,f=a.y,l=b.y+1;f<l;){var g=f++;g=this.world.mapData.map.get(e,g);null!=g&&(this._mapCellList.push(g),g=g.index,z._changed.h.hasOwnProperty(g)?z._changed.h[g]+=1:z._changed.h[g]=1)}else this._mapCellList.push(a),a=a.index,z._changed.h.hasOwnProperty(a)?z._changed.h[a]+=1:z._changed.h[a]=1;for(a=z._changed.keys();a.hasNext();)c=a.next(),b=z._changed.h[c],z._changed.remove(c),c=this.world.mapData.map.getArrayElement(c),0!=b&&(0<b?c.addShape(this):
c.removeShape(this))}};var Hd=function(){I.call(this)};Hd.__name__="client.physics.GameWorld";Hd.prototype=n(fa.prototype,{load:function(a){this._doclear();this._ready=!1;this.mapData=a;this.mapData.clearRuntime();this._array2=this.mapData.map;for(var b=a.objects.get_length();0<b--;){var c=a.objects.getArrayElement(b);if(!c.disabled){var d=Ga.get(c);null!=d&&(this.add(d),5==c.type&&(this.door=d))}}if(null!=this.door){this.hero=Yb.get();this.hero.self=!0;this.hero.setMapObject(this.door.data);if(null!=
this.onInit)this.onInit();this.param.hero=this.hero;this._finish=this._started=this._clear=!1;this._startWaitFrame=-1;this._ready=!0;this.bindEvent(u.onUpdate,g(this,this.onUpdate));this.param.start();this._fixedTime=.016666666666666666;this._time=0;this.event.clear()}},add:function(a){this._addedMap.h.hasOwnProperty(a.instanceID)||(this._addedMap.h[a.instanceID]=a,this._addShapes.push(a))},remove:function(a){this._addedMap.h.hasOwnProperty(a.instanceID)&&(this._addedMap.remove(a.instanceID),this._removeShapes.push(a))},
pause:function(){this._started&&(this._running=!1)},finish:function(){this._finish=!0},clear:function(){this._clear=!0},action:function(){if(this._ready){this._ready=!1;this._running=!0;this._started=!1;this._time=0;this._startWaitFrame=6;this._actionFrame=-1;this.hero.setMapObject(this.door.data);this.add(this.hero);if(null!=this.onGameStart)this.onGameStart();if(null==this.onFail)throw new w("not add onfail callback");}else this._finish||6<this.param.frame&&this.param.frame<this._actionFrame+4||
(this._actionFrame=this.param.frame,this.param.pressed=!0)},onAwake:function(){fa.prototype.onAwake.call(this);this._array2=new Ud(16,10);this._addedMap=new X;this._updateShapes=V.fromArray([]);this._addShapes=V.fromArray([]);this._removeShapes=V.fromArray([]);this._tempShapes=V.fromArray([]);this._running=!1;this.param=new yf(this);this._finish=!1;this.event=new xf},onUpdate:function(a){this._finish&&(this.bindEvent(u.onUpdate,null),this._running=!1);a=this._addShapes.get_length();if(0<a){this._tempShapes.copyFastArray(this._addShapes);
this._addShapes.clear();for(var b=0;b<a;){var c=b++;c=this._tempShapes.getArrayElement(c);c.editMode=!1;c.drawLine=!0;if(null!=this.onAddShape)this.onAddShape(c);c.onAdd(this);c.onSetup(this.param);this._updateShapes.push(c);this._started&&c.begin(this.param)}}a=this._removeShapes.get_length();if(0<a)for(this._tempShapes.copyFastArray(this._removeShapes),this._removeShapes.clear();0<a--;){b=this._tempShapes.getArrayElement(a);if(null!=this.onRemoveShape)this.onRemoveShape(b);b.onRemove(this);this._updateShapes.remove(b)}if(0<
this._startWaitFrame){for(this._time+=this.actor.deltaTime;this._time>=this._fixedTime;)this._time-=this._fixedTime,this._startWaitFrame--;if(1>this._startWaitFrame)for(this._started=!0,this._time=0,a=this._updateShapes.get_length();0<a--;)this._updateShapes.getArrayElement(a).begin(this.param)}if(this._started&&this._running)for(this._time+=this.actor.deltaTime;this._time>=this._fixedTime;)this._time-=this._fixedTime,this.loopUpdate(.016666666666666666);for(a=this._updateShapes.get_length();0<a--;)b=
this._updateShapes.getArrayElement(a),b.drawLine&&(b.render(),b.innerRender());if(null!=this.onRender)this.onRender();null!=r.getKey(65)?this.actor.timeScale=.5:this.actor.timeScale=1.2;this._clear&&this._doclear();if(65530<=this.param.frame&&(this._finish=!0,null!=this.onFail))this.onFail()},loopUpdate:function(a){if(this._running)for(var b=1;0<b--&&this._running;){this.param.update(a);for(var c=this._updateShapes.get_length();0<c--;){var d=this._updateShapes.getArrayElement(c);d.enabled&&d.update(this.param)}this.param.pressed=
!1;for(c=this._updateShapes.get_length();0<c--;)d=this._updateShapes.getArrayElement(c),d.enabled&&d.lateUpdate(this.param);for(;;){c=this.event.readHit();if(null==c)break;if(null!=this.onTrigger)this.onTrigger(c)}}},_doclear:function(){this._running=!1;this.bindEvent(u.onUpdate,null);this.param.pressed=!1;this._startWaitFrame=-1;this._ready=!1;for(var a=this._updateShapes.get_length();0<a--;){var b=this._updateShapes.getArrayElement(a);b.dispose();b.onRemove(this);if(null!=this.onRemoveShape)this.onRemoveShape(b)}this._updateShapes.clear();
for(a=this._addShapes.get_length();0<a--;)b=this._addShapes.getArrayElement(a),b.dispose(),b.onRemove(this);this._addShapes.clear();for(a=this._removeShapes.get_length();0<a--;)if(b=this._removeShapes.getArrayElement(a),b.dispose(),b.onRemove(this),null!=this.onRemoveShape)this.onRemoveShape(b);this._removeShapes.clear();for(a=new tb(this._addedMap);a.hasNext();)b=a.next(),this._addedMap.remove(b.key)},__class__:Hd});var wb=function(){this.instanceID=wb._id++};wb.get=function(){return wb.pool.get()};
wb.prototype={dispose:function(){wb.pool.set(this)}};var yf=function(a){this.world=a;this.actionFrameList=V.fromArray([]);this.pressed=!1;this.frame=this.deltaTime=0;this.touchY=this.touchX=-1;this._touchY=this._touchX=0};yf.prototype={start:function(){this.frame=0;this.actionFrameList.clear();this.pressed=!1},update:function(a){this.frame++;this.deltaTime=a;0<this._touchX&&(this._touchX--,0>=this._touchX&&(this.touchX=-1));0<this._touchY&&(this._touchY--,0>=this._touchY&&(this.touchY=-1))},record:function(a){this.hero==
a&&this.actionFrameList.push(this.frame)},updateActive:function(a,b){if(null!=this.onActive)this.onActive(a,b)},setTouchX:function(a){this._touchX=2;this.touchX=a},setTouchY:function(a){this._touchY=2;this.touchY=a}};var Dc=function(){z.call(this);this._center=new h(0,0,0);this._colliderRadius=11;this.type=102;this.overWall=!0};Dc.get=function(){return Dc.pool.get()};Dc.prototype=n(z.prototype,{dispose:function(){Dc.pool.set(this);this.onDispose()},update:function(a){this._angle+=111.61904761904762*
a.deltaTime;360<this._angle&&(this._angle-=360,a.updateActive(this,3));var b=-(.017453292519943295*this._angle+this._baseAngle);a=Math.cos(b)*this._length;b=Math.sin(b)*this._length;this.position.copy(this._center);this.position.x+=a;this.position.y+=b;this.updatePosition()},render:function(){G.drawCircle(this.position,20,null,F.BLACK);G.drawCircle(this.position,this._colliderRadius,null,this.enabled?F.RED:F.BLACK)},setMapObject:function(a){z.prototype.setMapObject.call(this,a);this.editMode&&null!=
this._editDot&&this._editDot.relateChanged()},editChange:function(a){a||(this._dir++,this.init(),this.editMode&&null!=this._editDot&&this._editDot.relateChanged())},editUpdate:function(a,b){a=z.prototype.editUpdate.call(this,a,b);this.editMode&&null!=this._editDot&&this._editDot.relateChanged();return a},onSetup:function(a){this._angle=0;this._moveDistance=this.data.params.getValue(1,3);3>this._moveDistance&&(this._moveDistance=3);this._dir=this.data.params.getValue(2,0)%4;this.init();this._length=
50*this._moveDistance;this._center.scale(50*this._moveDistance).add(this.position)},onAdd:function(a){z.prototype.onAdd.call(this,a);this.editMode&&(this._editDot=Lb.get(),a.add(this._editDot),this._editDot.setRelate(this))},onDispose:function(){z.prototype.onDispose.call(this);this._editDot=null},init:function(){0>this._dir&&(this._dir+=4);0==this._dir?(this._center.set(1,0),this._baseAngle=3.141592653589793):1==this._dir?(this._center.set(0,1),this._baseAngle=1.5707963267948966):2==this._dir?(this._center.set(-1,
0),this._baseAngle=0):3==this._dir&&(this._center.set(0,-1),this._baseAngle=-1.5707963267948966);this.data.params.setValue(2,this._dir)}});var Zb=function(){z.call(this);this.type=2;var a=this._min,b=-40,c=-10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c};Zb.get=function(){return Zb.pool.get()};Zb.prototype=n(z.prototype,{dispose:function(){Zb.pool.set(this);this.onDispose()},render:function(){G.drawPlane(this.position,h.get_right().scale(50),
h.get_up(),this.enabled?F.GREEN:F.GRAY)},setMapObject:function(a){this._positionOffset.x=25;this._positionOffset.y=25;z.prototype.setMapObject.call(this,a)},editChange:function(a){if(!a){a=$b.get();var b=Xa.get();b.copy(this.data);b.type=3;a.setMapObject(b);this.world.add(a);this.world.remove(this)}},onSetup:function(a){this.ignoreCollision=!0;a=this.world.mapData.map.get(this.data.x,this.data.y);null!=a&&a.setTypeIfNotWall(this.type);a=this.world.mapData.map.get(this.data.x+1,this.data.y);null!=
a&&a.setTypeIfNotWall(this.type)},onSetEditSize:function(){var a=this._min,b=-40,c=-10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}});var $b=function(){z.call(this);this.type=3;var a=this._min,b=-40,c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-1;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c};$b.get=function(){return $b.pool.get()};$b.prototype=n(z.prototype,{dispose:function(){$b.pool.set(this);this.onDispose()},render:function(){G.drawPlane(this.position,
h.get_right().scale(50),h.get_up(),this.enabled?F.GREEN:F.GRAY)},setMapObject:function(a){this._positionOffset.x=25;this._positionOffset.y=25;z.prototype.setMapObject.call(this,a)},editChange:function(a){if(!a){a=Zb.get();var b=Xa.get();b.copy(this.data);b.type=2;a.setMapObject(b);this.world.add(a);this.world.remove(this)}},onSetup:function(a){this.ignoreCollision=!0;a=this.world.mapData.map.get(this.data.x,this.data.y);null!=a&&a.setTypeIfNotWall(this.type);a=this.world.mapData.map.get(this.data.x+
1,this.data.y);null!=a&&a.setTypeIfNotWall(this.type)},onSetEditSize:function(){var a=this._min,b=-40,c=-10;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;b=40;c=-5;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}});var Ec=function(){z.call(this);this._colliderRadius=20;this.type=13;this.overWall=!0};Ec.get=function(){return Ec.pool.get()};Ec.prototype=n(z.prototype,{dispose:function(){Ec.pool.set(this);this.onDispose()},update:function(a){var b=!0;a.hero.flying&&a.hero.running&&(b=!1);b?(this._time+=
a.deltaTime,3<this._time&&(this._time-=3,this.world.event.enter(a.hero,this)),a.updateActive(this,4)):this._time=0},render:function(){G.drawCircle(this.position,25,null,F.BLACK);0<this._time&&G.drawCircle(this.position,this._time/3*25,null,F.RED)},onSetup:function(a){this._time=0;this.ignoreCollision=!0}});var Mb=function(){z.call(this);this._colliderRadius=6;this._dir=new H;var a=this._colliderRadius;this._wallCheck00=new Pa(a,-1,-1);this._wallCheck11=new Pa(a,1,1);this._wallCheck10=new Pa(a,1,-1);
this._wallCheck01=new Pa(a,-1,1);this._wallCheck00.crossBoard=!1;this._wallCheck10.crossBoard=!1;this._wallCheck01.crossBoard=!1;this._wallCheck11.crossBoard=!1;this.type=130};Mb.get=function(){return Mb.pool.get()};Mb.prototype=n(z.prototype,{dispose:function(){Mb.pool.set(this);this.onDispose()},start:function(a,b){this._dir.copy(b).normalize();this.position.x+=this._dir.x*(.51*this._colliderRadius+25.00001+136.625*a);this.position.y+=this._dir.y*(.51*this._colliderRadius+25.00001+136.625*a)},update:function(a){a=
a.deltaTime;this._wallCheck00.setCurrent(this.position);this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);var b=h.instance.set(136.625*this._dir.x,136.625*this._dir.y,0);this.position.x+=b.x*a;this.position.y+=b.y*a;this._wallCheck00.update(this.position,b,this.world.mapData);this._wallCheck11.update(this.position,b,this.world.mapData);this._wallCheck10.update(this.position,b,this.world.mapData);this._wallCheck01.update(this.position,
b,this.world.mapData);0<this._wallCheck00.density||0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density?(this.enabled=!1,this.world.remove(this)):(this.updatePosition(),this._time+=10*a,a=.1*Math.sin(this._time),this.scale.x=1+a,this.scale.y=1-a)},onSetup:function(a){z.prototype.onSetup.call(this,a);this._time=0}});var Fc=function(){z.call(this);this._colliderRadius=11;this.size=13;this.type=100;this._moveDirection=new H;this._checkX=this._checkY=-1};Fc.get=function(){return Fc.pool.get()};
Fc.prototype=n(z.prototype,{dispose:function(){Fc.pool.set(this);this.onDispose()},update:function(a){z.prototype.update.call(this,a);a.updateActive(this,3)},render:function(){G.drawCircle(this.position,this._colliderRadius,null,this.enabled?F.RED:F.BLACK)},onSetup:function(a){z.prototype.onSetup.call(this,a);this._dir=this.data.params.getValue(2,0)%4;this.init()},init:function(){0>this._dir&&(this._dir+=4);if(0==this._dir){var a=this._moveDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=
c;this._checkX=this.data.x+1;this._checkY=-1}else 1==this._dir?(a=this._moveDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this._checkY=this.data.y+1,this._checkX=-1):2==this._dir?(a=this._moveDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this._checkX=this.data.x-1,this._checkY=-1):3==this._dir&&(a=this._moveDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this._checkY=this.data.y-1,this._checkX=-1);this.data.params.setValue(2,this._dir)}});var Gc=function(){z.call(this);
this.size=30;this._positionOffset.set(25,-25+this.size);this._colliderRadius=30;var a=this.editCheckWall,b=2,c=2;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this.type=5};Gc.get=function(){return Gc.pool.get()};Gc.prototype=n(z.prototype,{render:function(){G.drawPlane(this.position,h.get_right().scale(this.size),h.get_up().scale(this.size),this.enabled?F.WHITE:F.GRAY)},dispose:function(){Gc.pool.set(this);this.onDispose()},begin:function(a){z.prototype.begin.call(this,a);a.updateActive(this,6)},onSetup:function(a){this.ignoreCollision=
!0}});var Hc=function(){z.call(this);this.type=12;this._colliderRadius=20;this.size=6;this.ignoreCollision=!0;this._fireDirection=new H;this._preTime=.3342482464165904;this.overWall=!0};Hc.get=function(){return Hc.pool.get()};Hc.prototype=n(z.prototype,{dispose:function(){Hc.pool.set(this);this.onDispose()},render:function(){G.drawCircle(this.position,this.size,null,F.BLACK)},update:function(a){this._time-=a.deltaTime;if(0>=this._time)if(6>this._count){var b=Ic.get();b.owner=this;b.setMapObject(this.data);
b.start(-this._time,this._fireDirection,(6-this._count)*this._preTime);this.world.add(b);this._time+=this._preTime;this._count++;a.updateActive(this,1)}else this._time+=1.9528438548337905-this._preTime,this._count=0},editChange:function(a){a||(this._dir++,this.init())},onSetup:function(a){this.ignoreCollision=!0;this._count=this._time=0;this._dir=this.data.params.getValue(2,0);this.init()},init:function(){this._dir%=4;0>this._dir&&(this._dir+=4);if(0==this._dir){var a=this._fireDirection,b=1,c=0;
null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this._dir?(a=this._fireDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this._dir?(a=this._fireDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this._dir&&(a=this._fireDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this.rotation=90*this._dir;this.data.params.setValue(2,this._dir)}});var Lb=function(){z.call(this);this.size=20;this.type=150;this._colliderRadius=20;this._moveDirection=new H;var a=this._min,
b=-this._colliderRadius,c=-this._colliderRadius;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a=this._max;c=b=this._colliderRadius;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this.overWall=!0};Lb.get=function(){return Lb.pool.get()};Lb.prototype=n(z.prototype,{dispose:function(){Lb.pool.set(this);this.onDispose()},setRelate:function(a){this._relate=this.owner=a;this.data=Xa.get();this.data.copy(this._relate.data);this.relateChanged()},relateChanged:function(){this.distance=this._relate.data.params.getValue(1,
3);3>this.distance&&(this.distance=3);this.direction=this._relate.data.params.getValue(2,0)%4;0>this.direction&&(this.direction+=4);if(0==this.direction){var a=this._moveDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this.direction?(a=this._moveDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this.direction?(a=this._moveDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this.direction&&(a=this._moveDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),
a.x=b,a.y=c);a=this._relate.data.x;b=p.floatToInt(this._moveDirection.x*this.distance);this.data.x=a+b;a=this._relate.data.y;b=p.floatToInt(this._moveDirection.y*this.distance);this.data.y=a+b;this.setGrid(this.data.x,this.data.y)},setMapObject:function(a){z.prototype.setMapObject.call(this,a);this.relateChanged()},editBegin:function(){},editUpdate:function(a,b){if(0!=this._moveDirection.x){b=p.floatToInt((a-this._relate.data.x)*this._moveDirection.x);if(3>b)return!1;this._relate.data.params.setValue(1,
b);return z.prototype.editUpdate.call(this,a,this._relate.data.y)}a=p.floatToInt((b-this._relate.data.y)*this._moveDirection.y);if(3>a)return!1;this._relate.data.params.setValue(1,a);return z.prototype.editUpdate.call(this,this._relate.data.x,a)},render:function(){G.drawCircle(this.position,this._colliderRadius,null,F.YELLOW)}});var Jc=function(){z.call(this);this.type=106;this._colliderRadius=20;this._shootDirection=new H;this._moveDirection=new H;this._basePosition=new H;this._p1=new h;this._p2=
new h;this._p3=new h;this.overWall=!0};Jc.get=function(){return Jc.pool.get()};Jc.prototype=n(z.prototype,{dispose:function(){Jc.pool.set(this);this.onDispose()},update:function(a){var b=a.deltaTime;this._shootTime-=b;if(0>=this._shootTime){var c=Mb.get();c.setMapObject(this.data);var d=a.world.mapData.getByPosition(this.position.x,this.position.y);c.position.set(50*(d.x+.5),50*(d.y+.5));c.start(-this._shootTime,this._shootDirection);this.world.add(c);this._shootTime+=1.0027447392497713;a.updateActive(this,
1)}this._time+=b;this._time>this._totalTime&&(this._time-=this._totalTime);a=this._time/this._totalTime;a=49.863138686131386*this._totalTime*(.5>a?2*a:1-2*(a-.5))*.5;this.position.x=this._basePosition.x+this._moveDirection.x*a;this.position.y=this._basePosition.y+this._moveDirection.y*a},render:function(){this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);var a=Ca.instance.setEulerAngles(0,0,this._shootDirection.get_angle());a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);
this._p2.add(this.position);this._p3.add(this.position);G.drawTriangle(this._p1,this._p2,this._p3,F.BLACK)},onSetup:function(a){this.ignoreCollision=!0;this._shootTime=0;a=this.data.params.getValue(2,0)%4;0>a&&(a+=4);if(0==a){a=this._shootDirection;var b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==a?(a=this._shootDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this.rotation=90):2==a?(a=this._shootDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this.scale.x=-1):
3==a&&(a=this._shootDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c,this.rotation=-90);a=this.data.params.getValue(3,0)%4;0>a&&(a+=4);if(0==a){b=this._moveDirection;c=1;var d=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d}else 1==a?(b=this._moveDirection,c=0,d=1,null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d):2==a?(b=this._moveDirection,c=-1,d=0,null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d):3==a&&(b=this._moveDirection,c=0,d=-1,null==d&&(d=0),null==c&&(c=0),b.x=c,b.y=d);this._moveDistance=this.data.params.getValue(1,
1);1>this._moveDistance&&(this._moveDistance=1);this._totalTime=2.0054894784995425*this._moveDistance;this._basePosition.x=this.position.x;this._basePosition.y=this.position.y;this._time=0;this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);a=Ca.instance.setEulerAngles(0,0,90*a);a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position)}});var Ic=function(){z.call(this);this.type=131;this._colliderRadius=
12;this._dir=new H;this._totalTime=1.6};Ic.get=function(){return Ic.pool.get()};Ic.prototype=n(z.prototype,{dispose:function(){Ic.pool.set(this);this.onDispose()},start:function(a,b,c){null==c&&(c=0);this._dir.copy(b).normalize();this.position.x+=this._dir.x*(this._colliderRadius+1E-5+74.79470802919708*a);this.position.y+=this._dir.y*(this._colliderRadius+1E-5+74.79470802919708*a);this.rotation=this._dir.get_angle();this._totalTime=c;this._totalTime-=a},update:function(a){a=a.deltaTime;var b=h.instance.set(74.79470802919708*
this._dir.x,74.79470802919708*this._dir.y,0);this.position.x+=b.x*a;this.position.y+=b.y*a;this.updatePosition();this._totalTime-=a;0>=this._totalTime&&(this.enabled=!1,this.world.remove(this))},onSetup:function(a){z.prototype.onSetup.call(this,a);this.rotation=this._dir.get_angle()}});var xb=function(){this.a=new H;this.b=new H};xb.prototype={intersect:function(a,b){var c=a,d=b;null==d&&(c=this,d=a);a=c.a;c=c.b;b=d.a;var e=d.b;d=(a.x-b.x)*(c.y-b.y)-(a.y-b.y)*(c.x-b.x);var f=(a.x-e.x)*(c.y-e.y)-(a.y-
e.y)*(c.x-e.x);if(0<=d*f)return null;b=(b.x-a.x)*(e.y-a.y)-(b.y-a.y)*(e.x-a.x);if(0<=b*(b+d-f))return null;f=b/(f-d);b=xb._helperVec2;d=a.x+f*(c.x-a.x);a=a.y+f*(c.y-a.y);null==a&&(a=0);null==d&&(d=0);b.x=d;b.y=a;return xb._helperVec2}};var Kc=function(){z.call(this);this.type=103;this.velocity=new h;this._moveDirection=new h;this.size=this._colliderRadius=11;this._wallCheck00=new Pa(this.size,-1,-1);this._wallCheck11=new Pa(this.size,1,1);this._wallCheck10=new Pa(this.size,1,-1);this._wallCheck01=
new Pa(this.size,-1,1);this._wallCheck00.ignoreBoard=!0;this._wallCheck10.ignoreBoard=!0;this._wallCheck01.ignoreBoard=!0;this._wallCheck11.ignoreBoard=!0;this._distanceToWall=1E-5;this._moveLine=new xb;this._checkLine=new xb;this._nextPosition=new h;this._tracePosition=new h;this._totalAcc=new h;this._moveAdd=new h;this.overWall=!0};Kc.get=function(){return Kc.pool.get()};Kc.prototype=n(z.prototype,{dispose:function(){Kc.pool.set(this);this.onDispose()},update:function(a){var b=this.world.mapData.getByPosition(this.position.x,
this.position.y);if(null==b||1!=b.type&&4!=b.type){var c=a.deltaTime;this._tracePosition.copy(a.hero.position);b=h._pool.get().copy(this._tracePosition).sub(this.position);var d=this._moveDirection.angle(b,h.get_forward());b.normalize();this._rotation+=c*d*4;b=H.instance;d=1;var e=0;null==e&&(e=0);null==d&&(d=0);b.x=d;b.y=e;b.set_angle(this._rotation);this._moveDirection.set(b.x,b.y,0).normalize();b=h._pool.get().copy(this._moveDirection).scale(100).add(this.position);G.drawLine(this.position,b);
this._wallCheck00.setCurrent(this.position);this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);b=121.5*this._moveDirection.x*c;c*=121.5*this._moveDirection.y;this._nextPosition.copy(this.position);this._nextPosition.x+=b+this._moveAdd.x;this._nextPosition.y+=c+this._moveAdd.y;this._moveAdd.set(0,0,0);this._wallCheck00.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck11.update(this._nextPosition,
this.velocity,this.world.mapData);this._wallCheck10.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck01.update(this._nextPosition,this.velocity,this.world.mapData);if(0<this._wallCheck00.density||0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density)if(d=!1,0<this._wallCheck00.density&&0<this._wallCheck01.density&&(this._nextPosition.x=this._wallCheck00.currentCell.getLeft(this._colliderRadius+this._distanceToWall),d=!0),0<this._wallCheck00.density&&
0<this._wallCheck10.density&&(this._nextPosition.y=this._wallCheck00.currentCell.getBottom(this._colliderRadius+this._distanceToWall),d=!0),0<this._wallCheck10.density&&0<this._wallCheck11.density&&(this._nextPosition.x=this._wallCheck10.nextCell.getLeft(-this._colliderRadius-this._distanceToWall),d=!0),0<this._wallCheck11.density&&0<this._wallCheck01.density&&(this._nextPosition.y=this._wallCheck11.nextCell.getBottom(-this._colliderRadius-this._distanceToWall),d=!0),!d){d=this._wallCheck00;if(0<
d.density){e=d.getChangeType();if(3==e){this._moveLine.a.copy(d.currentPoint);this._moveLine.b.copy(d.nextPoint);e=this._checkLine.a;var f=d.nextCell.getRight(),l=d.nextCell.getTop();null==l&&(l=0);null==f&&(f=0);e.x=f;e.y=l;e=this._checkLine.b;f=d.nextCell.getLeft();l=d.nextCell.getTop();null==l&&(l=0);null==f&&(f=0);e.x=f;e.y=l;e=null!=this._moveLine.intersect(this._checkLine)?2:1}1==e?this._nextPosition.x=d.nextCell.getRight(this._colliderRadius+this._distanceToWall):2==e&&(this._nextPosition.y=
d.nextCell.getTop(this._colliderRadius+this._distanceToWall))}d=this._wallCheck10;0<d.density&&(e=d.getChangeType(),3==e&&(this._moveLine.a.copy(d.currentPoint),this._moveLine.b.copy(d.nextPoint),e=this._checkLine.a,f=d.nextCell.getLeft(),l=d.nextCell.getTop(),null==l&&(l=0),null==f&&(f=0),e.x=f,e.y=l,e=this._checkLine.b,f=d.nextCell.getRight(),l=d.nextCell.getTop(),null==l&&(l=0),null==f&&(f=0),e.x=f,e.y=l,e=null!=this._moveLine.intersect(this._checkLine)?2:1),1==e?this._nextPosition.x=d.nextCell.getLeft(-this._colliderRadius-
this._distanceToWall):2==e&&(this._nextPosition.y=d.nextCell.getTop(this._colliderRadius+this._distanceToWall)));d=this._wallCheck01;0<d.density&&(e=d.getChangeType(),3==e&&(this._moveLine.a.copy(d.currentPoint),this._moveLine.b.copy(d.nextPoint),e=this._checkLine.a,f=d.nextCell.getRight(),l=d.nextCell.getBottom(),null==l&&(l=0),null==f&&(f=0),e.x=f,e.y=l,e=this._checkLine.b,f=d.nextCell.getLeft(),l=d.nextCell.getBottom(),null==l&&(l=0),null==f&&(f=0),e.x=f,e.y=l,e=null!=this._moveLine.intersect(this._checkLine)?
2:1),1==e?this._nextPosition.x=d.nextCell.getRight(this._colliderRadius+this._distanceToWall):2==e&&(this._nextPosition.y=d.nextCell.getBottom(-this._colliderRadius-this._distanceToWall)));d=this._wallCheck11;0<d.density&&(e=d.getChangeType(),3==e&&(this._moveLine.a.copy(d.currentPoint),this._moveLine.b.copy(d.nextPoint),e=this._checkLine.a,f=d.nextCell.getLeft(),l=d.nextCell.getBottom(),null==l&&(l=0),null==f&&(f=0),e.x=f,e.y=l,e=this._checkLine.b,f=d.nextCell.getRight(),l=d.nextCell.getBottom(),
null==l&&(l=0),null==f&&(f=0),e.x=f,e.y=l,e=null!=this._moveLine.intersect(this._checkLine)?2:1),1==e?this._nextPosition.x=d.nextCell.getLeft(-this._colliderRadius-this._distanceToWall):2==e&&(this._nextPosition.y=d.nextCell.getBottom(-this._colliderRadius-this._distanceToWall)))}b=this._nextPosition.x-b-this.position.x;c=this._nextPosition.y-c-this.position.y;0<b&&(d=this._moveDirection.y,this._moveAdd.y=b*(0<d?1:0>d?-1:0)*.5);0<c&&(b=this._moveDirection.x,this._moveAdd.x=c*(0<b?1:0>b?-1:0)*.5);
this.position.copy(this._nextPosition);this.updatePosition();a.updateActive(this,3)}},onSetup:function(a){this._nextPosition.copy(this.position);this._moveDirection.copy(a.hero.position).sub(this.position).normalize();var b=H.instance,c=this._moveDirection.x,d=this._moveDirection.y;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this._rotation=b.get_angle();this._tracePosition.copy(a.hero.position)}});var Lc=function(){z.call(this);this.type=105;this._colliderRadius=12;this.size=13};Lc.get=function(){return Lc.pool.get()};
Lc.prototype=n(z.prototype,{dispose:function(){Lc.pool.set(this);this.onDispose()},render:function(){z.prototype.render.call(this);G.drawCircle(this.position,20,null,F.BLACK)}});var Mc=function(){z.call(this);this.type=14;this.size=20;this._colliderRadius=38;this._positionOffset.set(25,25);this.overWall=!0};Mc.get=function(){return Mc.pool.get()};Mc.prototype=n(z.prototype,{dispose:function(){Mc.pool.set(this);this.onDispose()},onTriggerEnter:function(a,b){6==a.type&&a.inverseGravity()}});var Nc=
function(){z.call(this);this.type=10;this._colliderRadius=20;this.size=25;this._moveDirection=new H;this._p1=new h;this._p2=new h;this._p3=new h;this.overWall=!0};Nc.get=function(){return Nc.pool.get()};Nc.prototype=n(z.prototype,{dispose:function(){Nc.pool.set(this);this.onDispose()},update:function(a){this._time-=a.deltaTime;if(0>=this._time){var b=Mb.get();b.owner=this;b.setMapObject(this.data);b.start(-this._time,this._moveDirection);this.world.add(b);this._time+=2.0054894784995425;a.updateActive(this,
1)}},render:function(){this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);var a=Ca.instance.setEulerAngles(0,0,45*this._dir);a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position);G.drawTriangle(this._p1,this._p2,this._p3,F.BLACK)},editChange:function(a){a||(this._dir++,this.init())},onSetup:function(a){this.ignoreCollision=!0;this._time=.21160409556313994;this._dir=this.data.params.getValue(2,0);this.init()},
init:function(){this._dir%=8;0>this._dir&&(this._dir+=8);if(0==this._dir){var a=this._moveDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this._dir?(a=this._moveDirection,c=b=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this._dir?(a=this._moveDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this._dir?(a=this._moveDirection,b=-1,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):4==this._dir?(a=this._moveDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):
5==this._dir?(a=this._moveDirection,c=b=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):6==this._dir?(a=this._moveDirection,b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):7==this._dir&&(a=this._moveDirection,b=1,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this.rotation=45*this._dir;this.data.params.setValue(2,this._dir)}});var Ca=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};Ca.prototype={copy:function(a){if(null==a||a==this)return this;
var b=a.x,c=a.y,d=a.z;a=a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);this.x=b;this.y=c;this.z=d;this.w=a;return this},dot:function(a,b){var c=null==b,d=c?this:a;a=c?a:b;return d.x*a.x+d.y*a.y+d.z*a.z+d.w*a.w},mul:function(a,b){var c=null==b,d=c?this:a,e=c?a:b;a=d.w*e.x+d.x*e.w+d.y*e.z-d.z*e.y;b=d.w*e.y+d.y*e.w+d.z*e.x-d.x*e.z;c=d.w*e.z+d.z*e.w+d.x*e.y-d.y*e.x;d=d.w*e.w-d.x*e.x-d.y*e.y-d.z*e.z;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;
this.w=d;return this},rotate:function(a){var b=a.x,c=a.y,d=a.z,e=this.w*b+this.y*d-this.z*c,f=this.w*c+this.z*b-this.x*d,l=this.w*d+this.x*c-this.y*b;b=-this.x*b-this.y*c-this.z*d;return a.set(e*this.w+b*-this.x+f*-this.z-l*-this.y,f*this.w+b*-this.y+l*-this.x-e*-this.z,l*this.w+b*-this.z+e*-this.y-f*-this.x)},setEulerAngles:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a*=.017453292519943295;b*=.017453292519943295;var d=Math.sin,e=Math.cos,f=.008726646259971648*c;c=d(f);f=e(f);var l=
.5*a;a=d(l);l=e(l);b*=.5;d=d(b);var g=e(b);e=g*a;b=d*l;l*=g;a*=d;this.x=e*f+b*c;this.y=b*f-e*c;this.z=l*c-a*f;this.w=l*f+a*c;return this},getEulerAngles:function(a){null==a&&(a=h._pool.get());var b=this.x*this.x,c=this.y*this.y,d=this.z*this.z,e=this.y*this.x+this.z*this.w;e=.4999<e?1:-.4999>e?-1:0;0==e?(e=2*(this.w*this.x-this.z*this.y),a.x=Math.asin(-1>e?-1:1<e?1:e),a.y=Math.atan2(2*(this.y*this.w+this.x*this.z),1-2*(c+b)),a.z=Math.atan2(2*(this.w*this.z+this.y*this.x),1-2*(b+d))):(a.x=1.5707963267948966*
e,a.y=0,a.z=2*e*Math.atan2(this.y,this.w));a.scale(57.29577951308232);return a},setLookAt:function(a,b){null==b&&(b=h.get_up());var c=-a.dot(b);if(1==c||-1==c)return this.setEulerAngles(90*c,0,0),this;b=h._pool.get().cross(b,a).normalize();c=h._pool.get().cross(a,b).normalize();this.setFromAxes(b.x,c.x,a.x,b.y,c.y,a.y,b.z,c.z,a.z);return this},setFromAxes:function(a,b,c,d,e,f,l,g,h){var k=a+e+h;0<=k?(a=Math.sqrt(k+1),this.w=.5*a,a=.5/a,this.x=(g-f)*a,this.y=(c-l)*a,this.z=(d-b)*a):a>e&&a>h?(a=Math.sqrt(1+
a-e-h),this.x=.5*a,a=.5/a,this.y=(d+b)*a,this.z=(c+l)*a,this.w=(g-f)*a):e>h?(a=Math.sqrt(1+e-a-h),this.y=.5*a,a=.5/a,this.x=(d+b)*a,this.z=(g+f)*a,this.w=(c-l)*a):(a=Math.sqrt(1+h-a-e),this.z=.5*a,a=.5/a,this.x=(c+l)*a,this.y=(g+f)*a,this.w=(d-b)*a);return this},slerpTo:function(a,b){if(null==a||0>=b)return this;if(1<=b)return this.copy(a),this;if(0<=b&&1>=b){var c=this.dot(a),d=p.abs(c),e=1-b,f=b;if(.1<1-d){f=Math.acos(d);d=Math.sin;var l=1/d(f);e=d((1-b)*f)*l;f=d(b*f)*l}0>c&&(f=-f);b=e*this.x+f*
a.x;c=e*this.y+f*a.y;d=e*this.z+f*a.z;a=e*this.w+f*a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);this.x=b;this.y=c;this.z=d;this.w=a}return this},get_up:function(){return this.rotate(h.get_up())},get_right:function(){return this.rotate(h.get_right())}};var Oc=function(){z.call(this);this.type=11;this._colliderRadius=20;this.size=25;this._shootDirection=new H;this._p1=new h;this._p2=new h;this._p3=new h;this._rotation=new Ca;this.overWall=!0};Oc.get=function(){return Oc.pool.get()};
Oc.prototype=n(z.prototype,{dispose:function(){Oc.pool.set(this);this.onDispose()},update:function(a){},lateUpdate:function(a){var b=a.deltaTime,c=a.hero.velocity.x,d=a.hero.velocity.y,e=this._shootDirection;c=a.hero.position.x-this.position.x+11*(0<c?1:0>c?-1:0);d=a.hero.position.y-this.position.y+11*(0<d?1:0>d?-1:0);null==d&&(d=0);null==c&&(c=0);e.x=c;e.y=d;e=Ca.instance.setEulerAngles(0,0,this._shootDirection.get_angle());this._rotation.slerpTo(e,8*b);this.rotation=this._rotation.getEulerAngles().z;
this._time-=a.deltaTime;0>=this._time&&(this._shootDirection.set_angle(this.rotation),b=Mb.get(),b.owner=this,b.setMapObject(this.data),b.start(-this._time,this._shootDirection),this.world.add(b),this._time+=2.0054894784995425,a.updateActive(this,1))},render:function(){this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);var a=Ca.instance.setEulerAngles(0,0,this.rotation);a.rotate(this._p1);a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position);
G.drawTriangle(this._p1,this._p2,this._p3,F.BLACK)},onSetup:function(a){this.ignoreCollision=!0;this._time=.21160409556313994;var b=this._shootDirection,c=a.hero.position.x-this.position.x;a=a.hero.position.y-this.position.y;null==a&&(a=0);null==c&&(c=0);b.x=c;b.y=a;this.rotation=this._shootDirection.get_angle();this._rotation.setEulerAngles(0,0,this.rotation);this._p1.set(0,-25,0);this._p2.set(0,25,0);this._p3.set(25,0,0);b=Ca.instance.setEulerAngles(0,0,this._shootDirection.get_angle());b.rotate(this._p1);
b.rotate(this._p2);b.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position)}});var Yb=function(){z.call(this);this.type=6;this._colliderCheck=new ef(this);this._positionOffset.y=-15;this._positionOffset.x=25;this.velocity=new h(0,0);this.shapeSize=10;this._wallCheck00=new Pa(this.shapeSize,-1,-1);this._wallCheck11=new Pa(this.shapeSize,1,1);this._wallCheck10=new Pa(this.shapeSize,1,-1);this._wallCheck01=new Pa(this.shapeSize,-1,1);this._wallCheck00.boardOffset=
6;this._wallCheck10.boardOffset=6;this._wallCheck01.boardOffset=6;this._wallCheck11.boardOffset=6;this._moveLine=new xb;this._checkLine=new xb;this._colliderRadius=11;this._nextPosition=new h;this._distanceToWall=1E-5;this._targetScaleY=1;this._replayFrameList=V.fromArray([]);this.acc=new h;this.overWall=!0};Yb.get=function(){return Yb.pool.get()};Yb.prototype=n(z.prototype,{dispose:function(){this.self=this._replayMode=this.ignoreCollision=!1;Yb.pool.set(this);this.onDispose()},setReplay:function(a){if(null!=
a&&!(1>a.length)){this._replayMode=!0;for(var b=a.length;0<b--;)this._replayFrameList.push(a[b]);this._replayActionFrame=this._replayFrameList.pop()}},inverseGravity:function(){this.gravity&&(this.gravity=!1,this.rotation=180,this._gravityScaleY=-1,this.scale.x=(0<this._xdir?1:-1)*this._gravityScaleY)},begin:function(a){this.playing=this.running=!0},update:function(a){var b=a.deltaTime;if(this._replayMode){if(a.frame==this._replayActionFrame){if(0<this._replayFrameList.get_length())this._replayActionFrame=
this._replayFrameList.pop();else{this.ignoreCollision&&this.world.event.success(this);return}this._pressed=8}}else a.pressed&&(this._pressed=8);if(0<this._pressed)if(this._pressed--,12>this.flyCount){var c=this.getGravity();this.velocity.y=337.5*c;if(0<this._spring){c=Sb.springJumpUpVelocity;var d=this.getGravity();this.velocity.y=c*d}else c=this.getGravity(),this.velocity.y=337.5*c;this.velocity.x=134*this._xdir;this.flyCount=12;this._pressed=0;a.record(this);a.updateActive(this,2)}else 0==this.runCount&&
(c=this.getGravity(),this.velocity.y=367.49999999999994*c,this._xdir=-this._xdir,this.scale.x=(0<this._xdir?1:-1)*this._gravityScaleY,this.velocity.x=134*this._xdir,this.flyCount=12,this._pressed=0,a.record(this),a.updateActive(this,7));this._wallCheck00.setCurrent(this.position);this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);a=this.velocity.y*b-421.87499999999994*this.getGravity()*b*b;this.velocity.y-=843.7499999999999*
this.getGravity()*b;0<this.flyCount&&1>this.runCount&&(this.gravity?-64.32>this.velocity.y:64.32<this.velocity.y)&&(a=this.velocity.y,a+=.5*(-64.32*this.getGravity()-a),this.velocity.y=a,a=this.velocity.y*b);c=H._pool.get();d=this.velocity.x;var e=this.velocity.y;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;this._nextPosition.copy(this.position);this._nextPosition.x+=b*this.velocity.x;this._nextPosition.y+=a;this.flying=0<this.flyCount;this.running=0<this.runCount;this.flyCount++;this.runCount++;this._wallCheck00.update(this._nextPosition,
this.velocity,this.world.mapData);this._wallCheck11.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck10.update(this._nextPosition,this.velocity,this.world.mapData);this._wallCheck01.update(this._nextPosition,this.velocity,this.world.mapData);0<this._wallCheck00.density||0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density?(this._spring=this._wallCheck00.spring+this._wallCheck01.spring+this._wallCheck10.spring+this._wallCheck11.spring,a=!1,
0<this._wallCheck00.density&&0<this._wallCheck01.density&&(this._nextPosition.x=this._wallCheck00.nextCell.getRight(this.shapeSize+this._distanceToWall),this.touchLeft(this._wallCheck00.nextCell),a=!0),0<this._wallCheck00.density&&0<this._wallCheck10.density&&(this._nextPosition.y=this._wallCheck00.currentCell.getBottom(this.shapeSize+this._distanceToWall),a=!0,this.touchYAxis(this._wallCheck00.nextCell,!0)),0<this._wallCheck10.density&&0<this._wallCheck11.density&&(this._nextPosition.x=this._wallCheck10.nextCell.getLeft(-this.shapeSize-
this._distanceToWall),this.touchRight(this._wallCheck10.nextCell),a=!0),0<this._wallCheck11.density&&0<this._wallCheck01.density&&(this._nextPosition.y=this._wallCheck11.nextCell.getBottom(-this.shapeSize-this._distanceToWall),a=!0,this.touchYAxis(this._wallCheck11.nextCell,!1)),a||(a=this._wallCheck00,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getRight(2),e=a.nextCell.getTop(),null==e&&(e=0),null==
d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getLeft(-2),e=a.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?(this._nextPosition.x=a.nextCell.getRight(this.shapeSize+this._distanceToWall),this.touchLeft(a.nextCell)):2==c&&(this._nextPosition.y=a.nextCell.getTop(this.shapeSize+this._distanceToWall),this.touchYAxis(a.nextCell,!0))),a=this._wallCheck10,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),
this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getLeft(-2),e=a.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getRight(2),e=a.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?(this._nextPosition.x=a.nextCell.getLeft(-this.shapeSize-this._distanceToWall),this.touchRight(a.nextCell)):2==c&&(this._nextPosition.y=a.nextCell.getTop(this.shapeSize+this._distanceToWall),
this.touchYAxis(a.nextCell,!0))),a=this._wallCheck01,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getRight(),e=a.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getLeft(),e=a.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?(this._nextPosition.x=a.nextCell.getRight(this.shapeSize+
this._distanceToWall),this.touchLeft(a.nextCell)):2==c&&(this._nextPosition.y=a.nextCell.getBottom(-this.shapeSize-this._distanceToWall),this.touchYAxis(a.nextCell,!1))),a=this._wallCheck11,0<a.density&&(c=a.getChangeType(),3==c&&(this._moveLine.a.copy(a.currentPoint),this._moveLine.b.copy(a.nextPoint),c=this._checkLine.a,d=a.nextCell.getLeft(),e=a.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=a.nextCell.getRight(),e=a.nextCell.getBottom(),null==e&&(e=0),null==
d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?(this._nextPosition.x=a.nextCell.getLeft(-this.shapeSize-this._distanceToWall),this.touchRight(a.nextCell)):2==c&&(this._nextPosition.y=a.nextCell.getBottom(-this.shapeSize-this._distanceToWall),this.touchYAxis(a.nextCell,!1)))),this._targetScaleY=1):(this._beginFall&&(this._beginFall=!1,0>this.velocity.y&&(0<this._wallCheck00.prevDesity&&this._wallCheck00.prevCell.getRight(),0<this._wallCheck10.prevDesity&&this._wallCheck10.prevCell.getLeft()),
this.fall()),this.falling(),a=this.velocity.y/337.5,this._targetScaleY=1+.5*p.abs(-1>a?-1:1<a?1:a));a=this.scale.y;this.scale.y=a+5*(this._targetScaleY-a)*b;this.acc.copy(this._nextPosition).sub(this.position);this.position.copy(this._nextPosition);this.updatePosition()},lateUpdate:function(a){this.getColliderShapes(this._colliderCheck);var b=this._colliderCheck.triggerEnterList.get_length();if(0<b)for(;0<b--;)this._colliderCheck.triggerEnterList.getArrayElement(b).onTriggerEnter(this,a);b=this._colliderCheck.triggerExitList.get_length();
if(0<b)for(;0<b--;)this._colliderCheck.triggerExitList.getArrayElement(b).onTriggerExit(this,a)},render:function(){G.drawPlane(this.position,h.get_right().scale(this.shapeSize),h.get_up().scale(this.shapeSize),F.RED);var a=h.instance.copy(this.position);a.y+=3.5999999999999996;G.drawPlane(a,h.get_right().scale(this.shapeSize+3.5999999999999996),h.get_up().scale(this.shapeSize+3.5999999999999996),F.BLUE)},onSetup:function(a){this.type=6;this.playing=this.running=!1;this._wallCheck00.reset();this._wallCheck10.reset();
this._wallCheck01.reset();this._wallCheck11.reset();this._nextPosition.copy(this.position);this._hasGround=!1;this.gravity=!0;this.velocity.x=134;this.flyCount=this.runCount=1E3;this._xdir=1;this._pressed=this._spring=0;a=this.world.mapData.getByPosition(this.position.x,this.position.y);a=this.world.mapData.map.get(a.x,a.y-1);1==a.type||4==a.type?(this.flyCount=0,this.velocity.x=146.5,this.flying=!1):(this.velocity.x=134,this.flying=!0);this.velocity.y=0;this._gravityScaleY=1;this._colliderCheck.clear();
this.scale.set(1,1,1);this.rotation=0},getGravity:function(){return this.gravity?1:-1},touchYAxis:function(a,b){null==b&&(b=!0);this.gravity||(b=!b);b?(this.flyCount=this.velocity.y=0,this.velocity.x=146.5*this._xdir,this._beginFall=!0):(this.velocity.y=0,this.velocity.x=140.25*this._xdir);this._hasGround||(this._hasGround=!0,this.scale.y=this._targetScaleY=.5,this.world.param.updateActive(this,6));this.world.param.setTouchY(a.y)},touchLeft:function(a){this.runCount=0;this.velocity.x=146.5*this._xdir;
this.world.param.setTouchX(a.x)},touchRight:function(a){this.runCount=0;this.velocity.x=146.5*this._xdir;this.world.param.setTouchX(a.y)},fall:function(){this.velocity.x=134*this._xdir},falling:function(){this._hasGround=!1}});var Pc=function(){z.call(this);this.type=101;this._moveDirection=new H;this._basePosition=new H;this._time=0;this._colliderRadius=11;this._p1=new h;this._p2=new h;this._p3=new h;this._path=-1;this.overWall=!0};Pc.get=function(){return Pc.pool.get()};Pc.prototype=n(z.prototype,
{dispose:function(){Pc.pool.set(this);this.onDispose()},update:function(a){this._time+=a.deltaTime;this._time>this._totalTime&&(this._time-=this._totalTime,this._path=0);var b=this._time/this._totalTime;.5>b?(b=qd.quadInOut(2*b),this.scale.x=0<this._moveDirection.x+this._moveDirection.y?1:-1,1!=this._path&&(this._path=1,a.updateActive(this,3))):(b=qd.quadInOut(1-2*(b-.5)),this.scale.x=0<-(this._moveDirection.x+this._moveDirection.y)?1:-1,-1!=this._path&&(this._path=-1,a.updateActive(this,3)));a=130.80357142857144*
this._totalTime*b*.5;this.position.x=this._basePosition.x+this._moveDirection.x*a;this.position.y=this._basePosition.y+this._moveDirection.y*a;this.updatePosition()},render:function(){G.drawCircle(this.position,20,null,F.BLACK);G.drawCircle(this.position,this._colliderRadius,null,this.enabled?F.RED:F.BLACK);this._p1.set(0,-this._colliderRadius,0);this._p2.set(0,this._colliderRadius,0);this._p3.set(this._colliderRadius,0,0);var a=Ca.instance.setEulerAngles(0,0,0>this.scale.x?180:0);a.rotate(this._p1);
a.rotate(this._p2);a.rotate(this._p3);this._p1.add(this.position);this._p2.add(this.position);this._p3.add(this.position);G.drawTriangle(this._p1,this._p2,this._p3,F.RED)},setMapObject:function(a){z.prototype.setMapObject.call(this,a);this.editMode&&null!=this._editDot&&this._editDot.relateChanged()},editChange:function(a){a||(this._dir++,this.init(),this.editMode&&null!=this._editDot&&this._editDot.relateChanged())},editUpdate:function(a,b){a=z.prototype.editUpdate.call(this,a,b);this.editMode&&
null!=this._editDot&&this._editDot.relateChanged();return a},onSetup:function(a){this._basePosition.x=this.position.x;this._basePosition.y=this.position.y;this._time=0;this._moveDistance=this.data.params.getValue(1,3);3>this._moveDistance&&(this._moveDistance=3);this._dir=this.data.params.getValue(2,0)%4;this.init();this.scale.x=0<this._moveDirection.x+this._moveDirection.y?1:-1;this._totalTime=100*this._moveDistance/130.80357142857144},onAdd:function(a){z.prototype.onAdd.call(this,a);this.editMode&&
(this._editDot=Lb.get(),a.add(this._editDot),this._editDot.setRelate(this))},onDispose:function(){z.prototype.onDispose.call(this);this._editDot=null},init:function(){0>this._dir&&(this._dir+=4);if(0==this._dir){var a=this._moveDirection,b=1,c=0;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==this._dir?(a=this._moveDirection,b=0,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==this._dir?(a=this._moveDirection,b=-1,c=0,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==this._dir&&(a=this._moveDirection,
b=0,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this.data.params.setValue(2,this._dir)}});var Qc=function(){z.call(this);this.type=104;this._colliderRadius=11;this._wallCheck00=new Pa(this._colliderRadius,-1,-1);this._wallCheck11=new Pa(this._colliderRadius,1,1);this._wallCheck10=new Pa(this._colliderRadius,1,-1);this._wallCheck01=new Pa(this._colliderRadius,-1,1);this._moveLine=new xb;this._checkLine=new xb;this._distanceToWall=1E-5;this._moveVelocity=new H;this._nextPosition=new h;this._willPosition=
new h;this.overWall=!0};Qc.get=function(){return Qc.pool.get()};Qc.prototype=n(z.prototype,{dispose:function(){Qc.pool.set(this);this.onDispose()},update:function(a){var b=this.world.mapData.getByPosition(this.position.x,this.position.y);if(null==b||1!=b.type&&4!=b.type){b=a.deltaTime;this._wallCheck00.setCurrent(this.position);this._wallCheck11.setCurrent(this.position);this._wallCheck10.setCurrent(this.position);this._wallCheck01.setCurrent(this.position);var c=h.instance.set(134.625*this._moveVelocity.x,
134.625*this._moveVelocity.y,0);this._nextPosition.x+=c.x*b;this._nextPosition.y+=c.y*b;this._willPosition.copy(this._nextPosition);this._wallCheck00.update(this._nextPosition,c,this.world.mapData);this._wallCheck11.update(this._nextPosition,c,this.world.mapData);this._wallCheck10.update(this._nextPosition,c,this.world.mapData);this._wallCheck01.update(this._nextPosition,c,this.world.mapData);if(0<this._wallCheck00.density||0<this._wallCheck01.density||0<this._wallCheck10.density||0<this._wallCheck11.density){b=
!1;0<this._wallCheck00.density&&0<this._wallCheck01.density&&(this._nextPosition.x=this._wallCheck00.currentCell.getLeft(this.size+this._distanceToWall),b=!0);0<this._wallCheck00.density&&0<this._wallCheck10.density&&(this._nextPosition.y=this._wallCheck00.currentCell.getBottom(this.size+this._distanceToWall),b=!0);0<this._wallCheck10.density&&0<this._wallCheck11.density&&(this._nextPosition.x=this._wallCheck10.nextCell.getLeft(-this.size-this._distanceToWall),b=!0);0<this._wallCheck11.density&&0<
this._wallCheck01.density&&(this._nextPosition.y=this._wallCheck11.nextCell.getBottom(-this.size-this._distanceToWall),b=!0);if(!b){b=this._wallCheck00;if(0<b.density){c=b.getChangeType();if(3==c){this._moveLine.a.copy(b.currentPoint);this._moveLine.b.copy(b.nextPoint);c=this._checkLine.a;var d=b.nextCell.getRight(),e=b.nextCell.getTop();null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=this._checkLine.b;d=b.nextCell.getLeft();e=b.nextCell.getTop();null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=null!=this._moveLine.intersect(this._checkLine)?
2:1}1==c?this._nextPosition.x=b.nextCell.getRight(this.size+this._distanceToWall):2==c&&(this._nextPosition.y=b.nextCell.getTop(this.size+this._distanceToWall))}b=this._wallCheck10;0<b.density&&(c=b.getChangeType(),3==c&&(this._moveLine.a.copy(b.currentPoint),this._moveLine.b.copy(b.nextPoint),c=this._checkLine.a,d=b.nextCell.getLeft(),e=b.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=b.nextCell.getRight(),e=b.nextCell.getTop(),null==e&&(e=0),null==d&&(d=0),c.x=
d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?this._nextPosition.x=b.nextCell.getLeft(-this.size-this._distanceToWall):2==c&&(this._nextPosition.y=b.nextCell.getTop(this.size+this._distanceToWall)));b=this._wallCheck01;0<b.density&&(c=b.getChangeType(),3==c&&(this._moveLine.a.copy(b.currentPoint),this._moveLine.b.copy(b.nextPoint),c=this._checkLine.a,d=b.nextCell.getRight(),e=b.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=b.nextCell.getLeft(),
e=b.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?this._nextPosition.x=b.nextCell.getRight(this.size+this._distanceToWall):2==c&&(this._nextPosition.y=b.nextCell.getBottom(-this.size-this._distanceToWall)));b=this._wallCheck11;0<b.density&&(c=b.getChangeType(),3==c&&(this._moveLine.a.copy(b.currentPoint),this._moveLine.b.copy(b.nextPoint),c=this._checkLine.a,d=b.nextCell.getLeft(),e=b.nextCell.getBottom(),null==e&&(e=0),
null==d&&(d=0),c.x=d,c.y=e,c=this._checkLine.b,d=b.nextCell.getRight(),e=b.nextCell.getBottom(),null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=null!=this._moveLine.intersect(this._checkLine)?2:1),1==c?this._nextPosition.x=b.nextCell.getLeft(-this.size-this._distanceToWall):2==c&&(this._nextPosition.y=b.nextCell.getBottom(-this.size-this._distanceToWall)))}this._willPosition.sub(this._nextPosition);b=this._willPosition.x;c=this._willPosition.y;d=p.abs(b)+p.abs(c);this._count++;4<=this._count?(this._count=
0,this._moveVelocity.y=-this._moveVelocity.y,this._moveVelocity.x=-this._moveVelocity.x,this._nextPosition.y+=d*this._moveVelocity.y,this._nextPosition.x+=d*this._moveVelocity.x,a.updateActive(this,6)):(0!=c&&(this._moveVelocity.y=-this._moveVelocity.y,this._nextPosition.y+=d*this._moveVelocity.y,a.updateActive(this,6)),0!=b&&(this._moveVelocity.x=-this._moveVelocity.x,this._nextPosition.x+=d*this._moveVelocity.x,a.updateActive(this,6)));this.rotation=this._moveVelocity.get_angle()}this.position.copy(this._nextPosition);
this.updatePosition()}},onSetup:function(a){this._count=0;a=this.data.params.getValue(2,0)%4;0>a&&(a+=4);if(0==a){a=this._moveVelocity;var b=1,c=1;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c}else 1==a?(a=this._moveVelocity,b=-1,c=1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):2==a?(a=this._moveVelocity,c=b=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c):3==a&&(a=this._moveVelocity,b=1,c=-1,null==c&&(c=0),null==b&&(b=0),a.x=b,a.y=c);this._nextPosition.copy(this.position);this.rotation=this._moveVelocity.get_angle()}});
var Rc=function(){z.call(this);this.type=151;this.size=13};Rc.get=function(){return Rc.pool.get()};Rc.prototype=n(z.prototype,{dispose:function(){Rc.pool.set(this);this.onDispose()},onSetup:function(a){z.prototype.onSetup.call(this,a);this.ignoreCollision=!0}});var Sc=function(){z.call(this);this.type=7;this._colliderRadius=this.size=26;this._positionOffset.set(25,-25+this._colliderRadius);var a=this.editCheckWall,b=2,c=2;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c};Sc.get=function(){return Sc.pool.get()};
Sc.prototype=n(z.prototype,{dispose:function(){Sc.pool.set(this);this.onDispose()},colliderWith:function(a){var b=a.position.x,c=a.position.y,d=this.position.x-30,e=this.position.x+30,f=this.position.y+26,l=this.position.y-26;a.position.x<d?b=d:a.position.x>e&&(b=e);a.position.y<l?c=l:a.position.y>f&&(c=f);b-=a.position.x;c-=a.position.y;return b*b+c*c<a._colliderRadius*a._colliderRadius?!0:!1},onTriggerEnter:function(a,b){this.world.event.enter(a,this);b.hero==a&&(b.record(b.hero),b.updateActive(this,
6))},render:function(){G.drawPlane(this.position,h.get_right().scale(30),h.get_up().scale(26),this.enabled?F.GREEN:F.BLACK)}});var Zd=function(){};Zd.prototype={execute:function(a){}};var zf=function(){};zf.prototype=n(Zd.prototype,{execute:function(a){Q.copyFieldTo(a.userData,J.userData);Q.copyFieldTo(a.pveData,J.pveData);N.level.seed=J.userData.seed;J.bagData.from(a.bagData.list);na.autoAdd.init(a.passTime);t.map.show();t.itemInfo1.show()}});var Af=function(){};Af.prototype=n(Zd.prototype,{execute:function(a){var b=
a.id,c=a.star-J.pveData.states[a.id];0>c&&(c=0);for(var d=N.level.getLevel(a.id),e=d.reward.length;0<e--;)J.bagData.addItemCount(d.reward[e].x,d.reward[e].y*c);0==J.pveData.states[a.id]&&(b+=1);0<c&&(J.pveData.states[a.id]=a.star);a.id==J.pveData.currentLevel?J.pveData.currentLevel++:J.pveData.currentLevel=a.id;J.userData.activeTime=(new Date).getTime();J.datebase.getTable("user").search({id:J.userData.id}).update({activeTime:(new Date).getTime()});J.datebase.getTable("bag").search({}).update(J.bagData.get_data());
J.datebase.getTable("pve").search({}).update(J.pveData.get_data()).then(function(a){J.bagData.update();t.map.show();t.map.focus(b)})}});var Fe=function(){this._time=0};Fe.prototype={frameUpdate:function(a){this._dirty&&(this._dirty=!1,J.datebase.getTable("user").search({id:J.userData.id}).update({activeTime:(new Date).getTime()}));0<this._time&&(this._time-=a,0>=this._time&&this.check())},init:function(a){this._dirty=!1;var b=(new Date).getTime(),c=N.itemLevelEffect.autoAddList,d=c.length;for(this._autoAddItems=
V.fromArray([]);0<d--;){var e=new Bf(c[d],b,a);e.onTrigger=g(this,this.onUpdate);this._autoAddItems.push(e)}this.check()},check:function(){for(var a=(new Date).getTime(),b=this._autoAddItems.get_length(),c=1E7;0<b--;){var d=this._autoAddItems.getArrayElement(b);d.update(a);d=d.endTime-a;d<c&&(c=d)}this._time=.001*c+2},onUpdate:function(a){this._dirty=!0;var b=J.bagData.getItem(a.id);b=N.itemLevelEffect.getEffect(b.id,b.count);J.bagData.addItemCount(b.autoAddItem.x,b.autoAddItem.y*a.count);J.bagData.update();
J.datebase.getTable("bag").search({}).update(J.bagData.get_data())}};var Bf=function(a,b,c){this.id=a;this.startTime=b;var d=J.bagData.getItem(a);this._delay=N.itemLevelEffect.getEffect(a,d.count).param1;this.endTime=b+this._delay-c;this.count=0};Bf.prototype={update:function(a){var b=a-this.endTime;if(!(0>b)){var c=J.bagData.getItem(this.id);this._delay=N.itemLevelEffect.getEffect(this.id,c.count).param1;this.count=p.floatToInt(.001*b/this._delay)+1;this.startTime=a;this.endTime=this.startTime+1E3*
this._delay;if(null!=this.onTrigger)this.onTrigger(this);this.count=0}}};var Ie=function(){var a=na.response;a.map(1,new zf);a.map(2,new Af)};Ie.prototype={};var De=function(){this._map=new X;this._update=new X;this._dirty=!1};De.prototype={frameUpdate:function(a){if(this._dirty)for(this._dirty=!1,a=new tb(this._update);a.hasNext();){var b=a.next(),c=b.key;b=b.value;var d=this._map.h[c];this._update.remove(c);if(null!=d)for(c=d.length;0<c--;)d[c].dataUpdate(b)}},addWatch:function(a,b){var c=this._map.h[a.type];
null==c&&(c=[],this._map.h[a.type]=c);y.remove(c,b);c.push(b);b.dataUpdate(a)},removeWatch:function(a,b){a=this._map.h[a.type];null!=a&&y.remove(a,b)},dataUpdate:function(a){this._dirty=!0;this._update.h[a.type]=a}};var Cf=function(){};Cf.get=function(a){switch(a){case 2:var b=kc.get();break;case 3:b=lc.get();break;case 5:b=oc.get();break;case 6:b=yc.get();break;case 7:b=Cc.get();break;case 10:b=wc.get();break;case 11:b=xc.get();break;case 12:b=pc.get();break;case 13:b=mc.get();break;case 14:b=vc.get();
break;case 101:b=zc.get();break;case 102:b=jc.get();break;case 103:b=tc.get();break;case 104:b=Ac.get();break;case 105:b=uc.get();break;case 130:b=nc.get();break;case 131:b=sc.get();break;case 150:b=rc.get();break;case 151:b=Bc.get();break;default:b=null}null!=b&&(b.name=Ga.getNameByType(a));return b};var Df=function(){this._list=[]};Df.prototype={add:function(a){this._list.push(a)},frameUpdate:function(a){if(!(1>this._list.length||(a=this._list.shift(),0>a.protocol)))this.onRequest(a)},onRequest:function(a){}};
var He=function(){this._list=[];this._map=new X;this._map.h[1]=g(this,this._login);this._map.h[2]=g(this,this._pveComplete);this._rightTime=!0};He.prototype=n(Df.prototype,{onRequest:function(a){var b=this._map.h[a.protocol];null!=b&&(null==this._response&&(this._response=na.response),b(a))},_login:function(a){this._loginRequest=a;this._dologin()},_dologin:function(){var a=this;J.datebase.getTable("user").search({id:this._loginRequest.user}).get().then(function(b){var c=!1;null!=b&&(c=0>Q.getFloat(b[0],
"createTime",0));if(c)nb.clear(),J.datebase.getTable("user").search({id:a._loginRequest.user}).delete().then(function(b){a._dologin()});else if(null==b){b=new Ad;b.id=a._loginRequest.user;b.createTime=(new Date).getTime();b.activeTime=b.createTime;c=jb.instance;c.reset();c.addString(b.id);b.seed=c.getCode();J.datebase.getTable("user").add(b.get_data());c=new Bd;for(var d=N.newuserItem.list.length;0<d--;){var e=N.newuserItem.list[d];c.updateItem({id:e.id,count:e.count})}J.datebase.getTable("bag").add(c.get_data());
d=new Cd;J.datebase.getTable("pve").add(d.get_data());e=new $d;e.userData=b;e.bagData=c;e.pveData=d;e.passTime=0;a._response.add(e)}else{var f=new $d;c=new Ad;f.userData=c;Q.copyFieldTo(b[0],c);J.datebase.getTable("bag").search({}).get().then(function(b){var c=new Bd;f.bagData=c;Q.copyFieldTo(b[0],c);J.datebase.getTable("pve").search({}).get().then(function(b){var c=new Cd;f.pveData=c;Q.copyFieldTo(b[0],c);b=(new Date).getTime();J.datebase.getTable("user").search({id:a._loginRequest.user}).update({activeTime:b});
a._response.add(f)})})}})},_pveComplete:function(a){J.userData.activeTime=(new Date).getTime();var b=new Ef;b.star=a.star;b.keyCount=a.keyCount;b.id=a.id;this._response.add(b)}});var cd=function(){this._retryCall=new ba(g(this,this._retry));this._transfer=new Ff};cd.prototype={loadLevel:function(a,b,c){this._mapData=b;this._callback=c;a>=N.level.max||(a=N.level.getLevel(a),null!=a&&(this._mapData.set(this._transfer.decode(a.data)),a.data.position=0));null!=this._callback&&this._callback(this._mapData)},
load:function(a,b){this._mapData=a;this._callback=b;this._url=a.url;-1==a.url.indexOf(".tmx")&&(this._url+=".tmx");this._res=m.bytes.get(this._url);this._res.addEventListener(C.complete._type,g(this,this.resComplete));this._res.enabled&&this.resComplete()},_retry:function(){this._res.unload();this._res=m.bytes.get(this._url);this._res.addEventListener(C.complete._type,g(this,this.resComplete))},resComplete:function(a){null==this._res.bytes||ta.gt(1,this._res.bytes._length)?this._retryCall.start(3):
(this._res.removeEventListener(C.complete._type,g(this,this.resComplete)),-1!=this._url.indexOf("tmb")?this._mapData.set(this._transfer.decode(this._res.bytes)):this._mapData.set(this._transfer.parse(this._res.bytes.toString(),this._url)),null!=this._callback&&this._callback(this._mapData),this._res.unload())}};var Ee=function(){this._list=[];this._commands=new X};Ee.prototype={map:function(a,b){this._commands.h[a]=b},add:function(a){y.remove(this._list,a);this._list.push(a)},frameUpdate:function(a){if(!(1>
this._list.length||(a=this._list.shift(),0>a.protocol))){var b=this._commands.h[a.protocol];null!=b&&b.execute(a)}}};var Ga=function(){};Ga.get=function(a){switch(a.type){case 2:var b=Zb.get();break;case 3:b=$b.get();break;case 5:b=Gc.get();break;case 7:b=Sc.get();break;case 10:b=Nc.get();break;case 11:b=Oc.get();break;case 12:b=Hc.get();break;case 13:b=Ec.get();break;case 14:b=Mc.get();break;case 100:b=Fc.get();break;case 101:b=Pc.get();break;case 102:b=Dc.get();break;case 103:b=Kc.get();break;case 104:b=
Qc.get();break;case 105:b=Lc.get();break;case 106:b=Jc.get();break;case 150:b=Lb.get();break;case 151:b=Rc.get();break;default:b=null}if(null==b)return null;b.setMapObject(a);b.ignoreCollision=!1;return b};Ga.getNameByType=function(a){switch(a){case 2:a="Board";break;case 3:a="BoardSpring";break;case 5:a="Door";break;case 6:a="Hero";break;case 7:a="Treasure";break;case 10:a="Gun";break;case 11:a="GunHoming";break;case 12:a="Dragon";break;case 13:a="Boiler";break;case 14:a="Gravity";break;case 100:a=
"Chainsaw";break;case 101:a="RedDemon";break;case 102:a="BlueDemon";break;case 103:a="Fly";break;case 104:a="Ricochet";break;case 105:a="Gear";break;case 106:a="Elk";break;case 130:a="Bullet";break;case 131:a="Flame";break;case 150:a="editTarget";break;case 151:a="tips";break;default:a="unknow"}return a};Ga.getItemByType=function(a){if(null!=Ga._typeIdMap)return Ga._typeIdMap.h[a];Ga._typeIdMap=new X;Ga._typeIdMap.h[101]=37;Ga._typeIdMap.h[102]=38;Ga._typeIdMap.h[12]=39;Ga._typeIdMap.h[106]=40;Ga._typeIdMap.h[103]=
41;Ga._typeIdMap.h[105]=42;Ga._typeIdMap.h[10]=43;Ga._typeIdMap.h[11]=44;Ga._typeIdMap.h[104]=45;Ga._typeIdMap.h[100]=49;return Ga._typeIdMap.h[a]};var Ge=function(){this._soundList=V.fromArray([]);this._sound=new L};Ge.prototype={frameUpdate:function(a){a=this._soundList.get_length();if(!(1>a)){for(;0<a--;)this._soundList.getArrayElement(a).play();this._soundList.clear()}},playById:function(a,b){a=N.trapSound.getKey(a,b);a=N.trapSound.get(a);null!=a&&this.play(A.soundPath+p.randomOneFromList(a.soundName)+
".m4a",1)},play:function(a,b){null==b&&(b=1);var c=this._sound;c=null!=q[a]?c.getReserved(a):c.h[a];if(null==c){c=m.audio.getRes(a);c=new Gf(c.audio);c=new Hf(c);var d=this._sound;null!=q[a]?d.setReserved(a,c):d.h[a]=c}b<c.volume||(c.volume=b,this._soundList.push(c))}};var Hf=function(a){this.audio=a};Hf.prototype={play:function(){this.audio.stop();this.audio.set_volume(this.volume);this.volume=0;this.audio.play()}};var Ff=function(){this._levelData=new Fb;this._encode=new Fb};Ff.prototype={parse:function(a,
b){this._levelData.clear();var c=x.parse(a).firstElement();a=p.stringToInt(c.get("width"));b=p.stringToInt(c.get("height"));this._tileSize=p.stringToInt(c.get("tilewidth"));this._levelData.width=a;this._levelData.height=b;for(c=c.elements();c.hasNext();){var d=c.next();if(d.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(d.nodeType));if("layer"==d.nodeName){d=d.firstElement();if(d.nodeType!=x.Document&&d.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+
ka.toString(d.nodeType));d=d.children[0];if(d.nodeType==x.Document||d.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(d.nodeType));d=d.nodeValue.split(",");for(var e=d.length;0<e--;){var f=p.trim(d[e]);f=p.stringToInt(f);if(0<f){var l=e%a,g=p.floatToInt(e/a);g=b-g-1;this._levelData.setWall(l,g,1==f);if(1<f&&4>f){var h=Xa.get();h.x=l;h.y=g;h.type=f;this._levelData.objects.push(h)}}}}else{if(d.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(d.nodeType));
if("objectgroup"==d.nodeName)for(d=d.elements();d.hasNext();)e=d.next(),this.parseObject(e)}}return this._levelData},decode:function(a){this._encode.decode(a);return this._encode},parseObject:function(a){if(!a.exists("visible")||0!=p.stringToBool(a.get("visible"))){var b=p.stringToFloat(a.get("x")),c=p.stringToFloat(a.get("y"));b=p.floatToInt(b/this._tileSize);var d=this._levelData.height-1-p.floatToInt(c/this._tileSize);if(!(b>=this._levelData.width||d>=this._levelData.height||0>b||0>d)){var e=a.get("template");
if(null!=e){e=ia.replace(e,".tx","");c=Xa.get();c.x=b;c.y=d;switch(e){case "\u53cd\u91cd\u529b":b=14;break;case "\u55b7\u706b\u9f99":b=12;break;case "\u5b9d\u7bb1":b=7;break;case "\u5bfc\u5f39":b=11;break;case "\u5f39\u7403":b=104;break;case "\u63d0\u793a":b=151;break;case "\u70ae\u624b":b=10;break;case "\u79fb\u52a8\u70ae":b=106;break;case "\u7ea2\u9b54\u9b3c":b=101;break;case "\u82cd\u8747":b=103;break;case "\u84dd\u9b54\u9b3c":b=102;break;case "\u94fe\u952f":b=100;break;case "\u9505\u7089":b=13;
break;case "\u95e8":b=5;break;case "\u9f7f\u8f6e":b=105;break;default:b=-1}c.type=b;if(-1!=c.type){for(a=a.elements();a.hasNext();){b=a.next();if(b.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(b.nodeType));if("properties"==b.nodeName)for(b=b.elements();b.hasNext();){var f=b.next();d=f.get("type");e=f.get("name");f=f.get("value");switch(d){case "int":d=this.getType(e),c.params.setValue(d,p.stringToInt(f))}}}this._levelData.objects.push(c)}}}}},getType:function(a){switch(a){case "count":a=
5;break;case "direction":a=2;break;case "forward":a=3;break;case "gold":a=6;break;case "length":a=1;break;case "level":a=4;break;default:a=0}return a}};var Ce=function(){Ia.game.addEventListener(C.update._type,g(this,this.update));this._list=[]};Ce.prototype={add:function(a){y.remove(this._list,a);this._list.push(a)},update:function(a){a=E.deltaTime;var b=this._list.length;if(!(1>b))for(var c=0;c<b;){var d=c++;this._list[d].frameUpdate(a)}}};var D=function(){};D.init=function(a,b,c){D.root=new v;
D.root.name="view root";D.root.get_transform().position.set(400,250,0);a.addChild(D.root);D.touchInput=D.root.addComponentIfNotExist(rd);D.touchInput.camera=b;D._gameRoot=new v;D._gameRoot.get_transform().position.set(400,250,0);c.addChild(D._gameRoot);D._layers=new X;D._cacheViewLayer=new X;D._layers.h[Fa.background]=[];D._layers.h[Fa.uifloat]=[];D._layers.h[Fa.uipop]=[]};D.showGame=function(a){a.setParent(D._gameRoot)};D.show=function(a,b){null==b&&(b=-1);0>b&&(b=a.viewLayer);if(!(b>Fa.uipop)){var c=
D._layers.h[b];if(b<Fa.uifloat){if(0<c.length){var d=c[0];if(d!=a)d.get_transform().removeFromParent(),d.isShow=!1,d.onRemove();else return;c.pop()}D._history.push(a)}c.push(a);D._cacheViewLayer.h[a.instanceID]=b;D.root.get_transform().addChild(a.get_transform());a._inited||(a._inited=!0,a.onInit());a.isShow=!0;a.onAdd();D.sort()}};D.close=function(a){if(D._cacheViewLayer.h.hasOwnProperty(a.instanceID)){var b=D._cacheViewLayer.h[a.instanceID];D._cacheViewLayer.remove(a.instanceID);y.remove(D._layers.h[b],
a)&&(a.get_transform().removeFromParent(),a.isShow=!1,a.onRemove())}};D.back=function(){if(1<D._history.length){var a=D._history[D._history.length-1];D.close(a);D._history.pop();a=D._history[D._history.length-1];null!=a&&D.show(a,-1);a=D._history.length;for(var b=null;0<a--;){var c=D._history[a];c==b&&D._history.splice(a,1);b=c}}};D.sort=function(){for(var a=0,b=Fa.background,c=Fa.uipop+1;b<c;){var d=b++;d=D._layers.h[d];for(var e=0,f=d.length;e<f;){var l=e++;l=d[l];var g=a++;null!=l._canvas&&(l._canvas.order=
g);D.root.get_transform().addChild(l.get_transform())}}};var If=function(){var a=N.shader.get("hole_vert"),b=N.shader.get("hole_frag");new U("_h",a,b);a=N.shader.get("bevel_vert");b=N.shader.get("bevel_frag");new U(A.lightShader,a,b);a=N.shader.get("img_blur_vert");b=N.shader.get("img_blur_frag");new U("blur",a,b)};If.prototype={};var ae=function(){this.name="item";this.__list=[]};ae.prototype={createTableItem:function(){var a=new Jf;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=
this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var Le=function(){ae.call(this);this._map=new X;this._typeMap=new X};Le.prototype=n(ae.prototype,{get:function(a){return this._map.h[a]},addItem:function(a){this._map.h[a.id]=a;var b=this._typeMap.h[a.type];null==b&&(b=[],this._typeMap.h[a.type]=b);b.push(a)}});var be=function(){this.name="itemLevelEffect";this.__list=[]};be.prototype={createTableItem:function(){var a=
new Kf;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var Ne=function(){be.call(this);this._map=new L;this._addMap=new X;this.autoAddList=[]};Ne.prototype=n(be.prototype,{getEffect:function(a,b){var c=this._map;a=a+":"+b;return null!=q[a]?c.getReserved(a):c.h[a]},addItem:function(a){var b=this._map,c=a.id+":"+a.level;null!=q[c]?b.setReserved(c,
a):b.h[c]=a;null!=a.autoAddItem&&0<a.param1&&!this._addMap.h.hasOwnProperty(a.id)&&(this._addMap.h[a.id]=!0,this.autoAddList.push(a.id))}});var ce=function(){this.name="level";this.__list=[]};ce.prototype={createTableItem:function(){var a=new Lf;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var Ke=function(){ce.call(this);this._list=
[];this.max=0};Ke.prototype=n(ce.prototype,{getLevel:function(a){return this._list[a]},getMinRandomKey:function(a){null==this._r&&(this._r=new fd);this._r.setSeed(J.userData.seed+a);a=this.getLevel(a);a=N.itemLevelEffect.getEffect(46,a.keyLevel).count;this._r.getFloat();var b=this._r.getFloat();return p.floatToInt(b*a)+1},addItem:function(a){this._list[a.id]=a;a.id>this.max&&(this.max=a.id)}});var de=function(){this.name="newUserItem";this.__list=[]};de.prototype={createTableItem:function(){var a=
new Mf;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var Me=function(){de.call(this);this.list=[]};Me.prototype=n(de.prototype,{addItem:function(a){this.list.push(a)}});var Id=function(){this.name="shader";this.__list=[]};Id.prototype={createTableItem:function(){var a=new Nf;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=
this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var Pe=function(){Id.call(this);this._map=new L};Pe.prototype=n(Id.prototype,{get:function(a){var b=this._map;return null!=q[a]?b.getReserved(a):b.h[a]},addItem:function(a){Id.prototype.addItem.call(this,a);var b=this._map,c=a.name;a=a.value;null!=q[c]?b.setReserved(c,a):b.h[c]=a}});var ee=function(){this.name="skin";this.__list=[]};ee.prototype={createTableItem:function(){var a=
new Of;null!=this.__list&&this.__list.push(a);return a},tableInit:function(){if(null!=this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var Je=function(){ee.call(this);this._map=new X};Je.prototype=n(ee.prototype,{get:function(a){return this._map.h[a]},addItem:function(a){this._map.h[a.id]=a}});var Jd=function(){this.name="trapSound";this.__list=[]};Jd.prototype={createTableItem:function(){var a=new Pf;null!=this.__list&&
this.__list.push(a);return a},tableInit:function(){if(null!=this.__list){for(var a=0,b=this.__list.length;a<b;){var c=a++;this.addItem(this.__list[c])}this.__list=null}},addItem:function(a){}};var Oe=function(){Jd.call(this);this._map=new X};Oe.prototype=n(Jd.prototype,{getKey:function(a,b){return 100*a+b},get:function(a){return this._map.h[a]},addItem:function(a){Jd.prototype.addItem.call(this,a);var b=this.getKey(a.shapeType,a.soundType);this._map.h[b]=a}});var Jf=function(){};Jf.prototype={};var Kf=
function(){};Kf.prototype={};var Lf=function(){};Lf.prototype={};var Mf=function(){};Mf.prototype={};var Nf=function(){};Nf.prototype={};var Of=function(){};Of.prototype={};var Pf=function(){};Pf.prototype={};var R=function(){v.call(this);this.viewLayer=Fa.background;this._canvas=this.addComponent(Qa);var a=this._canvas.rectTransform;this._transform=a;a.width=800;a.height=500;this.isShow=!1};R.prototype=n(v.prototype,{close:function(){this._inited&&D.close(this)},show:function(a){null==a&&(a=-1);
D.show(this,a)},back:function(){D.back()},onInit:function(){},onAdd:function(){},onRemove:function(){},getImageResource:function(a){return m.atlas.getRes(A.uiPath+a+".png")}});var cf=function(){R.call(this);this.viewLayer=Fa.uipop;this._material=new Hb("blur");this._material1=new Hb("blur");this._blurTime=0};cf.prototype=n(R.prototype,{set:function(a,b,c,d){null==d&&(d="\u4e0d\u597d");null==c&&(c="\u597d\u7684");null==b&&(b="");null==a&&(a="");this.show();this._title.set_text(a);this._content.set_text(b);
this._yes.set_text(c);this._no.set_text(d)},callback:function(a,b,c){this._yesHandler=a;this._noHandler=b;this._showHandler=c},onInit:function(){var a=this;R.prototype.onInit.call(this);this._background=new id(64);this._background1=new id(64);var b=new v,c=b.addComponent(Ya),d=b.addComponent(pa);d.scaleEffect=!1;c.rectTransform.width=ea.width;c.rectTransform.height=ea.height;b.setParent(this);d.onClick=function(b){null!=a._noHandler&&a._noHandler()};b=new v;b.setParent(this);b=b.addComponent(xa);
c=new Qf;c.uvflipY=!0;c.width=t.viewWidth;c.height=t.viewHeight;b.mesh.fromBuffer(c.build());b.material.setTexture(this._background);this._blurMat=b.material;this._con=new v;this._con.setParent(this);b=new v;this._bg=b.addComponent(O);b.setParent(this._con);this._bg.set_resource(this.getImageResource("ui_alert"));b=new v;this._title=b.addComponent(Y);this._title.rectTransform.width=this._title.rectTransform.height=0;this._title.size=28;c=new F;c.setRGBA(1998791167);this._title.colorTop=this._title.colorBottom=
c;this._title.set_alignmentX(0);this._title.set_alignmentY(0);b.setParent(this._con);b=new v;this._content=b.addComponent(Y);this._content.rectTransform.width=300;this._content.rectTransform.height=-1;this._content.transform.position.y=-60;this._content.size=20;c=new F;c.setRGBA(1998791167);this._content.colorTop=this._content.colorBottom=c;this._content.set_alignmentX(0);this._content.set_alignmentY(-1);b.setParent(this._con);this._content.addEventListener(C.update._type,g(this,this.contextUpdate));
b=new v;b.addComponent(O).set_resource(this.getImageResource("ui_btn1"));b.setParent(this._con);c=b.addComponent(pa);d=new v;this._yes=d.addComponent(Y);this._yes.set_alignmentX(0);this._yes.set_alignmentY(0);d.setParent(b);this._yes.set_text("yes");b.get_transform().position.x=-100;c.onClick=function(b){b=a._yesHandler;a.close();null!=b&&b()};b=new v;b.addComponent(O).set_resource(this.getImageResource("ui_btn1"));b.setParent(this._con);c=b.addComponent(pa);d=new v;this._no=d.addComponent(Y);this._no.set_alignmentX(0);
this._no.set_alignmentY(0);d.setParent(b);this._no.set_text("no");b.get_transform().position.x=100;c.onClick=function(b){b=a._noHandler;a.close();null!=b&&b()}},onAdd:function(){R.prototype.onAdd.call(this);this._blurTime=this._blurMat.color.w=0;this._material.setFloat2("delta",new H(50/ea.width,50/ea.height));var a=Z.add(!1);a.blit(ea.renderBuffer,this._background1,this._material);this._material1.setFloat2("delta",new H(10/ea.width,10/ea.height));a.blit(this._background1,this._background,this._material1);
a.execute(Ia.game.getBufferContext())},onRemove:function(){R.prototype.onRemove.call(this);this._noHandler=this._yesHandler=null},onUpdate:function(){R.prototype.onUpdate.call(this);if(.2>this._blurTime){this._blurTime+=this.deltaTime;var a=this._blurTime/.2;.2<=this._blurTime&&(a=1,null!=this._showHandler&&this._showHandler());this._blurMat.color.w=a}},contextUpdate:function(a){a=this._content.textHeight;this._con.get_transform().position.y=.5*a;a+=this._bg.resource.data.frame.w;this._bg.rectTransform.height=
a;a-=50;this._yes.transform.parent.position.y=-a;this._no.transform.parent.position.y=-a}});var Ve=function(){R.call(this);this.viewLayer=Fa.background};Ve.prototype=n(R.prototype,{onInit:function(){this._dragOffset=new h;this.data=new fc;var a=new v;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,225,0);this._txt.language=!0;this._txt.set_text("\u7f16\u8f91\u5730\u5bab");a=new v;a.name="back";
var b=a.addComponent(O),c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(m.atlas.get(A.uiPath+"ui_back.png"));a.setParent(this);this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,25);a=new v;b=a.addComponent(O);c=b.rectTransform.anchorX;e=d=.9111111111111111;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;
e=d=.05;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(m.atlas.get(A.uiPath+"ui_edit.png"));a.setParent(this);this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onSaveClick);b=new v;c=b.addComponent(Y);c.set_alignmentX(0);c.set_alignmentY(0);c.size=22;b.setParent(a);b.get_transform().position.set(10,0,0);c.language=!0;c.set_text("\u4fdd\u5b58")},onAdd:function(){this._dragObject=null;D.touchInput.enabled=!0;t.game.show();this.gameWorld=t.game.gameWorld;var a=la.getParam("get");
if(null!=a&&-1!=a.indexOf("levels/")){if(a=a.split(":"),this.data.url=a[0],this.list=[],a=a[1],!p.stringEmpty(a)){a=a.split(",");for(var b=0,c=a.length;b<c;){var d=b++;this.list.push(p.stringToInt(a[d]))}}}else a=p.floatToInt(9*p.randomInstance.getFloat()+1),this.data.url="levels/"+a;this.gameWorld.onInit=g(this,this.onGameInit);this.gameWorld.onAddShape=g(this,this.onAddShape);D.root.addEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));D.root.addEventListener(u.onTouchEnd._type,g(this,
this.onTouchEnd));this.data=J.mapData;t.game.load(this.data)},onRemove:function(){D.root.removeEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));D.root.removeEventListener(u.onTouchEnd._type,g(this,this.onTouchEnd))},onUpdate:function(){if(null!=this._dragObject){var a=r.getTouch();if(null!=a){a=a.position;a.z=t.distance;var b=t.camera.screenToWorldPoint(a);b.sub(this._dragOffset);a=p.floatToInt(b.x/50);b=p.floatToInt(b.y/50);var c=this.gameWorld.mapData.width-2;a=1>a?1:a>c?c:a;c=this.gameWorld.mapData.height-
2;b=1>b?1:b>c?c:b;a==this._dragObject.data.x&&b==this._dragObject.data.y||!this._dragObject.editUpdate(a,b)||(this._changed=!0)}}},onGameInit:function(){this.gameWorld.remove(this.gameWorld.hero);t.game.bg.showGrid(!0)},onTouchBegin:function(a){if(null==a.currentActor){a=a.touch.position;a.z=t.distance;a=t.camera.screenToWorldPoint(a);var b=this.gameWorld.mapData.getByPosition(a.x,a.y);if(null!=b){var c=b.shapes.get_length();if(0<c)for(;0<c--;){var d=b.shapes.getArrayElement(c);if(6!=d.type){this._dragObject=
d;this._dragOffset.copy(a);this._dragOffset.x-=50*(this._dragObject.data.x+.5);this._dragOffset.y-=50*(this._dragObject.data.y+.5);this._dragOffset.z=0;this._changed=!1;this._targetX=this._dragObject.data.x;this._targetY=this._dragObject.data.y;this._dragObject.editBegin();break}}null!=this._dragObject||this.checkHasObjectOnCell(b)||(t.game.bg.load(this.data),t.game.bg.showGrid(!0))}}},onTouchEnd:function(a){null!=this._dragObject&&(this.checkBehindWall(this._dragObject)&&(this._dragObject.data.x=
this._targetX,this._dragObject.data.y=this._targetY,this._dragObject.setMapObject(this._dragObject.data)),this._dragObject.editChange(this._changed),this._dragObject=null,this._changed=!1)},checkBehindWall:function(a){var b=p.floatToInt(a.editCheckWall.x),c=p.floatToInt(a.editCheckWall.y);if(0<b||0<c)for(var d=0;d<b;)for(var e=d++,f=0,l=c;f<l;){var g=f++;g=this.gameWorld.mapData.map.get(e+a.data.x,g+a.data.y);if(null!=g&&(1==g.type||4==g.type))return!0}return!1},onBackClick:function(a){a.currentActor==
a.downActor&&(this.close(),t.home.show(1))},onSaveClick:function(a){a.currentActor==a.downActor&&(this.close(),t.save.show(1),t.save.start(this.data))},onAddShape:function(a){a.editMode=!0;t.game.onAddShape(a)},checkHasObjectOnCell:function(a){var b=a.x;a=a.y;if(1>b||1>a||b+1>=this.data.width||a+1>=this.data.height)return!0;--b;--a;b=p.floatToInt(.5*b);var c=p.floatToInt(.5*a);a=2*b+1;b=2*c+1;c=a;for(var d=a+2;c<d;)for(var e=c++,f=b,l=b+2;f<l;){var g=f++;g=this.data.map.get(e,g);for(var h=g.shapes.get_length();0<
h--;)if(!g.shapes.getArrayElement(h).overWall)return!0}c=a;for(a+=2;c<a;)for(d=c++,e=b,f=b+2;e<f;)l=e++,l=this.data.map.get(d,l),l.type=0==l.type?1:0;return!1}});var Se=function(){v.call(this);this._displays=V.fromArray([]);this._displayMap=new X;this._display=new v;this.bg=new wf;this.bg.setParent(this);this.bg.get_transform().position.set(-400,-250);var a=new v;a.get_transform().position.set(-400,-250);a.setParent(this);this._display.setParent(a);this.gameWorld=a.addComponent(Hd)};Se.prototype=
n(v.prototype,{show:function(){D.showGame(this);this.onAdd()},close:function(){this.get_transform().removeFromParent();this.onRemove()},load:function(a){this.data=a;this.bg.load(a);this.bg.showGrid(!1);this.gameWorld.load(a)},onAddShape:function(a){var b=Cf.get(a.type);null!=b&&(this._displayMap.h[a.instanceID]=b,this._displays.push(b),b.begin(a),b.setParent(this._display))},onRemoveShape:function(a){var b=this._displayMap.h[a.instanceID];null!=b&&(b.end(),this._displayMap.remove(a.instanceID),this._displays.remove(b),
b.get_transform().removeFromParent())},onGameRender:function(){for(var a=this._displays.get_length();0<a--;)this._displays.getArrayElement(a).udpate()},onAdd:function(){this.gameWorld.onAddShape=g(this,this.onAddShape);this.gameWorld.onRemoveShape=g(this,this.onRemoveShape);this.gameWorld.onRender=g(this,this.onGameRender);this.gameWorld.param.onActive=g(this,this.onShapeActive)},onRemove:function(){this.gameWorld.clear();this.gameWorld.onFail=null},onShapeActive:function(a,b){b=N.trapSound.getKey(a.type,
b);b=N.trapSound.get(b);if(null!=b){var c=a.position.distanceSquared(this.gameWorld.param.hero.position);2E4<c||(c=1-c/2E4,na.sound.play(A.soundPath+p.randomOneFromList(b.soundName,a.data.params.getValue(4)-1)+".m4a",c))}}});var Ue=function(){R.call(this);this.viewLayer=Fa.background};Ue.prototype=n(R.prototype,{onInit:function(){this.loader=new cd;var a=new v;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,
225,0);this._txt.language=!0;this._txt.set_text("\u6211\u7684\u5730\u5bab");a=new v;var b=a.addComponent(O);this.backImage=b;var c=b.rectTransform.anchorX,d=.08888888888888889,e=.08888888888888889;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b=b.rectTransform.anchorY;d=c=.05;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this.backImage.set_resource(m.atlas.get(A.uiPath+"ui_attack.png"));a.setParent(this);b=new v;c=b.addComponent(Y);c.set_alignmentX(0);c.set_alignmentY(0);c.size=22;b.setParent(a);b.get_transform().position.set(10,
0,0);c.language=!0;c.set_text("\u63a2\u9669");this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onAttackClick);a=new v;b=a.addComponent(O);c=b.rectTransform.anchorX;e=d=.9111111111111111;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=.05;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(m.atlas.get(A.uiPath+"ui_edit.png"));a.setParent(this);this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onEditClick);b=new v;c=b.addComponent(Y);c.set_alignmentX(0);
c.set_alignmentY(0);c.size=22;b.setParent(a);b.get_transform().position.set(10,0,0);c.language=!0;c.set_text("\u5e03\u7f6e")},onAdd:function(){D.root.addEventListener(u.onTouchEnd._type,g(this,this.onTouchEnd));t.loading.show(4);t.game.show();this.gameWorld=t.game.gameWorld;this.gameWorld.onInit=g(this,this.onGameInit);var a=la.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){var b=a.split(":");J.mapData.url=b[0];this.loader.load(J.mapData,g(this,this.success))}else b=p.floatToInt(9*p.randomInstance.getFloat()+
1),null!=a&&(a=a.split(":"),a=p.stringToInt(a[0]),null!=a&&(b=a)),this.loader.loadLevel(b,J.mapData,g(this,this.success))},onRemove:function(){D.root.removeEventListener(u.onTouchEnd._type,g(this,this.onTouchEnd));t.game.close()},success:function(a){t.loading.close();t.game.load(a)},onGameInit:function(){this.gameWorld.mapData.wallGroupList.get(0)},onTouchEnd:function(a){},onAttackClick:function(a){a.currentActor==a.downActor&&(this.close(),t.map.show(0))},onEditClick:function(a){null!=a.currentActor&&
a.currentActor==a.downActor&&(this.close(),t.edit.show(1))}});var bf=function(){R.call(this);this.viewLayer=Fa.uifloat};bf.prototype=n(R.prototype,{fail:function(a,b){a=Ga.getItemByType(a);b=N.itemLevelEffect.getEffect(a,b);this._current-=b.count;1>this._current&&(this._current=1);this._hpTxt.set_text(this._current+"");this._bar.rectTransform.width=this._current/this._total*100},getStar:function(){return this._current==this._total?3:.6<=this._current/this._total?2:1},onInit:function(){R.prototype.onInit.call(this);
var a=new v,b=a.addComponent(Ya);a.setParent(this);var c=b.rectTransform.anchorX,d=1,e=1;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b=b.rectTransform.anchorY;d=c=1;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.get_transform().position.set(-150,-20);b=new v;c=b.addComponent(O);d=c.material.color;var f=e=1,l=1,g=.5;null==g&&(g=1);null==l&&(l=0);null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;d.z=l;d.w=g;c.set_resource(m.atlas.get(A.uiPath+"ui_hpBar.png"));b.setParent(a);c.rectTransform.width=100;b=new v;c=b.addComponent(O);
c.set_resource(m.atlas.get(A.uiPath+"ui_hpBar.png"));b.setParent(a);this._bar=c;c.rectTransform.width=50;b=c.material.color;c=1;e=d=0;f=.8;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;b=new v;b.addComponent(O).set_resource(m.atlas.get(A.uiPath+"ui_hpHeart.png"));b.setParent(a);a=new v;this._hpTxt=a.addComponent(Y);a.setParent(b);this._hpTxt.set_alignmentX(0);this._hpTxt.set_alignmentY(0);this._hpTxt.set_text("300")},onAdd:function(){R.prototype.onAdd.call(this);
var a=J.bagData.getItem(36);this._current=this._total=N.itemLevelEffect.getEffect(a.id,a.count).count;this._hpTxt.set_text(this._total+"");this._bar.rectTransform.width=100}});var af=function(){R.call(this);this.viewLayer=Fa.uifloat};af.prototype=n(R.prototype,{dataUpdate:function(a){for(a=this._ids.length;0<a--;){var b=this._txt[a];if(null!=b){var c=J.bagData.getItem(this._ids[a]);null!=c&&(null==c?b.set_text("0"):b.set_text(c.count+""))}}},onInit:function(){R.prototype.onInit.call(this);this._ids=
[1,4,2];this._txt=[];for(var a=this._ids,b=0,c=a.length;b<c;){var d=b++,e=new v,f=e.addComponent(O),l=N.item.get(a[d]);if(null!=l){f.set_resource(m.atlas.get(A.uiPath+l.icon+".png"));e.setParent(this);l=f.rectTransform.anchorX;var g=0,h=0;null==h&&(h=0);null==g&&(g=0);l.x=g;l.y=h;l=f.rectTransform.anchorY;h=g=1;null==h&&(h=0);null==g&&(g=0);l.x=g;l.y=h;f.transform.position.set(100*d+30,-20);f=new v;l=f.addComponent(Y);l.set_alignmentX(-1);l.set_alignmentY(0);l.set_text("0");this._txt[d]=l;f.setParent(e);
f.get_transform().position.set(20)}}},onAdd:function(){R.prototype.onAdd.call(this);na.dataWatch.addWatch(J.bagData,this)},onRemove:function(){R.prototype.onRemove.call(this);na.dataWatch.removeWatch(J.bagData,this)}});var Qe=function(){R.call(this)};Qe.prototype=n(R.prototype,{set:function(a){this._context=a;this.isShow&&this._txt.set_text(this._context);return this},onInit:function(){R.prototype.onInit.call(this);this.viewInit()},onAdd:function(){R.prototype.onAdd.call(this);this._txt.set_text(this._context)},
viewInit:function(){var a=new v;a.setParent(this);var b=a.addComponent(O),c=a.addComponent(pa);a.name="loading";c.scaleEffect=!1;a=new v;a.setParent(this);this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.set_text("\u6b63\u5728\u52a0\u8f7d");this._txt.colorTop=(new F).setRGBA(-1);this._txt.colorBottom=(new F).setRGBA(-572662273);b.set_resource(m.atlas.get("default/splash.jpg"))}});var fe=function(){v.call(this);this.name="LevelCell";var a=new v;this._image=
a.addComponent(O);this._image.material.renderQueue=30002;a.setParent(this);a.name="levelCell";a=this.addComponent(Ya);a.rectTransform.width=60;a.rectTransform.height=60;this.addComponent(pa)};fe.prototype=n(v.prototype,{update:function(a){this.data=a;this.get_transform().position.set(a.x,a.y,0);this.set_enabled(!0);this.data.state=0==this.data.id?-3:J.pveData.getState(this.data.id);1==this.data.id?-3==this.data.state&&(this.data.state=0):-1==this.data.state&&(this.data.state=0);0>this.data.state?
this._image.set_resource(m.atlas.get(A.uiPath+"ui_levelLock.png")):0<=this.data.state&&this._image.set_resource(m.atlas.get(A.uiPath+"ui_levelStar"+this.data.state+".png"))}});var pa=function(){I.call(this)};pa.__name__="lovedna.game.components.ui.Button";pa.prototype=n(fa.prototype,{onAwake:function(){fa.prototype.onAwake.call(this);this.mouseEnabled=!0;this._event=new dd("");this.scaleEffect=!0;this._scaleCache=new h},onStart:function(){fa.prototype.onStart.call(this);null==this.rect&&(this.rect=
this.actor.getComponent(Ya));this.collider=this.actor.addComponent(Kd);this.bindEvent(u.onTouchBegin,g(this,this.onTouchBegin));this.bindEvent(u.onTouchEnd,g(this,this.onTouchEnd));this.bindEvent(u.onRectTransform,g(this,this.onRectTransform));this.bindEvent(u.onAdded,g(this,this.onAdded))},onDestroy:function(){fa.prototype.onDestroy.call(this);this.collider=null;this._event.clear();this.rect=this.onRelease=this.onPress=this.onClick=this._event=null},onAdded:function(a){this.bindEvent(u.onUpdate,
null)},onTouchBegin:function(a){if(this.mouseEnabled&&!(0<=this._tid)){this._event.copy(u.onTouchBegin);this._tid=this._event.touch.touchId;if(null!=this.onPress)this.onPress(this._event);this._event.clear();this._scaleCache.copy(this.transform.scale);this.scaleEffect&&this.scaleTo(pa.SCALE_PRESS,pa.TIME_PRESS)}},onTouchEnd:function(a){if(this.mouseEnabled&&(this._event.copy(u.onTouchEnd),this._event.touch.touchId==this._tid)){this._tid=-1;if(null!=this.onRelease)this.onRelease(this._event);if(this.scaleEffect)this.scaleTo(1,
pa.TIME_RELEASE);else if(null!=this.onClick)this.onClick(this._event)}},scaleTo:function(a,b){this._totalTime=b;this._time=0;this._targetScale=a;this._currentScale=this.transform.scale.x;this._scaleDelta=this._targetScale-this._currentScale;this.bindEvent(u.onUpdate,g(this,this.onUpdate))},onUpdate:function(a){this._time+=E.deltaTime;a=1;0<this._totalTime&&(a=this._time/this._totalTime);if(1<=a&&(this.bindEvent(u.onUpdate,null),0>this._tid&&null!=this.onClick))this.onClick(this._event);a=qd.backOut(a);
a=this._currentScale+this._scaleDelta*a;this.transform.scale.copy(this._scaleCache).scale(a)},onRectTransform:function(a){if(null!=this.rect){a=this.rect.rectTransform.width;var b=this.rect.rectTransform.height;this.collider.size.set(a,b,1);this.collider.center.set((.5-this.rect.rectTransform.pivot.x)*a,(.5-this.rect.rectTransform.pivot.y)*b,0)}},__class__:pa});var Re=function(){this._focusId=-1;this._page=5;R.call(this);this._lineHeight=220;this.viewLayer=Fa.background;this._focusId=-1};Re.prototype=
n(R.prototype,{focus:function(a){this._focusId=a;this._cacheLine=-1;this._targetPosition.copy(this._moveMap.get_transform().position);a=this._levels.getArrayElement(a);null==a&&(a=this._levels.getArrayElement(this._levels.get_length()-1));this._targetPosition.y=-a.y;null==this._select.get_transform().parent&&this._select.setParent(this._icons);this._select.select(a);this._targetPosition.y>this._max?this._targetPosition.y=this._max:this._targetPosition.y<this._min&&(this._targetPosition.y=this._min)},
onInit:function(){R.prototype.onInit.call(this);this._downPosition=new h;this._startPosition=new h;this._targetPosition=new h;this._velocity=new h;this._dragActor=new v;this._dragActor.name="drag area";var a=this._dragActor.addComponent(Ya);a.rectTransform.width=t.viewWidth+100;a.rectTransform.height=t.viewHeight;this._dragActor.addComponent(pa);this._dragActor.setParent(this);this._moveMap=new v;this._moveMap.setParent(this);a=N.level.max;this._zoom=1;this._page=p.ceilToInt(a/(5*p.floatToInt(760/
this._lineHeight)));for(var b=0,c=this._page;b<c;){var d=b++,e=new v;this._bg=e.addComponent(O);this._bg.material.renderQueue=3E4;this._bg.set_resource(m.atlas.get("image/map/1.jpg"));var f=this._bg.rectTransform.pivot,l=0,k=0;null==k&&(k=0);null==l&&(l=0);f.x=l;f.y=k;e.setParent(this._moveMap);e.get_transform().position.y=670*d;this._bg.rectTransform.width=1124;this._bg.rectTransform.position.x=-100}this._draging=!1;this._icons=new v;this._icons.setParent(this._moveMap);b=new v;c=b.addComponent(O);
c.set_resource(m.atlas.get(A.uiPath+"ui_searchBig.png"));b.setParent(this);d=c.rectTransform.anchorX;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;c.rectTransform.position.x=90;c.rectTransform.position.y=-50;b.addComponent(pa).onClick=g(this,this.onSearchClick);b=new v;c=b.addComponent(O);c.set_resource(m.atlas.get(A.uiPath+"ui_home.png"));b.setParent(this);d=c.rectTransform.anchorX;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;d=c.rectTransform.anchorY;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=
e;d.y=f;c.rectTransform.position.x=90;c.rectTransform.position.y=50;b.addComponent(pa).onClick=g(this,this.onHomeClick);b=new v;this._lineRenderer=b.addComponent(qc);this._lineRenderer.setWidth(2,2);this._lineRenderer.get_material().renderQueue=30001;this._lineRenderer.get_material().renderState.depthState.writeEnabled=!1;this._lineRenderer.get_material().renderState.depthState.compareFunction=0;this._lineRenderer.get_material().color.w=.5;b.setParent(this._icons);b=new fd;b.setSeed(91);this._levels=
V.fromArray([]);for(c=0;c<a;)d=c++,f=p.floatToInt(d/5),e=p.floatToInt(d%5),0!=(f&1)&&(e=5-e-1),e=100*e+b.randomFloat(-10,10),f=f*this._lineHeight+b.randomFloat(-50,50),l=new ge(d),l.x=330+e,l.y=150+f,this._levels.push(l),this._lineRenderer.setPosition(d,h.instance.set(l.x,l.y));this._showCells=V.fromArray([]);for(a=0;20>a;)a++,b=new fe,this._showCells.push(b),b.setParent(this._icons),b.get_transform().position.x=-2E3;this._cacheLine=-1;this._max=-(.5*t.viewHeight);this._min=-670*this._page-this._max;
this._moveMap.get_transform().position.y=this._max;this._select=new Rf},onAdd:function(){R.prototype.onAdd.call(this);var a=t.viewWidth-1024;0>a&&(a=0);var b=.5*-t.viewWidth;this._moveMap.get_transform().position.x=b+a;this._icons.get_transform().position.x=a;this._downPosition.copy(this._moveMap.get_transform().position);this._targetPosition.copy(this._moveMap.get_transform().position);this._targetPosition.y>this._max?this._targetPosition.y=this._max:this._targetPosition.y<this._min&&(this._targetPosition.y=
this._min);this._zoom=t.align.scale;1>this._zoom&&(this._zoom=1);this._zoom=1.5;this.refreshCells();D.root.addEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));D.root.addEventListener(u.onTouchEnd._type,g(this,this.onTouchEnd));-1==this._focusId&&this.focus(J.pveData.currentLevel);t.settingInfo.show()},onRemove:function(){R.prototype.onRemove.call(this);D.root.removeEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));D.root.removeEventListener(u.onTouchEnd._type,g(this,this.onTouchEnd));
t.settingInfo.close()},onUpdate:function(){R.prototype.onUpdate.call(this);if(this._draging){var a=r.getTouch();null!=a&&(this._velocity.copy(this._targetPosition),a=h.instance.copy(a.position),a.z=t.distance,a.copy(t.camera.screenToWorldPoint(a)),a.sub(this._startPosition),a.x=0,this._targetPosition.copy(this._downPosition).add(a.scale(this._zoom)),this._targetPosition.y>this._max?this._targetPosition.y=this._max:this._targetPosition.y<this._min&&(this._targetPosition.y=this._min),this._velocity.sub(this._targetPosition))}this.refreshCells();
this._moveMap.get_transform().position.lerpTo(this._targetPosition,8*this.deltaTime)},refreshCells:function(){var a=-(this._moveMap.get_transform().position.y-this._max);a=p.floatToInt((a-100)/this._lineHeight);0>a&&(a=0);if(this._cacheLine!=a){this._cacheLine=a;ge.max=J.pveData.currentLevel;for(var b=0;20>b;){var c=b++,d=5*a+c;c=this._showCells.getArrayElement(c);d=this._levels.getArrayElement(d);null==d?c.get_transform().position.x=-2E3:c.update(d)}}},onTouchBegin:function(a){0<a.touch.touchId||
null!=a.downActor&&a.downActor!=this._dragActor&&"LevelCell"!=a.downActor.name||(this._draging=!0,a=h.instance.copy(r.getTouch().position),a.z=t.distance,this._startPosition.copy(t.camera.screenToWorldPoint(a)),this._downPosition.copy(this._moveMap.get_transform().position),this._targetPosition.copy(this._downPosition))},onTouchEnd:function(a){0<a.touch.touchId||(this._draging=!1,this._targetPosition.y-=5*this._velocity.y,this._velocity.y=0,this._targetPosition.y>this._max?this._targetPosition.y=
this._max:this._targetPosition.y<this._min&&(this._targetPosition.y=this._min),a.downActor==a.currentActor&&a.downActor!=this._dragActor&&!(5E-4<a.touch.down.distanceSquared(a.touch.up))&&a.downActor instanceof fe&&(a=a.downActor,N.level.getLevel(a.data.id),0>a.data.state||(this._select.data==a.data?(this.close(),t.mode_single.targetLevel=a.data.id,t.mode_single.show()):(null==this._select.get_transform().parent&&this._select.setParent(this._icons),this._select.select(a.data)))))},onSearchClick:function(a){a.currentActor==
a.downActor&&(t.alert.set("\u6d88\u606f","\u529f\u80fd\u6682\u672a\u5f00\u653e","\u597d\u7684","\u5173\u95ed"),t.alert.callback(g(this,this.openSelf),g(this,this.openSelf),g(this,this.hideSelf)))},hideSelf:function(){this.close()},openSelf:function(){t.map.show()},onHomeClick:function(a){a.currentActor==a.downActor&&(this.close(),t.home.show())}});var Rf=function(){v.call(this);this._image=this.addComponent(O);this._image.set_resource(m.atlas.get(A.uiPath+"ui_levelSelect.png"));var a=new v;this._txt=
a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);a.setParent(this);a.get_transform().position.set(10,40,0)};Rf.prototype=n(v.prototype,{select:function(a){this.data=a;this.get_transform().position.set(a.x,a.y+30,0);this._txt.set_text("\u5173\u5361"+a.id)}});var ge=function(a){this.id=a;this.state=p.floatToInt(4*p.randomInstance.getFloat()+-1)};ge.prototype={};var Ye=function(){R.call(this)};Ye.prototype=n(R.prototype,{onInit:function(){this.loader=new cd;this.data=new fc;
var a=new v;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,225,0);this.delayReStart=new ba(g(this,this.delayCall));a=new v;a.name="back";var b=a.addComponent(O),c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(m.atlas.get(A.uiPath+"back.png"));a.setParent(this);this.backBtn=a.addComponent(pa);
this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,23)},onAdd:function(){t.loading.show(4);t.game.show();this.gameWorld=t.game.gameWorld;var a=la.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){if(a=a.split(":"),this.data.url=a[0],this.list=[],a=a[1],!p.stringEmpty(a)){a=a.split(",");for(var b=0,c=a.length;b<c;){var d=b++;this.list.push(p.stringToInt(a[d]))}}}else a=p.floatToInt(9*p.randomInstance.getFloat()+1),this.data.url="levels/"+a;this._txt.set_text(this.data.url);
this.loader.load(this.data,g(this,this.success));this.gameWorld.onTrigger=g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);D.root.addEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin))},onRemove:function(){D.root.removeEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin))},success:function(a){t.loading.close();t.game.load(a)},delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){if(!(null==this.list||1>this.list.length)){var a=
this.list,b=Yb.get();b.setMapObject(this.gameWorld.door.data);this.gameWorld.add(b);b.setReplay(a)}},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?this.gameWorld.hero!=a.target?this.gameWorld.remove(a.target):this.gameWorld.pause():this.gameWorld.hero==a.target&&6!=a.trap.type&&this.gameWorld.pause())},onTouchBegin:function(a){null==a.currentActor&&this.gameWorld.action()},onBackClick:function(a){a.currentActor==a.downActor&&this.delayCall()}});var $e=function(){R.call(this);this._hasOpen=
[];this._hasOpen[0]=!1;this._hasOpen[1]=!1;this._hasOpen[2]=!1;this._hasOpen[3]=!1;this._hasOpen[4]=!1;this._hasOpen[5]=!1;this._hasOpen[6]=!1;this._hasOpen[7]=!1;this._hasOpen[8]=!1;this._hasOpen[9]=!1;this._hasOpen[10]=!1;this._hasOpen[11]=!1;this._successDelay=new ba(g(this,this.openSuccess))};$e.prototype=n(R.prototype,{setup:function(a,b){this._keyLevel=a;a=N.itemLevelEffect.getEffect(46,this._keyLevel);switch(a.param1){case 1:var c=1;break;case 3:c=2;break;case 6:c=3;break;default:c=1}this._keyType=
c;this._keyTotal=a.count;this._keyRandom=b;this._keyOpened=0;this._hasOpen[0]=!1;this._hasOpen[1]=!1;this._hasOpen[2]=!1;this._hasOpen[3]=!1;this._hasOpen[4]=!1;this._hasOpen[5]=!1;this._hasOpen[6]=!1;this._hasOpen[7]=!1;this._hasOpen[8]=!1;this._hasOpen[9]=!1;this._hasOpen[10]=!1;this._hasOpen[11]=!1;this.usedKeyCount=0},setSuccessCallback:function(a){this._successCallback=a},onInit:function(){var a=new v;a.addComponent(O).set_resource(m.atlas.get("image/ui/lockBg.jpg"));a.setParent(this);a=new v;
this._bg=a.addComponent(O);this._bg.set_resource(m.atlas.get(A.uiPath+"ui_lockBig.png"));a.setParent(this);this._bg.rectTransform.pivot.y=1;this._bg.rectTransform.position.x=10;this._bg.rectTransform.position.y=90;this._bg.rectTransform.height=310;this._list=[];for(a=0;12>a;){var b=a++,c=new ed;c.name=b+"";this._list.push(c);var d=b%4;b=p.floatToInt(b/4);c.get_transform().position.set(72*d-110,85*-b-100,0);c.setParent(this._bg.actor);c.onKeyPress=g(this,this.keyHolePress)}a=new v;a.name="back";c=
a.addComponent(O);d=c.rectTransform.anchorX;var e=b=0;null==e&&(e=0);null==b&&(b=0);d.x=b;d.y=e;d=c.rectTransform.anchorY;e=b=0;null==e&&(e=0);null==b&&(b=0);d.x=b;d.y=e;c.set_resource(m.atlas.get(A.uiPath+"ui_back.png"));a.setParent(this);a.addComponent(pa).onClick=g(this,this.onBackClick);a.get_transform().position.set(50,25);this.usedKeyCount=0},onAdd:function(){R.prototype.onAdd.call(this);this.success=!1;var a=p.ceilToInt(this._keyTotal/4);this._bg.rectTransform.height=150+80*a;for(a=this._list.length;0<
a--;){var b=this._list[a];a<this._keyTotal?(b.setParent(this._bg.actor),b.show(this._keyType),this._hasOpen[a]&&b.open()):b.get_transform().removeFromParent()}ed.success=!1;this._soundId=1},onRemove:function(){R.prototype.onRemove.call(this);if(!this.success){var a=J.bagData.getItem(2);a.count+=this.usedKeyCount;J.bagData.updateItem(a)}},onBackClick:function(a){a.currentActor==a.downActor&&this.back()},keyHolePress:function(a){if(a.closed){var b=J.bagData.getItem(2);if(null!=b){var c=b.count,d=N.itemLevelEffect.getEffect(46,
this._keyLevel).param1;c<d?t.alert.set("\u94a5\u5319","\u662f\u5426\u60f3\u6062\u590d\u6240\u6709\u94a5\u5319","\u662f","\u5426"):(b.count-=d,J.bagData.updateItem(b),b=p.stringToInt(a.name),this._hasOpen[b]=!0,a.open(),this._keyOpened++,this._keyRandom--,this.usedKeyCount+=d,this._keyOpened>=this._keyTotal||0>=this._keyRandom?(this.success=!0,ed.success=!0,this._successDelay.start(.5),na.sound.playById(0,3)):(na.sound.playById(0,this._soundId),this._soundId++,2<this._soundId&&(this._soundId=1)),b=
Tc.get(),b.setup(d),b.get_transform().position.copy(a.get_transform().position),b.setParent(this._bg.actor))}}},openSuccess:function(){this.close();null!=this._successCallback&&this._successCallback()}});var ed=function(){v.call(this);this._bg=this.addComponent(O);this._bg.material.color.setRGBA(1717986918);this._skin=(new v).addComponent(O);this.btn=this.addComponent(pa);this.btn.onPress=g(this,this.onPress);this._break=!1;this._v=new h};ed.prototype=n(v.prototype,{show:function(a){this._skin.material.renderQueue=
xa.defaultRenderQueue;this._bg.set_resource(m.atlas.get(A.uiPath+"ui_keyHole"+a+"bg.png"));this._skin.set_resource(m.atlas.get(A.uiPath+"ui_keyHole"+a+".png"));this._skin.actor.setParent(this);this.closed=this.btn.scaleEffect=!0;this._break=!1;this._skin.transform.position.set(0,0,0);this._skin.transform.rotation.setEulerAngles(0,0,0)},open:function(){this.closed=this.btn.scaleEffect=!1;this._break=!0;this._v.set(600*p.randomInstance.getFloat()+-300,300*p.randomInstance.getFloat()+600,300);this._skin.material.renderQueue=
xa.defaultRenderQueue+2;this._r=0},onPress:function(a){if(!ed.success&&null!=this.onKeyPress)this.onKeyPress(this)},onUpdate:function(){v.prototype.onUpdate.call(this);if(this._break){var a=h.instance.copy(this._v).scale(this.deltaTime);this._skin.transform.position.add(a);this._skin.transform.rotation.setEulerAngles(0,0,this._r);this._r+=500*this.deltaTime;this._v.y-=3E3*this.deltaTime;-500>this._skin.transform.position.y&&(this._break=!1)}}});var Tc=function(){v.call(this);var a=this.addComponent(O),
b=N.item.get(2);a.set_resource(m.atlas.get(A.uiPath+b.icon+".png"));this._time=.5;a=new v;this._txt=a.addComponent(Y);a.setParent(this);this._txt.set_alignmentX(1);this._txt.set_alignmentY(0);this._txt.rectTransform.pivot.x=1;this._txt.transform.position.x=-10};Tc.get=function(){return Tc.pool.get()};Tc.prototype=n(v.prototype,{setup:function(a){this._txt.set_text("-"+a);this._time=.5},onUpdate:function(){v.prototype.onUpdate.call(this);0<this._time&&(this._time-=this.deltaTime,this.get_transform().position.y+=
300*this.deltaTime,0>=this._time&&(this.get_transform().removeFromParent(),Tc.pool.set(this)))}});var Ze=function(){R.call(this)};Ze.prototype=n(R.prototype,{onInit:function(){this.loader=new cd;this.data=new fc;var a=new v;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,225,0);this.delayReStart=new ba(g(this,this.delayCall));a=new v;a.name="back";var b=a.addComponent(O),c=b.rectTransform.anchorX,
d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(m.atlas.get(A.uiPath+"back.png"));a.setParent(this);this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,23)},onAdd:function(){D.touchInput.enabled=!0;t.loading.show(4);t.game.show();this.gameWorld=t.game.gameWorld;var a=la.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){if(a=a.split(":"),this.data.url=
a[0],this.list=[],a=a[1],!p.stringEmpty(a)){a=a.split(",");for(var b=0,c=a.length;b<c;){var d=b++;this.list.push(p.stringToInt(a[d]))}}}else a=p.floatToInt(9*p.randomInstance.getFloat()+1),this.data.url="levels/"+a;this._txt.set_text(this.data.url);this.loader.load(this.data,g(this,this.success));this.gameWorld.onTrigger=g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);D.root.addEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin))},onRemove:function(){D.root.removeEventListener(u.onTouchBegin._type,
g(this,this.onTouchBegin))},success:function(a){t.loading.close();t.game.load(a)},delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){null==this.list||1>this.list.length||this.gameWorld.hero.setReplay(this.list)},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?(this.gameWorld.remove(a.target),this.gameWorld.finish()):6!=a.trap.type&&(this.gameWorld.pause(),this.delayReStart.start(.5)))},onTouchBegin:function(a){null==a.currentActor&&this.gameWorld.action()},
onBackClick:function(a){a.currentActor==a.downActor&&this.delayCall()}});var We=function(){R.call(this);this.viewLayer=Fa.background};We.prototype=n(R.prototype,{start:function(a){this.data=a;t.game.load(a)},onInit:function(){this.delayReStart=new ba(g(this,this.delayCall));var a=new v;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;this._txt.set_text("\u4fdd\u5b58\u5730\u5bab");a.setParent(this);a.get_transform().position.set(0,225,0);a=new v;
a.name="back";var b=a.addComponent(O);this.backImage=b;var c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b=b.rectTransform.anchorY;d=c=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this.backImage.set_resource(m.atlas.get(A.uiPath+"ui_back.png"));a.setParent(this);this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,25);this._state=0},onAdd:function(){t.game.show();this.gameWorld=t.game.gameWorld;this.gameWorld.onTrigger=
g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);this.gameWorld.onGameStart=g(this,this.onGameStart);this.gameWorld.onFail=g(this,this.delayCall);D.root.addEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));this._state=0;Va.onEvent.addEventListener(Da.onUpdate._type,g(this,this.onKeyUpdate))},onRemove:function(){D.root.removeEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));Va.onEvent.removeEventListener(Da.onUpdate._type,g(this,this.onKeyUpdate));t.game.close()},
onKeyUpdate:function(a){1==Da.onUpdate.key.type&&32==Da.onUpdate.key.keyCode&&this.gameWorld.action()},delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){this._state=1;this.backImage.set_resource(m.atlas.get(A.uiPath+"ui_back.png"))},onGameStart:function(){this._state=2;this.backImage.set_resource(m.atlas.get(A.uiPath+"ui_retry.png"))},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?this.gameWorld.hero!=a.target?this.gameWorld.remove(a.target):
(this.gameWorld.pause(),this._state=3,this.close(),t.home.show(1)):6!=a.trap.type&&(this.gameWorld.pause(),this.delayReStart.start(.5)))},onTouchBegin:function(a){null==a.currentActor&&this.gameWorld.action()},onBackClick:function(a){a.currentActor==a.downActor&&(2==this._state?this.delayCall():(this.close(),t.edit.show(1)))}});var df=function(){R.call(this);this.viewLayer=Fa.uifloat};df.prototype=n(R.prototype,{onInit:function(){var a=this;R.prototype.onInit.call(this);var b=new v,c=b.addComponent(O),
d=c.rectTransform.anchorX,e=1,f=1;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;d=c.rectTransform.anchorY;f=e=0;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;d=c.rectTransform.pivot;e=.5;f=1;null==f&&(f=0);null==e&&(e=0);d.x=e;d.y=f;c.transform.scale.y=-1;b.get_transform().position.x=-20;c.set_resource(m.atlas.get(A.uiPath+"ui_setting.png"));b.setParent(this);b.addComponent(pa).onClick=function(b){b.currentActor==b.downActor&&(t.alert.set("\u91cd\u7f6e","\u8981\u5220\u9664\u672c\u5730\u5b58\u50a8\u7684\u6570\u636e\u5417?",
"\u5220\u9664","\u518d\u60f3\u60f3"),t.alert.callback(g(a,a.deleteData)))}},onAdd:function(){R.prototype.onAdd.call(this)},deleteData:function(){var a=this;J.datebase.getTable("user").search({id:J.userData.id}).update({createTime:-1}).then(function(b){t.alert.set("\u6210\u529f","\u5df2\u5220\u9664\u4e86\u672c\u5730\u6570\u636e,\u4e0b\u6b21\u8fdb\u5165\u6e38\u620f\u5f00\u59cb\u5220\u9664","\u597d\u7684","\u8c22\u8c22");t.alert.callback(g(a,a.closeMe),g(a,a.closeMe))})},closeMe:function(){}});var Xe=
function(){R.call(this);this.targetLevel=-1;this.viewLayer=Fa.background;this._failData=new ff};Xe.prototype=n(R.prototype,{onInit:function(){this.loader=new cd;this.data=new fc;var a=new v;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,225,0);this.delayReStart=new ba(g(this,this.delayCall));a=new v;a.name="back";var b=a.addComponent(O);this.backImage=b;var c=b.rectTransform.anchorX,d=0,e=0;null==
e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b=b.rectTransform.anchorY;d=c=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;this.backImage.set_resource(m.atlas.get(A.uiPath+"ui_back.png"));a.setParent(this);this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,25);b=la.getParam("get");a=p.floatToInt(9*p.randomInstance.getFloat()+1);null!=b&&(b=b.split(":"),b=p.stringToInt(b[0]),null!=b&&(a=b));-1==this.targetLevel&&(this.targetLevel=a);this._state=0;this._rt=
new id(ea.width,ea.height);this._heroPos=new h},onAdd:function(){t.loading.show(4);t.hpInfo.show();t.game.show();this.gameWorld=t.game.gameWorld;this.gameWorld.onTrigger=g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);this.gameWorld.onGameStart=g(this,this.onGameStart);this.gameWorld.onFail=g(this,this.delayCall);D.root.addEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));Va.onEvent.addEventListener(Da.onUpdate._type,g(this,this.onKeyUpdate));this._state=0;this._txt.set_text("\u5173\u5361"+
this.targetLevel);this.loader.loadLevel(this.targetLevel,this.data,g(this,this.success));Ia.camera3D.renderTarget=this._rt;Ia.camera3D.actor.addEventListener(u.onPostRender._type,g(this,this.onPostRender));this._failData.clear()},onRemove:function(){D.root.removeEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));Va.onEvent.removeEventListener(Da.onUpdate._type,g(this,this.onKeyUpdate));t.hpInfo.close();t.game.close();Ia.camera3D.renderTarget=null;Ia.camera3D.actor.removeEventListener(u.onPostRender._type,
g(this,this.onPostRender))},onKeyUpdate:function(a){1==Da.onUpdate.key.type&&32==Da.onUpdate.key.keyCode&&(1==this._state&&0>J.pveData.getState(this.targetLevel)?(t.openDoor.usedKeyCount=0,a=N.level.getLevel(this.targetLevel),t.openDoor.setup(a.keyLevel,N.level.getMinRandomKey(this.targetLevel)),t.openDoor.show(),t.openDoor.setSuccessCallback(g(this,this.openDoorSuccess))):this.gameWorld.action())},success:function(a){if(-1!=this.viewLayer){t.loading.close();for(var b=N.level.getLevel(this.targetLevel),
c=a.objects.get_length();0<c--;){var d=a.objects.getArrayElement(c);if(5==d.type){J.pveData.getState(this.targetLevel);var e=N.itemLevelEffect.getEffect(46,b.keyLevel);d.params.setValue(4,e.param1);d.params.setValue(5,e.count)}else if(7==d.type){d.params.setValue(6,100);for(e=b.reward.length;0<e--;)1==b.reward[e].x&&d.params.setValue(6,3*b.reward[e].y);d.params.setValue(7,0)}else e=N.level.getLevel(this.targetLevel),d.params.setValue(4,e.trapLevel)}t.game.load(a)}},delayCall:function(){this.gameWorld.clear();
this.gameWorld.load(this.data)},onGameInit:function(){this._state=1;this.backImage.reset();this.backImage.set_resource(m.atlas.get(A.uiPath+"ui_back.png"));Ia.light.transform.position.copy(this.gameWorld.door.position)},onGameStart:function(){this.gameWorld.hero.self=!0;this.gameWorld.add(this.gameWorld.hero);this._state=2;this.backImage.reset();this.backImage.set_resource(m.atlas.get(A.uiPath+"ui_retry.png"))},onGameTrigger:function(a){var b=this;1==a.phase&&(7==a.trap.type?this.gameWorld.hero!=
a.target?this.gameWorld.remove(a.target):(this.gameWorld.remove(this.gameWorld.hero),this.gameWorld.pause(),this._state=3,(new ba(function(){var a=new Sf;a.star=t.hpInfo.getStar();a.id=b.targetLevel;for(var d=b.gameWorld.param.actionFrameList,e=[],f=0,l=d.get_length();f<l;){var g=f++;e[g]=d.getArrayElement(g)}a.actions=e;a.keyCount=t.openDoor.usedKeyCount;t.openDoor.usedKeyCount=0})).start(.5)):6!=a.trap.type&&(a=a.trap,null!=a.owner&&(a=a.owner),t.hpInfo.fail(a.data.type,a.data.params.getValue(4)),
null!=this._failData.count(a)&&(a.data.disabled=!0),this.gameWorld.pause(),this.delayReStart.start(.5)))},onTouchBegin:function(a){null==a.currentActor&&(1==this._state&&0>J.pveData.getState(this.targetLevel)?(t.openDoor.usedKeyCount=0,a=N.level.getLevel(this.targetLevel),t.openDoor.setup(a.keyLevel,N.level.getMinRandomKey(this.targetLevel)),t.openDoor.show(),t.openDoor.setSuccessCallback(g(this,this.openDoorSuccess))):this.gameWorld.action())},onBackClick:function(a){a.currentActor==a.downActor&&
(2==this._state?this.delayCall():(this.close(),t.map.show(0),t.map.focus(this.targetLevel)))},openDoorSuccess:function(){t.openDoor.success&&(J.pveData.states[this.targetLevel]=0);t.mode_single.show()},onPostRender:function(a){null!=Ia.camera3D.renderTarget&&(null==this._material&&(this._material=new Hb("_h")),this._heroPos.copy(Ia.camera3D.worldToViewport(this.gameWorld.hero.position)),this._heroPos.x*=ea.width,this._heroPos.y*=ea.height,this._heroPos.z=2E3,this._material.setFloat3("pos",this._heroPos),
a=Z.add(!1),a.blit(Ia.camera3D.renderTarget,ea.renderBuffer,this._material),a.execute(Ia.game.getBufferContext()))}});var ye=function(){v.call(this);this._updateState=!1;m.init("assets");m.atlas.addAtlas("default/ui.png");this._progress=this._showProgress=0;this._loaded=!1;m.setVersion("version.txt",(new Date).getTime()+"");m.bytes.get("version.txt").addEventListener(C.complete._type,g(this,this.versionComplete))};ye.prototype=n(v.prototype,{onUpdate:function(){var a=this;if(!this._loaded){if(1>this._progress){var b=
this._showProgress;this._showProgress=b+(this._progress-b)*this.deltaTime}else this._showProgress+=this.deltaTime,1<this._showProgress&&(this._showProgress=1);null!=this._txt&&this._txt.set_text(p.floatToInt(100*this._showProgress)+"%");null!=this._progressBar&&(this._progressBar.rectTransform.width=300*this._showProgress);1<=this._showProgress&&!this._updateState&&((new ba(function(){a.finish()})).start(.2),this._loaded=!0)}},viewInit:function(){var a=xa.defaultRenderQueue;xa.defaultRenderQueue=
1E4;var b=new v;b.setParent(this);var c=b.addComponent(O),d=b.addComponent(pa);b.name="loading";d.scaleEffect=!1;c.addMeshRenderer();b=new v;b.get_transform().position.y=-100;b.setParent(this);d=new v;var e=d.addComponent(O);e.set_resource(m.atlas.get("default/ui/Background.png"));e.addMeshRenderer();d.setParent(b);e.rectTransform.width=300;e.rectTransform.height=32;d=new v;this._progressBar=d.addComponent(O);this._progressBar.material.renderQueue+=1;this._progressBar.rectTransform.pivot.x=0;this._progressBar.rectTransform.position.x=
-150;this._progressBar.set_resource(m.atlas.get("default/ui/UISprite.png"));this._progressBar.addMeshRenderer();d.setParent(b);this._progressBar.rectTransform.width=0;this._progressBar.rectTransform.height=32;d=new v;d.setParent(b);this._txt=d.addComponent(Y);this._txt.material.renderQueue+=2;this._txt.set_font(m.fnt.get("default/font_en.png"));this._txt.set_alignmentX(0);this._txt.set_alignmentY(0);this._txt.addMeshRenderer();this._txt.set_text("Loading");this._txt.colorBottom=(new F).setRGBA(858993663);
this._txt.colorTop=(new F).setRGBA(858993663);c.set_resource(m.atlas.get("default/splash.jpg"));--c.material.renderQueue;xa.defaultRenderQueue=a},versionComplete:function(a){a=a.target;var b=(new Date).getTime()+"";a.enabled&&(b=a.bytes.toString());m.version=b;m.loadMeta("version.bin",g(this,this.metaSuccess))},metaSuccess:function(){this._progress=this._showProgress=0;this._loaded=!1;this.loadrecord=new Tf;this.loadrecord.start();this.viewInit();m.atlas.get("image/pack.png");A.normal=m.texture.getRes("image/pack_n.png").texture;
m.texture.get("image/map/back_castle.jpg");m.texture.get("image/map/wall_castle.jpg");m.texture.get("image/ui/lockBg.jpg");m.texture.get("image/map/1.jpg");Y.defaultFnt=m.fnt.get("font/ch.png");N.init(m.table.get("data/data.bin"));this.loadrecord.end(null,g(this,this.progress))},progress:function(){this._progress=this.loadrecord.loaded/this.loadrecord.total},finish:function(){var a=this;new If;Y.languageFormat=Be.get;t.postInit();D.touchInput.enabled=!0;this._txt.set_font(Y.defaultFnt);this._txt.set_text("\u6b63\u5728\u767b\u9646");
null!=this._progressBar&&(this._progressBar.actor.get_transform().parent.removeFromParent(),this._progressBar=null);(new ba(function(){a.get_transform().removeFromParent()})).start(.1);var b=la.getParam("get");null!=b&&3<b.length?t.test.show():(t.loading.set("\u6b63\u5728\u767b\u9646").show(),b=new Uf,b.user="test",b.pass="test")}});var Te=function(){R.call(this)};Te.prototype=n(R.prototype,{onInit:function(){this.loader=new cd;this.data=new fc;var a=new v;this._txt=a.addComponent(Y);this._txt.set_alignmentX(0);
this._txt.set_alignmentY(0);this._txt.size=22;a.setParent(this);a.get_transform().position.set(0,225,0);this.delayReStart=new ba(g(this,this.delayCall));a=new v;a.name="back";var b=a.addComponent(O),c=b.rectTransform.anchorX,d=0,e=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=b.rectTransform.anchorY;e=d=0;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;b.set_resource(m.atlas.get(A.uiPath+"ui_back.png"));a.setParent(this);this.backBtn=a.addComponent(pa);this.backBtn.onClick=g(this,this.onBackClick);a.get_transform().position.set(50,
25)},onAdd:function(){t.loading.show(4);t.game.show();this.gameWorld=t.game.gameWorld;var a=la.getParam("get");if(null!=a&&-1!=a.indexOf("levels/")){if(a=a.split(":"),this.data.url=a[0],this.list=[],a=a[1],!p.stringEmpty(a)){a=a.split(",");for(var b=0,c=a.length;b<c;){var d=b++;this.list.push(p.stringToInt(a[d]))}}}else a=p.floatToInt(9*p.randomInstance.getFloat()+1),this.data.url="levels/"+a;this._txt.set_text(this.data.url);this.loader.load(this.data,g(this,this.success));this.gameWorld.onTrigger=
g(this,this.onGameTrigger);this.gameWorld.onInit=g(this,this.onGameInit);this.gameWorld.onFail=g(this,this.delayCall);D.root.addEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));Va.onEvent.addEventListener(Da.onUpdate._type,g(this,this.onKeyUpdate))},onRemove:function(){D.root.removeEventListener(u.onTouchBegin._type,g(this,this.onTouchBegin));Va.onEvent.removeEventListener(Da.onUpdate._type,g(this,this.onKeyUpdate))},onKeyUpdate:function(a){1==Da.onUpdate.key.type&&(32==Da.onUpdate.key.keyCode?
this.gameWorld.action():27==Da.onUpdate.key.keyCode&&this.delayCall())},success:function(a){t.loading.close();t.game.load(a)},delayCall:function(){this.gameWorld.clear();this.gameWorld.load(this.data)},onGameInit:function(){null==this.list||1>this.list.length||this.gameWorld.hero.setReplay(this.list)},onGameTrigger:function(a){1==a.phase&&(7==a.trap.type?this.gameWorld.hero!=a.target?this.gameWorld.remove(a.target):this.gameWorld.pause():this.gameWorld.hero==a.target&&6!=a.trap.type&&this.delayCall())},
onTouchBegin:function(a){null==a.currentActor&&this.gameWorld.action()},onBackClick:function(a){a.currentActor==a.downActor&&this.delayCall()}});var gc=function(){this.kv=new he;this.protocol=-1;gc.service.add(this)};gc.prototype={};var Uf=function(){gc.call(this);this.protocol=1};Uf.prototype=n(gc.prototype,{});var Sf=function(){gc.call(this);this.protocol=2};Sf.prototype=n(gc.prototype,{});var sd=function(){this.kv=new he;this.protocol=-1};sd.prototype={};var $d=function(){sd.call(this);this.protocol=
1;this.passTime=0};$d.prototype=n(sd.prototype,{});var Ef=function(){sd.call(this);this.protocol=2};Ef.prototype=n(sd.prototype,{});var ie=function(a,b){this.high=a;this.low=b};ie.prototype={};var bb=function(){this.buf=new Nb;this.cache=[];this.useCache=bb.USE_CACHE;this.useEnumIndex=bb.USE_ENUM_INDEX;this.shash=new L;this.scount=0};bb.run=function(a){var b=new bb;b.serialize(a);return b.toString()};bb.prototype={toString:function(){return this.buf.b},serializeString:function(a){var b=this.shash;
b=null!=q[a]?b.getReserved(a):b.h[a];if(null!=b)this.buf.b+="R",this.buf.b+=null==b?"null":""+b;else{b=this.shash;var c=this.scount++;null!=q[a]?b.setReserved(a,c):b.h[a]=c;this.buf.b+="y";a=encodeURIComponent(a);this.buf.b+=ma.string(a.length);this.buf.b+=":";this.buf.b+=null==a?"null":""+a}},serializeRef:function(a){for(var b=typeof a,c=0,d=this.cache.length;c<d;){var e=c++,f=this.cache[e];if(typeof f==b&&f==a)return this.buf.b+="r",this.buf.b+=null==e?"null":""+e,!0}this.cache.push(a);return!1},
serializeFields:function(a){for(var b=0,c=ja.fields(a);b<c.length;){var d=c[b];++b;this.serializeString(d);this.serialize(ja.field(a,d))}this.buf.b+="g"},serialize:function(a){var b=Cb.typeof(a);switch(b._hx_index){case 0:this.buf.b+="n";break;case 1:if(0==a){this.buf.b+="z";break}this.buf.b+="i";this.buf.b+=null==a?"null":""+a;break;case 2:isNaN(a)?this.buf.b+="k":isFinite(a)?(this.buf.b+="d",this.buf.b+=null==a?"null":""+a):this.buf.b+=0>a?"m":"p";break;case 3:this.buf.b+=a?"t":"f";break;case 4:aa.__instanceof(a,
Vf)?(a=a.__name__,this.buf.b+="A",this.serializeString(a)):aa.__instanceof(a,Wf)?(this.buf.b+="B",this.serializeString(a.__ename__)):this.useCache&&this.serializeRef(a)||(this.buf.b+="o",this.serializeFields(a));break;case 5:throw new w("Cannot serialize function");case 6:b=b.c;if(b==String){this.serializeString(a);break}if(this.useCache&&this.serializeRef(a))break;switch(b){case Array:b=0;this.buf.b+="a";for(var c=0,d=a.length;c<d;){var e=c++;null==a[e]?++b:(0<b&&(1==b?this.buf.b+="n":(this.buf.b+=
"u",this.buf.b+=null==b?"null":""+b),b=0),this.serialize(a[e]))}0<b&&(1==b?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==b?"null":""+b));this.buf.b+="h";break;case Date:this.buf.b+="v";this.buf.b+=ma.string(a.getTime());break;case X:this.buf.b+="q";for(b=a.keys();b.hasNext();)c=b.next(),this.buf.b+=":",this.buf.b+=null==c?"null":""+c,this.serialize(a.h[c]);this.buf.b+="h";break;case je:this.buf.b+="l";for(a=a.h;null!=a;)b=a.item,a=a.next,this.serialize(b);this.buf.b+="h";break;case td:this.buf.b+=
"M";for(b=a.keys();b.hasNext();)c=b.next(),d=ja.field(c,"__id__"),ja.deleteField(c,"__id__"),this.serialize(c),c.__id__=d,this.serialize(a.h[c.__id__]);this.buf.b+="h";break;case L:this.buf.b+="b";for(b=a.keys();b.hasNext();)c=b.next(),this.serializeString(c),this.serialize(null!=q[c]?a.getReserved(c):a.h[c]);this.buf.b+="h";break;case Ea:this.buf.b+="s";this.buf.b+=ma.string(Math.ceil(8*a.length/6));this.buf.b+=":";c=0;d=a.length-2;b=bb.BASE64_CODES;if(null==b){b=Array(bb.BASE64.length);e=0;for(var f=
bb.BASE64.length;e<f;){var l=e++;b[l]=y.cca(bb.BASE64,l)}bb.BASE64_CODES=b}for(;c<d;)e=a.b[c++],f=a.b[c++],l=a.b[c++],this.buf.b+=String.fromCodePoint(b[e>>2]),this.buf.b+=String.fromCodePoint(b[(e<<4|f>>4)&63]),this.buf.b+=String.fromCodePoint(b[(f<<2|l>>6)&63]),this.buf.b+=String.fromCodePoint(b[l&63]);c==d?(d=a.b[c++],a=a.b[c++],this.buf.b+=String.fromCodePoint(b[d>>2]),this.buf.b+=String.fromCodePoint(b[(d<<4|a>>4)&63]),this.buf.b+=String.fromCodePoint(b[a<<2&63])):c==d+1&&(a=a.b[c++],this.buf.b+=
String.fromCodePoint(b[a>>2]),this.buf.b+=String.fromCodePoint(b[a<<4&63]));break;default:this.useCache&&this.cache.pop(),null!=a.hxSerialize?(this.buf.b+="C",this.serializeString(b.__name__),this.useCache&&this.cache.push(a),a.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(b.__name__),this.useCache&&this.cache.push(a),this.serializeFields(a))}break;case 7:b=b.e;if(this.useCache){if(this.serializeRef(a))break;this.cache.pop()}this.buf.b+=ma.string(this.useEnumIndex?"j":"w");
this.serializeString(b.__ename__);this.useEnumIndex?(this.buf.b+=":",this.buf.b+=ma.string(a._hx_index)):this.serializeString(Ra[a.__enum__].__constructs__[a._hx_index]);this.buf.b+=":";b=Cb.enumParameters(a);this.buf.b+=ma.string(b.length);for(c=0;c<b.length;)d=b[c],++c,this.serialize(d);this.useCache&&this.cache.push(a);break;default:throw new w("Cannot serialize "+ma.string(a));}}};var gd=function(a){var b=this;this.id=setInterval(function(){b.run()},a)};gd.delay=function(a,b){var c=new gd(b);
c.run=function(){c.stop();a()};return c};gd.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){}};var ke=function(){};ke.prototype={resolveClass:function(a){return gb[a]},resolveEnum:function(a){return Ra[a]}};var kb=function(a){this.buf=a;this.length=a.length;this.pos=0;this.scache=[];this.cache=[];a=kb.DEFAULT_RESOLVER;null==a&&(a=new ke,kb.DEFAULT_RESOLVER=a);this.resolver=a};kb.initCodes=function(){for(var a=[],b=0,c=kb.BASE64.length;b<c;){var d=b++;
a[kb.BASE64.charCodeAt(d)]=d}return a};kb.prototype={readDigits:function(){for(var a=0,b=!1,c=this.pos;;){var d=this.buf.charCodeAt(this.pos);if(d!=d)break;if(45==d){if(this.pos!=c)break;b=!0}else{if(48>d||57<d)break;a=10*a+(d-48)}this.pos++}b&&(a*=-1);return a},readFloat:function(){for(var a=this.pos;;){var b=this.buf.charCodeAt(this.pos);if(b!=b)break;if(43<=b&&58>b||101==b||69==b)this.pos++;else break}return parseFloat(y.substr(this.buf,a,this.pos-a))},unserializeObject:function(a){for(;;){if(this.pos>=
this.length)throw new w("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var b=this.unserialize();if("string"!=typeof b)throw new w("Invalid object key");var c=this.unserialize();a[b]=c}this.pos++},unserializeEnum:function(a,b){if(58!=this.buf.charCodeAt(this.pos++))throw new w("Invalid enum format");var c=this.readDigits();if(0==c)return Cb.createEnum(a,b);for(var d=[];0<c--;)d.push(this.unserialize());return Cb.createEnum(a,b,d)},unserialize:function(){switch(this.buf.charCodeAt(this.pos++)){case 65:var a=
this.unserialize(),b=this.resolver.resolveClass(a);if(null==b)throw new w("Class not found "+a);return b;case 66:a=this.unserialize();b=this.resolver.resolveEnum(a);if(null==b)throw new w("Enum not found "+a);return b;case 67:a=this.unserialize();b=this.resolver.resolveClass(a);if(null==b)throw new w("Class not found "+a);a=Object.create(b.prototype);this.cache.push(a);a.hxUnserialize(this);if(103!=this.buf.charCodeAt(this.pos++))throw new w("Invalid custom data");return a;case 77:a=new td;for(this.cache.push(a);104!=
this.buf.charCodeAt(this.pos);)b=this.unserialize(),a.set(b,this.unserialize());this.pos++;return a;case 82:a=this.readDigits();if(0>a||a>=this.scache.length)throw new w("Invalid string reference");return this.scache[a];case 97:a=[];for(this.cache.push(a);;){b=this.buf.charCodeAt(this.pos);if(104==b){this.pos++;break}117==b?(this.pos++,b=this.readDigits(),a[a.length+b-1]=null):a.push(this.unserialize())}return a;case 98:a=new L;for(this.cache.push(a);104!=this.buf.charCodeAt(this.pos);){b=this.unserialize();
var c=this.unserialize();null!=q[b]?a.setReserved(b,c):a.h[b]=c}this.pos++;return a;case 99:a=this.unserialize();b=this.resolver.resolveClass(a);if(null==b)throw new w("Class not found "+a);a=Object.create(b.prototype);this.cache.push(a);this.unserializeObject(a);return a;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:a=this.unserialize();b=this.resolver.resolveEnum(a);if(null==b)throw new w("Enum not found "+a);this.pos++;c=this.readDigits();var d=b.__constructs__.slice()[c];
if(null==d)throw new w("Unknown enum index "+a+"@"+c);a=this.unserializeEnum(b,d);this.cache.push(a);return a;case 107:return NaN;case 108:a=new je;for(this.cache.push(a);104!=this.buf.charCodeAt(this.pos);)a.add(this.unserialize());this.pos++;return a;case 109:return-Infinity;case 110:return null;case 111:return a={},this.cache.push(a),this.unserializeObject(a),a;case 112:return Infinity;case 113:a=new X;this.cache.push(a);for(b=this.buf.charCodeAt(this.pos++);58==b;)b=this.readDigits(),c=this.unserialize(),
a.h[b]=c,b=this.buf.charCodeAt(this.pos++);if(104!=b)throw new w("Invalid IntMap format");return a;case 114:a=this.readDigits();if(0>a||a>=this.cache.length)throw new w("Invalid reference");return this.cache[a];case 115:a=this.readDigits();d=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<a)throw new w("Invalid bytes length");var e=kb.CODES;null==e&&(e=kb.initCodes(),kb.CODES=e);var f=this.pos,l=a&3,g=f+(a-l);b=new Ea(new ArrayBuffer(3*(a>>2)+(2<=l?l-1:0)));for(c=0;f<g;){var h=
e[d.charCodeAt(f++)],k=e[d.charCodeAt(f++)];b.b[c++]=h<<2|k>>4;h=e[d.charCodeAt(f++)];b.b[c++]=k<<4|h>>2;k=e[d.charCodeAt(f++)];b.b[c++]=h<<6|k}2<=l&&(k=e[d.charCodeAt(f++)],g=e[d.charCodeAt(f++)],b.b[c++]=k<<2|g>>4,3==l&&(d=e[d.charCodeAt(f++)],b.b[c++]=g<<4|d>>2));this.pos+=a;this.cache.push(b);return b;case 116:return!0;case 118:return 48<=this.buf.charCodeAt(this.pos)&&57>=this.buf.charCodeAt(this.pos)&&48<=this.buf.charCodeAt(this.pos+1)&&57>=this.buf.charCodeAt(this.pos+1)&&48<=this.buf.charCodeAt(this.pos+
2)&&57>=this.buf.charCodeAt(this.pos+2)&&48<=this.buf.charCodeAt(this.pos+3)&&57>=this.buf.charCodeAt(this.pos+3)&&45==this.buf.charCodeAt(this.pos+4)?(a=y.strDate(y.substr(this.buf,this.pos,19)),this.pos+=19):a=new Date(this.readFloat()),this.cache.push(a),a;case 119:a=this.unserialize();b=this.resolver.resolveEnum(a);if(null==b)throw new w("Enum not found "+a);a=this.unserializeEnum(b,this.unserialize());this.cache.push(a);return a;case 120:throw w.wrap(this.unserialize());case 121:a=this.readDigits();
if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<a)throw new w("Invalid string length");b=y.substr(this.buf,this.pos,a);this.pos+=a;b=decodeURIComponent(b.split("+").join(" "));this.scache.push(b);return b;case 122:return 0}this.pos--;throw new w("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos);}};var Ea=function(a){this.length=a.byteLength;this.b=new Uint8Array(a);this.b.bufferValue=a;a.hxBytes=this;a.bytes=this.b};Ea.ofString=function(a,b){if(b==Xf.RawNative){b=new Uint8Array(a.length<<
1);for(var c=0,d=a.length;c<d;){var e=c++,f=a.charCodeAt(e);b[e<<1]=f&255;b[e<<1|1]=f>>8}return new Ea(b.buffer)}b=[];for(c=0;c<a.length;)d=a.charCodeAt(c++),55296<=d&&56319>=d&&(d=d-55232<<10|a.charCodeAt(c++)&1023),127>=d?b.push(d):(2047>=d?b.push(192|d>>6):(65535>=d?b.push(224|d>>12):(b.push(240|d>>18),b.push(128|d>>12&63)),b.push(128|d>>6&63)),b.push(128|d&63));return new Ea((new Uint8Array(b)).buffer)};Ea.ofData=function(a){var b=a.hxBytes;return null!=b?b:new Ea(a)};Ea.prototype={blit:function(a,
b,c,d){if(0>a||0>c||0>d||a+d>this.length||c+d>b.length)throw new w(Yf.OutsideBounds);0==c&&d==b.b.byteLength?this.b.set(b.b,a):this.b.set(b.b.subarray(c,c+d),a)},getString:function(a,b,c){if(0>a||0>b||a+b>this.length)throw new w(Yf.OutsideBounds);null==c&&(c=Xf.UTF8);var d="",e=this.b,f=a;a+=b;switch(c._hx_index){case 0:for(;f<a;)if(c=e[f++],128>c){if(0==c)break;d+=String.fromCodePoint(c)}else if(224>c)c=(c&63)<<6|e[f++]&127,d+=String.fromCodePoint(c);else if(240>c)b=e[f++],c=(c&31)<<12|(b&127)<<
6|e[f++]&127,d+=String.fromCodePoint(c);else{b=e[f++];var l=e[f++];c=(c&15)<<18|(b&127)<<12|(l&127)<<6|e[f++]&127;d+=String.fromCodePoint(c)}break;case 1:for(;f<a;)c=e[f++]|e[f++]<<8,d+=String.fromCodePoint(c)}return d},toString:function(){return this.getString(0,this.length)}};var Xf=Ra["haxe.io.Encoding"]={__ename__:"haxe.io.Encoding",__constructs__:["UTF8","RawNative"],UTF8:{_hx_index:0,__enum__:"haxe.io.Encoding",toString:ha},RawNative:{_hx_index:1,__enum__:"haxe.io.Encoding",toString:ha}},Eb=
function(){};Eb.encode=function(a,b){null==b&&(b=!0);var c=(new le(Eb.BYTES)).encodeBytes(a).toString();if(b)switch(a.length%3){case 1:c+="==";break;case 2:c+="="}return c};Eb.decode=function(a,b){null==b&&(b=!0);if(b)for(;61==y.cca(a,a.length-1);)a=y.substr(a,0,-1);return(new le(Eb.BYTES)).decodeBytes(Ea.ofString(a))};var le=function(a){for(var b=a.length,c=1;b>1<<c;)++c;if(8<c||b!=1<<c)throw new w("BaseCode : base length must be a power of two.");this.base=a;this.nbits=c};le.prototype={encodeBytes:function(a){for(var b=
this.nbits,c=this.base,d=8*a.length/b|0,e=new Ea(new ArrayBuffer(d+(0==8*a.length%b?0:1))),f=0,l=0,g=(1<<b)-1,h=0,k=0;k<d;){for(;l<b;)l+=8,f<<=8,f|=a.b[h++];l-=b;e.b[k++]=c.b[f>>l&g]}0<l&&(e.b[k++]=c.b[f<<b-l&g]);return e},initTable:function(){for(var a=[],b=0;256>b;){var c=b++;a[c]=-1}b=0;for(c=this.base.length;b<c;){var d=b++;a[this.base.b[d]]=d}this.tbl=a},decodeBytes:function(a){var b=this.nbits;null==this.tbl&&this.initTable();for(var c=this.tbl,d=a.length*b>>3,e=new Ea(new ArrayBuffer(d)),f=
0,l=0,g=0,h=0;h<d;){for(;8>l;){l+=b;f<<=b;var k=c[a.b[g++]];if(-1==k)throw new w("BaseCode : invalid encoded char");f|=k}l-=8;e.b[h++]=f>>l&255}return e}};var Zf=function(){};Zf.make=function(a){var b=-1,c=a.b.bufferValue,d=0;for(a=a.length;d<a;){var e=d++;e=(b^c.bytes[e])&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;b=b>>>8^e}return b^
-1};var je=function(){this.length=0};je.prototype={add:function(a){a=new $f(a,null);null==this.h?this.h=a:this.q.next=a;this.q=a;this.length++}};var $f=function(a,b){this.item=a;this.next=b};$f.prototype={};var td=function(){this.h={__keys__:{}}};td.prototype={set:function(a,b){var c=a.__id__||(a.__id__=W.$haxeUID++);this.h[c]=b;this.h.__keys__[c]=a},get:function(a){return this.h[a.__id__]},keys:function(){var a=[],b;for(b in this.h.__keys__)this.h.hasOwnProperty(b)&&a.push(this.h.__keys__[b]);return y.iter(a)}};
var Pb=function(a,b){this.map=a;this.keys=b;this.index=0;this.count=b.length};Pb.prototype={hasNext:function(){return this.index<this.count},next:function(){var a=this.map,b=this.keys[this.index++];return null!=q[b]?a.getReserved(b):a.h[b]}};var Yf=Ra["haxe.io.Error"]={__ename__:"haxe.io.Error",__constructs__:["Blocked","Overflow","OutsideBounds","Custom"],Blocked:{_hx_index:0,__enum__:"haxe.io.Error",toString:ha},Overflow:{_hx_index:1,__enum__:"haxe.io.Error",toString:ha},OutsideBounds:{_hx_index:2,
__enum__:"haxe.io.Error",toString:ha},Custom:(P=function(a){return{_hx_index:3,e:a,__enum__:"haxe.io.Error",toString:ha}},P.__params__=["e"],P)},ud=function(){};ud.i32ToFloat=function(a){ud.helper.setInt32(0,a,!0);return ud.helper.getFloat32(0,!0)};var tb=function(a){this.map=a;this.keys=a.keys()};tb.prototype={hasNext:function(){return this.keys.hasNext()},next:function(){var a=this.keys.next();return{value:this.map.get(a),key:a}}};var yb=function(){};yb.getType=function(a){a=yb.getMeta(a);return null==
a||null==a.obj?{}:a.obj};yb.getMeta=function(a){return a.__meta__};yb.getStatics=function(a){a=yb.getMeta(a);return null==a||null==a.statics?{}:a.statics};yb.getFields=function(a){a=yb.getMeta(a);return null==a||null==a.fields?{}:a.fields};var Ha=function(a,b,c){this.xml=b;this.message=a;this.position=c;this.lineNumber=1;for(a=this.positionAtLine=0;a<c;){var d=a++;d=b.charCodeAt(d);10==d?(this.lineNumber++,this.positionAtLine=0):13!=d&&this.positionAtLine++}};Ha.prototype={toString:function(){return aa.getClass(this).__name__+
": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine}};var Ob=function(){};Ob.parse=function(a,b){null==b&&(b=!1);var c=x.createDocument();Ob.doParse(a,b,0,c);return c};Ob.doParse=function(a,b,c,d){null==c&&(c=0);for(var e=null,f=1,l=1,g=null,h=0,k=0,n=0,m=a.charCodeAt(c),p=new Nb,r=1,t=-1;m==m;){switch(f){case 0:switch(m){case 9:case 10:case 13:case 32:break;default:f=l;continue}break;case 1:if(60==m)f=0,l=2;else{h=c;f=13;continue}break;case 2:switch(m){case 33:if(91==a.charCodeAt(c+
1)){c+=2;if("CDATA["!=y.substr(a,c,6).toUpperCase())throw new w(new Ha("Expected <![CDATA[",a,c));c+=5;f=17}else if(68==a.charCodeAt(c+1)||100==a.charCodeAt(c+1)){if("OCTYPE"!=y.substr(a,c+2,6).toUpperCase())throw new w(new Ha("Expected <!DOCTYPE",a,c));c+=8;f=16}else{if(45!=a.charCodeAt(c+1)||45!=a.charCodeAt(c+2))throw new w(new Ha("Expected \x3c!--",a,c));c+=2;f=15}h=c+1;break;case 47:if(null==d)throw new w(new Ha("Expected node name",a,c));h=c+1;f=0;l=10;break;case 63:f=14;h=c;break;default:f=
3;h=c;continue}break;case 3:if(!(97<=m&&122>=m||65<=m&&90>=m||48<=m&&57>=m||58==m||46==m||95==m||45==m)){if(c==h)throw new w(new Ha("Expected node name",a,c));e=x.createElement(y.substr(a,h,c-h));d.addChild(e);++k;f=0;l=4;continue}break;case 4:switch(m){case 47:f=11;break;case 62:f=9;break;default:f=5;h=c;continue}break;case 5:if(!(97<=m&&122>=m||65<=m&&90>=m||48<=m&&57>=m||58==m||46==m||95==m||45==m)){if(h==c)throw new w(new Ha("Expected attribute name",a,c));g=y.substr(a,h,c-h);if(e.exists(g))throw new w(new Ha("Duplicate attribute ["+
g+"]",a,c));f=0;l=6;continue}break;case 6:if(61==m)f=0,l=7;else throw new w(new Ha("Expected =",a,c));break;case 7:switch(m){case 34:case 39:p=new Nb;f=8;h=c+1;t=m;break;default:throw new w(new Ha('Expected "',a,c));}break;case 8:switch(m){case 38:r=c-h;p.b+=null==r?y.substr(a,h,null):y.substr(a,h,r);f=18;r=8;h=c+1;break;case 60:case 62:if(b)throw new w(new Ha("Invalid unescaped "+String.fromCodePoint(m)+" in attribute value",a,c));m==t&&(l=c-h,p.b+=null==l?y.substr(a,h,null):y.substr(a,h,l),l=p.b,
p=new Nb,e.set(g,l),f=0,l=4);break;default:m==t&&(l=c-h,p.b+=null==l?y.substr(a,h,null):y.substr(a,h,l),l=p.b,p=new Nb,e.set(g,l),f=0,l=4)}break;case 9:h=c=Ob.doParse(a,b,c,e);f=1;break;case 10:if(!(97<=m&&122>=m||65<=m&&90>=m||48<=m&&57>=m||58==m||46==m||95==m||45==m)){if(h==c)throw new w(new Ha("Expected node name",a,c));l=y.substr(a,h,c-h);if(null==d||0!=d.nodeType)throw new w(new Ha("Unexpected </"+l+">, tag is not open",a,c));if(d.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+
ka.toString(d.nodeType));if(l!=d.nodeName){if(d.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(d.nodeType));throw new w(new Ha("Expected </"+d.nodeName+">",a,c));}f=0;l=12;continue}break;case 11:if(62==m)f=1;else throw new w(new Ha("Expected >",a,c));break;case 12:if(62==m)return 0==k&&d.addChild(x.createPCData("")),c;throw new w(new Ha("Expected >",a,c));case 13:60==m?(l=c-h,p.b+=null==l?y.substr(a,h,null):y.substr(a,h,l),l=x.createPCData(p.b),p=new Nb,d.addChild(l),
++k,f=0,l=2):38==m&&(r=c-h,p.b+=null==r?y.substr(a,h,null):y.substr(a,h,r),f=18,r=13,h=c+1);break;case 14:63==m&&62==a.charCodeAt(c+1)&&(++c,m=y.substr(a,h+1,c-h-2),d.addChild(x.createProcessingInstruction(m)),++k,f=1);break;case 15:45==m&&45==a.charCodeAt(c+1)&&62==a.charCodeAt(c+2)&&(d.addChild(x.createComment(y.substr(a,h,c-h))),++k,c+=2,f=1);break;case 16:91==m?++n:93==m?--n:62==m&&0==n&&(d.addChild(x.createDocType(y.substr(a,h,c-h))),++k,f=1);break;case 17:93==m&&93==a.charCodeAt(c+1)&&62==a.charCodeAt(c+
2)&&(m=x.createCData(y.substr(a,h,c-h)),d.addChild(m),++k,c+=2,f=1);break;case 18:if(59==m){h=y.substr(a,h,c-h);if(35==h.charCodeAt(0))h=120==h.charCodeAt(1)?ma.parseInt("0"+y.substr(h,1,h.length-1)):ma.parseInt(y.substr(h,1,h.length-1)),p.b+=String.fromCodePoint(h);else if(m=Ob.escapes,null!=q[h]?m.existsReserved(h):m.h.hasOwnProperty(h))m=Ob.escapes,h=null!=q[h]?m.getReserved(h):m.h[h],p.b+=ma.string(h);else{if(b)throw new w(new Ha("Undefined entity: "+h,a,c));p.b+=ma.string("&"+h+";")}h=c+1;f=
r}else if(!(97<=m&&122>=m||65<=m&&90>=m||48<=m&&57>=m||58==m||46==m||95==m||45==m)&&35!=m){if(b)throw new w(new Ha("Invalid character in entity: "+String.fromCodePoint(m),a,c));p.b+=String.fromCodePoint(38);m=c-h;p.b+=null==m?y.substr(a,h,null):y.substr(a,h,m);--c;h=c+1;f=r}}m=a.charCodeAt(++c)}1==f&&(h=c,f=13);if(13==f){if(0==d.nodeType){if(d.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(d.nodeType));throw new w(new Ha("Unclosed node <"+d.nodeName+">",a,
c));}if(c!=h||0==k)b=c-h,p.b+=null==b?y.substr(a,h,null):y.substr(a,h,b),d.addChild(x.createPCData(p.b));return c}if(!b&&18==f&&13==r)return p.b+=String.fromCodePoint(38),b=c-h,p.b+=null==b?y.substr(a,h,null):y.substr(a,h,b),d.addChild(x.createPCData(p.b)),c;throw new w(new Ha("Unexpected end",a,c));};var yd=function(a){this.output=new Nb;this.pretty=a};yd.print=function(a,b){null==b&&(b=!1);b=new yd(b);b.writeNode(a,"");return b.output.b};yd.prototype={writeNode:function(a,b){switch(a.nodeType){case 0:this.output.b+=
ma.string(b+"<");if(a.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(a.nodeType));this.output.b+=ma.string(a.nodeName);for(var c=a.attributes();c.hasNext();){var d=c.next();this.output.b+=ma.string(" "+d+'="');d=ia.htmlEscape(a.get(d),!0);this.output.b+=ma.string(d);this.output.b+='"'}if(this.hasChildren(a)){this.output.b+=">";this.pretty&&(this.output.b+="\n");if(a.nodeType!=x.Document&&a.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+
ka.toString(a.nodeType));for(c=y.iter(a.children);c.hasNext();)d=c.next(),this.writeNode(d,this.pretty?b+"\t":b);this.output.b+=ma.string(b+"</");if(a.nodeType!=x.Element)throw new w("Bad node type, expected Element but found "+ka.toString(a.nodeType));this.output.b+=ma.string(a.nodeName);this.output.b+=">"}else this.output.b+="/>";this.pretty&&(this.output.b+="\n");break;case 1:if(a.nodeType==x.Document||a.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(a.nodeType));a=a.nodeValue;
0!=a.length&&(b+=ia.htmlEscape(a),this.output.b+=ma.string(b),this.pretty&&(this.output.b+="\n"));break;case 2:this.output.b+=ma.string(b+"<![CDATA[");if(a.nodeType==x.Document||a.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(a.nodeType));this.output.b+=ma.string(a.nodeValue);this.output.b+="]]\x3e";this.pretty&&(this.output.b+="\n");break;case 3:if(a.nodeType==x.Document||a.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(a.nodeType));a=a.nodeValue;
a=a.replace(/[\n\r\t]+/g,"");this.output.b+=null==b?"null":""+b;b=ia.trim("\x3c!--"+a+"--\x3e");this.output.b+=ma.string(b);this.pretty&&(this.output.b+="\n");break;case 4:if(a.nodeType==x.Document||a.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(a.nodeType));this.output.b+=ma.string("<!DOCTYPE "+a.nodeValue+">");this.pretty&&(this.output.b+="\n");break;case 5:if(a.nodeType==x.Document||a.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(a.nodeType));
this.output.b+=ma.string("<?"+a.nodeValue+"?>");this.pretty&&(this.output.b+="\n");break;case 6:if(a.nodeType!=x.Document&&a.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+ka.toString(a.nodeType));for(a=y.iter(a.children);a.hasNext();)c=a.next(),this.writeNode(c,b)}},hasChildren:function(a){if(a.nodeType!=x.Document&&a.nodeType!=x.Element)throw new w("Bad node type, expected Element or Document but found "+ka.toString(a.nodeType));for(a=y.iter(a.children);a.hasNext();){var b=
a.next();switch(b.nodeType){case 0:case 1:return!0;case 2:case 3:if(b.nodeType==x.Document||b.nodeType==x.Element)throw new w("Bad node type, unexpected "+ka.toString(b.nodeType));if(0!=ia.ltrim(b.nodeValue).length)return!0}}return!1}};var w=function(a){Error.call(this);this.val=a;Error.captureStackTrace&&Error.captureStackTrace(this,w)};w.wrap=function(a){return a instanceof Error?a:new w(a)};w.prototype=n(Error.prototype,{});var aa=function(){};aa.getClass=function(a){if(null==a)return null;if(a instanceof
Array&&null==a.__enum__)return Array;var b=a.__class__;if(null!=b)return b;a=aa.__nativeClassName(a);return null!=a?aa.__resolveNativeClass(a):null};aa.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a.__enum__){var d=Ra[a.__enum__];c=d.__constructs__[a._hx_index];var e=d[c];if(e.__params__){b+="\t";d=[];var f=0;for(e=e.__params__;f<e.length;){var l=
e[f];f+=1;d.push(aa.__string_rec(a[l],b))}return c+"("+d.join(",")+")"}return c}if(a instanceof Array){c="[";b+="\t";d=0;for(f=a.length;d<f;)e=d++,c+=(0<e?",":"")+aa.__string_rec(a[e],b);return c+"]"}try{d=a.toString}catch(bh){return"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d&&(c=a.toString(),"[object Object]"!=c))return c;c="{\n";b+="\t";d=null!=a.hasOwnProperty;f=null;for(f in a)d&&!a.hasOwnProperty(f)||"prototype"==f||"__class__"==f||"__super__"==f||"__interfaces__"==f||"__properties__"==
f||(2!=c.length&&(c+=", \n"),c+=b+f+" : "+aa.__string_rec(a[f],b));b=b.substring(1);return c+("\n"+b+"}");case "string":return a;default:return String(a)}};aa.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;if(Object.prototype.hasOwnProperty.call(a,"__interfaces__"))for(var c=a.__interfaces__,d=0,e=c.length;d<e;){var f=d++;f=c[f];if(f==b||aa.__interfLoop(f,b))return!0}return aa.__interfLoop(a.__super__,b)};aa.__instanceof=function(a,b){if(null==b)return!1;switch(b){case Array:return a instanceof
Array;case $g:return"boolean"==typeof a;case ah:return null!=a;case ag:return"number"==typeof a;case me:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(aa.__downcastCheck(a,b))return!0}else{if("object"==typeof b&&aa.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==Vf&&null!=a.__name__||b==Wf&&null!=a.__ename__?!0:null!=a.__enum__?Ra[a.__enum__]==b:!1}};aa.__downcastCheck=function(a,b){return a instanceof b?
!0:b.__isInterface__?aa.__interfLoop(aa.getClass(a),b):!1};aa.__cast=function(a,b){if(null==a||aa.__instanceof(a,b))return a;throw new w("Cannot cast "+ma.string(a)+" to "+ma.string(b));};aa.__nativeClassName=function(a){a=aa.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};aa.__isNativeObj=function(a){return null!=aa.__nativeClassName(a)};aa.__resolveNativeClass=function(a){return W[a]};var kd=function(){};kd.getLocalStorage=function(){try{var a=window.localStorage;
a.getItem("");if(0==a.length){var b="_hx_"+Math.random();a.setItem(b,b);a.removeItem(b)}return a}catch(c){return null}};var F=function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);ya.call(this,a,b,c,d)};F.prototype=n(ya.prototype,{setRGBA:function(a){this.x=.00392156863*ta.toFloat(a>>>24&255);this.y=.00392156863*ta.toFloat(a>>>16&255);this.z=.00392156863*ta.toFloat(a>>>8&255);this.w=.00392156863*ta.toFloat(a&255);return this},parse:function(a){if(null==a||""==a)return this;
0==a.indexOf("#")&&(a="0x"+y.substr(a,1,null));-1==a.indexOf("0x")&&(a="0x"+a);10>a.length&&(a=p.stringFill(a,10-a.length,"F"));this.setRGBA(p.hexToInt(a));return this}});var cb=function(){this._pool=M.current;this.instanceID=cb._id++;this._vec3=h.instance;this._hsv=Ld.instance};cb.prototype={start:function(a,b){this._life=this._duration=a;null!=b&&(this._color=new F,this._color.copy(b))},fill:function(a,b){var c=1;0<this._duration&&(c=this._life/this._duration);this.onFill(a,c);this._life-=b;return 0>=
this._life?(this._pool.set(this),!1):!0},onFill:function(a,b){},getColor:function(a){if(null!=this._color)return this._color.w=a,this._color;cb._c.w=a;return cb._c}};var bg=function(){cb.call(this);this.position=new h;this.rotation=new Ca};bg.prototype=n(cb.prototype,{setup:function(a,b,c){this.position.copy(a);this.radius=b;this.rotation.setEulerAngles(0,0,0);this.rotation.copy(c)},onFill:function(a,b){for(var c=Math.sin,d=Math.cos,e=this.getColor(b),f=0;18>f;){var l=f++,g=this._hsv,h=20*l,k=1,m=
1;null==m&&(m=1);null==k&&(k=1);null==h&&(h=0);g.h=h;g.s=k;g.v=m;h=.3490658503988659*l;g=d(h)*this.radius;h=c(h)*this.radius;this.rotation.rotate(this._vec3.set(g,h,0)).add(this.position);null==this._color&&(e=this._hsv.toColor(),e.w=b);a.addVertex(this._vec3,e);g=l+1;18<=g&&(g=0);a.addIndex(l,g)}}});var Ld=function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=0);this.h=a;this.s=b;this.v=c};Ld.prototype={toColor:function(){var a=F.instance;if(0==this.s){var b=this.v,c=this.v,d=this.v,e=1;null==
e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;return a}b=this.h%360/60;e=b|0;d=b-e;b=this.v*(1-this.s);c=this.v*(1-this.s*d);d=this.v*(1-this.s*(1-d));switch(e){case 0:c=this.v;e=1;null==e&&(e=1);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.z=b;a.w=e;break;case 1:d=this.v;e=1;null==e&&(e=1);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.z=b;a.w=e;break;case 2:c=this.v;e=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=
c;a.z=d;a.w=e;break;case 3:d=this.v;e=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;break;case 4:c=d;d=this.v;e=1;null==e&&(e=1);null==d&&(d=0);null==b&&(b=0);null==c&&(c=0);a.x=c;a.y=b;a.z=d;a.w=e;break;case 5:d=this.v,e=1,null==e&&(e=1),null==c&&(c=0),null==b&&(b=0),null==d&&(d=0),a.x=d,a.y=b,a.z=c,a.w=e}return a}};var cg=function(){cb.call(this);this.p1=new h;this.p2=new h};cg.prototype=n(cb.prototype,{setup:function(a,b){this.p1.copy(a);this.p2.copy(b)},
onFill:function(a,b){b=this.getColor(b);a.addVertex(this.p1,b);a.addVertex(this.p2,b);a.addIndex(0,1)}});var dg=function(){cb.call(this);this.pos=new h;this.right=new h;this.up=new h};dg.prototype=n(cb.prototype,{setup:function(a,b,c){this.pos.copy(a);this.right.set(1,0,0);this.up.set(0,1,0);this.right.copy(b);this.up.copy(c)},onFill:function(a,b){b=this.getColor(b);this._vec3.copy(this.pos).sub(this.right).sub(this.up);a.addVertex(this._vec3,b);this._vec3.copy(this.pos).add(this.right).sub(this.up);
a.addVertex(this._vec3,b);this._vec3.copy(this.pos).add(this.right).add(this.up);a.addVertex(this._vec3,b);this._vec3.copy(this.pos).sub(this.right).add(this.up);a.addVertex(this._vec3,b);a.addIndex(0,1);a.addIndex(1,2);a.addIndex(2,3);a.addIndex(3,0)}});var eg=function(){cb.call(this);this.point1=new h;this.point2=new h;this.point3=new h};eg.prototype=n(cb.prototype,{setup:function(a,b,c){this.point1.copy(a);this.point2.copy(b);this.point3.copy(c)},onFill:function(a,b){b=this.getColor(b);a.addVertex(this.point1,
b);a.addVertex(this.point2,b);a.addVertex(this.point3,b);a.addIndex(0,1);a.addIndex(1,2);a.addIndex(2,0)}});var fg=function(){this.geometry=new Za;this.geometry.color=new Ib;this.offset=0};fg.prototype={clear:function(){this.geometry.position.clear();this.geometry.color.clear();this.geometry.group.clear();this.offset=0},addVertex:function(a,b){this.geometry.position.push(a);this.geometry.color.push(b)},addIndex:function(a,b){this.geometry.group.indices.push2(a+this.offset,b+this.offset)},begin:function(){this.offset=
this.geometry.position.length}};var Za=function(){this.uvflipY=!1;I.call(this);this.group=new gg;this.position=new ne;this.changed=!1};Za.prototype=n(I.prototype,{clear:function(a){null!=a&&a.clear()},update:function(){this.changed=!0;this.dispatchEvent(C.update)},dispose:function(){I.prototype.dispose.call(this);null!=this.group&&(this.group.dispose(),this.group=null,this.dispatchEvent(C.delete));null!=this.position&&(this.position.dispose(),this.position=null);null!=this.uv&&(this.uv.dispose(),
this.uv=null);null!=this.uv2&&(this.uv2.dispose(),this.uv2=null);null!=this.normal&&(this.normal.dispose(),this.normal=null);null!=this.tangent&&(this.tangent.dispose(),this.tangent=null);null!=this.color&&(this.color.dispose(),this.color=null);null!=this.color2&&(this.color2.dispose(),this.color2=null);null!=this.color3&&(this.color3.dispose(),this.color3=null);null!=this.color3&&(this.color3.dispose(),this.color3=null);null!=this.color4&&(this.color4.dispose(),this.color4=null);null!=this.color5&&
(this.color5.dispose(),this.color5=null);null!=this.color6&&(this.color6.dispose(),this.color6=null);null!=this.joint&&(this.joint.dispose(),this.joint=null);null!=this.weight&&(this.weight.dispose(),this.weight=null)},getCustomUVMethod:function(){return null==this._customUVMethod?g(this,this._getuv):this._customUVMethod},_getuv:function(a,b,c){a=Za._uv;c=this.uvflipY?1-c:c;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;return a}});var gg=function(){this.indices=new hg;this._index=this.count=0};gg.prototype=
{clear:function(){this.indices.clear();this._index=this.count=0},dispose:function(){this.indices.dispose();this._length=this._offset=this.indices=null},getGroupOffset:function(a){return this._offset[a]},getGroupLength:function(a){return this._length[a]}};var hg=function(){this.length=0;this.data=[];this.offset=0};hg.prototype={clear:function(){this.offset=this.length=0;this._changed=!0},dispose:function(){this.data=null},push2:function(a,b){this.data[this.length++]=a+this.offset;this.data[this.length++]=
b+this.offset;this._changed=!0},push3:function(a,b,c){this.data[this.length++]=a+this.offset;this.data[this.length++]=b+this.offset;this.data[this.length++]=c+this.offset;this._changed=!0},get_changed:function(){return this._changed?(this._changed=!1,!0):!1}};var Uc=function(a){null==a&&(a=5126);this.length=this.dataLength=0;this.data=[];this.componentType=a;this.bytesPerElement=p.getByteLengthByType(a)};Uc.prototype={clear:function(){this.length=this.dataLength=0;this._changed=!0},dispose:function(){this.data=
null},get_changed:function(){return this._changed?(this._changed=!1,!0):!1}};var ne=function(a){null==a&&(a=5126);Uc.call(this,a)};ne.prototype=n(Uc.prototype,{push:function(a){if(null==a)throw new w("null value");if(null!=this.onPush)this.onPush(a);a.fillArray(this.data,3*this.length);this._changed=!0;this.length++;this.dataLength=3*this.length},get:function(a){return h.instance.fromArray(this.data,3*a)}});var p=function(){};p.lerpTo=function(a,b,c,d,e){return c+(e-a)/(b-a)*(d-c)};p.stringToInt=
function(a){if(null==a||1>a.length)return 0;-1!=a.indexOf("_")&&(a=ia.replace(a,"_",""));if(-1!=a.indexOf(":")){a=a.split(":");for(var b=a.length,c=0,d=1;0<b--;)c+=parseFloat(a[b])*d,d*=60;return p.floatToInt(c)}return ma.parseInt(a)};p.stringToFloat=function(a){if(null==a||1>a.length)return 0;-1!=a.indexOf("_")&&(a=ia.replace(a,"_",""));if(-1!=a.indexOf(":")){a=a.split(":");for(var b=a.length,c=0,d=1;0<b--;)c+=parseFloat(a[b])*d,d*=60;return c}return parseFloat(p.trim(a))};p.stringToBool=function(a){a=
p.trim(a).toLowerCase();return"true"==a?!0:"false"==a?!1:0!=p.stringToInt(a)};p.hexToInt=function(a){if(0==a.indexOf("0x"))return 10<a.length&&(a=y.substr(a,0,10)),p.stringToInt(a);8<a.length&&(a=y.substr(a,0,8));return p.stringToInt("0x"+a)};p.floatToInt=function(a){return p.floor(a)|0};p.toExp=function(a,b){for(var c=1;0!=(b&1)&&(c*=a),b>>=1,0!=b;)a*=a;return c};p.fixed=function(a,b){null==b&&(b=4);var c=p.toExp(10,b);a=ma.string((a*c|0)/c);c=a.indexOf(".");if(-1!=c)for(c=y.substr(a,c+1,null).length;c<
b;)c++,a+="0";else for(a+=".",c=0;c<b;)c++,a+="0";return p.stringToFloat(a)};p.abs=function(a){return 0>a?-a:a};p.absInt=function(a){return 0>a?-a:a};p.intToNextPow2=function(a){--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;return(a|a>>16)+1};p.pow2Count=function(a){a=p.intToNextPow2(a);for(var b=0;1<a;)a>>=1,++b;return b};p.floor=function(a){var b=a|0;0>a&&b!=a&&--b;return b};p.ceil=function(a){var b=a|0;if(a==b)return b;++a;b=a|0;0>a&&b!=a&&--b;return b};p.ceilToInt=function(a){return p.ceil(a)|0};p.trim=
function(a,b){null==b&&(b=" ");if(null==a)return null;a=ia.replace(ia.trim(a),"\t","");if(""==b)return a;0==a.indexOf(b)&&(a=y.substr(a,1,null));a.lastIndexOf(b)==a.length-1&&(a=y.substr(a,0,-1));return a};p.stringFill=function(a,b,c){null==c&&(c=" ");if(""==c||0==b)return a;var d=0>b;b=p.absInt(b);for(var e="",f=0;f<b;)f++,e+=c;return d?e+a:a+e};p.binarySearchLow=function(a,b){var c=a.length;if(2>c&&b>=a[0])return 0;var d=0,e=c-1,f=e>>>1;for(c=e;0<c--;){var l=a[f];if(b>l)d=f,f+=e-d>>>1;else if(b<
l)e=f,f=d+(e-d>>>1);else if(b==l)return f;if(3>e-d){if(b>=a[e])return e;if(b>=a[f])return f;if(b>=a[d])return d}}return-1};p.stringEmpty=function(a){return null!=a?""==a:!0};p.getByteLengthByType=function(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:return 4}};p.stringToArray=function(a){var b=[];if(null!=a){for(var c=0,d="",e=0,f=a.length;e<f;){var l=e++;l=a.charAt(l);","==l&&1>c?(b.push(p.trim(d)),d=""):("{"!=l&&"["!=l&&"("!=
l||++c,"}"!=l&&"]"!=l&&")"!=l||--c,d+=l)}""!=d&&b.push(p.trim(d))}return b};p.randomOneFromList=function(a,b){null==b&&(b=0);var c=a.length;b=p.floatToInt(0==c?0:c*p.randomInstance.getFloat())+b;c=a.length-1;return a[0>b?0:b>c?c:b]};var Ib=function(a){null==a&&(a=5126);Uc.call(this,a)};Ib.prototype=n(Uc.prototype,{push:function(a){if(null==a)throw new w("null value");a.fillArray(this.data,4*this.length);this._changed=!0;this.length++;this.dataLength=4*this.length}});var G=function(){};G.update=function(a){G.buffer.clear();
var b=G._list.get_length();if(0<b){for(G._cleared=!1;0<b--;){var c=G._list.getArrayElement(b);G.buffer.begin();c.fill(G.buffer,a)||G._list.removeAt(b)}G.buffer.geometry.update()}else G._cleared||G.buffer.geometry.update(),G._cleared=!0;G._enabled=!0};G.getGeometry=function(){G._enabled=!1;return G.buffer.geometry};G.drawLine=function(a,b,c,d){null==d&&(d=0);if(G.editorMode){var e=G._lines.get();e.setup(a,b);e.start(d,c);G._list.push(e)}};G.drawTriangle=function(a,b,c,d,e){null==e&&(e=0);if(G.editorMode){var f=
G._triangles.get();f.setup(a,b,c);f.start(e,d);G._list.push(f)}};G.drawPlane=function(a,b,c,d,e){null==e&&(e=0);if(G.editorMode){var f=G._planes.get();f.setup(a,b,c);f.start(e,d);G._list.push(f)}};G.drawCircle=function(a,b,c,d,e){null==e&&(e=0);if(G.editorMode){var f=G._circles.get();f.setup(a,b,c);f.start(e,d);G._list.push(f)}};var Sa=function(){},oa=function(){};oa.getnow=function(){return.001*(new Date).getTime()+oa._offset};var ig=function(a){this._items=new S;this._items.push(null);this._compare=
a;this.count=0};ig.prototype={push:function(a){this._items.push(a);this.toRoot(this._items.get_length()-1);this.count=this._items.get_length()-1},shift:function(){if(1==this._items.get_length())return null;if(2==this._items.get_length())return this.count=0,this._items.pop();var a=this._items.get(1);this.toLeaf();this.count=this._items.get_length()-1;return a},Clear:function(){this._items.set_length(1)},toRoot:function(a){for(var b=a;1<b;){var c=b>>1,d=this._items.get(b),e=this._items.get(c);if(0>
this._compare(d,e))this._items.setArrayElement(b,e),this._items.setArrayElement(c,d);else break;b=c;if(0>a--)break}},toLeaf:function(){var a=1;this._items.setArrayElement(1,this._items.pop());for(var b=this._items.get_length(),c=b;;){var d=a,e=a<<1;if(e<b){var f=this._items.get(a),l=this._items.get(e);0<this._compare(f,l)&&(a=e,f=l);e+1<b&&(l=this._items.get(e+1),0<this._compare(f,l)&&(a=e+1))}if(a!=d)f=this._items.get(a),e=this._items.get(d),this._items.setArrayElement(a,e),this._items.setArrayElement(d,
f);else break;if(0>c--)break}}};var oe=function(a){null==a&&(a=0);this.bigEndian=!1;this._data=new Ea(new ArrayBuffer(a));this._length=this.position=0};oe.prototype={dispose:function(){null!=this._data&&(this._data=null,this._length=this.position=0)},toString:function(){return this._data.getString(0,this._length)},setBytes:function(a){if(null==a||0==a.length)return this;this.__resize(a.length);this.position=0;this._data.blit(0,a,0,a.length);return this},getBytes:function(){this.trim();return this._data},
readUnsignedByte:function(){if(ta.gt(this._length,this.position))return this._data.b[this.position++];throw new w("EOF");},readByte:function(){var a=this.readUnsignedByte();return 0!=(a&128)?a-256:a},readUnsignedShort:function(){var a=this.readUnsignedByte(),b=this.readUnsignedByte();return this.bigEndian?a<<8|b:(b<<8)+a},readShort:function(){var a=this.readUnsignedShort();return 0!=(a&32768)?a-65536:a},readUnsignedInt:function(){var a=this.readUnsignedByte(),b=this.readUnsignedByte(),c=this.readUnsignedByte(),
d=this.readUnsignedByte();return this.bigEndian?a<<24|b<<16|c<<8|d:d<<24|c<<16|b<<8|a},readInt:function(){var a=this.readUnsignedByte(),b=this.readUnsignedByte(),c=this.readUnsignedByte(),d=this.readUnsignedByte();return this.bigEndian?a<<24|b<<16|c<<8|d:d<<24|c<<16|b<<8|a},readFloat:function(){return ud.i32ToFloat(this.readInt())},readUTFBytes:function(a){if(this.position+a>this._length)throw new w("EOF");this.position+=a;return this._data.getString(this.position-a,a)},writeUTFBytes:function(a){a=
Ea.ofString(a);this.writeBytes(a)},readUTF:function(){var a=this.readUnsignedShort();return this.readUTFBytes(a)},readTinyUTF:function(){var a=this.readUnsignedByte();return this.readUTFBytes(a)},readBlob:function(a,b,c){null==c&&(c=0);null==b&&(b=0);0==c&&(c=this._length-this.position);if(ta.gt(this.position+c,this._length))throw new w("EOF");a._data.length<b+c&&a.__resize(b+c);a._data.blit(b,this._data,this.position,c);this.position+=c},writeBytes:function(a,b,c){null==c&&(c=0);null==b&&(b=0);0!=
a.length&&(0==c&&(c=a.length-b),this.__resize(this.position+c),this._data.blit(this.position,a,b,c),this.position+=c)},readBytes:function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.readBlob(a,b,c)},trim:function(){if(this._data.length>this._length){var a=new Ea(new ArrayBuffer(this._length));a.blit(0,this._data,0,this._length);this._data=a}},__resize:function(a){if(a>this._data.length){var b=new Ea(new ArrayBuffer(3*(a+1)>>1));b.blit(0,this._data,0,this._length);this._data=b}this._length<a&&(this._length=
a)}};var fb=function(a){null==a&&(a=5126);Uc.call(this,a)};fb.prototype=n(Uc.prototype,{add:function(a){for(var b=0,c=a.length;b<c;){var d=b++;this.push(a.get(d))}},push:function(a){if(null==a)throw new w("null value");if(null!=this.onPush)this.onPush(a);a.fillArray(this.data,2*this.length);this._changed=!0;this.length++;this.dataLength=2*this.length},get:function(a){return H.instance.fromArray(this.data,2*a)}});var wa={_new:function(a){null==a&&(a=0);return new oe(a)},fromBytes:function(a){return null==
a?null:(new oe).setBytes(a)},toBytes:function(a){return null==a?null:a.getBytes()},toStr:function(a){if(null==a)return null;a.position=0;return a.toString()}},pe=function(a,b){null==b&&(b=!1);null==a&&(a="");this._list=[];this._keep=b;this.decode(a)};pe.prototype={readLine:function(){return this._position<this._length?this._list[this._position++]:null},decode:function(a){0<this._length&&this._list.splice(0,this._length);this._position=this._length=0;if(null!=a){a=ia.replace(a,"\r","\n");a=a.split("\n");
for(var b=0,c=a.length;b<c;){var d=b++;d=a[d];(""!=d||this._keep)&&this._list.push(d)}this._length=this._list.length;this._position=0}}};var jg=function(a,b){this.x=a;this.y=b};jg.prototype={};var kg=function(a,b,c){this.x=a;this.y=b;this.z=c};kg.prototype={};var od=function(){};od.createInstance=function(a,b){a=null==b?Object.create(a.prototype):Cb.createInstance(a,b);a instanceof mb&&!a.__constructed&&(a.__constructed=!0,a.instanceID=mb._id++,a.onConstruct());return a};od.getClassName=function(a){return null==
a?"null":aa.getClass(a).__name__};var C=function(a){this.name=a;this._type=od.getClassName(this)+"."+a+"."+((new Date(2019,9,22,15,40,16)).getTime()|0)};C.__name__="lovedna.events.Event";C.prototype={copy:function(a){this.type=a._type;this.name=a.name;this.currentTarget=a.currentTarget;this.target=a.target},clear:function(){this.currentTarget=this.target=null},__class__:C};var Td=function(a,b){this.callback=a;this.priority=b};Td.prototype={dispose:function(){this.callback=null}};var Jb=function(a){C.call(this,
a)};Jb.__name__="lovedna.events.FileLoadEvent";Jb.prototype=n(C.prototype,{__class__:Jb});var Da=function(a){C.call(this,a)};Da.__name__="lovedna.events.KeyEvent";Da.prototype=n(C.prototype,{__class__:Da});var Db=function(a){C.call(this,a);this.action=0;this.id=-1};Db.__name__="lovedna.events.MediaEvent";Db.prototype=n(C.prototype,{__class__:Db});var ac=function(a){C.call(this,a);this.value=new h;this.deltaMode=0};ac.__name__="lovedna.events.MouseWheelEvent";ac.prototype=n(C.prototype,{__class__:ac});
var ua=function(a){C.call(this,a);this.vintlist=[];this.vfloatlist=[];this.vstringlist=[]};ua.__name__="lovedna.events.SystemEvent";ua.prototype=n(C.prototype,{__class__:ua});var db=function(){this.instanceID=db._id++;this._key=null;this.type=0;this._alive=!1;this.device=this.touchId=-1;this.pressure=this.size=1;this.position=new h;this.down=new h;this.up=new h;this.time=new h;this.lastTime=new h;this._will=new ib;this._was=new ib};db.prototype={has:function(a){return this._was.getArrayElement(a)},
copy:function(a){null!=a&&(this.device=a.device,this.touchId=a.touchId,this.size=a.size,this.pressure=a.pressure,this.type=a.type,this.position.copy(a.position),this.down.copy(a.down),this.up.copy(a.up),this.time.copy(a.time),this.lastTime.copy(a.lastTime),this._key=a._key,this._alive=a._alive,this._will.value=a._will.value,this._was.value=a._was.value);return this},copyValue:function(a){this.touchId=a.touchId;this.position.copy(a.position);this.size=a.size;this.pressure=a.pressure},begin:function(a){this._will.value=
0;this._was.value=0;this.copyValue(a);this.down.copy(this.position);this.lastTime.x=this.time.x;this.time.x=oa._custom();this._will.setArrayElement(1);this._alive=!0},move:function(a){if(this._was.getArrayElement(1)||this._will.getArrayElement(1))this.copyValue(a),this.lastTime.y=this.time.y,this.time.y=oa._custom(),this._will.setArrayElement(2)},end:function(a){this.copyValue(a);this.up.copy(this.position);this.lastTime.z=this.time.z;this.time.z=oa._custom();this._will.setArrayElement(5)},cancel:function(a){this.copyValue(a);
this.up.copy(this.position);this.lastTime.z=this.time.z;this.time.z=oa._custom();this._will.setArrayElement(5)},execute:function(a){null==a&&(a=oa._custom());this._was.getArrayElement(1)&&(this._was.getArrayElement(4)||a-this.time.x>=db.holdTime&&this._will.setArrayElement(4));a=this._will.getArrayElement(1);var b=this._will.getArrayElement(2),c=this._will.getArrayElement(4),d=this._will.getArrayElement(5),e=!0;a&&(this.type=1,this._was.setArrayElement(1),e=!1,this.fire());b&&(this.type=2,this._was.setArrayElement(2),
e=!1,this.fire());c&&(this.type=4,this._was.setArrayElement(4),e=!1,this.fire());d&&(this.type=5,this._was.setArrayElement(5),e=!1,this.fire(),this._was.value=0,this._was.setArrayElement(5),this._will.value=0,this._alive=!1);e&&(this.type=3,this.fire());this._will.value=0},fire:function(){var a=bc.onUpdate;a.touch.copy(this);db.onEvent.dispatchEvent(a)}};var bc=function(a){C.call(this,a);this.touch=new db};bc.__name__="lovedna.events.TouchEvent";bc.prototype=n(C.prototype,{__class__:bc});var Xd=function(){this.width=
this.height=0;this.format="rgba8888";this.magFilter=this.minFilter="linear";this.vWrap=this.uWrap=0};Xd.prototype={decode:function(a){this.name=a.readTinyUTF();this.width=a.readUnsignedShort();this.height=a.readUnsignedShort();this.format=a.readTinyUTF();this.minFilter=a.readTinyUTF();this.magFilter=a.readTinyUTF();this.uWrap=a.readUnsignedByte();this.vWrap=a.readUnsignedByte()}};var Ja=function(){this.rotate=0;this.frame=new bd(0,0,1,1);this.originalSize=new H(1,1);this.offset=new H(0,0);this.index=
0;this.pivot=new H(.5,.5);Ja._uv=H.instance;this.normalzedFrame=new bd;this.border=new lg(0,0,0,0)};Ja.prototype={decode:function(a){this.name=a.readTinyUTF();this.rotate=a.readByte();this.frame.x=a.readUnsignedShort();this.frame.y=a.readUnsignedShort();this.frame.set_width(a.readUnsignedShort());this.frame.set_height(a.readUnsignedShort());this.originalSize.x=a.readUnsignedShort();this.originalSize.y=a.readUnsignedShort();this.offset.x=a.readUnsignedShort();this.offset.y=a.readUnsignedShort();this.index=
a.readUnsignedByte();this.pivot.x=a.readFloat();this.pivot.y=a.readFloat();this.border.setBorder(a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat())},postInit:function(){if(0==this.rotate){var a=this.getUV(0,1);this.normalzedFrame.x=a.x;this.normalzedFrame.y=a.y;a=this.getUV(1,0);this.normalzedFrame.set_width(a.x-this.normalzedFrame.x);this.normalzedFrame.set_height(a.y-this.normalzedFrame.y)}else a=this.getUV(0,0),this.normalzedFrame.x=a.x,this.normalzedFrame.y=a.y,a=this.getUV(1,1),this.normalzedFrame.set_width(a.x-
this.normalzedFrame.x),this.normalzedFrame.set_height(a.y-this.normalzedFrame.y)},copy:function(a){this.name=a.name;this.rotate=a.rotate;this.frame.copy(a.frame);this.normalzedFrame.copy(a.normalzedFrame);this.originalSize.copy(a.originalSize);this.offset.copy(a.offset);this.page=a.page;this.pivot.copy(a.pivot);this.border.copy(a.border);this.index=a.index;this._uv11=this._uv00=null},getUV:function(a,b){if(null==this._uv00)if(this._uv00=new H,this._uv11=new H,0==this.rotate){var c=this._uv00,d=this.frame.x/
this.page.width,e=(this.frame.y+this.frame.w)/this.page.height;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c=this._uv11;d=(this.frame.x+this.frame.z)/this.page.width;e=this.frame.y/this.page.height;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e}else 0<this.rotate?(c=this._uv00,d=this.frame.x/this.page.width,e=this.frame.y/this.page.height,null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._uv11,d=(this.frame.x+this.frame.w)/this.page.width,e=(this.frame.y+this.frame.z)/this.page.height,null==e&&(e=0),null==
d&&(d=0),c.x=d,c.y=e):(c=this._uv00,d=(this.frame.x+this.frame.w)/this.page.width,e=(this.frame.y+this.frame.z)/this.page.height,null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e,c=this._uv11,d=this.frame.x/this.page.width,e=this.frame.y/this.page.height,null==e&&(e=0),null==d&&(d=0),c.x=d,c.y=e);0==this.rotate?(c=Ja._uv,d=this._uv00.x,a=d+(this._uv11.x-d)*a,d=this._uv00.y,b=d+(this._uv11.y-d)*b,null==b&&(b=0),null==a&&(a=0),c.x=a,c.y=b):(c=Ja._uv,d=this._uv00.x,b=d+(this._uv11.x-d)*b,d=this._uv00.y,a=d+
(this._uv11.y-d)*a,null==a&&(a=0),null==b&&(b=0),c.x=b,c.y=a);return Ja._uv},getRectUvs:function(a,b,c,d){null==Ja._uvBuffer?Ja._uvBuffer=new fb:Ja._uvBuffer.clear();if(1>a&&1>b&&1>=c&&1>=d)Ja._uvBuffer.push(this.getUV(a,b)),Ja._uvBuffer.push(this.getUV(a+c,b)),Ja._uvBuffer.push(this.getUV(a+c,b+d)),Ja._uvBuffer.push(this.getUV(a,b+d));else{var e=this.frame.z,f=this.frame.w;Ja._uvBuffer.push(this.getUV(a/e,b/f));Ja._uvBuffer.push(this.getUV((a+c)/e,b/f));Ja._uvBuffer.push(this.getUV((a+c)/e,(b+d)/
f));Ja._uvBuffer.push(this.getUV(a/e,(b+d)/f))}return Ja._uvBuffer}};var Ka=function(){this._list=V.fromArray([]);this.instanceID=Ka._id++;this._count=-1};Ka.prototype={add:function(a){this._inputData=a;this._type=Ka.type_add;this._list.clear();this._resultData=this._then=null;this._table._search(this);return this},update:function(a){this._inputData=a;this._type=Ka.type_update;this._list.clear();this._resultData=this._then=null;this._table._search(this);return this},"delete":function(){this._type=
Ka.type_delete;this._list.clear();this._resultData=this._then=null;this._table._search(this);return this},get:function(){this._type=Ka.type_get;this._list.clear();this._resultData=this._then=null;this._table._search(this);return this},then:function(a){null!=this._resultData?a(this._resultData):this._then=a},_init:function(a,b){this._table=a;this._localStorage=nb.getStorage(a.path);this._searchData=b},_addSearch:function(a){this._list.push(a)},_searchComplete:function(){var a=this._list.get_length();
if(this._type==Ka.type_update){if(0<a){var b=[];this._resultData=b;for(var c=0;c<a;){var d=c++;d=this._table.get(this._list.getArrayElement(d));Q.copyFieldTo(this._inputData,d);b.push(d)}this._table.save()}}else if(this._type==Ka.type_delete){if(0<a){for(this._resultData=b=[];0<a--;)c=this._list.getArrayElement(a),d=this._table.get(c),b.push(d),this._table._list.splice(c,1);this._table.save()}}else if(this._type==Ka.type_add)this._table._list.push(this._inputData),this._table.save(),this._resultData=
this._inputData;else if(this._type==Ka.type_get&&0<a)for(this._resultData=b=[],c=0;c<a;)d=c++,d=this._table.get(this._list.getArrayElement(d)),b.push(d);a=this._then;null!=a&&(this._then=null,a(this._resultData),this._resultData=null);this._list.clear()}};var Ae=function(a,b){this.name=a;this.path=b;this._localStorage=nb.getStorage(b);this._timeCall=new ba(g(this,this.call));this._saveCall=new ba(g(this,this.delaySave))};Ae.prototype={add:function(a){var b=Ka.pool.get();b._init(this,null);return b.add(a)},
search:function(a){var b=Ka.pool.get();b._init(this,a);return b},get:function(a){return null==this._list?null:this._list[a]},save:function(){this._saveCall.start(.04)},_search:function(a){null==this._searchList&&(this._searchList=[]);this._searchList.push(a);this._timeCall.running||this._timeCall.start(.02)},_doSearch:function(a){var b=a._searchData;if(null!=b){var c=this._list.length,d=a._count;a._count=-1;1>d&&(d=100);for(var e=0;e<c;){var f=e++;Q.containsValue(this._list[f],b)&&a._addSearch(f);
--d;if(0>=d)break}}a._searchComplete();this._timeCall.start(.02)},call:function(){var a=this;if(null==this._list)this._localStorage.connect(function(b){a._list=[];b=a._localStorage.get("list");if(null!=b)for(var c=0,e=b.length;c<e;){var f=c++;a._list.push(b[f])}a._timeCall.start(.2)});else if(0<this._searchList.length){var b=this._searchList.shift();this._doSearch(b)}},delaySave:function(){this._localStorage.set("list",this._list);this._localStorage.flush()}};var vd=function(){I.call(this);this._chars=
new X;this.scaleH=this.scaleW=this.base=this.lineHeight=this.italic=this.bold=0;this.pages=1;this.id=this.packed=0};vd.prototype=n(I.prototype,{decode:function(a){this.face=a.readUTF();this.size=a.readInt();this.bold=a.readInt();this.italic=a.readInt();this.lineHeight=a.readInt();this.base=a.readInt();this.scaleW=a.readInt();this.scaleH=a.readInt();this.pages=a.readInt();this.packed=a.readInt();this.id=a.readInt();this.file=a.readUTF();for(var b=this.count=a.readInt();0<b--;){var c=new mg;c.decode(a);
this.addChar(c)}0>this.size&&(this.size=-this.size)},addChar:function(a){this._chars.h[a.id]=a},dispose:function(){I.prototype.dispose.call(this);this._chars=null}});var mg=function(){};mg.prototype={decode:function(a){this.id=a.readInt();this.x=a.readInt();this.y=a.readInt();this.width=a.readInt();this.height=a.readInt();this.xoffset=a.readFloat();this.yoffset=a.readFloat();this.xadvance=a.readFloat();this.page=a.readInt()}};var he=function(){this.intValues=new L;this.floatValues=new L;this.stringValues=
new L};he.prototype={};var hf=function(){this._meta=new L};hf.prototype={get:function(a){var b=this._meta;return null!=q[a]?b.getReserved(a):b.h[a]},addInfo:function(a,b){var c=this._meta;null!=q[a]?c.setReserved(a,b):c.h[a]=b;"path"==a?this.path=b:"crc"==a?this.crc=b:"size"==a&&(this.size=b)},read:function(a){for(var b=ja.fields(a),c=b.length;0<c--;){var d=b[c];this.addInfo(d,Q.getValue(a,d))}}};var xd=function(){this._IEND=new wd;this._IEND.type=1229278788;this._chunkList=[];if(null==xd._keepType){xd._keepType=
new X;for(var a=[1229472850,1229209940,1229278788,1665684045,1732332865,1933723988,1347179589,1649100612,1749635924,1951551059],b=a.length;0<b--;)xd._keepType.h[a[b]]=!0}};xd.prototype={dispose:function(){this._IEND.dispose();this._bytes=null;if(null!=this._chunkList){for(var a=this._chunkList.length;0<a--;){var b=this._chunkList[a];null!=b&&b.dispose()}this._chunkList=null}},decode:function(a){var b=this._chunkList.length;0<b&&this._chunkList.splice(0,b);if(ta.gt(12,a._length-a.position))return!1;
a.bigEndian=!0;b=a.position;a.position=b+8;var c=a.readInt();if(100<c&&(a.position=b+8,c=a.readInt(),100<c)||1229472850!=a.readInt())return!1;for(a.position=b+8;ta.gt(a._length-a.position,0);){b=new wd;b.decode(a);c=b.type;if(1>c)break;1229278788==c?this._IEND=b:this.addChunk(b)}a=this.getChunk(1229472850);null!=a&&(a=a.getContent(),a.bigEndian=!0,this.width=a.readUnsignedInt(),this.height=a.readUnsignedInt(),a.bigEndian=!1);return!0},getChunk:function(a){for(var b=this._chunkList.length;0<b--;){var c=
this._chunkList[b];if(c.type==a)return c}return null},addChunk:function(a){this._chunkList.push(a)}};var wd=function(){};wd.prototype={dispose:function(){this._content=null},decode:function(a){var b=a.readUnsignedInt();this.type=a.readUnsignedInt();this._content=wa._new();0<b&&a.readBlob(this._content,0,b);this._crc=a.readInt()},getContent:function(){this._content.bigEndian=!1;return this._content}};var ob=function(){this.instanceID=ob._id++};ob.pop=function(a,b){var c=ob._pool.get();c.set(a,b);return c};
ob.push=function(a){ob._pool.set(a)};ob.prototype={set:function(a,b){this.component=a;this.state=b}};var ng=function(){this.type=0;this.color=new F(0,0,0,0)};ng.prototype={};var la=B.lovedna.game.Game=function(){I.call(this);this._running=!0;this._timeScale=1;this._system=new da;this._system.addEventListener(ua.init._type,g(this,this.sysinit));this._system.addEventListener(ua.resize._type,g(this,this.resize));Sa.systemDispatcher.addEventListener(C.blur._type,g(this,this.systemBlur));Sa.systemDispatcher.addEventListener(C.focus._type,
g(this,this.systemFocus));la._current=this;null!=la._args&&null==this._glContext&&this._system.setup(la._args);this.fps=new og;U.init();this._pauseStep=this.isPaused=!1;this.debugFrame=-1;this.backgroundColor=new F(0,0,0,0);this._worldList=V.fromArray([]);this._debugRender=new pg;this._property=new zb;this._timeData=new ya;this._sinTimeData=new ya;this._cosTimeData=new ya;this._deltaTimeData=new ya;this._property.setFloat4(k.toString(k.TIME),this._timeData);this._property.setFloat4(k.toString(k.TIME_SIN),
this._sinTimeData);this._property.setFloat4(k.toString(k.TIME_COS),this._cosTimeData);this._property.setFloat4(k.toString(k.TIME_DELTA),this._deltaTimeData)};la.config=function(a){la._args=a;null!=la.getParam("version")&&(la.version=la.getParam("version"));null!=la.main&&(la.main.startGameMain(la._args),la.main=null);null!=la._current&&la._current._system.setup(a)};la.getParam=function(a){return null!=la._args&&Q.exist(la._args,a)?Q.getValue(la._args,a):null};la.prototype=n(I.prototype,{step:function(){this._running=
this._pauseStep=!0},onInit:function(a){this._onInitHandler=a;Q.setValue(la._args,"system",la._current._system);null!=this._glContext&&null!=this._onInitHandler&&this._onInitHandler()},addWorld:function(a){a.width=this._width;a.height=this._height;this._worldList.remove(a);this._worldList.push(a);a._now=oa._custom()},removeWorld:function(a){this._worldList.remove(a)},getBufferContext:function(){return this._cmdContext},systemBlur:function(a){E._focused||(a=oa._custom()-E._blurTime,E._offset+=a,E._blurTime=
0);E._blurTime=oa._custom()},systemFocus:function(a){a=oa._custom()-E._blurTime;E._offset+=a;E._blurTime=0},sysinit:function(a){this._system.addEventListener(ua.update._type,g(this,this.update));this._glContext=new lb(this._system.glcontext);this._property.setFloat4(k.toString(k.SCREEN_PARAMS),this._glContext.screenParams);this._cmdContext=new qg;this._width=this._system.width;this._height=this._system.height;ea.setSize(this._width,this._height);null!=this._onInitHandler&&this._onInitHandler();E.init()},
update:function(a){r.update();this.dispatchEvent(C.update);if(this._running){E.step(this._timeScale);a=E.time;var b=this._timeData,c=a/20,d=a,e=2*a,f=3*a;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;b=this._sinTimeData;c=Math.sin(a/8);d=Math.sin(a/4);e=Math.sin(a/2);f=Math.sin(a);null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;b=this._cosTimeData;c=Math.cos(a/8);d=Math.cos(a/4);e=Math.cos(a/2);a=Math.cos(a);null==a&&(a=1);
null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=a;e=E.smoothDeltaTime;a=this._deltaTimeData;b=e;c=1/e;d=e;e=1/e;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;this._glContext.begin(this._width,this._height);b=Z.add();b.setViewport(0,0,this._width,this._height);a=ea.renderBuffer;null!=a&&b.pushRenderTarget(a);b.clearRenderTarget(this.backgroundColor,1,0);b.setGlobalProperty(this._property);if(null!=this.onUpdate)this.onUpdate();b=0;for(c=this._worldList.get_length();b<
c;)d=b++,Qa.reset(),this._worldList.get(d)._update();null!=a&&(b=Z.add(),b.popRenderTarget(),b.blit(a,null,ea.renderBufferMaterial));this._debugRender.render(this.debugCamera);this._cmdContext.clear();this._cmdContext.glContext=this._glContext;this._cmdContext.stopActionIndex=this.debugFrame;Z.flush(this._cmdContext);this.debugFrame=this._cmdContext.stopActionIndex}G.isPlaying||(this.isPaused=!0);this._timeScale=-1<this.debugFrame?0:1;this._running=this.isPaused||-1<this.debugFrame?!1:!0;r.lateUpdate();
this.fps.step(E.get_now());v._endFrame()},resize:function(a){this._width=a.vintlist[0];this._height=a.vintlist[1];ea.setSize(this._width,this._height);for(a=this._worldList.get_length();0<a--;){var b=this._worldList.getArrayElement(a);b.width=this._width;b.height=this._height;b._resized=!0}}});var og=function(){this.cacheCount=this.currentFPS=0;this.times=[]};og.prototype={step:function(a){for(this.times.push(a);this.times[0]<a-1;)this.times.shift();a=this.times.length;this.currentFPS=Math.round((a+
this.cacheCount)/2);this.cacheCount=a}};var Va=function(){this.modifier=new ib;this.deviceId=this.deviceType=0;this.type=-1;this.instanceID=Va._id++};Va.prototype={copy:function(a){this.deviceId=a.deviceId;this.deviceType=a.deviceType;this.type=a.type;this.keyCode=a.keyCode;this.value=a.value;this.key=a.key;this.modifier.value=a.modifier.value},trigger:function(){var a=Da.onUpdate;a.key=this;Va.onEvent.dispatchEvent(a)},get_id:function(){return 1E4*this.deviceType+1E3*this.deviceId+this.keyCode}};
var Na=function(a){if(null==a)this.data=new ib(-1);else{this.data=new ib(0);for(var b=a.length;0<b--;){var c=Na.nameToLayer(a[b]);this.data.setArrayElement(c)}0==this.data.value&&(this.data.value=-1)}};Na.setLayerName=function(a,b){if(null==Na._names[a]){Na._names[a]=b;var c=Na._layers;null!=q[b]?c.setReserved(b,a):c.h[b]=a}};Na.nameToLayer=function(a){var b=Na._layers;return null!=q[a]?b.getReserved(a):b.h[a]};Na.prototype={add:function(a){this.data.setArrayElement(a)},exist:function(a){return this.data.getArrayElement(a)}};
var r=function(){};r.raycastCollider=function(a,b){if(!b.enabled||!a.layerMask.exist(b.actor.layer))return!1;null==a.world&&(a.world=ld.current);var c=a.maxDistance;a.maxDistance=c*c;b=b.raycast(a);a.maxDistance=c;return b?!0:!1};r.touchDown=function(a,b){null==b&&(b=!1);null==a&&(a=0);0>a&&(a=0);var c=r._touchDown.get_length();if(1>c)return!1;if(b){if(a>=r._touchsWithIndex.get_length())return!1;b=r._touchsWithIndex.get(a);if(null==b)return!1;a=b.touchId}for(;0<c--;)if(b=r._touchDown.get(c),b.touchId==
a)return!0;return!1};r.touchUp=function(a,b){null==b&&(b=!1);null==a&&(a=0);0>a&&(a=0);var c=r._touchUp.get_length();if(1>c)return!1;if(b){if(a>=r._touchsWithIndex.get_length())return!1;b=r._touchsWithIndex.get(a);if(null==b)return!1;a=b.touchId}for(;0<c--;)if(b=r._touchUp.get(c),b.touchId==a)return!0;return!1};r.getTouch=function(a,b){null==b&&(b=!1);null==a&&(a=0);0>a&&(a=0);if(b){if(a>=r._touchsWithIndex.get_length())return null;a=r._touchsWithIndex.get(a);if(null==a)return null;a=a.touchId}return r._touchsWithTouchId.get(a)};
r.wheel=function(){return r._wheeling};r.getWheel=function(){return r._wheelValue};r.getKey=function(a,b){null==b&&(b=-1);for(var c=r._activeKeys.iterator();c.hasNext();){var d=c.next();if(d.keyCode==a&&(-1==b||b==d.deviceId))return d}return null};r.keyDown=function(a,b){null==b&&(b=-1);for(var c=r._keyDownList.get_length();0<c--;){var d=r._keyDownList.get(c);if(0>a&&0>b||0>b&&d.keyCode==a||0>a&&b==d.deviceId||d.keyCode==a&&b==d.deviceId)return r._currentKey=d,!0}r._currentKey=null;return!1};r.update=
function(){r._init||(r._init=!0,r.touchCount=0,r._frame=0,db.onEvent.addEventListener(bc.onUpdate._type,r.ontouch),Ua.onWheel.addEventListener(ac.onUpdate._type,r.onWheel),Va.onEvent.addEventListener(Da.onUpdate._type,r.onkey),r._wheeling=!1,r._wheelValue=new h);r._frame++;var a=r._touchBuffer.get_length();if(0<a)for(var b=0;b<a;){var c=b++;c=r._touchBuffer.get(c);5==c.type?r._touchUp.push(c):(r._touchDown.push(c),r._touchsWithIndex.push(c));r._touchsWithTouchId.setArrayElement(c.touchId,c)}r._touchBuffer.clear();
r.touchCount=r._touchsWithIndex.get_length();a=0;for(b=r._keyBuffer.get_length();a<b;){c=a++;c=r._keyBuffer.get(c);var d=c.get_id();r._activeKeys.h.hasOwnProperty(d)||(r._activeKeys.h[d]=c);1==c.type?r._keyDownList.push(c):r._keyUpList.push(c)}r._keyBuffer.clear()};r.lateUpdate=function(){var a=r._touchUp.get_length();if(0<a){for(;0<a--;){var b=r._touchUp.get(a);r.removeTouch(b);r._touchPool.set(b)}r.maxTouchId=0;for(a=r._touchsWithTouchId.get_length();0<a--;)if(null!=r._touchsWithTouchId.get(a)){r.maxTouchId=
a+1;break}}r._touchDown.clear();r._touchUp.clear();r._wheeling=!1;r._wheelValue.set(0,0,0);r._keyDownList.clear();for(a=r._keyUpList.get_length();0<a--;)b=r._keyUpList.get(a),r._activeKeys.remove(b.get_id()),r._keyPool.set(b);r._keyUpList.clear()};r.ontouch=function(a){a=bc.onUpdate.touch;var b=a.type,c=a.touchId;2==b?(b=r._touchsWithTouchId.getArrayElement(c),null!=b&&b.copy(a)):1==b?(b=r.getTouchFromBuffer(a),null==b&&(b=r._touchPool.get()),b.copy(a),r._touchBuffer.push(b)):5==b&&(b=r.getTouchFromBuffer(a),
null==b&&(b=r._touchPool.get()),b.copy(a),r._touchBuffer.push(b))};r.getTouchFromBuffer=function(a){for(var b=r._touchBuffer.get_length();0<b--;){var c=r._touchBuffer.getArrayElement(b);if(c.type==a.type&&c.touchId==a.touchId&&c.device==a.device)return c}return null};r.onWheel=function(a){r._wheelValue.copy(ac.onUpdate.value);r._wheeling=!0};r.onkey=function(a){a=Da.onUpdate.key;if(null!=a){var b=a.get_id();b=r._activeKeys.h[b];if(null==b)if(2==a.type)for(b=r._keyBuffer.get_length();0<b--;){if(r._keyBuffer.get(b).get_id()==
a.get_id()){r._keyBuffer.removeAt(b);break}}else b=r._keyPool.get(),b.copy(a),r._keyBuffer.push(b);else 1!=a.type&&(b.copy(a),r._keyBuffer.push(b))}};r.removeTouch=function(a){r._touchsWithTouchId.setArrayElement(a.touchId,null);for(var b=r._touchsWithIndex.get_length();0<b--;)r._touchsWithIndex.getArrayElement(b).touchId==a.touchId&&r._touchsWithIndex.removeAt(b)};var E=function(){};E.init=function(){E._time=E.get_now();E._fixedTime=0;E.fixedCount=0;E.time=0;E.frame=0;E.smoothDeltaTime=E.fixedTime};
E.step=function(a){null==a&&(a=1);var b=E.get_now();E.deltaTime=(b-E._time)*a;E._time=b;E.deltaTime>E.fixedTime?E.deltaTime=E.fixedTime:0>E.deltaTime&&(E.deltaTime=0);b=E.smoothDeltaTime;E.smoothDeltaTime=(b+.05*(E.deltaTime-b))*a;E.time+=E.smoothDeltaTime;E._fixedTime+=E.smoothDeltaTime;for(E.fixedCount=0;E._fixedTime>=E.fixedTime;)E.fixedCount++,E._fixedTime-=E.fixedTime;E.frame++};E.get_now=function(){return oa._custom()-E._offset};var Ma=function(){this.id=Ma._id--};Ma.deleteGeometryBuffer=function(a){if(Ma._bufferMap.h.hasOwnProperty(a)){var b=
Ma._bufferMap.h[a];Ma._bufferMap.remove(a);b.dispose()}};Ma.prototype={check:function(){return null!=this.gpuBuffer&&this.gpuBuffer.enabled?!0:!1},fromBuffer:function(a){this.id=a.instanceID;Ma._bufferMap.h.hasOwnProperty(this.id)?this.gpuBuffer=Ma._bufferMap.h[this.id]:(this.gpuBuffer=new Kb,Ma._bufferMap.h[this.id]=this.gpuBuffer,this.gpuBuffer.set(a));return this},dispose:function(){this.gpuBuffer=null}};var Md=function(){this.normal=new h;this.point=new h};Md.prototype={};var rg=function(){this.ray=
new Ab;this.result=new S;this.layerMask=new Na;this.maxDistance=9999999};rg.prototype={add:function(a){this.result.push(a)}};var ea=function(){};ea.setSize=function(a,b){ea.width=a;ea.height=b};var ld=function(){mb.call(this);this.timeScale=1;this._dirty=this.enabled=this.visible=!0;this.set_dirty(!0);this._resized=!0;this._now=oa._custom();this.actor=new v;this.actor._connectWorld(this);this._actorList=new S;this._actorMap=new X;this._fixedList=new S;this._updateList=new S;this._fixedRemoveIds=new S;
this._addMap=new X;this._collectorMap=new L;this._collectorList=[];this.collectorCamera=new sg(this.instanceID);this.collectorRenderer=new tg(this.instanceID);this.collectorCollider=new ug(this.instanceID);this.collectorLight=new vg(this.instanceID);this.addCollector(this.collectorCamera);this.addCollector(this.collectorRenderer);this.addCollector(this.collectorCollider);this.addCollector(this.collectorLight)};ld.prototype=n(mb.prototype,{addChild:function(a){this.actor.get_transform().addChild(a.get_transform());
this.set_dirty(!0)},addCollector:function(a){-1==this._collectorList.indexOf(a)&&this._collectorList.push(a)},_update:function(){if(this.enabled){ld.current=this;Wa.current=this.collectorCamera.get(0);this.frame=E.frame;var a=E.smoothDeltaTime*this.timeScale,b=E.fixedTime,c=E.fixedCount,d=this._resized;this._resized=!1;this._fixedList.clear();this._updateList.clear();for(var e=this._actorList.get_length(),f,l=0;l<e;)if(f=l++,f=this._actorList.get(f),f._enabled){f._frameStart(a);if(0<c){var g=u.onFixedUpdate._type;
if(null==f.__eventMap)g=!1;else{var h=f.__eventMap;g=null!=q[g]?h.existsReserved(g):h.h.hasOwnProperty(g)}g&&this._fixedList.push(f)}this._updateList.push(f)}e=this._fixedList.get_length();if(0<c)for(;0<c--;)for(a=0,l=e;a<l;)f=a++,f=this._fixedList.get(f),f._fixedUpdate(b);e=this._updateList.get_length();b=0;for(c=e;b<c;)f=b++,f=this._updateList.getArrayElement(f),f._update();b=0;for(c=e;b<c;)f=b++,f=this._updateList.getArrayElement(f),e=this.frame,f.get_transform().checkChanged(),f.dispatchEvent(u.onLateUpdate),
d&&f.dispatchEvent(u.onScreenResize),f.get_transform()._updateTransform(e),f.frame=e;if(this.visible)for(e=this.collectorCamera.count,d=0,f=e;d<f;)b=d++,b=this.collectorCamera.get(b),b.beforeRender(),b.render();this.collectActors()}},collectActors:function(){if(this._dirty){this._dirty=!1;for(var a=this._actorList.get_length();0<a--;){var b=this._actorList.get(a);this._addMap.h[b.instanceID]=b}this._actorList.clear();this.actor._collectActors(this._actorList);for(a=this._actorList.get_length();0<
a--;)b=this._actorList.get(a),b.sortId=a,this._actorMap.h.hasOwnProperty(b.instanceID)||(b._connectWorld(this),this._actorMap.h[b.instanceID]=b),this._addMap.remove(b.instanceID);for(a=this._addMap.iterator();a.hasNext();)b=a.next(),b._disconnectWorld(),this._addMap.remove(b.instanceID),this._actorMap.remove(b.instanceID)}},addComponent:function(a){this._dirty=!0;var b=a.classType,c=this._collectorMap;if(null!=q[b]?c.existsReserved(b):c.h.hasOwnProperty(b))c=this._collectorMap,(null!=q[b]?c.getReserved(b):
c.h[b]).add(a);else for(c=this._collectorList.length;0<c--;){var d=this._collectorList[c];if(d.exist(a)){d.add(a);var e=this._collectorMap;null!=q[b]?e.setReserved(b,d):e.h[b]=d}}},removeComponent:function(a){var b=a.classType,c=this._collectorMap;if(null!=q[b]?c.existsReserved(b):c.h.hasOwnProperty(b))c=this._collectorMap,(null!=q[b]?c.getReserved(b):c.h[b]).remove(a)},set_dirty:function(a){return this._dirty=!0}});var sg=function(a){this.id=a;this._dirty=!1;this.count=0;this._cameras=new X;this._list=
[]};sg.prototype={exist:function(a){return a instanceof Wa},add:function(a){this._cameras.h.hasOwnProperty(a.instanceID)||(this._cameras.h[a.instanceID]=a,this._dirty=!0,this._list.push(a),this.count=this._list.length)},remove:function(a){this._cameras.h.hasOwnProperty(a.instanceID)&&(this._cameras.remove(a.instanceID),y.remove(this._list,a),this.count=this._list.length)},get:function(a){this._dirty&&this._list.sort(g(this,this.sort));return this._list[a]},sort:function(a,b){return a.depth!=b.depth?
a.depth>b.depth?1:-1:0}};var ug=function(a){this.id=a;this._list=[];this.count=0;this._map=new X};ug.prototype={exist:function(a){return a instanceof Vc},add:function(a){this._map.h.hasOwnProperty(a.instanceID)||(this._map.h[a.instanceID]=this._list.length,this._list.push(a),this.count=this._list.length)},remove:function(a){if(this._map.h.hasOwnProperty(a.instanceID)){var b=this._map.h[a.instanceID];this._list.splice(b,1);this._map.remove(a.instanceID);a=b;for(b=this._list.length;a<b;){var c=a++;
this._map.h[this._list[c].instanceID]=c}this.count=this._list.length}}};var vg=function(a){this.id=a;this._dirty=!1;this.count=0;this._map=new X;this._list=[]};vg.prototype={exist:function(a){return a instanceof nd},add:function(a){this._map.h.hasOwnProperty(a.instanceID)||(this._map.h[a.instanceID]=a,this._dirty=!0,this._list.push(a),this.count=this._list.length)},remove:function(a){this._map.h.hasOwnProperty(a.instanceID)&&(this._map.remove(a.instanceID),y.remove(this._list,a),this.count=this._list.length)},
get:function(a){return this._list[a]}};var tg=function(a){this.id=a;this._list=[];this.count=0;this._map=new X;this._bounds=new X};tg.prototype={exist:function(a){return a instanceof Ba},add:function(a){this._map.h.hasOwnProperty(a.instanceID)||(this._map.h[a.instanceID]=this._list.length,this._list.push(a),this.count=this._list.length)},remove:function(a){if(this._map.h.hasOwnProperty(a.instanceID)){var b=a.instanceID;this._bounds.remove(b);b=this._map.h[b];this._list.splice(b,1);this._map.remove(a.instanceID);
a=b;for(b=this._list.length;a<b;){var c=a++;this._map.h[this._list[c].instanceID]=c}this.count=this._list.length}},setCullCamera:function(a){this._camera=a;this._frustum=this._camera.frustum;this._maxDistance=this._camera.farClipPlane*this._camera.farClipPlane},cull:function(a,b){null==b?this._bounds.h.hasOwnProperty(a)&&(b=this._bounds.h[a]):this._bounds.h[a]=b;if(null==b)return 0;a=this._camera.eye.distanceSquared(b.sphere.center);if(a>this._maxDistance)return-1;var c=b.sphere;return null!=c&&this._frustum.containsPoint(c.center,
c.radius)&&this._frustum.intersectsBox(b.box)?a:-1}};var Vc=function(){I.call(this)};Vc.__name__="lovedna.game.components.Collider";Vc.prototype=n(fa.prototype,{raycast:function(a){return!1},onAwake:function(){fa.prototype.onAwake.call(this);this._transformFrame=-1;this.enabled=!0},__class__:Vc});var Kd=function(){I.call(this)};Kd.__name__="lovedna.game.components.BoxCollider";Kd.prototype=n(Vc.prototype,{raycast:function(a){var b=this.get_bounds(),c=a.ray.intersectSphere(b.sphere);if(null==c)return!1;
c=a.ray.intersectBox(b.box);if(null==c||c.distanceSquared(a.ray.start)>a.maxDistance)return!1;b=Md._pool.get();b.actor=this.actor;b.collider=this;b.point.copy(c);b.distance=c.distance(a.ray.start);a.add(b);return!0},onAwake:function(){Vc.prototype.onAwake.call(this);this.center=new h;this.size=new h(1,1,1);this._bounds=new Nd},get_bounds:function(){if(this.enabled&&this._transformFrame<this.actor.get_transform().transformFrame){this._transformFrame=this.actor.get_transform().transformFrame;this._bounds.reset();
var a=h._pool.get().copy(this.size);a.scale(.5);this._bounds.expand(a.add(this.center));a.copy(this.size).scale(-.5);this._bounds.expand(a.add(this.center));this._bounds.multiplyMatrix44(this.actor.get_transform().getLocalToWorld())}return this._bounds},__class__:Kd});var Wa=function(){I.call(this)};Wa.__name__="lovedna.game.components.Camera";Wa.prototype=n(fa.prototype,{screenToViewportPoint:function(a){var b=p.lerpTo(0,1,-1,1,a.x),c=p.lerpTo(0,1,1,-1,a.y);return h._pool.get().set(b,c,a.z)},viewportToWorldPoint:function(a){var b=
h._pool.get().set(a.x,a.y,-1),c=h._pool.get().copy(b);c.z=1;this.projectionViewInverseMatrix.transformPoint(b,!0);this.projectionViewInverseMatrix.transformPoint(c,!0);a=a.z/(this.farClipPlane-this.nearClipPlane);return c.sub(b).scale(a).add(b)},worldToViewport:function(a){a=h._pool.get().copy(a);this.projectionViewMatrix.transformPoint(a,!0);return a},screenToWorldPoint:function(a){return this.viewportToWorldPoint(this.screenToViewportPoint(a))},viewportPointToRay:function(a){a=h._pool.get().set(a.x,
a.y,-1);var b=h._pool.get().copy(a);b.z=1;this.projectionViewInverseMatrix.transformPoint(a,!0);this.projectionViewInverseMatrix.transformPoint(b,!0);return Ab.get_temp().set(a,b)},ScreenPointToRay:function(a){return this.viewportPointToRay(this.screenToViewportPoint(a))},beforeRender:function(){this.enabled&&null!=this._renderPipeline&&this._renderPipeline.collectRenderer()},render:function(){this.enabled&&null!=this._renderPipeline&&this._renderPipeline.render()},onConstruct:function(){fa.prototype.onConstruct.call(this);
this.updateFrame=0;Wa.current=this;this.clearFlags=new ng;this.cullingMask=new Na;this.orthographic=!1;this.orthographicScale=1;this.depth=0;this.enabled=!0;this.viewMatrix=this.worldToCameraMatrix=new za;this.viewInverseMatrix=this.cameraToWorldMatrix=new za;this.projectionMatrix=new za;this.projectionViewMatrix=new za;this.projectionViewInverseMatrix=new za;this.nearClipPlane=.1;this.farClipPlane=2E3;this.fieldOfView=60;this.projectionParams=new ya(this.nearClipPlane,this.farClipPlane,this.fieldOfView,
0);this.frustum=new wg;this._orthographicParams=new ya;this.eye=new h;this.fog=new ya(80,300,0,.5);this.fogColor=new F(0,0,0,0);this.property=new zb;this.property.setMatrix(k.toString(k.P),this.projectionMatrix);this.property.setMatrix(k.toString(k.V),this.viewMatrix);this.property.setMatrix(k.toString(k.IV),this.viewInverseMatrix);this.property.setMatrix(k.toString(k.VP),this.projectionViewMatrix);this.property.setMatrix(k.toString(k.IVP),this.projectionViewInverseMatrix);this.property.setMatrix(k.toString(k.IVP),
this.projectionViewInverseMatrix);this.property.setFloat4(k.toString(k.PROJECTION_PARAMS),this.projectionParams);this.property.setFloat4(k.toString(k.ORTHOGRAPHIC_PARAMS),this._orthographicParams);this.property.setFloat3(k.toString(k.EYE),this.eye);this.property.setFloat4(k.toString(k.FOG),this.fog);this.property.setFloat4(k.toString(k.FOG_COLOR),this.fogColor);Wa.current=this;this._renderPipeline=new xg(this)},onStart:function(){fa.prototype.onStart.call(this);this._orthographicParams.x=this.actor.world.width;
this._orthographicParams.y=this.actor.world.height;this._aspect=this._orthographicParams.x/this._orthographicParams.y;this.bindEvent(u.onScreenResize,g(this,this.screenResize));this.bindEvent(u.onTransformComplete,g(this,this.transformComplete))},screenResize:function(a){this._orthographicParams.x=this.actor.world.width;this._orthographicParams.y=this.actor.world.height;this._aspect=this._orthographicParams.x/this._orthographicParams.y},transformComplete:function(a){this.updateCamera()},updateCamera:function(){var a=
!1;if(this.projectionParams.x!=this.nearClipPlane||this.projectionParams.y!=this.farClipPlane||this.projectionParams.z!=this.fieldOfView||this.projectionParams.w!=this._aspect||this._orthographicParams.z!=(this.orthographic?1:0)||this._orthographicParams.w!=this.orthographicScale){a=this.projectionParams;var b=this.nearClipPlane,c=this.farClipPlane,d=this.fieldOfView,e=this._aspect;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e;this._orthographicParams.z=this.orthographic?
1:0;this._orthographicParams.w=this.orthographicScale;this.orthographic?(a=this._orthographicParams.x,b=this._orthographicParams.y,this.projectionMatrix.setOrtho(-a*this.orthographicScale,a*this.orthographicScale,-b*this.orthographicScale,b*this.orthographicScale,this.nearClipPlane,this.farClipPlane)):this.projectionMatrix.setProjection(this.nearClipPlane,this.farClipPlane,this.fieldOfView,this._aspect);a=!0}this.transform.transformFrame>this.updateFrame&&(this.updateFrame=this.transform.transformFrame,
this.eye.copy(this.actor.get_transform().get_worldPosition()),a=this.actor.get_transform().get_worldRotation().rotate(h.get_forward()),a.scale(this.farClipPlane-this.nearClipPlane).add(this.eye),this.viewMatrix.lookAt(this.eye,a,this.actor.get_transform().get_worldRotation().rotate(h.get_up())),a=!0);a&&(this.projectionViewMatrix.copy(this.projectionMatrix),this.projectionViewMatrix.append(this.viewMatrix),this.viewInverseMatrix.copy(this.viewMatrix),this.viewInverseMatrix.inverse(),this.frustum.multiplyMatrix44(this.projectionViewMatrix),
this.projectionViewInverseMatrix.copy(this.projectionViewMatrix),this.projectionViewInverseMatrix.inverse(),this.updateFrame=this.transform.transformFrame,this.actor.dispatchEvent(u.onCameraUpdate))},__class__:Wa});var md=function(){I.call(this)};md.__name__="lovedna.game.components.CameraAlignWithView";md.prototype=n(fa.prototype,{setView:function(a,b,c){1>a||1>b||(this.scale=1,this._width=a,this._height=b,this.width=this._width,this.height=this._height,this._callback=c,null==this.camera&&(this.camera=
this.actor.getComponent(Wa)),this.dirty())},onAwake:function(){fa.prototype.onAwake.call(this);this._dirty=!1;this._width=this._height=0;this.scale=1},onStart:function(){fa.prototype.onStart.call(this);this.camera=this.actor.getComponent(Wa)},dirty:function(){this._dirty=!0;this.bindEvent(u.onLateUpdate,g(this,this.onUpdate))},onUpdate:function(a){this.refresh()},refresh:function(){if(this._dirty&&null!=this.camera&&!(1>this._width||1>this._height||1>this.camera.updateFrame)){this._dirty=!1;var a=
h._pool.get(),b=h._pool.get(),c=h._pool.get();a.set(-1,-1,1);b.set(1,1,1);c.set(-1,-1,-1);this.camera.projectionViewInverseMatrix.transformPoint(a,!0);this.camera.projectionViewInverseMatrix.transformPoint(b,!0);c.copy(b);c.y=a.y;var d=a.distance(c);c.copy(b);c.x=a.x;b=a.distance(c);a=ea.width/ea.height;c=this.camera.farClipPlane-this.camera.nearClipPlane;this._width/this._height>a?(d=this._width/d*c,this.camera.transform.position.z=d,this.height=this._width/a,this.scale=ea.width/this._width):(d=
this._height/b*c,this.camera.transform.position.z=d,this.width=this._height*a,this.scale=ea.height/this._height);this.camera.transform.position.set(.5*this._width,.5*this._height,d);this.distance=d;null!=this._callback&&(this._callback(this),this._callback=null)}},__class__:md});var qe=function(){this.maxy=89.9;this.miny=-89.9;I.call(this)};qe.__name__="lovedna.game.components.CameraControl";qe.prototype=n(fa.prototype,{onAwake:function(){fa.prototype.onAwake.call(this);this._touchCount=0;this.target=
new h;this._rotationStart=new h;this._rotationEnd=new h;this.distance=this.speed=10;this.miny=-89.9;this.maxy=89.9;this.moveDelta=this.zoomDelta=1;this._rotationCurrent=new h;this.scaleRotationY=this.scaleRotationX=.5;this._distanceCurrent=this._distanceEnd=200;this._rotationTouchStart=new h;this._rotationTouchEnd=new h;this._moveTouchStart=new h;this._moveTouchEnd=new h;this._positionStart=new h;this._positionEnd=new h;this._position1=new h;this._position2=new h;this._twoDistance=0},onStart:function(){fa.prototype.onStart.call(this);
this._camera=this.actor.getComponent(Wa);null!=this._camera&&(this._actorRotation=this.actor.get_transform().rotation,this.bindEvent(u.onUpdate,g(this,this.onUpdate2)),this._distanceCurrent=this._distanceEnd=this.distance,this._actorRotation.getEulerAngles(this._rotationCurrent),this._rotationEnd.copy(this._rotationCurrent),this._rotationStart.copy(this._rotationCurrent),this.actor.get_transform().position.copy(this._actorRotation.rotate(h.get_forward()).scale(-this._distanceCurrent).add(this.target)))},
onUpdate2:function(a){var b=r.touchCount;b!=this._touchCount&&(this._touchCount=b,this._twoDistance=this._state=0);if(!(2<this._touchCount)){a=this.actor.deltaTime;var c=h.instance;r.wheel()&&(this._distanceEnd+=0<r.getWheel().y?this.zoomDelta:-this.zoomDelta);if(1==b){b=r.getTouch(0,!0);if(null==b)return;0==this._state&&(0>=b.pressure&&2==b.touchId||null!=r.getKey(32)?(this._moveTouchStart.copy(b.position),this._positionStart.copy(this.target),this._state=2):(this.actor.get_transform().rotation.getEulerAngles(this._rotationStart),
this._rotationCurrent.copy(this._rotationStart),this._rotationTouchStart.copy(b.position),this._state=1));2==this._state?this._moveTouchEnd.copy(b.position):1==this._state&&this._rotationTouchEnd.copy(b.position)}else if(2==b){var d=r.getTouch(0,!0),e=r.getTouch(1,!0);if(0>d.pressure||null==d||null==e)return;if(0==this._state)if(b=d.position.distance(e.position),0>=this._twoDistance)this._twoDistance=b,this._position1.copy(d.position),this._position2.copy(e.position);else{d=h._pool.get().copy(d.position).lerpTo(e.position,
.5);e=h._pool.get().copy(this._position1).lerpTo(this._position2,.5);e=d.distance(e);var f=p.abs(this._twoDistance-b);if(.008<f||.008<e)f>e?(this._state=3,this._touchZoomStart=this._distanceEnd,this._touchZoom=b,this._twoDistance=0):(this._state=2,this._positionStart.copy(this.target),this._moveTouchStart.copy(d),this._moveTouchEnd.copy(d))}else 3==this._state?(b=d.position.distance(e.position)-this._touchZoom,this._distanceEnd=this._touchZoomStart-b*this.zoomDelta*15):2==this._state&&(b=h._pool.get().copy(d.position).lerpTo(e.position,
.5),this._moveTouchEnd.copy(b))}else 1>b&&(this._twoDistance=this._state=0,this._moveTouchEnd.copy(this._moveTouchStart),this._positionStart.copy(this.target));b=this._distanceCurrent;this._distanceCurrent=b+(this._distanceEnd-b)*a*this.speed;c.copy(this._rotationTouchEnd).sub(this._rotationTouchStart);c.x=360*c.x*this.scaleRotationY;c.y=360*c.y*this.scaleRotationX;this._rotationEnd.copy(this._rotationStart);this._rotationEnd.x+=c.y;this._rotationEnd.y-=c.x;this._rotationCurrent.lerpTo(this._rotationEnd,
a*this.speed);this._rotationCurrent.x>this.maxy&&(this._rotationCurrent.x=this.maxy);this._rotationCurrent.x<this.miny&&(this._rotationCurrent.x=this.miny);this._actorRotation.setEulerAngles(this._rotationCurrent.x,this._rotationCurrent.y,this._rotationCurrent.z);c.copy(this._moveTouchEnd).sub(this._moveTouchStart);this.target.copy(this._positionStart);this.target.add(this.actor.get_transform().get_worldRotation().get_right().scale(c.x*this.moveDelta*this._distanceEnd));this.target.add(this.actor.get_transform().get_worldRotation().get_up().scale(c.y*
this.moveDelta*this._distanceEnd));this.actor.get_transform().position.copy(this._actorRotation.rotate(h.get_forward()).scale(-this._distanceCurrent).add(this.target))}},__class__:qe});var nd=function(){I.call(this)};nd.__name__="lovedna.game.components.Light";nd.prototype=n(fa.prototype,{onAwake:function(){fa.prototype.onAwake.call(this);this.position=new h;this.direction=new h;this.ambient=new h(1,1,1);this.specular=new ya(0,0,0,10);this.property=new zb;this.property.enableDefine(k.toString(k.LIGHT));
this.property.setFloat3(k.LIGHT_POSITION.name,this.position);this.property.setFloat3(k.LIGHT_AMBIENT.name,this.ambient);this.property.setFloat4(k.LIGHT_SPECULAR.name,this.specular)},onStart:function(){fa.prototype.onStart.call(this);this.onTransform();this.bindEvent(u.onTransform,g(this,this.onTransform))},onTransform:function(a){this.position.copy(this.transform.get_worldPosition());a=this.actor.get_transform().get_worldRotation().rotate(h.get_forward().scale(-1)).normalize();this.direction.copy(a);
G.drawCircle(this.transform.get_worldPosition(),30,this.transform.get_worldRotation())},__class__:nd});var Ub=function(){I.call(this)};Ub.__name__="lovedna.game.components.MeshRenderer";Ub.prototype=n(Ba.prototype,{cull:function(a){if(null==this.mesh||!this.mesh.check())return!0;if(!this.cameraCull)return!1;if(this._meshId!=this.mesh.id||this._transformFrame<this.actor.get_transform().transformFrame)this._meshId=this.mesh.id,this._transformFrame=this.actor.get_transform().transformFrame,this.bounds.copy(this.mesh.gpuBuffer.get_bounds()),
this.bounds.multiplyMatrix44(this.actor.get_transform().getLocalToWorld());this._distanceToCamera=a.cull(this.instanceID,this.bounds);return 0>this._distanceToCamera?!0:!1},collectRenderObject:function(a){if(null!=this.transform.removed)for(var b=0,c=this.materials.length;b<c;){var d=b++;d=this.materials[d];if(null!=d){d.setMatrixHandler(k.toString(k.M),(P=this.actor.get_transform(),g(P,P.getLocalToWorld)));d.setMatrixHandler(k.toString(k.IM),(P=this.actor.get_transform(),g(P,P.getWorldToLocal)));
null!=this.skinningMatrixList&&0<this.skinningMatrixList.length&&(d.enableDefine(k.toString(k.SKINNING),0),d.setMatrixArray(k.toString(k.BONE),this.skinningMatrixList));var e=this.mesh.gpuBuffer,f=this._distanceToCamera,l=this.actor.sortId;null==l&&(l=0);null==f&&(f=0);d=eb._pool.get().set(d,e,f,l);a.add(d)}}},onConstruct:function(){Ba.prototype.onConstruct.call(this);this._meshId=1E7;this.bounds=new Nd;this.skipFrame=0;this._cacheCull=!0},onAwake:function(){this._distanceToCamera=0;this._transformFrame=
-1},onDestroy:function(){Ba.prototype.onDestroy.call(this);null!=this.mesh&&this.mesh.dispose();this.mesh=null;null!=this.bounds&&this.bounds.dispose();this.bounds=null},__class__:Ub});var Wb=function(){this.instanceID=Wb._id++;this.position=new h;this.speed=new h;this.id=0;this.scaleX=this.scaleY=1};Wb.prototype={draw:function(a){a.position.push(this.position);a.position.push(this.position);a.position.push(this.position);a.position.push(this.position);var b=ya.instance,c=this.startTime,d=this.life,
e=this.sizeStart,f=this.sizeEnd;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;a.color.push(b);a.color.push(b);a.color.push(b);a.color.push(b);c=this.speed.x;d=this.speed.y;e=this.speed.z;f=this.angleStart;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;a.color2.push(b);a.color2.push(b);a.color2.push(b);a.color2.push(b);c=this.angleDelta;d=this.id;e=this.scaleX;f=this.scaleY;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==
c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;a.color3.push(b);a.color3.push(b);a.color3.push(b);a.color3.push(b)}};var La=function(){I.call(this)};La.__name__="lovedna.game.components.Transform";La.prototype=n(fa.prototype,{localToWorldPoint:function(a){return this.getLocalToWorld().transformPoint(a)},worldToLocalPoint:function(a){return this.getWorldToLocal().transformPoint(a)},addChild:function(a,b){null==b&&(b=!1);this.addChildAt(a,1E7,b)},addChildAt:function(a,b,c){null==c&&(c=!1);null==a||a==this||a.hasChild(this)||
(null!=a.parent&&(a.parent.removeChild(a),a.parent==this&&(c=!1)),null==this._childs&&(this._childs=new S),0>b?this._childs.unshift(a):b>=this._childs.get_length()?this._childs.push(a):this._childs.insert(b,a),c&&(b=za._pool.get(),b.copy(this.getWorldToLocal()),b.append(a.getLocalToWorld()),a.rotation.copy(b.getRotation()),a.position.copy(b.getTranslation()),a.scale.copy(b.getScale())),a.makeChange(),a.parent=this,a.removed=!1,a.actor.dispatchEvent(u.onAdded),null!=this.actor.world&&this.actor.world.set_dirty(!0),
this.childCount=this._childs.get_length())},removeFromParent:function(){null!=this.parent&&this.parent.removeChild(this)},removeChild:function(a){null!=a&&a!=this&&a.parent==this&&null!=this._childs&&-1!=this._childs.remove(a)&&(this.childCount=this._childs.get_length(),a.actor.dispatchEvent(u.onRemoved),null!=this.actor.world&&this.actor.world.set_dirty(!0),a.removed=!0)},getChild:function(a,b){null==b&&(b=!1);return null==this._childs?null:this._childs.get(a,b)},hasChild:function(a){if(null==a||
a==this||null==a.parent)return!1;a=a.parent;for(var b=200;null!=a;){if(a==this)return!0;var c=a.parent;if(c==a)break;a=c;--b;if(1>b)break}return!1},getLocalToWorld:function(){null==this._localToWorld&&(null==this.__localToWorld&&(this.__localToWorld=new za),this._localToWorld=this.__localToWorld,this._doUpdateTransform());return this._localToWorld},getWorldToLocal:function(){null==this._worldToLocal&&(null==this.__worldToLocal&&(this.__worldToLocal=new za),this._worldToLocal=this.__worldToLocal,this._worldToLocal.copy(this.getLocalToWorld()),
this._worldToLocal.inverse());return this._worldToLocal},onAwake:function(){fa.prototype.onAwake.call(this);this.position=new h(0,0,0);this.scale=new h(1,1,1);this.rotation=new Ca;this._localPosition=new h(.1,.2,.3);this._localScale=new h(1.1,1.2,1.3);this._localRotation=new Ca;this.childCount=0;this.transformFrame=-1;this.removed=!0;this.inherit=new ib;this.inherit.setArrayElement(0);this.inherit.setArrayElement(1);this.inherit.setArrayElement(2)},onDestroy:function(){fa.prototype.onDestroy.call(this);
if(null!=this._childs)for(var a=this._childs.get_length();0<a--;){var b=this._childs.getArrayElement(a);this.removeChild(b);v.destory(b.actor)}null!=this.parent&&this.parent.removeChild(this);this._worldToLocal=this._localToWorld=this.__worldToLocal=this.__localToWorld=this._localRotation=this._localScale=this._localPosition=this.rotation=this.scale=this.position=this.parent=this._childs=null},_removed:function(){this.removed&&(this.parent=null)},checkChanged:function(){if(this.removed)return!1;if(null!=
this.parent&&this.parent._frameChanged)return this.makeChange(),!0;var a=this._localPosition,b=this.position;if(a.x!=b.x||a.y!=b.y||a.z!=b.z)return this._localPosition.copy(this.position),this.makeChange(),!0;a=this._localRotation;b=this.rotation;if(a.x!=b.x||a.y!=b.y||a.z!=b.z||a.w!=b.w)return this._localRotation.copy(this.rotation),this.makeChange(),!0;a=this._localScale;b=this.scale;return a.x!=b.x||a.y!=b.y||a.z!=b.z?(this._localScale.copy(this.scale),this.makeChange(),!0):!1},makeChange:function(){this._frameChanged=
!0;this._worldToLocal=this._localToWorld=this._scale=this._rotation=this._position=null},_updateTransform:function(a){this._frameChanged&&(this.transformFrame=a,this.onTransform(),this.actor.dispatchEvent(u.onTransform));this.actor.dispatchEvent(u.onTransformComplete)},_doUpdateTransform:function(){if(!this.removed)if(null==this.parent)this._localToWorld.setTRS(this.position,this.rotation,this.scale);else{if(7==this.inherit.value)this._localToWorld.copy(this.parent.getLocalToWorld());else{var a=this.parent.getLocalToWorld(),
b=null,c=null,d=null;this.inherit.getArrayElement(0)&&(b=a.getTranslation());this.inherit.getArrayElement(1)&&(c=a.getRotation());this.inherit.getArrayElement(2)&&(d=a.getScale());this._localToWorld.setTRS(b,c,d)}this._localToWorld.appendTRS(this.position,this.rotation,this.scale)}},onTransform:function(){},get_worldPosition:function(){null==this._position&&(null==this.__position&&(this.__position=new h),this._position=this.__position,this.getLocalToWorld().getTranslation(this._position));return h._pool.get().copy(this._position)},
get_worldScale:function(){null==this._scale&&(null==this.__scale&&(this.__scale=new h),this._scale=this.__scale,this.getLocalToWorld().getScale(this._scale));return h._pool.get().copy(this._scale)},get_worldRotation:function(){null==this._rotation&&(null==this.__rotation&&(this.__rotation=new Ca),this._rotation=this.__rotation,this.getLocalToWorld().getRotation(this._rotation));return Ca._pool.get().copy(this._rotation)},__class__:La});var Tb=function(){I.call(this)};Tb.__name__="lovedna.game.components.RectTransform";
Tb.prototype=n(La.prototype,{onAwake:function(){La.prototype.onAwake.call(this);this.anchorX=new H(.5,.5);this.anchorY=new H(.5,.5);this.height=this.width=0;this._size=new H;this._anchorX=new H(.5,.5);this._anchorY=new H(.5,.5);this.pivot=new H(.5,.5);this._pivot=new H(.5,.5);this._rectChange=!0;this.bindEvent(u.onAdded,g(this,this.onAdded))},onStart:function(){La.prototype.onStart.call(this)},checkChanged:function(){if(this.width!=this._size.x||this.height!=this._size.y){var a=this._size,b=this.width,
c=this.height;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;this.makeChange();return this._rectChange=!0}a=this._pivot;b=this.pivot;if(a.x!=b.x||a.y!=b.y)return this._pivot.copy(this.pivot),this.makeChange(),this._rectChange=!0;a=this._anchorY;b=this.anchorY;if(a.x!=b.x||a.y!=b.y)return this._anchorY.copy(this.anchorY),this.makeChange(),this._rectChange=!0;a=this._anchorX;b=this.anchorX;return a.x!=b.x||a.y!=b.y?(this._anchorX.copy(this.anchorX),this.makeChange(),this._rectChange=!0):La.prototype.checkChanged.call(this)?
!0:!1},onTransform:function(){this._rectChange&&this.actor.dispatchEvent(u.onRectTransform);this._rectChange=!1},_doUpdateTransform:function(){var a=h._pool.get().copy(this.position);if(null!=this._parent){this.anchorX.clamp(0,1);this.anchorY.clamp(0,1);if(this.anchorX.y>this.anchorX.x){var b=this.anchorX.y-this.anchorX.x;this.width=this._parent.width*b;this.position.x+=(this.anchorX.x+.5*b-.5)*this._parent.width+(this.pivot.x-.5)*this.width}else this.position.x+=(this.anchorX.x-.5)*this._parent.width;
this.anchorY.y>this.anchorY.x?(b=this.anchorY.y-this.anchorY.x,this.height=this._parent.height*b,this.position.y+=(this.anchorY.x+.5*b-.5)*this._parent.height+(this.pivot.y-.5)*this.height):this.position.y+=(this.anchorY.x-.5)*this._parent.height}La.prototype._doUpdateTransform.call(this);this.position.copy(a)},onDestroy:function(){La.prototype.onDestroy.call(this);this.anchorX=this.anchorY=this.pivot=this._size=this._anchorX=this._anchorY=this._pivot=this._parent=null},onAdded:function(a){this.parent instanceof
Tb&&(this._parent=this.parent)},__class__:Tb});var Ta=function(){this.life=0;this.position=new h;this._ins=h.instance};Ta.prototype={add:function(a,b){null==b&&(b=.5);this.position.copy(a);this.life=b},update:function(a){this.life-=a},drawTo:function(a,b,c){null!=this.next?(Ta._dir.sub(this.next.position,this.position),this._ins.cross(Ta._dir,this.normal).normalize().scale(b),Ta._temp.copy(this.position).add(this._ins),a.add(Ta._temp),Ta._temp.copy(this.position).sub(this._ins),a.add(Ta._temp)):null!=
this.prev?(Ta._dir.sub(this.position,this.prev.position),this._ins.cross(Ta._dir,this.normal).normalize().scale(b),Ta._temp.copy(this.position).add(this._ins),a.add(Ta._temp),Ta._temp.copy(this.position).sub(this._ins),a.add(Ta._temp)):(a.add(this.position),a.add(this.position))}};var Od=function(){this.position=new h;this.rotation=new Ca};Od.prototype={init:function(a){this._particle=a},update:function(){null==this._transform&&(this._transform=this._particle.transform);this.position.copy(this._particle.getPosition());
this.rotation.copy(this._particle.getRotation());this.onUpdate()},onUpdate:function(){}};var tf=function(a,b){null==b&&(b=1);null==a&&(a=0);Od.call(this);this.minSize=a;this.maxSize=b;this.rangeX=new pb(-1,1);this.rangeY=new pb(-1,1);this.rangeZ=new pb(-1,1)};tf.prototype=n(Od.prototype,{onUpdate:function(){Od.prototype.onUpdate.call(this);0>this.maxSize&&(this.maxSize=0);this.minSize>this.maxSize&&(this.minSize=this.maxSize);var a=this.rangeX.get(),b=this.rangeY.get(),c=this.rangeZ.get(),d=Ca.instance,
e=h.get_zero();a=h._pool.get().set(a,b,c);d=d.setLookAt(h._pool.get().sub(a,e).normalize(),null);this.rotation.mul(d);d=this.maxSize-this.minSize;this.position.add(this.rotation.rotate(h.get_forward()).scale(this.minSize+Math.random()*d))}});var Qa=function(){I.call(this)};Qa.__name__="lovedna.game.components.ui.Canvas";Qa.collect=function(a){null!=Qa._current&&Qa._current._guiList.push(a)};Qa.reset=function(){Qa._list.clear();Qa._current=null};Qa.prototype=n(Ba.prototype,{onAwake:function(){Ba.prototype.onAwake.call(this);
var a=this.actor.getComponent(La);null!=a?(this.actor.removeComponent(La),this.rectTransform=this.actor.addComponent(Tb),this.rectTransform.position.copy(a.position),this.rectTransform.scale.copy(a.scale),this.rectTransform.rotation.copy(a.rotation),this.transform=this.rectTransform,null!=a.parent&&a.parent.addChild(this.rectTransform)):this.rectTransform=this.actor.addComponent(Tb);this._guiList=V.fromArray([]);this.order=this.actor.sortId;this.color=new F(1,1,1,1)},onStart:function(){Ba.prototype.onStart.call(this);
this.bindEvent(u.onCollectChildren,g(this,this.onCollectChildren));this.bindEvent(u.onCollectChildrenComplete,g(this,this.onCollectChildrenComplete))},cull:function(a){return!1},collectRenderObject:function(a){for(var b=1E3*this.order,c=0,d=this._guiList.get_length();c<d;){var e=c++;this._guiList.getArrayElement(e).collectRenderObject(a,b+e,this)}},onCollectChildren:function(a){this._guiList.clear();Qa._list.push(this);Qa._current=this},onCollectChildrenComplete:function(a){Qa._current=Qa._list.pop()},
__class__:Qa});var Pd=function(){I.call(this)};Pd.__name__="lovedna.game.components.ui.UIRoot";Pd.prototype=n(fa.prototype,{onAwake:function(){fa.prototype.onAwake.call(this);this.planeDistance=60;this.height=this.width=0;this._dirty=!1;this.updatePosition=this.refresh=!0;this._onRefresh=!1;this.touchInput=this.actor.addComponent(rd);this.bindEvent(u.onAdded,g(this,this.onAdded));Pd.current=this;this.actor.name="uiroot"},onStart:function(){fa.prototype.onStart.call(this);this.actor.get_transform().position.set(0,
0,this.planeDistance);this.bindEvent(u.onTransformComplete,g(this,this.onTransformComplete));this.touchInput.camera=this._camera},onAdded:function(a){this._dirty=!0},onTransformComplete:function(a){if(null!=this._camera&&this._dirty&&null!=this._camera){if(this._onRefresh&&(this._onRefresh=!1,null!=this.onRefresh))this.onRefresh();if(this.refresh){this._dirty=this.refresh=!1;var b=h._pool.get(),c=h._pool.get(),d=h._pool.get(),e=1;a=this.planeDistance/(this._camera.farClipPlane-this._camera.nearClipPlane);
b.set(-e,-e,1);c.set(e,-e,1);d.set(-e,e,1);this._camera.projectionViewInverseMatrix.transformPoint(b,!0);this._camera.projectionViewInverseMatrix.transformPoint(c,!0);this._camera.projectionViewInverseMatrix.transformPoint(d,!0);e=b.distance(c);d=b.distance(d);b=e*a;a*=d;e=b/ea.width;0<this.width&&0<this.height&&(e=this.width/this.height>b/a?b/this.width:a/this.height);this.actor.get_transform().scale.set(e,e,e);a=h._pool.get();a.set(0,0,-1);this._camera.actor.get_transform().getLocalToWorld().getRotation().rotate(a);
this.actor.get_transform().rotation.setLookAt(a);this.updatePosition&&(this.updatePosition=!1,a.set(0,0,this.planeDistance),this._camera.actor.get_transform().localToWorldPoint(a),this.actor.get_transform().parent.worldToLocalPoint(a),this.actor.get_transform().position.copy(a));this._onRefresh=!0}}},__class__:Pd});var rd=function(){I.call(this)};rd.__name__="lovedna.game.components.ui.UITouchInput";rd.prototype=n(fa.prototype,{onAwake:function(){fa.prototype.onAwake.call(this);this.enabled=!1;this._actorList=
V.fromArray([]);this._eventList=V.fromArray([]);this._checkActorList=V.fromArray([]);this.touchCount=2;this.layerMask=new Na;this.layerMask.data.value=0;this.layerMask.add(4)},onStart:function(){fa.prototype.onStart.call(this);this._pressed=!1;this.bindEvent(u.onUpdate,g(this,this.onUpdate));this._hitInfo=new rg;this._pressList=[]},onUpdate:function(a){if(this.enabled&&null!=this.camera&&null!=this.camera.actor.world){a=0;for(var b=this.touchCount;a<b;){var c=a++;if(r.touchDown(c)){this._currentTouchId=
c;var d=u.onTouchBegin;d.downActor=null;d.currentActor=null;d.touch.copy(r.getTouch(c));var e=this.camera.ScreenPointToRay(r.getTouch(c).position);this._hitInfo.ray.copy(e);this._hitInfo.world=this.camera.actor.world;e=this._hitInfo.world.collectorCollider;this._checkActorList.setArrayElement(c,null);for(var f=e.count;0<f--;){var l=e._list[f];if(this.layerMask.exist(l.actor.layer)&&this.transform.hasChild(l.transform)){var g=this._checkActorList.getArrayElement(c);null!=g&&l.actor.sortId<g.actor.sortId||
r.raycastCollider(this._hitInfo,l)&&this._checkActorList.setArrayElement(c,l)}}e=this._checkActorList.getArrayElement(c);null!=e&&(d.downActor=e.actor,d.currentActor=e.actor,this._actorList.push(e.actor),this._eventList.push(d),this._pressList[c]=e.actor);this._actorList.push(this.actor);this._eventList.push(d)}if(r.touchUp(c)){this._currentTouchId=c;d=u.onTouchEnd;d.downActor=null;d.currentActor=null;d.touch.copy(r.getTouch(c));e=this._pressList[c];f=null;this._pressList[c]=null;l=this.camera.ScreenPointToRay(d.touch.position);
this._hitInfo.ray.copy(l);this._hitInfo.world=this.camera.actor.world;l=this._hitInfo.world.collectorCollider;this._checkActorList.setArrayElement(c,null);for(g=l.count;0<g--;){var h=l._list[g],k=this._checkActorList.getArrayElement(c);null!=k&&h.actor.sortId<k.actor.sortId||r.raycastCollider(this._hitInfo,h)&&this._checkActorList.setArrayElement(c,h)}c=this._checkActorList.getArrayElement(c);null!=c&&(f=c.actor);d.currentActor=f;d.downActor=e;null!=e&&(this._actorList.push(e),this._eventList.push(d));
null!=f&&e!=f&&(this._actorList.push(f),this._eventList.push(d));this._actorList.push(this.actor);this._eventList.push(d)}}for(a=this._actorList.get_length();0<a--;)b=this._actorList.getArrayElement(a),c=this._eventList.getArrayElement(a),b.dispatchEvent(c);this._actorList.clear();this._eventList.clear()}},__class__:rd});var dd=function(a){C.call(this,a);this.touch=new db};dd.__name__="lovedna.game.events.ActorTouchEvent";dd.prototype=n(C.prototype,{copy:function(a){C.prototype.copy.call(this,a);
null!=a&&(this.touch.copy(a.touch),this.downActor=a.downActor,this.currentActor=a.currentActor)},clear:function(){C.prototype.clear.call(this);this.currentActor=this.downActor=null},__class__:dd});var u=function(a){C.call(this,a)};u.__name__="lovedna.game.events.ActorEvent";u.prototype=n(C.prototype,{__class__:u});var Nd=function(){this.box=new yg;this.sphere=new zg};Nd.prototype={dispose:function(){this.box.dispose();this.sphere.dispose();this.sphere=this.box=null},copy:function(a){null!=a&&(this.box.copy(a.box),
this.sphere.copy(a.sphere));return this},reset:function(){null!=this.box&&(this.box.reset(),this.sphere.radius=0)},expand:function(a){this.box.expand(a)},multiplyMatrix44:function(a){null!=a&&this.box.multiplyMatrix44(a);this.sphere.center.copy(this.box.getCenter());a=this.box.min.distance(this.box.max);this.sphere.radius=.5*a}};var Kb=function(){this.id=Kb._id++;this.vertexBuffers=new S;this.indexBuffer=new Bb;this._buffers=new L;this.enabled=!1;this._bounds=new Nd;this._boundsDirty=!1;this.property=
new zb};Kb.prototype={set:function(a){this.geometry!=a&&(null!=this.geometry&&this.geometry.removeEventListener(C.update._type,g(this,this.geometryUpdate)),this.enabled=!1,this.geometry=a,null!=this.geometry&&this.geometry.addEventListener(C.update._type,g(this,this.geometryUpdate)),this.geometryUpdate())},dispose:function(){this.indexBuffer.unload();for(var a=this.vertexBuffers.get_length();0<a--;)this.vertexBuffers.getArrayElement(a).unload();this.vertexBuffers.clear();this.vertexBuffers.dispose();
this._buffers=this.vertexBuffers=null;null!=this._bounds&&(this._bounds.dispose(),this._bounds=null)},updateBuffer:function(a,b){if(null==a||1>a.dataLength)this.property.disableDefine(b.name);else if(a.get_changed()){var c=b.name,d=this._buffers;d=null!=q[c]?d.getReserved(c):d.h[c];if(null==d){d=new Wc;this.vertexBuffers.push(d);d.setLayout([new Ag(c,b.size,a.componentType)]);var e=this._buffers;null!=q[c]?e.setReserved(c,d):e.h[c]=d;b!=k.POSITION?this.property.enableDefine(b.name):this._boundsDirty=
!0}d.upload(a)}},geometryUpdate:function(a){if(0>=this.geometry.position.length||0>=this.geometry.group.indices.length)this.enabled=!1;else{if(this.geometry.group.indices.get_changed()){if(1>this.geometry.group.count||null==this.indexBuffer.layouts||this.geometry.group.count<this.indexBuffer.layouts.length){a=[];for(var b=0,c=this.geometry.group.count;b<c;){var d=b++,e=new Bg;e.length=this.geometry.group.getGroupLength(d);e.offset=this.geometry.group.getGroupOffset(d);a.push(e)}this.indexBuffer.setLayouts(a)}this._boundsDirty=
!0;this.indexBuffer.upload(this.geometry.group.indices.data,this.geometry.group.indices.length)}this.updateBuffer(this.geometry.position,k.POSITION);this.updateBuffer(this.geometry.uv,k.UV);this.updateBuffer(this.geometry.uv2,k.UV2);this.updateBuffer(this.geometry.normal,k.NORMAL);this.updateBuffer(this.geometry.tangent,k.TANGENT);this.updateBuffer(this.geometry.color,k.COLOR);this.updateBuffer(this.geometry.color2,k.COLOR2);this.updateBuffer(this.geometry.color3,k.COLOR3);this.updateBuffer(this.geometry.color4,
k.COLOR4);this.updateBuffer(this.geometry.color5,k.COLOR5);this.updateBuffer(this.geometry.color6,k.COLOR6);null!=this.geometry.joint&&this.geometry.joint.get_changed()&&(this.property.enableDefine(k.toString(k.BONE)),this.updateBuffer(this.geometry.joint,k.BONE_INDEX));null!=this.geometry.weight&&this.geometry.weight.get_changed()&&this.updateBuffer(this.geometry.weight,k.BONE_WEIGHT);1<this.indexBuffer.length&&0<this.vertexBuffers.get_length()&&1<this.geometry.position.length&&(this.enabled=!0)}},
get_bounds:function(){if(!this._boundsDirty||null==this.geometry)return this._bounds;this._boundsDirty=!1;var a=p.floatToInt(this.geometry.position.length);this._bounds.reset();for(var b=0;b<a;){var c=b++;this._bounds.expand(this.geometry.position.get(c))}return this._bounds}};var Qf=function(){Za.call(this);this.heightSegments=this.widthSegments=this.height=this.width=1;this.uv=new fb;this.normal=new ne;this.color=new Ib};Qf.prototype=n(Za.prototype,{build:function(){1>this.widthSegments&&(this.widthSegments=
1);1>this.heightSegments&&(this.heightSegments=1);0>=this.width&&(this.width=1E-4);0>=this.height&&(this.height=1E-4);this.position.clear();this.normal.clear();this.uv.clear();this.color.clear();this.group.clear();for(var a=h.instance,b=ya.instance,c=.5*this.width,d=.5*this.height,e=this.widthSegments,f=this.heightSegments,l=e+1,g=f+1,k=this.width/e,m=this.height/f,n=this.getCustomUVMethod(),p=0;p<g;)for(var q=p++,r=q*m-d,t=0,v=l;t<v;){var u=t++;a.set(u*k-c,-r,0);null!=this.transform&&this.transform.transformPoint(a);
this.position.push(a);a.set(0,0,1);null!=this.transform&&this.transform.transformPoint(a);this.normal.push(a);this.uv.push(n(0,u/e,q/f));if(null!=this.customColor)this.color.push(this.customColor);else{var w=u=1,x=1,y=1;null==y&&(y=1);null==x&&(x=0);null==w&&(w=0);null==u&&(u=0);b.x=u;b.y=w;b.z=x;b.w=y;this.color.push(b)}}for(a=0;a<f;)for(b=a++,c=0,d=e;c<d;)g=c++,k=g+l*(b+1),m=g+1+l*(b+1),n=g+1+l*b,this.group.indices.push3(g+l*b,k,n),this.group.indices.push3(k,m,n);this.update();return this}});var ec=
function(a){this.game=a;this.debugFrame=!1;this.game.addEventListener(C.update._type,g(this,this.gameUpdate));this._pressTime=0;ec.instance=this;this._touchDebugFrame=!1};ec.prototype={gameUpdate:function(a){if(this._touchDebugFrame)r.touchDown()&&(.5<r.getTouch().position.x?(this.game.debugFrame++,this.game.step()):(this.game.debugFrame--,this.game.step(),0>this.game.debugFrame&&(this.game.debugFrame=0)));else{a=oa._custom()-this._now;this._now=oa._custom();if(null!=r.getKey(39)){this._pressTime-=
a;if(0<this._pressTime)return;this._pressTime=ec.pressDelay;this.game.isPaused&&this.game.step();this.debugFrame&&(this.game.debugFrame++,this.game.step())}if(null!=r.getKey(37)){this._pressTime-=a;if(0<this._pressTime)return;this._pressTime=ec.pressDelay;this.debugFrame&&(this.game.debugFrame--,this.game.step(),0>this.game.debugFrame&&(this.game.debugFrame=0))}r.keyDown(40)&&r.getKey(40).modifier.getArrayElement(2)&&(this.game.isPaused=!this.game.isPaused,G.pause=this.game.isPaused);r.keyDown(38)&&
r.getKey(38).modifier.getArrayElement(2)&&(this.debugFrame=!this.debugFrame,this.game.debugFrame=this.debugFrame?0:-1)}}};var pg=function(){this._material=new Hb;this._material.debug=3;this._material.renderState.drawMode=1;this._material.renderState.depthState.compareFunction=0;this._material.renderState.depthState.writeEnabled=!1;this._material.renderQueue=40100;this._mesh=new Kb;this._mesh.set(G.getGeometry());var a=new za;a.setProjection(.1,1E3,60);var b=new za;b.lookAt(new h(0,0,100));a.append(b);
this._material.setMatrix(k.toString(k.VP),a);this._material.setMatrix(k.toString(k.M),new za)};pg.prototype={render:function(a){G.update(E.smoothDeltaTime);if(this._mesh.enabled){var b=Z.add();b.name="debug";null!=a&&b.setProperty(a.property);a=this._material;var c=this._mesh;b.draw(eb._pool.get().set(a,c,0,0))}}};var zb=function(){this._shaderDefineMap=new L;this._uniformMap=new L;this._defineDirty=!1};zb.prototype={enableDefine:function(a,b){null==b&&(b=1);if(!p.stringEmpty(a)){var c=this._shaderDefineMap;
if(null!=q[a]?c.existsReserved(a):c.h.hasOwnProperty(a))this._defineDirty=!0;c=this._shaderDefineMap;null!=q[a]?c.setReserved(a,b):c.h[a]=b}},disableDefine:function(a){this._shaderDefineMap.remove(a)&&(this._defineDirty=!0)},clear:function(){for(var a=this._shaderDefineMap.keys();a.hasNext();){var b=a.next();this._shaderDefineMap.remove(b);this._defineDirty=!0}for(a=this._uniformMap.keys();a.hasNext();)b=a.next(),this.removeProperty(b)},copyProperties:function(a){this.clear();for(var b=a._shaderDefineMap.keys();b.hasNext();){var c=
b.next(),d=this._shaderDefineMap;this.enableDefine(c,null!=q[c]?d.getReserved(c):d.h[c])}for(b=a._uniformMap.keys();b.hasNext();){c=b.next();d=this.getUniform(c);var e=a._uniformMap;d.copy(null!=q[c]?e.getReserved(c):e.h[c])}this._defineDirty=!0},addProperties:function(a){for(var b=a._uniformMap.keys();b.hasNext();){var c=b.next(),d=this._uniformMap,e=null!=q[c]?d.getReserved(c):d.h[c];d=null==e||e.temp;e=a._uniformMap;var f=null!=q[c]?e.getReserved(c):e.h[c];e=this.getUniform(c);e.copy(f);e.temp=
d}},removeProperty:function(a){var b=this._uniformMap;if(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))b=this._uniformMap,b=null!=q[a]?b.getReserved(a):b.h[a],b.temp=!1,$a.pool.set(b),this._uniformMap.remove(a)},setColor:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setFloat4(b)},setFloat2:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setFloat2(b)},setFloat3:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setFloat3(b)},setFloat4:function(a,
b){null==b?this.removeProperty(a):this.getUniform(a).setFloat4(b)},setMatrix:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setMatrix(b)},setMatrixArray:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setMatrixArray(b)},setMatrixHandler:function(a,b){null==b?this.removeProperty(a):this.getUniform(a).setMatrixHandler(b)},setTexture:function(a,b){null==b&&(b=k.toString(k.BASECOLORMAP));null==a?(this.removeProperty(b),this.disableDefine(b)):(this.getUniform(b).setTexture(a),
this.enableDefine(b));b+=k.toString(k._REGION);this.disableDefine(b);this.removeProperty(b)},setAtlas:function(a,b){null==b&&(b=k.toString(k.BASECOLORMAP));null==a?(this.removeProperty(b),this.disableDefine(b),b+=k.toString(k._REGION),this.disableDefine(b),this.removeProperty(b)):(this.getUniform(b).setTexture(a.texture.texture),this.enableDefine(b),b+=k.toString(k._REGION),this.enableDefine(b),this.getUniform(b).setFloat4(a.data.normalzedFrame))},getUniform:function(a){var b=this._uniformMap;if(null!=
q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))return b=this._uniformMap,null!=q[a]?b.getReserved(a):b.h[a];b=$a.pool.get();b.name=a;var c=this._uniformMap;null!=q[a]?c.setReserved(a,b):c.h[a]=b;return b}};var Hb=function(a){zb.call(this);this.debug=2;this.subMesh=-1;this._shaderDefines=V.fromArray([]);this._shaderId=-1;this.shader=new Oa;null==a&&(a="default");this.shader.loadCode(a);this.renderQueue=1E4;this.color=new F;this.setColor(k.toString(k.COLOR),this.color);this.renderState=new va};Hb.prototype=
n(zb.prototype,{copy:function(a){this.name=a.name;this.renderQueue=a.renderQueue;this.renderState.copy(a.renderState);this.color.copy(a.color);this.subMesh=a.subMesh;this.debug=a.debug;this.shader.loadCode(a.shader.name);this._shaderId=a._shaderId;this._shaderDefines.copyFastArray(a._shaderDefines);this._overrideShader=a._overrideShader;this.copyProperties(a)},dispose:function(){this.shader=null},loadShader:function(a){a!=this.shader.name&&(this.name=a,this.shader.loadCode(a),this._shaderId=-1)},
addDefineProperty:function(a,b){null==b&&(b=0);for(a=a._shaderDefineMap.keys();a.hasNext();){var c=a.next(),d=this._shaderDefineMap;if(null!=q[c]?d.existsReserved(c):d.h.hasOwnProperty(c))if(d=this._shaderDefineMap,0<(null!=q[c]?d.getReserved(c):d.h[c]))continue;this.enableDefine(c,b);this._defineDirty=!0}},compile:function(){if(0==this.shader.codeId)return!1;if(this._defineDirty||this.shader.codeId!=this._shaderId){this._shaderId=this.shader.codeId;this._shaderDefines.clear();this._defineDirty=!1;
for(var a=this._shaderDefineMap.keys();a.hasNext();){var b=a.next();this.shader.hasDefine(b)&&this._shaderDefines.push(b);var c=this._shaderDefineMap;0==(null!=q[b]?c.getReserved(b):c.h[b])&&(this._shaderDefineMap.remove(b),this._defineDirty=!0)}}for(a=this._shaderDefines.get_length();0<a--;)this.shader.addDefine(this._shaderDefines.getArrayElement(a));a=this.shader.compile();null!=this._overrideShader&&(this.shader.loadCode(this._overrideShader),this._overrideShader=null);return a},upload:function(){var a=
this._uniformMap;for(a=new Pb(a,a.arrayKeys());a.hasNext();){var b=a.next();this.shader.addUniform(b);b.temp&&this.removeProperty(b.name)}return this.shader.upload(0<this.debug--)}});var Cg=function(){};Cg.getQueue=function(a){a=p.floatToInt(1E-4*a);0>a&&(a=0);4<a&&(a=4);return 1E4*a};var Qd=function(){this.instanceID=Qd._id++};Qd.prototype={init:function(a,b){this.input=a;this.index=b},clear:function(){this.value=null}};var Rd=function(){this.instanceID=Rd._id++};Rd.prototype={init:function(a,b){this.input=
a;this.index=b;this.defaultValue=null;this._uploaded=!1},clear:function(){this._uploaded=!1;this.value=this.defaultValue;return null!=this.value},upload:function(){if(this._uploaded)return!0;this._uploaded=!0;return null!=this.value&&this.value.bind(this.input)?this.value.upload():!1}};var Oa=function(){this.id=this.codeId=0;this._uploadUniforms=new L;this._uniformUploadedBit=new ib(1);this._uniformUploadedBitValue=0;this._uploadAttribute=new L;this._attributeUploadedBit=new ib(1);this._attributeUploadedBitValue=
0;this._attributes=V.fromArray([]);this._defineBit=new ib;this._defineList=V.fromArray([])};Oa.prototype={loadCode:function(a){if(null==a)this.codeId=0;else{var b=U.get(a);null==b?this.codeId=0:(this.name=a,b!=this.code&&(this.code=b,this.codeId=this.code.id,this._defineValue=-1))}},addDefine:function(a){var b=this.code,c=b._defines;(null!=q[a]?c.existsReserved(a):c.h.hasOwnProperty(a))?(b=b._defines,b=null!=q[a]?b.getReserved(a):b.h[a]):b=-1;-1==b||this._defineBit.getArrayElement(b)||(this._defineBit.setArrayElement(b,
!0),this._defineList.push(a))},compile:function(){if(this._defineBit.value!=this._defineValue){this._defineValue=this._defineBit.value;this._defineList.sort(g(this,this.sortDefine));var a="",b=this._defineList.get_length();Oa._fnv.reset();Oa._fnv.addInt(this.codeId);for(Oa._fnv.addInt(b);0<b--;){var c=this._defineList.getArrayElement(b);Oa._fnv.addString(c);a+="#define ";a+=null==c?"null":""+c;a+="\n"}b=Oa._fnv.getCode();if(this.id!=b||null==this._program){this.id=b;Oa._programMap.h.hasOwnProperty(this.id)?
this._program=Oa._programMap.h[this.id]:(this._program=new Xc(this.code.getVert(a),this.code.getFrag(a)),Oa._programMap.h[this.id]=this._program);if(!this._program.enabled)return!1;for(a=this._uploadUniforms.keys();a.hasNext();)b=a.next(),c=this._uploadUniforms,c=null!=q[b]?c.getReserved(b):c.h[b],Oa.uniformPool.set(c),this._uploadUniforms.remove(b);a=this._program._uniformList;b=a.length;if(31<=b)return!1;for(this._uniformUploadedBit.value=0;0<b--;){this._uniformUploadedBit.setArrayElement(b,!0);
var d=a[b];c=Oa.uniformPool.get();c.init(d,b);var e=this._uploadUniforms,f=d.name;null!=q[f]?e.setReserved(f,c):e.h[f]=c;d=this.code.getUniformInfo(d.name);null!=d&&(c.defaultValue=d.defaultValue,d=d.alias,null!=d&&(e=this._uploadUniforms,null!=q[d]?e.setReserved(d,c):e.h[d]=c))}this._uniformUploadedBitValue=this._uniformUploadedBit.value;for(a=this._uploadAttribute.keys();a.hasNext();)b=a.next(),c=this._uploadAttribute,c=null!=q[b]?c.getReserved(b):c.h[b],Oa.attributePool.set(c),this._uploadAttribute.remove(b);
a=this._program._attributeList;b=a.length;if(31<=b)return!1;for(this._attributeUploadedBit.value=0;0<b--;)this._attributeUploadedBit.setArrayElement(b,!0),d=a[b],c=Oa.attributePool.get(),c.init(d,b),e=this._uploadAttribute,f=d.name,null!=q[f]?e.setReserved(f,c):e.h[f]=c,d=this.code.getAttributeInfo(d.name),null!=d&&(d=d.alias,null!=d&&(e=this._uploadAttribute,null!=q[d]?e.setReserved(d,c):e.h[d]=c));this._attributeUploadedBitValue=this._attributeUploadedBit.value}}if(null==this._program)return!1;
this._defineBit.value=0;this._defineList.clear();this._uniformUploadedBit.value=this._uniformUploadedBitValue;this._attributeUploadedBit.value=this._attributeUploadedBitValue;a=this._uploadUniforms;for(a=new Pb(a,a.arrayKeys());a.hasNext();)b=a.next(),b.clear()&&this._uniformUploadedBit.setArrayElement(b.index,!1);this._attributes.clear();a=this._uploadAttribute;for(a=new Pb(a,a.arrayKeys());a.hasNext();)a.next().clear();return!0},addUniform:function(a){var b=a.name,c=this._uploadUniforms;if(null!=
q[b]?c.existsReserved(b):c.h.hasOwnProperty(b))c=this._uploadUniforms,b=null!=q[b]?c.getReserved(b):c.h[b],b.value=a,this._uniformUploadedBit.setArrayElement(b.index,!1)},addAttribute:function(a){for(var b=!1,c=a.layouts,d=0,e=c.length;d<e;){var f=d++;f=c[f];var l=f.name,g=this._uploadAttribute;if(null!=q[l]?g.existsReserved(l):g.h.hasOwnProperty(l))b=this._uploadAttribute,b=null!=q[l]?b.getReserved(l):b.h[l],f.location=b.input.location,b.value=a,this._attributeUploadedBit.setArrayElement(b.index,
!1),b=!0}b&&this._attributes.push(a)},upload:function(a){if(0==this.id||ta.gt(this._uniformUploadedBit.value,0)||ta.gt(this._attributeUploadedBit.value,0))return!1;this._program.bind();a=this._uploadUniforms;for(a=new Pb(a,a.arrayKeys());a.hasNext();)if(!a.next().upload())return!1;for(a=this._attributes.get_length();0<a--;)if(!this._attributes.getArrayElement(a).bind())return!1;return!0},hasDefine:function(a){var b=this.code,c=b._defines;(null!=q[a]?c.existsReserved(a):c.h.hasOwnProperty(a))?(b=b._defines,
a=null!=q[a]?b.getReserved(a):b.h[a]):a=-1;return 0<=a},sortDefine:function(a,b){return a>b?1:-1}};var Dg=function(){this._frag=this._vert="precision highp float;\nprecision mediump int;\nprecision lowp sampler2D;\nprecision lowp samplerCube;\n"};Dg.prototype={getVertPrecision:function(){return this._vert},getFragPrecision:function(){return this._frag}};var U=function(a,b,c){var d=U._map;if(null!=q[a]?!d.existsReserved(a):!d.h.hasOwnProperty(a)){null==U._keymap&&(U._keymap=new L,d=U._keymap,null!=
q.highp?d.setReserved("highp",!0):d.h.highp=!0,d=U._keymap,null!=q.mediump?d.setReserved("mediump",!0):d.h.mediump=!0,d=U._keymap,null!=q.lowp?d.setReserved("lowp",!0):d.h.lowp=!0);d=U._map;null!=q[a]?d.setReserved(a,this):d.h[a]=this;this._attributes=new L;this._uniforms=new L;this._defines=new L;this._mapping=[];U._extension.clear();U._ifdef.clear();jb.instance.reset();this._vert=this.parse(b);this._vertExt=U._extension.join("\n");U._extension.clear();this._frag=this.parse(c);this.pauseMapping();
this.id=jb.instance.getCode();this._fragExt=U._extension.join("\n");if(null==U._common){U._common=m.getEmbed("shader_common");a=new pe(U._common);b=a._length;for(c="";0<b--;)c+=ma.string(a.readLine()),c+="\n";U._common=c}a=0;for(b=this._defines.keys();b.hasNext();){c=b.next();d=this._defines;var e=a++;null!=q[c]?d.setReserved(c,e):d.h[c]=e}}};U.get=function(a){var b=U._map;return null!=q[a]?b.getReserved(a):b.h[a]};U.init=function(){new U("default",m.getEmbed("shader_default_vert"),m.getEmbed("shader_default_frag"));
new U("ui",m.getEmbed("shader_ui_vert"),m.getEmbed("shader_ui_frag"));new U("sky",m.getEmbed("shader_skymap_vert"),m.getEmbed("shader_skymap_frag"));new U("pbr",m.getEmbed("shader_pbr_vert"),m.getEmbed("shader_pbr_frag"));new U("particle",m.getEmbed("shader_particle_vert"),m.getEmbed("shader_particle_frag"))};U.prototype={getVert:function(a){return this._vertExt+"\n"+U._precision.getVertPrecision()+a+U._common+this._vert},getFrag:function(a){return this._fragExt+"\n"+U._precision.getFragPrecision()+
a+U._common+this._frag},getUniformInfo:function(a){var b=this._uniforms;return null!=q[a]?b.getReserved(a):b.h[a]},getAttributeInfo:function(a){var b=this._attributes;return null!=q[a]?b.getReserved(a):b.h[a]},parse:function(a){var b="";a=new pe(a);for(var c=a._length;0<c--;){var d=a.readLine();""!=d&&(-1!=d.indexOf("//mapping ")?this._mapping.push(d):ia.startsWith(p.trim(d),"//")||""==p.trim(d)||(-1!=d.toLowerCase().indexOf("#extension ")?(U._extension.push(d),jb.instance.addString(d)):(d=this.readLine(d),
jb.instance.addString(d),b+=null==d?"null":""+d,b+="\n")))}return b},readLine:function(a){a=p.trim(a);if(-1!=a.indexOf("attribute")){var b=a.split(" ");var c=b.length;a=0;for(var d=c;a<d;)if(c=a++,"attribute"==p.trim(b[c])){a=new Eg;d=2;var e=b[c+1],f=b[c+2],l=U._keymap;if(null!=q[e]?l.existsReserved(e):l.h.hasOwnProperty(e))d=3,f=b[c+d];f=ia.replace(f,";","");-1!=f.indexOf(":")&&(e=f.split(":"),2==e.length&&(f=p.trim(e[0]),e=p.trim(e[1]),a.alias=e));b[c+d]=f+";";a.name=f;c=this._attributes;d=a.name;
null!=q[d]?c.setReserved(d,a):c.h[d]=a;null!=a.alias&&(c=this._attributes,d=a.alias,null!=q[d]?c.setReserved(d,a):c.h[d]=a);c=U._ifdef.get_length();if(0<c)for(;0<c--;)a.addDefine(U._ifdef.getArrayElement(c));break}return b.join(" ")}if(-1!=a.indexOf("uniform")){b=a.split(" ");f=b.length;a=0;for(c=f;a<c;)if(f=a++,"uniform"==b[f]){l=2;a=b[f+1];e=b[f+l];c=U._keymap;if(null!=q[a]?c.existsReserved(a):c.h.hasOwnProperty(a))a=e,l=3,e=b[f+l];e=ia.replace(e,";","");c=new Fg;d=null;-1!=e.indexOf("=")&&(d=e.split("="),
e=p.trim(d[0]),d=p.trim(d[1]));if(-1!=e.indexOf(":")){var g=e.split(":");2==g.length&&(e=p.trim(g[0]),g=p.trim(g[1]),c.alias=g)}b[f+l]=e+";";f=e.indexOf("[");-1!=f&&(e=e.substring(0,f));c.name=e;f=this._uniforms;e=c.name;null!=q[e]?f.setReserved(e,c):f.h[e]=c;null!=c.alias&&(f=this._uniforms,e=c.alias,null!=q[e]?f.setReserved(e,c):f.h[e]=c);f=U._ifdef.get_length();if(0<f)for(;0<f--;)c.addDefine(U._ifdef.getArrayElement(f));c.addDefaultValue(a,d);break}return b.join(" ")}if(-1!=a.indexOf("#ifdef"))for(b=
a.split(" "),c=0,d=b.length;c<d;){if(f=c++,"#ifdef"==b[f]){b=p.trim(b[f+1]);U._ifdef.push(b);c=this._defines;null!=q[b]?c.setReserved(b,0):c.h[b]=0;break}}else if(-1!=a.indexOf("#endif"))for(b=a.split(" "),c=0,d=b.length;c<d;)if(f=c++,"#endif"==b[f]){U._ifdef.pop();break}return a},pauseMapping:function(){var a=this._mapping.length;if(!(1>a)){for(;0<a--;){var b=this._mapping[a];b=b.split("//mapping ").pop();b=p.stringToArray(b);for(var c=b.length;0<c--;){var d=b[c].split(":");if(!(2>d.length)){var e=
p.trim(d[0]);d=d[1];var f=null;if(-1!=d.indexOf("=")){var g=d.split("=");2==g.length&&(d=g[0],f=g[1])}g=this._attributes;if(null!=q[e]?g.existsReserved(e):g.h.hasOwnProperty(e)){g=this._attributes;g=null!=q[e]?g.getReserved(e):g.h[e];var h=this._attributes;(null!=q[d]?h.existsReserved(d):h.h.hasOwnProperty(d))||(h=this._attributes,null!=q[d]?h.setReserved(d,g):h.h[d]=g,g.alias=d)}g=this._uniforms;if(null!=q[e]?g.existsReserved(e):g.h.hasOwnProperty(e))g=this._uniforms,e=null!=q[e]?g.getReserved(e):
g.h[e],g=this._uniforms,(null!=q[d]?g.existsReserved(d):g.h.hasOwnProperty(d))||(g=this._uniforms,null!=q[d]?g.setReserved(d,e):g.h[d]=e,e.alias=d),null==e.defaultValue&&e.addDefaultValue("",f)}}}this._mapping=null}}};var Eg=function(){};Eg.prototype={addDefine:function(a){p.stringEmpty(a)||(null==this.defines&&(this.defines=[]),this.defines.push(a))}};var Fg=function(){};Fg.prototype={addDefine:function(a){p.stringEmpty(a)||(null==this.defines&&(this.defines=[]),this.defines.push(a))},addDefaultValue:function(a,
b){p.stringEmpty(b)||(b=ia.replace(b,")",""),b=b.split("("),2==b.length&&(a=p.trim(b[0]),b=p.trim(b[1]),this.defaultValue=new $a,this.defaultValue.name=this.name,"float"==a?this.defaultValue.setFloat(p.stringToFloat(b)):"int"==a?this.defaultValue.setInt(p.stringToInt(b)):"bool"==a?this.defaultValue.setInt(0==p.stringToInt(b)?0:1):"vec2"==a||"float2"==a||"fixed2"==a||"half2"==a?this.defaultValue.setFloat2((new H).parse(b)):"vec3"==a||"float3"==a||"fixed3"==a||"half3"==a?this.defaultValue.setFloat3((new h).parse(b)):
"vec4"==a||"float4"==a||"fixed4"==a||"half4"==a||"color"==a?this.defaultValue.setFloat4((new ya).parse(b)):this.defaultValue=null))}};var $a=function(){this.instanceID=$a._id++;this._bindType=this._dataType=0;this.temp=!1};$a.getData=function(a){a=p.intToNextPow2(a);var b=p.pow2Count(a),c=$a._tempList[b];null==c&&(c=new Float32Array(a),$a._tempList[b]=c);return c};$a.prototype={clear:function(){this._bindType=this._dataType=0;this._matrix4HandlerValue=this._matrix4ArrayValue=this._texture=this._float4ArrayValue=
this._matrix4Value=this._float4Value=this._float3Value=this._float2Value=this._floatArrayValue=null},copy:function(a){this.clear();switch(a._bindType){case 1:this.setInt(a._intValue);break;case 2:this.setFloat(a._floatValue);break;case 3:this.setFloatArray(a._floatArrayValue);break;case 4:this.setFloat2(a._float2Value);break;case 5:this.setFloat3(a._float3Value);break;case 6:this.setFloat4(a._float4Value);break;case 7:this.setMatrix(a._matrix4Value);break;case 8:this.setMatrixArray(a._matrix4ArrayValue);
break;case 9:this.setTexture(a._texture);break;case 11:this.setFloat4Array(a._float4ArrayValue);break;case 12:this.setMatrixHandler(a._matrix4HandlerValue)}},setInt:function(a){this._intValue=a;this._handler=g(this,this.bindInt);this._dataType=5124;this._bindType=1;return this},setFloat:function(a){this._floatValue=a;this._handler=g(this,this.bindFloat);this._dataType=5126;this._bindType=2;return this},setFloatArray:function(a){this._floatArrayValue=a;this._handler=g(this,this.bindFloatArray);this._dataType=
5126;this._bindType=3;return this},setFloat2:function(a){this._float2Value=a;this._handler=g(this,this.bindFloat2);this._dataType=35664;this._bindType=4;return this},setFloat3:function(a){this._float3Value=a;this._handler=g(this,this.bindFloat3);this._dataType=35665;this._bindType=5;return this},setFloat4:function(a){this._float4Value=a;this._handler=g(this,this.bindFloat4);this._dataType=35666;this._bindType=6;return this},setFloat4Array:function(a){this._float4ArrayValue=a;this._handler=g(this,
this.bindFloat4Array);this._dataType=35666;this._bindType=11;return this},setMatrix:function(a){this._matrix4Value=a;this._handler=g(this,this.bindMatrix4);this._dataType=35676;this._bindType=7;return this},setMatrixArray:function(a){this._matrix4ArrayValue=a;this._handler=g(this,this.bindMatrix4Array);this._dataType=35676;this._bindType=8;return this},setTexture:function(a){this._texture=a;this._handler=g(this,this.bindTexture);3553==a.params.type?(this._dataType=35678,this._bindType=9):34067==a.params.type&&
(this._dataType=35680,this._bindType=9);return this},setMatrixHandler:function(a){this._matrix4HandlerValue=a;this._handler=g(this,this.bindMatrix4Handler);this._dataType=35676;this._bindType=12;return this},bind:function(a){if(null==this._handler||a.type!=this._dataType)return!1;this._input=a;this._size=this._input.size;return!0},upload:function(){this._success=!0;null==this._gl&&(this._gl=lb.current.gl);this._handler();return this._success},bindInt:function(){this._gl.gl.uniform1i(this._input.location,
this._intValue)},bindFloat:function(){this._gl.gl.uniform1f(this._input.location,this._floatValue)},bindFloat2:function(){this._gl.gl.uniform2f(this._input.location,this._float2Value.x,this._float2Value.y)},bindFloat3:function(){this._gl.gl.uniform3f(this._input.location,this._float3Value.x,this._float3Value.y,this._float3Value.z)},bindFloat4:function(){this._gl.gl.uniform4f(this._input.location,this._float4Value.x,this._float4Value.y,this._float4Value.z,this._float4Value.w)},bindFloatArray:function(){for(var a=
this._floatArrayValue.length,b=$a.getData(a);0<a--;)b[a]=this._floatArrayValue[a];this._gl.gl.uniform1fv(this._input.location,b)},bindFloat4Array:function(){for(var a=this._float4ArrayValue.length,b=$a.getData(4*a);0<a--;){var c=4*a,d=this._float4ArrayValue[a];null!=d?(b[c]=d.x,b[c+1]=d.y,b[c+2]=d.z,b[c+3]=d.w):(b[c]=0,b[c+1]=0,b[c+2]=0,b[c+3]=0)}this._gl.gl.uniform4fv(this._input.location,b)},bindMatrix4:function(){var a=this._gl,b=this._input.location,c=this._matrix4Value.get_data();a.gl.uniformMatrix4fv(b,
!1,c)},bindMatrix4Handler:function(){var a=this._matrix4HandlerValue(),b=this._gl,c=this._input.location;a=a.get_data();b.gl.uniformMatrix4fv(c,!1,a)},bindMatrix4Array:function(){for(var a=this._matrix4ArrayValue.length,b=$a.getData(16*a);0<a--;){var c=this._matrix4ArrayValue[a];null!=c&&c.fillFloat32Array(b,16*a)}this._gl.gl.uniformMatrix4fv(this._input.location,!1,b)},bindTexture:function(){(this._success=this._texture.bind(this._input.id))&&this._gl.gl.uniform1i(this._input.location,this._input.id)}};
var qb=function(){};qb.prototype={execute:function(a){this.context=a;this.onExecute()},onExecute:function(){}};var Aa=function(){};Aa.prototype=n(qb.prototype,{set:function(a,b,c,d,e){null==e&&(e=!0);this.source=a;this.dest=b;this.material=c;this.rect=d;this.clear=e;return this},onExecute:function(){if(this.source!=this.dest){if(null==Aa._gbuffer){Aa._material=new Hb;Aa._material.renderState.depthState.writeEnabled=!1;Aa._material.renderState.depthState.compareFunction=0;Aa._mat=new za;Aa._material.setMatrix(k.toString(k.M),
Aa._mat);Aa._material.setMatrix(k.toString(k.V),Aa._mat);Aa._material.setMatrix(k.toString(k.P),Aa._mat);Aa._material.setMatrix(k.toString(k.VP),Aa._mat);Aa._gbuffer=new Kb;var a=new Za;a.position.push(h.instance.set(-1,-1,0));a.position.push(h.instance.set(1,-1,0));a.position.push(h.instance.set(1,1,0));a.position.push(h.instance.set(-1,1,0));a.uv=new fb;var b=H.instance,c=0,d=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.uv.push(b);b=H.instance;c=1;d=0;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;
a.uv.push(b);b=H.instance;d=c=1;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.uv.push(b);b=H.instance;c=0;d=1;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;a.uv.push(b);a.group.indices.push3(0,1,2);a.group.indices.push3(0,2,3);Aa._gbuffer.set(a)}null==this.material?this.material=Aa._material:this.material.addProperties(Aa._material);null==this._blitMaerial&&(this._blitMaerial=new Hb);this._blitMaerial.copy(this.material);this._blitMaerial.setTexture(this.source);a=this.context.commandBuffer;a.pushRenderTarget(this.dest);
this.clear&&a.clearRenderTarget(Aa._clearColor,1,0);null!=this.rect&&a.setViewport(this.rect.x,this.rect.y,this.rect.z,this.rect.w);b=this._blitMaerial;c=Aa._gbuffer;a.draw(eb._pool.get().set(b,c,0,0));a.popRenderTarget();this.context.actionIndex++}}});var Gg=function(){};Gg.prototype=n(qb.prototype,{set:function(a){this.value=a;return this},onExecute:function(){qb.prototype.onExecute.call(this);this.value()}});var Hg=function(){};Hg.prototype=n(qb.prototype,{set:function(a,b,c){null==c&&(c=0);null==
b&&(b=1);this.clearColor=a;this.clearDepth=b;this.clearStencil=c;return this},onExecute:function(){this.context.glContext.clear(this.clearColor,this.clearDepth,this.clearStencil);this.context.actionIndex++}});var Ig=function(){};Ig.prototype=n(qb.prototype,{set:function(a,b){this.global=b;this.value=a;return this},onExecute:function(){this.global?null==this.context.globalProperty?this.value.clear():this.value.copyProperties(this.context.globalProperty):null==this.context.property?this.value.clear():
this.value.copyProperties(this.context.property)}});var Jg=function(){};Jg.prototype=n(qb.prototype,{set:function(a){this.value=a;return this},onExecute:function(){var a=this.value.material;if(0!=a.shader.id){null!=this.context.globalProperty&&a.addProperties(this.context.globalProperty);null!=this.context.property&&a.addProperties(this.context.property);for(var b=this.value.mesh.vertexBuffers.get_length();0<b--;){var c=this.value.mesh.vertexBuffers.getArrayElement(b);a.shader.addAttribute(c)}null!=
this.context.glContext.currentRenderTarget&&a.setTexture(this.context.glContext.currentRenderTarget,k.toString(k.RENDER_BUFFER));a.upload()&&(this.context.glContext.setRenderState(a.renderState),this.value.mesh.indexBuffer.draw(a.renderState.drawMode,a.subMesh),this.context.actionIndex++,a.removeProperty(k.toString(k.RENDER_BUFFER)))}}});var Kg=function(){};Kg.prototype=n(qb.prototype,{onExecute:function(){this.context.glContext.popRenderTarget()}});var Lg=function(){};Lg.prototype=n(qb.prototype,
{set:function(a){this.target=a;return this},onExecute:function(){this.context.glContext.pushRenderTarget(this.target)}});var Mg=function(){};Mg.prototype=n(qb.prototype,{set:function(a,b,c){this.global=b;this.value=a;this.append=c;return this},onExecute:function(){this.global?null!=this.context.globalProperty&&this.append?this.context.globalProperty.addProperties(this.value):this.context.globalProperty=this.value:null!=this.context.property&&this.append?this.context.property.addProperties(this.value):
this.context.property=this.value}});var Ng=function(){};Ng.prototype=n(qb.prototype,{set:function(a,b,c,d){null==d&&(d=640);null==c&&(c=1138);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.width=c;this.height=d;return this},onExecute:function(){this.context.glContext.setViewport(this.x,this.y,this.width,this.height)}});var Z=function(){this._commands=V.fromArray([]);this._key=!1};Z.add=function(a){null==a&&(a=!0);var b=Z._pool.get();a?(b._added=!0,Z._buffers.push(b)):b._added=!1;return b};Z.flush=
function(a){a.actionIndex=1;for(var b=0;!a.isPause();){var c=Z._buffers.getArrayElement(b++);if(null==c)break;c.execute(a)}Z._buffers.clear();0<=a.stopActionIndex&&(a.stopActionIndex=a.actionIndex-1);a.glContext.end()};Z.prototype={execute:function(a){a.property=null;a.commandBuffer=this;for(var b=0;!a.isPause();){var c=this._commands.getArrayElement(b++);if(null==c)break;c.execute(a)}this._commands.clear();this._key=!1;a.commandBuffer=null},pushRenderTarget:function(a){this._commands.push(Z._pushRenderTarget.get().set(a))},
popRenderTarget:function(){this._commands.push(Z._popRenderTarget.get())},clearRenderTarget:function(a,b,c){null==c&&(c=0);null==b&&(b=1);this._commands.push(Z._clearRenderTarget.get().set(a,b,c))},setViewport:function(a,b,c,d){null==d&&(d=640);null==c&&(c=1138);null==b&&(b=0);null==a&&(a=0);this._commands.push(Z._setViewport.get().set(a,b,c,d))},blit:function(a,b,c,d,e){null==e&&(e=!0);a!=b&&(this._commands.push(Z._blit.get().set(a,b,c,d,e)),this._key=!0)},callback:function(a){this._commands.push(Z._callback.get().set(a))},
draw:function(a){a.enabled&&(this._commands.push(Z._draw.get().set(a)),this._key=!0)},setProperty:function(a){this._commands.push(Z._setProperty.get().set(a,!1,!1))},setGlobalProperty:function(a){this._commands.push(Z._setProperty.get().set(a,!0,!1))},addGlobalProperty:function(a){this._commands.push(Z._setProperty.get().set(a,!0,!0))},copyGlobalProperty:function(a){this._commands.push(Z._copyProperty.get().set(a,!0))}};var qg=function(){this.stopActionIndex=-1;this.actionIndex=0};qg.prototype={clear:function(){this.property=
this.globalProperty=null},isPause:function(){return 0<=this.stopActionIndex&&this.actionIndex>this.stopActionIndex?!0:!1}};var eb=function(){};eb.prototype={set:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);this.material=a;null!=eb.globalDefine&&a.addDefineProperty(eb.globalDefine,0);this.mesh=b;this.material.addDefineProperty(b.property,2);this.distance=c;this.enabled=a.compile();this.order=d;return this}};var Og=function(){this.background=V.fromArray([]);this.geometry=V.fromArray([]);this.transparent=
V.fromArray([]);this.ui=V.fromArray([]);this.overlay=V.fromArray([])};Og.prototype={clear:function(){this.background.clear();this.geometry.clear();this.transparent.clear();this.ui.clear();this.overlay.clear();this.count=0},sort:function(){this.geometry.sort(g(this,this.sortByNear2Far));this.transparent.sort(g(this,this.sortByNear2Far));this.ui.sort(g(this,this.sortByOrder));this.overlay.sort(g(this,this.sortByNear2Far))},add:function(a){if(a.enabled){var b=Cg.getQueue(a.material.renderQueue);1E4==
b?this.geometry.push(a):3E4==b?this.ui.push(a):2E4==b?this.transparent.push(a):0==b?this.background.push(a):4E4==b&&this.overlay.push(a);this.count++}},sortByNear2Far:function(a,b){var c=a.material.renderQueue,d=b.material.renderQueue;if(c!=d)return c>d?1:-1;c=a.material.shader.id;d=b.material.shader.id;return c!=d?c>d?1:-1:a.distance>b.distance?1:-1},sortByOrder:function(a,b){var c=a.material.renderQueue,d=b.material.renderQueue;if(c!=d)return c>d?1:-1;c=a.order;d=b.order;if(c!=d)return c>d?1:-1;
c=a.material.shader.id;d=b.material.shader.id;return c!=d?c>d?1:-1:a.distance>b.distance?-1:1}};var xg=function(a){this._camera=a;this._cullmask=this._camera.cullingMask;this._copyProperty=new zb;this._defineProperty=new zb;this._uniformProperty=new zb;this._renderObjectCollector=new Og;this.background=this._renderObjectCollector.background;this.geometry=this._renderObjectCollector.geometry;this.transparent=this._renderObjectCollector.transparent;this.ui=this._renderObjectCollector.ui;this.overlay=
this._renderObjectCollector.overlay};xg.prototype={collectRenderer:function(){var a=this._camera.actor.world;if(null!=a){this._renderObjectCollector.clear();this._defineProperty.disableDefine(k.toString(k.LIGHT));if(0<a.collectorLight.count){var b=a.collectorLight.get(0);this._defineProperty.enableDefine(k.toString(k.LIGHT));this._uniformProperty.addProperties(b.property)}a=a.collectorRenderer;a.setCullCamera(this._camera);b=a.count;eb.globalDefine=this._defineProperty;for(var c=0;c<b;){var d=c++;
d=a._list[d];if(d.visible){var e=d.actor;this._cullmask.exist(e.layer)||e._setVisible(!1);d.cull(a)?e._setVisible(!1):(e._setVisible(!0),d.collectRenderObject(this._renderObjectCollector))}}this._renderObjectCollector.sort()}},render:function(){var a=Z.add();a.callback(g(this,this.onPreRender));a.copyGlobalProperty(this._copyProperty);this._uniformProperty.addProperties(this._camera.property);a.setGlobalProperty(this._uniformProperty);a.addGlobalProperty(this._copyProperty);null!=this._camera.renderTarget&&
a.pushRenderTarget(this._camera.renderTarget);a=this.background.get_length();if(0<a)for(var b=0,c=a;b<c;)a=b++,a=this.background.getArrayElement(a),Z.add().draw(a);a=this.geometry.get_length();if(0<a)for(b=0,c=a;b<c;)a=b++,a=this.geometry.getArrayElement(a),Z.add().draw(a);a=this.transparent.get_length();if(0<a)for(b=0,c=a;b<c;)a=b++,a=this.transparent.getArrayElement(a),Z.add().draw(a);a=this.ui.get_length();if(0<a)for(b=0,c=a;b<c;)a=b++,a=this.ui.getArrayElement(a),Z.add().draw(a);a=this.overlay.get_length();
if(0<a)for(b=0,c=a;b<c;)a=b++,a=this.overlay.getArrayElement(a),Z.add().draw(a);a=Z.add();null!=this._camera.renderTarget&&a.popRenderTarget();a.setGlobalProperty(this._copyProperty);a.callback(g(this,this.onPostRender))},onPreRender:function(){this._camera.actor.dispatchEvent(u.onPreRender)},onPostRender:function(){this._camera.actor.dispatchEvent(u.onPostRender)}};var lg=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);ya.call(this,a,b,c,d)};lg.prototype=n(ya.prototype,
{setBorder:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d;return this},hasBorder:function(){return 0<this.x||0<this.y||0<this.z?!0:0<this.w}});var yg=function(){this.min=new h;this.max=new h;this._centerHelp=new h;this._dirty=null;this.points=[];this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h);this.points.push(new h)};
yg.prototype={dispose:function(){this.points=this._centerHelp=this.max=this.min=null},update:function(){this._dirty=null;this.enabled=!0},reset:function(){this.min.set(1.79769313486231E308,1.79769313486231E308,1.79769313486231E308);this.max.set(-1.79769313486231E308,-1.79769313486231E308,-1.79769313486231E308);this.enabled=!1;return this},copy:function(a){this.max.copy(a.max);this.min.copy(a.min);this.update();return this},expand:function(a){this.min.min(a);this.max.max(a);this.update();return this},
multiplyMatrix44:function(a){var b=h.get_one(),c=h.get_one();b.copy(this.min);c.copy(this.max);this.reset();this.expand(a.transformPoint(this.points[0].copy(b)));this.expand(a.transformPoint(this.points[1].set(b.x,b.y,c.z)));this.expand(a.transformPoint(this.points[2].set(c.x,b.y,c.z)));this.expand(a.transformPoint(this.points[3].set(c.x,b.y,b.z)));this.expand(a.transformPoint(this.points[4].set(b.x,c.y,b.z)));this.expand(a.transformPoint(this.points[5].set(b.x,c.y,c.z)));this.expand(a.transformPoint(this.points[6].copy(c)));
this.expand(a.transformPoint(this.points[7].set(c.x,c.y,b.z)));return this},getCenter:function(){null==this._dirty&&(this._dirty=this._centerHelp,this._dirty.copy(this.min).add(this.max).scale(.5));return this._dirty}};var wg=function(){this.planes=[];this.near=new Yc;this.far=new Yc;this.left=new Yc;this.right=new Yc;this.top=new Yc;this.bottom=new Yc;this.planes.push(this.near);this.planes.push(this.far);this.planes.push(this.left);this.planes.push(this.right);this.planes.push(this.top);this.planes.push(this.bottom)};
wg.prototype={containsPoint:function(a,b){null==b&&(b=0);for(var c=6;0<c--;)if(this.planes[c].distanceToPoint(a)<-b)return!1;return!0},intersectsBox:function(a){if(null==a)return!1;for(var b=h.get_one(),c=h.get_one(),d=6;0<d--;){var e=this.planes[d],f=e.normal.x,g=e.normal.y,k=e.normal.z;b.set(0<f?a.min.x:a.max.x,0<g?a.min.y:a.max.y,0<k?a.min.z:a.max.z);c.set(0<f?a.max.x:a.min.x,0<g?a.max.y:a.min.y,0<k?a.max.z:a.min.z);if(0>e.distanceToPoint(b)&&0>e.distanceToPoint(c))return!1}return!0},multiplyMatrix44:function(a){if(null==
a)return this;var b=a.m0,c=a.m1,d=a.m2,e=a.m3,f=a.m4,g=a.m5,h=a.m6,k=a.m7,m=a.m8,n=a.m9,p=a.m10,q=a.m11,r=a.m12,t=a.m13,u=a.m14;a=a.m15;this.planes[0].set(e+d,k+h,q+p,a+u);this.planes[1].set(e-d,k-h,q-p,a-u);this.planes[2].set(e+b,k+f,q+m,a+r);this.planes[3].set(e-b,k-f,q-m,a-r);this.planes[4].set(e-c,k-g,q-n,a-t);this.planes[5].set(e+c,k+g,q+n,a+t);return this}};var Yc=function(){this.normal=new h(0,0,1);this.distance=0};Yc.prototype={distanceToPoint:function(a){return this.normal.dot(a)+this.distance},
set:function(a,b,c,d){this.normal.set(a,b,c);this.distance=d;this.normalize()},normalize:function(){var a=this.normal;a=1/Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);this.normal.scale(a);this.distance*=a}};var Ab=function(){this.start=new h;this.direction=new h};Ab.get_temp=function(){return Ab._pool.get()};Ab.prototype={copy:function(a){if(a==this)return this;this.start.copy(a.start);this.direction.copy(a.direction);return this},set:function(a,b){this.start.copy(a);this.direction.sub(b,a);this.direction.normalize();
return this},at:function(a){var b=Ab._v30;b.copy(this.direction);b.scale(a);b.add(this.start);return b},intersectSphere:function(a){var b=Ab._v30;b.sub(a.center,this.start);var c=this.direction.dot(b);b=b.dot(b)-c*c;a=a.radius*a.radius;if(b>a)return null;b=Math.sqrt(a-b);a=c-b;c+=b;return 0>a&&0>c?null:0>a?this.at(c):this.at(a)},intersectBox:function(a){var b=0!=this.direction.x?1/this.direction.x:0;var c=0!=this.direction.y?1/this.direction.y:0;var d=0!=this.direction.z?1/this.direction.z:0,e=this.start;
if(0<=b){var f=(a.min.x-e.x)*b;b*=a.max.x-e.x}else f=(a.max.x-e.x)*b,b*=a.min.x-e.x;if(0<=c){var g=(a.min.y-e.y)*c;c*=a.max.y-e.y}else g=(a.max.y-e.y)*c,c*=a.min.y-e.y;if(f>c||g>b)return null;if(g>f||f!=f)f=g;if(c<b||b!=b)b=c;0<=d?(g=(a.min.z-e.z)*d,a=(a.max.z-e.z)*d):(g=(a.max.z-e.z)*d,a=(a.min.z-e.z)*d);if(f>a||g>b)return null;if(g>f||f!=f)f=g;if(a<b||b!=b)b=a;return 0>b?null:this.at(0<=f?f:b)}};var zg=function(){this.radius=0;this.center=new h(0,0,0);this.enabled=!0};zg.prototype={dispose:function(){this.center=
null},set:function(a,b){this.center.copy(a);this.radius=b;return this},copy:function(a){return a==this?this:this.set(a.center,a.radius)}};var Pg=function(){this.enabled=!0;this.writeMask=4;this.colorBlendOperation=this.alphaBlendOperation=32774;this.sourceColorBlendMode=770;this.destinationColorBlendMode=771;this.destinationAlphaBlendMode=this.sourceAlphaBlendMode=1};Pg.prototype={copy:function(a){this.enabled=a.enabled;this.writeMask=a.writeMask;this.alphaBlendOperation=a.alphaBlendOperation;this.colorBlendOperation=
a.colorBlendOperation;this.sourceColorBlendMode=a.sourceColorBlendMode;this.destinationColorBlendMode=a.destinationColorBlendMode;this.sourceAlphaBlendMode=a.sourceAlphaBlendMode;this.destinationAlphaBlendMode=a.destinationAlphaBlendMode}};var Qg=function(){this.compareFunction=513;this.writeEnabled=!0};Qg.prototype={copy:function(a){this.compareFunction=a.compareFunction;this.writeEnabled=a.writeEnabled}};var Bb=function(){this.id=Bb._id++;this.enabled=!1;this.type=5123};Bb.prototype={setLayouts:function(a){null==
this.layouts?this.layouts=[]:this.layouts.splice(0,this.layouts.length);for(var b=0,c=a.length;b<c;){var d=b++;this.layouts.push(a[d])}},upload:function(a,b){null==b&&(b=0);this.enabled=!1;if(null!=a&&1<a.length){this.enabled=!0;this._data=a;if(0==b||b>=this._data.length)b=this._data.length;this._dataLength=this.length=b}},draw:function(a,b){null==b&&(b=-1);this._time=oa._custom();var c=lb.current.gl;if(null!=this._data){null==this._buffer&&(this._buffer=c.gl.createBuffer());c.gl.bindBuffer(34963,
this._buffer);var d=this.getData();c.gl.bufferData(34963,d,35044);this._data=null}else null!=this._buffer&&this!=Bb.current&&(Bb.current=this,c.gl.bindBuffer(34963,this._buffer));0<=b?(b=this.layouts[b],c.gl.drawElements(a,b.length,5123,b.offset)):c.gl.drawElements(a,this.length,5123,0)},unload:function(){null!=this._buffer&&(lb.current.gl.gl.deleteBuffer(this._buffer),this._buffer=null);this._data=this.layouts=null},getData:function(){var a=this._dataLength,b=p.intToNextPow2(a),c=p.pow2Count(b),
d=Bb._tempList[c];null==d&&(d=new Uint16Array(b),Bb._tempList[c]=d);for(this.max=0;0<a--;)b=this._data[a],b>this.max&&(this.max=b),d[a]=b;return d}};var Bg=function(){};Bg.prototype={};var lb=function(a){lb.current=this;this.gl=a;this._state=0;this._renderTargetList=V.fromArray([]);this.screenParams=new ya;this._defaultState=new va};lb.prototype={begin:function(a,b){this._width=a;this._height=b;this.screenParams.x=this._width;this.screenParams.y=this._height;this._state=0;lb.current=this;this._renderTargetList.clear();
this.end()},end:function(){this.currentRenderTarget=null;Bb.current=null;Xc.current=null;this.gl.gl.bindFramebuffer(36160,null);this.gl.gl.bindRenderbuffer(36161,null);this.gl.gl.bindTexture(3553,null);this.gl.gl.bindBuffer(34963,null);this.gl.gl.bindBuffer(34962,null);this.setRenderState(this._defaultState)},setViewport:function(a,b,c,d){this.gl.gl.viewport(a,b,c,d)},setRenderState:function(a){this._state!=a.get_id()&&(this._state=a.get_id(),0==a.cullMode?this.gl.gl.disable(2884):(this.gl.gl.enable(2884),
this.gl.gl.cullFace(a.cullMode)),0==a.depthState.compareFunction?this.gl.gl.disable(2929):(this.gl.gl.enable(2929),this.gl.gl.depthFunc(a.depthState.compareFunction)),this.gl.gl.depthMask(a.depthState.writeEnabled),a.blendState.enabled?(this.gl.gl.enable(3042),this.gl.gl.blendEquationSeparate(a.blendState.colorBlendOperation,a.blendState.alphaBlendOperation),this.gl.gl.blendFuncSeparate(a.blendState.sourceColorBlendMode,a.blendState.destinationColorBlendMode,a.blendState.sourceAlphaBlendMode,a.blendState.destinationAlphaBlendMode)):
this.gl.gl.disable(3042),0==a.stencilState.compareFunction?this.gl.gl.disable(2960):(this.gl.gl.enable(2960),this.gl.gl.stencilFunc(a.stencilState.compareFunction,a.stencilReference,a.stencilState.readMask),this.gl.gl.stencilOp(a.stencilState.failOperation,a.stencilState.zFailOperation,a.stencilState.passOperation)))},clear:function(a,b,c){null==c&&(c=0);null==b&&(b=1);var d=0;null!=a&&(d|=16384,this.gl.gl.clearColor(a.x,a.y,a.z,a.w));0<=b&&(d|=256,this.gl.gl.clearDepth(b));0<=c&&(d|=1024,this.gl.gl.clearStencil(c));
this.gl.gl.colorMask(!0,!0,!0,!0);this.gl.gl.clear(d)},pushRenderTarget:function(a){null!=a?(a.bindBuffer(),this.setViewport(0,0,a.width,a.height),this.screenParams.z=a.width,this.screenParams.w=a.height):(this.gl.gl.bindFramebuffer(36160,null),this.gl.gl.bindRenderbuffer(36161,null),this.setViewport(0,0,this._width,this._height),this.screenParams.z=this._width,this.screenParams.w=this._height);this._renderTargetList.push(a);this.currentRenderTarget=a},popRenderTarget:function(){this._renderTargetList.pop();
this.currentRenderTarget=this._renderTargetList.get(-1);null!=this.currentRenderTarget?(this.currentRenderTarget.bindBuffer(),this.setViewport(0,0,this.currentRenderTarget.width,this.currentRenderTarget.height),this.screenParams.z=this.currentRenderTarget.width,this.screenParams.w=this.currentRenderTarget.height):(this.gl.gl.bindFramebuffer(36160,null),this.gl.gl.bindRenderbuffer(36161,null),this.setViewport(0,0,this._width,this._height),this.screenParams.z=this._width,this.screenParams.w=this._height)}};
var Xc=function(a,b,c){this.id=Xc._id++;this.enabled=!1;c=lb.current.gl;var d=c.gl.createShader(35633);c.gl.shaderSource(d,a);c.gl.compileShader(d);a=c.gl.createShader(35632);c.gl.shaderSource(a,b);c.gl.compileShader(a);this._glprogram=c.gl.createProgram();c.gl.attachShader(this._glprogram,d);c.gl.attachShader(this._glprogram,a);c.gl.linkProgram(this._glprogram);c.gl.deleteShader(d);c.gl.deleteShader(a);this.enabled=!0;this._bufferAttribs=new L;this._uniforms=new L;this._uniformList=[];this._attributeList=
[];b=c.gl.getProgramParameter(this._glprogram,35721);a=0;for(d=b;a<d;){var e=a++;var f=c.gl.getActiveAttrib(this._glprogram,e);b=f.name;e=new Rg(e,c.gl.getAttribLocation(this._glprogram,b),f,this.id);f=this._bufferAttribs;null!=q[b]?f.setReserved(b,e):f.h[b]=e;this._attributeList.push(e)}b=c.gl.getProgramParameter(this._glprogram,35718);d=a=0;for(e=b;d<e;){b=d++;f=c.gl.getActiveUniform(this._glprogram,b);b=f.name;var g=f.type;35678==g||35680==g?(f=new re(a,c.gl.getUniformLocation(this._glprogram,
b),f),g=this._uniforms,null!=q[b]?g.setReserved(b,f):g.h[b]=f,++a,this._uniformList.push(f)):(g=b.indexOf("["),0<g&&(b=y.substr(b,0,g)),f=new re(-1,c.gl.getUniformLocation(this._glprogram,b),f),g=this._uniforms,null!=q[b]?g.setReserved(b,f):g.h[b]=f,this._uniformList.push(f))}};Xc.prototype={bind:function(){this._time=oa._custom();this.enabled&&Xc.current!=this&&(lb.current.gl.gl.useProgram(this._glprogram),Xc.current=this)}};var Rg=function(a,b,c,d){this.id=a;this.location=b;this.name=c.name;this.type=
c.type;this.size=c.size};Rg.prototype={};var re=function(a,b,c){this.id=a;this.location=b;this._info=c;this.name=c.name;a=this.name.indexOf("[");0<a&&(this.name=y.substr(this.name,0,a));this.type=c.type;this.size=c.size};re.prototype={};var va=function(){this._id=0;this.drawMode=4;this.cullMode=1029;this.blendState=new Pg;this.depthState=new Qg;this.stencilState=new Sg;this.stencilReference=0};va.prototype={copy:function(a){this.cullMode=a.cullMode;this.blendState.copy(a.blendState);this.depthState.copy(a.depthState);
this.stencilState.copy(a.stencilState);this.stencilReference=a.stencilReference;this._id=0},get_id:function(){if(0!=this._id)return this._id;va._fnv.reset();va._fnv.addInt(this.cullMode);va._fnv.addInt(this.blendState.alphaBlendOperation);va._fnv.addInt(this.blendState.colorBlendOperation);va._fnv.addInt(this.blendState.destinationAlphaBlendMode);va._fnv.addInt(this.blendState.destinationColorBlendMode);va._fnv.addBool(this.blendState.enabled);va._fnv.addInt(this.blendState.sourceAlphaBlendMode);
va._fnv.addInt(this.blendState.sourceColorBlendMode);va._fnv.addInt(this.blendState.writeMask);va._fnv.addInt(this.depthState.compareFunction);va._fnv.addBool(this.depthState.writeEnabled);va._fnv.addInt(this.stencilState.compareFunction);va._fnv.addInt(this.stencilState.failOperation);va._fnv.addInt(this.stencilState.passOperation);va._fnv.addInt(this.stencilState.readMask);va._fnv.addInt(this.stencilState.writeMask);va._fnv.addInt(this.stencilState.zFailOperation);va._fnv.addInt(this.stencilReference);
return this._id=va._fnv.getCode()}};var Sg=function(){this.writeMask=this.readMask=255;this.compareFunction=0;this.passOperation=this.failOperation=this.zFailOperation=7680};Sg.prototype={copy:function(a){this.readMask=a.readMask;this.writeMask=a.writeMask;this.compareFunction=a.compareFunction;this.zFailOperation=a.zFailOperation;this.failOperation=a.failOperation;this.passOperation=a.passOperation}};var Tg={_new:function(a){null==a&&(a=-1);return 0>a?6408:a},fromString:function(a){switch(p.trim(a).toLowerCase()){case "alpha":a=
6406;break;case "luminance":a=6409;break;case "luminancealpha":a=6410;break;case "rgb565":a=36194;break;case "rgb888":a=6407;break;case "rgba4444":a=32854;break;case "rgba8888":a=6408;break;default:a=6408}return Tg._new(a)}},ve=function(){this.type=3553;this.filterMin=this.filterMag=9729;this.wrapT=this.wrapS=10497;this.dirty=this.mipmap=!0;this.format=Tg.fromString("");this._ispow2=!1;this._height=this._width=0};ve.prototype={setSize:function(a,b){this._width=a;this._height=b},bind:function(){if(this.dirty){this.dirty=
!1;-1==this.filterMag&&(this.filterMag=9729);-1==this.filterMin&&(this.filterMin=9729);-1==this.wrapS&&(this.wrapS=10497);-1==this.wrapT&&(this.wrapT=10497);var a=this.wrapS,b=this.wrapT,c=this.filterMin,d=this.filterMag,e=this.mipmap;var f=this._width;0<f&&0==(f&f-1)?(f=this._height,f=0<f&&0==(f&f-1)):f=!1;f?9729>=c&&(e=!1):(b=a=33071,9729<c&&(c=9729),9729<d&&(d=9729),e=!1);f=lb.current.gl;f.gl.texParameteri(this.type,10240,d);f.gl.texParameteri(this.type,10241,c);f.gl.texParameteri(this.type,10242,
a);f.gl.texParameteri(this.type,10243,b);e&&da.gl.gl.generateMipmap(this.type)}}};var Wc=function(){this.id=Wc._id++;this.length=this._time=0};Wc.prototype={setLayout:function(a){if(null==this.layouts)this.layouts=[],this._layoutMap=new L;else{for(var b=this.layouts.length;0<b--;)this._layoutMap.remove(this.layouts[b].name);this.layouts.splice(0,this.layouts.length)}b=this.stride=0;for(var c=a.length;b<c;){var d=b++;d=a[d];d.offset=this.stride;this.stride+=d.size*d.getDataSize();this.layouts.push(d);
var e=this._layoutMap,f=d.name;null!=q[f]?e.setReserved(f,d):e.h[f]=d}this.enabled=0<this.stride},upload:function(a){this._data=a;this.length=this._data.dataLength;this.count=this._data.length},bind:function(){this._time=oa._custom();if(!this.enabled)return!1;var a=this.layouts.length;if(1>a)return!1;var b=lb.current.gl;null!=this._data&&(null==this._buffer&&(this._buffer=b.gl.createBuffer()),b.gl.bindBuffer(34962,this._buffer),a=this.getData(),b.gl.bufferData(34962,a,35044),this._data=null);var c=
0;b.gl.bindBuffer(34962,this._buffer);for(a=this.layouts.length;0<a--;){var d=this.layouts[a];0>d.location||(b.gl.enableVertexAttribArray(d.location),b.gl.vertexAttribPointer(d.location,d.size,d.type,!1,this.stride,d.offset),++c)}return 1>c?!1:!0},unload:function(){null!=this._buffer&&(lb.current.gl.gl.deleteBuffer(this._buffer),this._buffer=null);this.layouts=this._layoutMap=this._data=null},getData:function(){var a=this._data.dataLength,b=p.intToNextPow2(a),c=p.pow2Count(b);switch(this._data.componentType){case 5120:case 5121:var d=
5120;break;case 5122:case 5123:d=5122;break;default:d=this._data.componentType}var e=d+"_"+c;c=Wc._tempList;c=null!=q[e]?c.getReserved(e):c.h[e];if(null==c){switch(d){case 5120:c=new Uint8Array(b);break;case 5122:c=new Uint16Array(b);break;case 5124:c=new Int32Array(b);break;case 5126:c=new Float32Array(b);break;default:c=new Float32Array(b)}b=Wc._tempList;null!=q[e]?b.setReserved(e,c):b.h[e]=c}if(5120==d)for(d=c;0<a--;)d[a]=this._data.data[a]|0;else if(5122==d)for(d=c;0<a--;)d[a]=this._data.data[a]|
0;else if(5126==d)for(d=c;0<a--;)d[a]=this._data.data[a];else if(5124==d)for(d=c;0<a--;)d[a]=this._data.data[a]|0;return c}};var Ag=function(a,b,c){null==c&&(c=5126);this.type=c;this.name=a;this.size=b;this.offset=0;this.location=-1};Ag.prototype={getDataSize:function(){return 4}};var pb=function(a,b){null==b&&(b=1);null==a&&(a=0);H.call(this,a,b)};pb.prototype=n(H.prototype,{get:function(){var a=this.x,b=this.y-a;return 0==b?a:b*p.randomInstance.getFloat()+a}});var Gf=function(a){I.call(this);this._status=
this._seekTime=0;this._rate=1;this._fade=null;this._volume=1;this._loop=!1;this._active=!0;this._needFocusResume=!1;Sa.systemDispatcher.addEventListener(C.blur._type,g(this,this._blur));Sa.systemDispatcher.addEventListener(C.focus._type,g(this,this._focus));this._buffer=a;this._buffer.enabled&&(this._status=1);this._buffer.addEventListener(Db.onUpdate._type,g(this,this._onupdate))};Gf.prototype=n(I.prototype,{play:function(a){null==a&&(a=!1);this._loop=a;3!=this._status&&(this._status=3,0!=this._status&&
this.doPlay())},pause:function(){2!=this._status&&0!=this._status&&(this._status=2,this._buffer.enabled&&(this._buffer.pause(),this._needFocusResume=!1))},resume:function(){2==this._status&&0!=this._status&&(this._status=3,this.doPlay())},stop:function(){1!=this._status&&0!=this._status&&(this._status=1,this._buffer.pause(),this._seekTime=0,this._needFocusResume=!1)},dispose:function(){Sa.systemDispatcher.addEventListener(C.blur._type,g(this,this._blur));Sa.systemDispatcher.addEventListener(C.focus._type,
g(this,this._focus));this._buffer.removeEventListener(Db.onUpdate._type,g(this,this._onupdate));this.stop();I.prototype.dispose.call(this)},_onupdate:function(a){a=Db.onUpdate;2==a.action?this._status=1:3==a.action?this._status=2:1==a.action?this._status=3:7==a.action&&3==this._status&&this.doPlay();this.dispatchEvent(a)},_blur:function(a){this._active=!1;3==this._status&&this.get_playing()&&(this.pause(),this._needFocusResume=!0)},_focus:function(a){this._active=!0;this._needFocusResume&&this.resume()},
doPlay:function(){Sa.focus&&this._buffer.enabled&&(this._buffer.setRate(this._rate),this._buffer.setLoop(this._loop),this._buffer.setVolume(this._volume),this._active&&(0<this._seekTime&&(this._buffer.setSeek(this._seekTime),this._seekTime=0),this._buffer.play()))},set_volume:function(a){0>a&&(a=1);this._volume=a;null!=this._buffer&&this._buffer.enabled&&this._buffer.setVolume(this._volume);return this._volume},get_playing:function(){return null==this._buffer?!1:this._buffer.getPlaying()}});var Rb=
function(a){this._data={};this._dirty=this.dirty=!1;this.name=a};Rb.getObject=function(a){if(p.stringEmpty(a))return null;var b=Rb._map;if(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))return b=Rb._map,null!=q[a]?b.getReserved(a):b.h[a];b=new Rb(a);var c=Rb._map;null!=q[a]?c.setReserved(a,b):c.h[a]=b;return b};Rb.prototype={readFromFile:function(a){try{this._data=(new kb(a)).unserialize(),this._dirty=!1}catch(b){this._data={}}},writeToFile:function(){return bb.run(this._data)},get:function(a){return null!=
this._data?ja.field(this._data,a):null},set:function(a,b){null!=this._data&&this.get(a)!=b&&(this._data[a]=b,this._dirty=!0)},get_dirty:function(){var a=this._dirty;this._dirty=!1;return a}};var ic=function(){I.call(this);this.type=vb.NULL;this.done=this.forceBytes=!1};ic.prototype=n(I.prototype,{dispose:function(){I.prototype.dispose.call(this);this.callback=this.key=this.path=this.customData=this.video=this.image=this.text=this.bytes=null},setType:function(a){this.type=a;a==vb.BYTES&&(this.forceBytes=
!0);return this},setPath:function(a){this.path=a;if(null==this.type)switch(this.type=vb.BYTES,a.split(".").pop().toLowerCase()){case "gif":case "jpeg":case "jpg":case "png":this.type=vb.IMAGE;break;case "mp2":case "mp3":break;case "m4a":case "ogg":case "wav":break;case "otf":case "ttf":break;case "css":case "json":case "plist":case "svg":case "text":case "txt":case "xml":this.type=vb.TEXT;this.forceBytes=!0;break;default:this.type=vb.BYTES,this.forceBytes=!0}return this},setUrl:function(a){this.url=
a;return this},complete:function(){this.done=!0},get_key:function(){if(null!=this._key)return this._key;ic._fnv.reset();ic._fnv.addString(this.url);ic._fnv.addInt(this.type._hx_index);return this._key=ic._fnv.getString()},get_enabled:function(){return null==this.bytes&&null==this.text&&null==this.image?null!=this.video:!0}});var Tf=function(){this._list=V.fromArray([]);this._checkDelay=new ba(g(this,this.complete));this.total=this.loaded=0};Tf.prototype={start:function(){this._list.clear();K.onLoadEvent.addEventListener(Jb.onLoad._type,
g(this,this.onLoad))},end:function(a,b){this._callback=a;this._progress=b;K.onLoadEvent.removeEventListener(Jb.onLoad._type,g(this,this.onLoad));1>this._list.get_length()?this.complete():this.check(null)},onLoad:function(a){a.file.get_enabled()||(a.file.addEventListener(C.complete._type,g(this,this.fileComplete)),this._list.push(a.file),this.total++)},fileComplete:function(a){this.check(a.target)},check:function(a){var b=this._list.get_length();if(!(1>b)){for(;0<b--;){var c=this._list.getArrayElement(b);
if(c.get_enabled()||c==a)this._list.removeAt(b),this.loaded++,null!=this._progress&&this._progress()}b=this._list.get_length();1>b&&null!=this._callback&&this._checkDelay.start(.1)}},complete:function(){this._callback()}};var vb=Ra["lovedna.net.FileType"]={__ename__:"lovedna.net.FileType",__constructs__:"NULL BYTES IMAGE TEXT VIDEO AUDIO".split(" "),NULL:{_hx_index:0,__enum__:"lovedna.net.FileType",toString:ha},BYTES:{_hx_index:1,__enum__:"lovedna.net.FileType",toString:ha},IMAGE:{_hx_index:2,__enum__:"lovedna.net.FileType",
toString:ha},TEXT:{_hx_index:3,__enum__:"lovedna.net.FileType",toString:ha},VIDEO:{_hx_index:4,__enum__:"lovedna.net.FileType",toString:ha},AUDIO:{_hx_index:5,__enum__:"lovedna.net.FileType",toString:ha}},Ug=function(){};Ug.prototype={};var pf=function(){this.name="files";this._list=[];this._map=new L};pf.prototype={createTableItem:function(){var a=new Ug;null!=this._list&&this._list.push(a);return a},tableInit:function(){if(null!=this._list){for(var a=0,b=this._list.length;a<b;){var c=a++;this.addItem(this._list[c])}this._list=
null}},addItem:function(a){var b=this._map,c=a.name;null!=q[c]?b.setReserved(c,a):b.h[c]=a},get:function(a){var b=this._map;if(null!=q[a]?!b.existsReserved(a):!b.h.hasOwnProperty(a))return null;b=this._map;a=null!=q[a]?b.getReserved(a):b.h[a];return null==a.bytes?a.string:a.bytes}};var ca=function(){I.call(this);this.unloaded=this.inited=this.enabled=!1};ca.delayCall=function(){ca._list.clear();for(var a=ca._map.keys();a.hasNext();){var b=a.next();ca._list.push(ca._map.h[b])}a=0;for(b=ca._list.get_length();a<
b;){var c=a++;c=ca._list.getArrayElement(c);ca._map.remove(c.getInstanceID());c.inited=!0;c.dispatchEvent(C.complete)}ca._list.clear()};ca.prototype=n(I.prototype,{unload:function(){this._file=null;this.enabled=!1;this.unloaded=!0;this.dispose()},fileComplete:function(){this.enabled=!0;this.onFileComplete();this.doComplete()},onFileComplete:function(){},doComplete:function(){var a=ca._map,b=this.getInstanceID();a.h[b]=this;null==ca._delayCall&&(ca._delayCall=new ba(ca.delayCall));ca._delayCall.start(.02)},
set_file:function(a){return this._file=a}});var Wd=function(){ca.call(this);this.data=new Ja};Wd.prototype=n(ca.prototype,{init:function(a){if(null!=this.texture)if(this.enabled=!0,null==a){this.packed=!1;a=this.texture.texture.width;var b=this.texture.texture.height;if(0!=a&&0!=b){var c=this.data.frame,d=0,e=0,f=a,g=b;null==g&&(g=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c.w=g;c=this.data.originalSize;d=a;e=b;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;this.data.page=new Xd;
this.data.page.name=this.atlasName;this.data.page.width=p.floatToInt(a);this.data.page.height=p.floatToInt(b);this.data.postInit();this.dispatchEvent(C.init)}}else this.packed=!0,a=a.getRegion(this.name),null==a?this.enabled=!1:(this.data.copy(a),null==this.data.page&&(this.enabled=!1),this.dispatchEvent(C.init))},set_atlasName:function(a){return null!=this.atlasName?this.atlasName:this.atlasName=a},set_name:function(a){return null!=this.name?this.name:this.name=a},set_texture:function(a){return null!=
this.texture?this.texture:this.texture=a}});var kf=function(){ca.call(this);this.audio=new ab};kf.prototype=n(ca.prototype,{unload:function(){ca.prototype.unload.call(this);null!=this.audio&&(this.audio.dispose(),this.audio=null)},onFileComplete:function(){ca.prototype.onFileComplete.call(this);this.audio.fromUrl(this._file.url)}});var mf=function(){ca.call(this);this.bytes=wa._new()};mf.prototype=n(ca.prototype,{unload:function(){ca.prototype.unload.call(this);null!=this.bytes&&(this.bytes.dispose(),
this.bytes=null)},onFileComplete:function(){ca.prototype.onFileComplete.call(this);this.enabled=null!=this._file.bytes;null!=this._file.bytes&&(this.bytes.writeBytes(this._file.bytes),this.bytes.position=0)}});var se=function(a,b){ca.call(this);this.name=a;this.texture=b};se.prototype=n(ca.prototype,{unload:function(){ca.prototype.unload.call(this);this.texture=null;null!=this.fnt&&(this.fnt.dispose(),this.fnt=null)},setfnt:function(a){this.fnt=a;this.enabled=!0;this.doComplete()}});var Vg=function(){ca.call(this);
this._table=new Yd;this._tableMap=new L};Vg.prototype=n(ca.prototype,{add:function(a){var b=this._tableMap,c=a.name;null!=q[c]?b.setReserved(c,a):b.h[c]=a},unload:function(){ca.prototype.unload.call(this);this._tableMap=this._table=null},onFileComplete:function(){ca.prototype.onFileComplete.call(this);if(null!=this._file.bytes){try{var a=wa.fromBytes(this._file.bytes);a=wa.fromBytes(dc.uncompress(wa.toBytes(a)));for(var b=a.readUnsignedShort();0<b--;){var c=a.readUnsignedInt(),d=wa._new();a.readBytes(d,
0,c);var e=this._table.readName(d);if(null!=e){var f=this._tableMap;if(null!=q[e]?f.existsReserved(e):f.h.hasOwnProperty(e)){this._table.name=e;var h=this._tableMap,k=null!=q[e]?h.getReserved(e):h.h[e];this._table.onCreateItem=g(k,k.createTableItem);this._table.decode(d)}}}for(var m=this._tableMap,n=new Pb(m,m.arrayKeys());n.hasNext();)n.next().tableInit()}catch(dh){}this._tableMap=this._table=null}}});var of=function(){ca.call(this);this.texture=new hd};of.prototype=n(ca.prototype,{unload:function(){ca.prototype.unload.call(this);
null!=this.texture&&(this.texture.unload(),this.texture=null)},onFileComplete:function(){ca.prototype.onFileComplete.call(this);if(null==this._file.image)this.enabled=!1;else try{0!=this._file.image.width&&(this.texture.setData(this._file.image),this.parsePng())}catch(a){}null!=this._file.bytes&&null==this._file.image&&(this._file.image=new Zc,this._file.image.fromBytes(this._file.bytes,g(this,this.onImageComplete)))},onImageComplete:function(a){this.onFileComplete()},parsePng:function(){m.texture.res=
this;m.texture.tag=0;m.texture.bytes=null;var a=0;if(null!=this._file.bytes){var b=new xd;b.decode(wa.fromBytes(this._file.bytes));var c=b.getChunk(wd.TYPE_USER);if(null!=c&&(c=c.getContent(),null!=c))for(c.position=0;ta.gt(c._length-c.position,0);){var d=new $c(0),e=d.decode(c);e.position=0;m.texture.tag=d.type;m.texture.bytes=e;m.texture.dispatchEvent(C.data);++a}b.dispose()}1>a&&(m.texture.tag=0,m.texture.bytes=null,m.texture.dispatchEvent(C.data))}});var we=function(){sa.call(this);$c.map.h[vd.TYPE]=
"fnt"};we.prototype=n(sa.prototype,{getRes:function(a){var b=this._map;if(null!=q[a]?b.existsReserved(a):b.h.hasOwnProperty(a))b=this._map,b=null!=q[a]?b.getReserved(a):b.h[a];else{var c=m.texture.get(a);c._file.forceBytes=!0;b=new se(a,c.texture);b.set_file(c._file);c=this._map;null!=q[a]?c.setReserved(a,b):c.h[a]=b;c=this._fntMap;if(null!=q[a]?c.existsReserved(a):c.h.hasOwnProperty(a))c=this._fntMap,b.setfnt(null!=q[a]?c.getReserved(a):c.h[a])}return b},onConstruct:function(){sa.prototype.onConstruct.call(this);
this._fntMap=new L},init:function(){sa.prototype.init.call(this);m.texture.addEventListener(C.data._type,g(this,this.ondata))},ondata:function(a){if(m.texture.tag==vd.TYPE){var b=m.texture.bytes;a=new vd;a.decode(b);b=m.texture.res._file.path;var c=this._fntMap;null!=q[b]?c.setReserved(b,a):c.h[b]=a;c=this._map;c=null!=q[b]?c.getReserved(b):c.h[b];if(null==c){c=new se(b,m.texture.get(b).texture);var d=this._map;null!=q[b]?d.setReserved(b,c):d.h[b]=c}c.enabled||c.setfnt(a)}}});var xe=function(){sa.call(this)};
xe.prototype=n(sa.prototype,{createRes:function(){return new Vg},onLoadBefore:function(a){sa.prototype.onLoadBefore.call(this,a);a._file.forceBytes=!0}});var te=function(a,b,c){null==c&&(c=!1);this.isStatic=c;this.priority=0;this._name=b;this._metaList=[];this._metaMap=new L;b=ja.fields(a);for(c=b.length;0<c--;){var d=b[c];if("t"!=d&&"f"!=d){this._metaList.push(d);var e=ja.field(a,d);null!=e&&1==e.length&&aa.__instanceof(e[0],me)&&(this.priority=e[0]);var f=this._metaMap;null!=q[d]?f.setReserved(d,
e):f.h[d]=e}}b=ja.field(a,"t");null!=b&&0<b.length?(this._type=gb[b[b.length-1]],this.isFunction=!1):(this.isFunction=!0,this._funArgs=[]);a=ja.field(a,"f");if(null!=a)for(b=0,c=a.length;b<c;)d=b++,d=ja.field(a[d],"type"),this._funArgs.push(gb[d])};te.prototype={};var Gb=function(){};Gb.get=function(a){if(null==a)return null;if(null!=Gb._infoMap.h.__keys__[a.__id__])return Gb._infoMap.h[a.__id__];var b=new Gb;b.classPath=a.__name__;b.parse(a);Gb._infoMap.set(a,b);b.parseClassMeta(yb.getType(a));return b};
Gb.prototype={getClassMeta:function(a,b,c){null==c&&(c=!1);null==b&&(b=!1);var d=this._classMetaMap;if(null!=q[a]?d.existsReserved(a):d.h.hasOwnProperty(a))return b=this._classMetaMap,null!=q[a]?b.getReserved(a):b.h[a];if(c)for(var e=a.toLowerCase(),f=this._classMetaMap.keys();f.hasNext();)if(d=f.next(),d.toLowerCase()==e)return a=this._classMetaMap,null!=q[d]?a.getReserved(d):a.h[d];return b&&(d=Gb.get(this._super),null!=d)?d.getClassMeta(a,b,c):null},parseClassMeta:function(a){this._classMetaMap=
new L;for(var b=ja.fields(a),c=b.length;0<c--;){var d=b[c],e=Q.getValue(a,d);null==e&&(e=[]);var f=this._classMetaMap;null!=q[d]?f.setReserved(d,e):f.h[d]=e}},parse:function(a){this._super=a.__super__;var b=yb.getFields(a);this._metaMap=new L;this._fields=[];for(var c=ja.fields(b),d=c.length,e=[];0<d--;){var f=c[d],h=new te(ja.field(b,f),f),k=this._metaMap;null!=q[f]?k.setReserved(f,h):k.h[f]=h;null!=h._type?this._fields.push(f):e.push(h)}d=e.length;if(0<d)for(e.reverse(),e.sort(g(this,this.sort)),
b=0;b<d;)c=b++,this._fields.push(e[c]._name);b=yb.getStatics(a);c=ja.fields(b);for(d=c.length;0<d--;)a=c[d],f=new te(ja.field(b,a),a,!0),h=this._metaMap,null!=q[a]?h.setReserved(a,f):h.h[a]=f,null!=f._type?this._fields.push(a):e.push(f)},sort:function(a,b){return a.priority<b.priority?1:a.priority>b.priority?-1:0}};var ba=function(a){null==ba._id&&(ba._id=0);this.instanceID=ba._id++;this.handler=a;this.running=!1;this.time=0};ba.add=function(a,b){if(null!=a)if(0>=b){if(null!=a.handler)a.onExecute()}else{var c=
oa._custom();a.time=b+c;null==ba._delayTask&&(ba._delayTask=new Wg);ba._delayTask.running||qa.add(ba._delayTask);ba._delayTask.add(a)}};ba.remove=function(a){null!=a&&null!=ba._delayTask&&ba._delayTask.remove(a)};ba.prototype={start:function(a){ba.add(this,a)},stop:function(){ba.remove(this)},onStart:function(){this.running=!0},onExecute:function(){this.running=!1;null!=this.handler&&this.handler()},onEnd:function(){}};var Wg=function(){this._map=new X;this._list=new ig(g(this,this.compare));this._callList=
new S;this._doList=new S;this._changed=!1};Wg.prototype={add:function(a){this._map.h.hasOwnProperty(a.instanceID)?this._changed=!0:(this._changed=!0,this._map.h[a.instanceID]=a,a.onStart())},remove:function(a){this._map.h.hasOwnProperty(a.instanceID)&&(this._changed=!0,this._map.remove(a.instanceID),a.onEnd())},onTaskStart:function(a){this.running=!0},onTaskExecute:function(a){if(this._changed){this._changed=!1;this._list.Clear();for(a=this._map.iterator();a.hasNext();){var b=a.next();null!=b&&b.running&&
this._list.push(b)}this._current=this._list.shift()}a=this._list.count;if(null!=this._current)for(b=oa._custom();null!=this._current&&!(0>a);){if(b>=this._current.time){this._map.remove(this._current.instanceID);var c=this._list.shift();this._callList.push(this._current);this._current=c}else break;--a}a=this._callList.get_length();if(0<a){for(this._doList.clear();0<a--;)this._doList.push(this._callList.get(a));this._callList.clear();for(a=this._doList.get_length();0<a--;)b=this._doList.getArrayElement(a),
b.onExecute(),b.onEnd()}return null!=this._current||this._changed?!0:this.running=!1},onTaskEnd:function(a){},compare:function(a,b){return a.time>b.time?1:-1}};var qa=function(){};qa.add=function(a){-1==qa._triggerList.indexOf(a)&&-1==qa._addList.indexOf(a)&&(qa._addList.push(a),null==qa._timer&&(qa._timer=new gd(15),qa._timer.run=qa.run))};qa.remove=function(a){-1==qa._triggerList.remove(a)&&qa._addList.remove(a);-1==qa._endList.indexOf(a)&&qa._endList.push(a)};qa.run=function(){var a=oa._custom(),
b=qa._endList.get_length();if(0<b){for(;0<b--;)qa._endList.get(b).onTaskEnd(a);qa._endList.clear()}b=qa._triggerList.get_length();if(0<b)for(;0<b--;){var c=qa._triggerList.get(b);c.onTaskExecute(a)||qa.remove(c)}b=qa._addList.get_length();if(0<b){for(;0<b--;)c=qa._addList.get(b),qa._triggerList.push(c),c.onTaskStart(a);qa._addList.clear()}};var cc=function(){this._keys=new X};cc.getInstance=function(){null==cc._instance&&(cc._instance=new cc);return cc._instance};cc.prototype={keyTrigger:function(a){var b=
a.get_id();if(this._keys.h.hasOwnProperty(b))var c=this._keys.h[b];else c=new Va,this._keys.h[b]=c;b=!0;c.type==a.type&&0==c.deviceType&&(b=!1);c.copy(a);b&&c.trigger()}};var Ua=function(a){null==a&&(a=!1);this._immediately=a;this.touchType=0;this._list=[];for(a=20;0<a--;)this._list.push(new db);this._keyMap=new L;this._deviceMap=new X;this._activeList=new S;this.activeCount=0;this._immediately||qa.add(this);this._wheelEvent=ac.onUpdate};Ua.prototype={begin:function(a){if(Ua.focus){var b=this.getTouch(a.device,
a.touchId);null!=b&&(a.touchId=b.touchId,b.begin(a),this._immediately&&this.execute())}},move:function(a){if(Ua.focus){var b=this.getTouch(a.device,a.touchId);null!=b&&(a.touchId=b.touchId,b.move(a),this._immediately&&this.execute())}},end:function(a){var b=this.getTouch(a.device,a.touchId);null!=b&&(a.touchId=b.touchId,b.end(a),this._immediately&&this.execute(),Ua.focus||b.has(2)||(Ua.focus=!0,Ua.onBegin.dispatchEvent(C.focus)))},cancel:function(a){if(Ua.focus){var b=this.getTouch(a.device,a.touchId);
null!=b&&(a.touchId=b.touchId,b.cancel(a),this._immediately&&this.execute())}},wheel:function(a,b){this._wheelEvent.deltaMode=a;this._wheelEvent.value.copy(b);Ua.onWheel.dispatchEvent(this._wheelEvent)},execute:function(){this._activeList.clear();for(var a=oa._custom(),b=20;0<b--;){var c=this._list[b];c._alive&&(c.execute(a),5==c.type&&(this._activeList.push(c),this.unset(c)))}this.activeCount=this._activeList.get_length();1>this.activeCount&&(this.touchType=0)},onTaskStart:function(a){},onTaskExecute:function(a){this.execute();
return!0},onTaskEnd:function(a){},getTouch:function(a,b){b=""+a+"|"+b;var c=this._keyMap;if(null!=q[b]?c.existsReserved(b):c.h.hasOwnProperty(b))return a=this._keyMap,null!=q[b]?a.getReserved(b):a.h[b];c=this.getUnused();if(null==c)return null;var d=this._keyMap;null!=q[b]?d.setReserved(b,c):d.h[b]=c;d=this._deviceMap.h[a];null==d&&(d=new Xg(a),this._deviceMap.h[a]=d);d.add(c);c._key=b;return c},getUnused:function(){for(var a=0;20>a;){var b=a++,c=this._list[b];if(null==c._key)return c.touchId=b,c}return null},
unset:function(a){var b=a._key,c=b.split("|");c=p.stringToInt(c[0]);a._key=null;this._keyMap.remove(b);b=this._deviceMap.h[c];null!=b&&(b.remove(a),1>b.count&&this._deviceMap.remove(c))}};var Xg=function(a){this.id=a;this._list=[];this.count=0};Xg.prototype={add:function(a){a.device=this.id;for(var b=0,c=this._list.length;b<c;){var d=b++;if(null==this._list[d]){a.touchId=d;this._list[d]=a;this.count++;return}}a.touchId=this._list.length;this._list.push(a);this.count++},remove:function(a){var b=this._list.length;
for(this.count=b;0<b--;)this._list[b]==a&&(this._list[b]=null,this.count--)}};var dc=function(){};dc.uncompress=function(a,b){null==b&&(b="zlib");var c=null;try{if("deflate"==b)c=pako.inflateRaw(a.b.bufferValue);else{if("lzma"==b)return a;"zlib"==b&&(c=pako.inflate(a.b.bufferValue))}}catch(d){}return Ea.ofData(c)};dc.getCRC32=function(a){return Zf.make(a)};var Q=function(){};Q.getValue=function(a,b){return a instanceof L?null!=q[b]?a.getReserved(b):a.h[b]:ja.getProperty(a,b)};Q.setValue=function(a,
b,c){a instanceof L?null!=q[b]?a.setReserved(b,c):a.h[b]=c:ja.setProperty(a,b,c)};Q.copyFieldTo=function(a,b,c){null==c&&(c="_");for(var d=ja.fields(a),e=d.length;0<e--;){var f=d[e];if(0!=f.indexOf(c)){var g=Q.getValue(b,f),h=Q.getValue(a,f);null==g?Q.setValue(b,f,h):g instanceof Array&&null==g.__enum__?(g=[],Q.copyFieldTo(h,g,c),Q.setValue(b,f,g)):"number"==typeof g||"number"==typeof g&&(g|0)===g||"string"==typeof g||"boolean"==typeof g?Q.setValue(b,f,h):(g={},Q.copyFieldTo(h,g,c),Q.setValue(b,f,
g))}}};Q.getInt=function(a,b,c){null==c&&(c=0);a=Q.getValue(a,b);return null==a?c:"string"==typeof a?ma.parseInt(a):aa.__cast(a,me)};Q.getFloat=function(a,b,c){null==c&&(c=0);a=Q.getValue(a,b);return null==a?c:"string"==typeof a?parseFloat(a):aa.__cast(a,ag)};Q.getBool=function(a,b,c){null==c&&(c=!1);a=Q.getValue(a,b);return null==a?c:a};Q.exist=function(a,b){var c=Object.prototype.hasOwnProperty.call(a,b);return c||null==ja.field(a,b)?c:!0};Q.containsValue=function(a,b){if(b==a)return!0;if(("string"==
typeof b?0:ja.isObject(b))&&("string"==typeof a?0:ja.isObject(a))){for(var c=ja.fields(b),d=c.length;0<d--;){var e=c[d],f=Q.getValue(b,e);e=Q.getValue(a,e);if(null!=e||null!=f)if("string"==typeof f?0:ja.isObject(f)){if(!Q.containsValue(e,f))return!1}else if(f!=e)return!1}return!0}return!1};var qd=function(){};qd.quadInOut=function(a){return.5>a?2*a*a:-2*--a*a+1};qd.backOut=function(a){return 0==a?0:1==a?1:--a*a*(2.70158*a+1.70158)+1};var rb=Ra["lovedna.utils._StringTable.ValueType"]={__ename__:"lovedna.utils._StringTable.ValueType",
__constructs__:"string float double int uint array map value2 value3 bytes file".split(" "),string:{_hx_index:0,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha},float:{_hx_index:1,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha},double:{_hx_index:2,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha},int:(P=function(a){return{_hx_index:3,size:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha}},P.__params__=["size"],P),uint:(P=function(a){return{_hx_index:4,
size:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha}},P.__params__=["size"],P),array:(P=function(a){return{_hx_index:5,type:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha}},P.__params__=["type"],P),map:(P=function(a){return{_hx_index:6,value:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha}},P.__params__=["value"],P),value2:(P=function(a,b){return{_hx_index:7,x:a,y:b,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha}},P.__params__=["x","y"],P),
value3:(P=function(a,b,c){return{_hx_index:8,x:a,y:b,z:c,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha}},P.__params__=["x","y","z"],P),bytes:{_hx_index:9,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha},file:(P=function(a){return{_hx_index:10,type:a,__enum__:"lovedna.utils._StringTable.ValueType",toString:ha}},P.__params__=["type"],P)},Yg=function(){this._stringTable=[];this._stringMap=new L};Yg.prototype={readType:function(a){switch(a.readUnsignedByte()){case 2:return rb.float;
case 3:return rb.double;case 4:return a=a.readUnsignedByte(),rb.int(a);case 5:return a=this.readType(a),rb.array(a);case 6:return a=this.readType(a),rb.map(a);case 7:return rb.bytes;case 8:var b=this.readType(a);a=this.readType(a);return rb.value2(b,a);case 9:b=this.readType(a);var c=this.readType(a);a=this.readType(a);return rb.value3(b,c,a);case 10:return a=a.readUnsignedByte(),rb.uint(a)}return rb.string},readValue:function(a,b){switch(b._hx_index){case 0:a=a.readUnsignedShort();if(65534!=a){if(65533==
a)return"";if(a>=this._stringTable.length)throw this.error="string id error",new w(this.error);return this._stringTable[a]}break;case 1:return a.readFloat();case 2:return a.readFloat();case 3:var c=b.size;if(8==c)return a.readByte();if(16==c)return a.readShort();if(32==c)return a.readInt();if(64==c)return new ie(a.readInt(),a.readInt());break;case 4:c=b.size;if(8==c)return a.readUnsignedByte();if(16==c)return a.readUnsignedShort();if(32==c)return a.readUnsignedInt();if(64==c)return new ie(a.readUnsignedInt(),
a.readUnsignedInt());break;case 5:c=b.type;var d=[];for(b=a.readUnsignedShort();0<b--;)d.push(this.readValue(a,c));return d;case 6:c=b.value;d=new L;for(b=a.readUnsignedByte();0<b--;){var e=this.readValue(a,rb.string),f=this.readValue(a,c);null!=q[e]?d.setReserved(e,f):d.h[e]=f}return d;case 7:c=b.y;d=b.x;if(0==a.readUnsignedByte())break;return new jg(this.readValue(a,d),this.readValue(a,c));case 8:c=b.z;d=b.y;b=b.x;if(0==a.readUnsignedByte())break;b=this.readValue(a,b);d=this.readValue(a,d);a=this.readValue(a,
c);return new kg(b,d,a);case 9:if(c=a.readUnsignedInt(),!(1>c)){if(ta.gt(c,a._length-a.position))throw this.error="error length",new w(this.error);d=wa._new();a.readBytes(d,0,c);return d}}return null},readStringTable:function(a){this._stringMap=null;this._stringTable=[];for(var b=a.readUnsignedShort();0<b--;)this._stringTable.push(a.readUTF())}};var Zg=function(a,b,c){this.name=a;this.type=b;this.disable=c};Zg.prototype={};var Yd=function(){this.parser=new Yg};Yd.prototype={readName:function(a){this.name=
null;return"TABLE"!=a.readUTFBytes(5)?(a.position-=5,this.name):this.name=a.readTinyUTF()},decode:function(a){var b=a.readUnsignedInt(),c=a.readUnsignedShort(),d=a.readUnsignedShort(),e=a.position;a.position=b;this.parser.readStringTable(a);a.position=e;this.fields=[];for(b=0;b<c;){b++;e=a.readTinyUTF();var f=this.parser.readType(a);e=new Zg(e,f,!1);this.fields.push(e)}for(;0<d--;)for(b=null,null!=this.onCreateItem&&(b=this.onCreateItem()),e=0,f=c;e<f;){var g=e++;g=this.fields[g];var h=this.parser.readValue(a,
g.type);null!=b&&(b[g.name]=h)}}};var sf=function(){this.scale=1;this.keys=new S;this.length=0;this._timeList=[];this._sort=!1;this.postWrapMode=this.preWrapMode=1;this._min=1.79769313486231E308;this._max=-1.79769313486231E308};sf.prototype={clear:function(){this.length=0;this.keys.clear();this._min=1.79769313486231E308;this._max=-1.79769313486231E308;this.minValue=1.79769313486231E308;this.maxValue=-1.79769313486231E308},addValue:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);a=new Fd(a,b,c,d);
this.add(a)},add:function(a){0<this.keys.get_length()&&a.time<this.keys.getArrayElement(this.length-1).time&&(this._sort=!0);this.keys.push(a);this.length=this.keys.get_length();this._timeList.push(a.time);a.time<this._min&&(this._min=a.time);a.time>this._max&&(this._max=a.time);var b=this.minValue,c=a.value;this.minValue=b<c?b:c;b=this.maxValue;a=a.value;this.maxValue=b>a?b:a},evaluate:function(a){if(2>this.length)return 0;if(this._sort){this._sort=!1;this.keys.sort(g(this,this.sort));for(var b=
0,c=this.length;b<c;){var d=b++;this._timeList[d]=this.keys.getArrayElement(d).time}}a>this._max?1==this.postWrapMode?a%=this._max:0==this.postWrapMode?a=this._max:2==this.postWrapMode&&(a%=this._max,0!=(p.floatToInt(a/this._max)&1)&&(a=this._max-a)):a<this._min&&(1==this.postWrapMode?(a%=this._max,a+=this._max):0==this.postWrapMode?a=this._min:2==this.postWrapMode&&(a%=this._max,a+=this._max,0!=(p.floatToInt(a/this._max)&1)&&(a=this._max-a)));c=p.binarySearchLow(this._timeList,a);if(-1==c)return 0;
if(c>=this.length-1)return this.keys.getArrayElement(this.length-1).value;b=c+1;var e=this.keys.getArrayElement(c),f=this.keys.getArrayElement(b);a-=e.time;d=e.time;b=e.value;c=e.time-d;var h=f.time-d,k=h-c,m=h*h-c*c;d=e.value-b;e=e.outTangent;var n=f.inTangent;f=((f.value-b-d-e*k)/(m-2*k*c*c)-(n-e)/(2*k))/((h*h*h-c*c*c-3*k*c*c)/(m-2*k*c)-3*m/(2*k));k=(n-e)/(2*k)-3*m/(2*k)*f;e-=2*k*c+3*f*c*c;return(d-(e*c+k*c*c+f*c*c*c)+e*a+k*a*a+f*a*a*a+b)*this.scale},sort:function(a,b){return a.time>b.time?1:a.time<
b.time?-1:0}};var Sd=function(a,b){this.time=a;this.value=b};Sd.prototype={};var Fd=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);Sd.call(this,a,b);this.inTangent=c;this.outTangent=d};Fd.prototype=n(Sd.prototype,{});var rf=function(){this._keys=new S;this.length=0;this._timeList=[];this._sort=!1;this.postWrapMode=this.preWrapMode=1;this._min=1.79769313486231E308;this._max=-1.79769313486231E308};rf.prototype={add:function(a,b){a=new Sd(a,b);0<this._keys.get_length()&&a.time<this._keys.getArrayElement(this.length-
1).time&&(this._sort=!0);this._keys.push(a);this.length=this._keys.get_length();this._timeList.push(a.time);a.time<this._min&&(this._min=a.time);a.time>this._max&&(this._max=a.time)},evaluate:function(a){if(1>this.length)return!1;if(this._sort){this._sort=!1;this._keys.sort(g(this,this.sort));for(var b=this._keys.get_length(),c=1.79769313486231E308;0<b--;){var d=this._keys.get(b);d.time==c&&(this._keys.removeAt(b),this._timeList.pop());c=d.time}b=this._keys.get_length();for(c=0;c<b;)d=c++,this._timeList[d]=
this._keys.getArrayElement(d).time}a>this._max?1==this.postWrapMode?a%=this._max:0==this.postWrapMode?a=this._max:2==this.postWrapMode&&(a%=this._max,0!=(p.floatToInt(a/this._max)&1)&&(a=this._max-a)):a<this._min&&(1==this.postWrapMode?(a%=this._max,a+=this._max):0==this.postWrapMode?a=this._min:2==this.postWrapMode&&(a%=this._max,a+=this._max,0!=(p.floatToInt(a/this._max)&1)&&(a=this._max-a)));c=p.binarySearchLow(this._timeList,a);if(-1==c)return!1;if(c>=this.length-1)return this.end=this.start=
this._keys.getArrayElement(this.length-1).value,this.ratio=0,!0;b=this._keys.getArrayElement(c);c=this._keys.getArrayElement(c+1);this.start=b.value;this.end=c.value;c=c.time-b.time;if(0>=c)return this.ratio=0,!0;this.ratio=(a-b.time)/c;return!0},sort:function(a,b){return a.time>b.time?1:a.time<b.time?-1:0}};"undefined"==typeof W.$haxeUID&&(W.$haxeUID=0);null==String.fromCodePoint&&(String.fromCodePoint=function(a){return 65536>a?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&
1023)+56320)});String.prototype.__class__=gb.String=String;Date.prototype.__class__=gb.Date=Date;var me={},ah={},ag=Number,$g=Boolean,Vf={},Wf={},q={};td.count=0;Object.defineProperty(w.prototype,"message",{get:function(){return String(this.val)}});aa.__toStr={}.toString;Na._names=[];Na._layers=new L;Na.setLayerName(0,"Default");Na.setLayerName(1,"Transparent");Na.setLayerName(2,"IgnoreRaycast");Na.setLayerName(3,"Water");Na.setLayerName(4,"UI");x.Element=0;x.PCData=1;x.CData=2;x.Comment=3;x.DocType=
4;x.ProcessingInstruction=5;x.Document=6;mb._id=0;I._temp=[];Qb._id=1;ab._elist=["play","pause","ended","canplaythrough","loadedmetadata"];ab._eaction=[1,3,2,7,-1];jd.workerEnable=!1;nb._map=new L;A.trapPath="image/pack/actor_";A.effectPath="image/pack/";A.uiPath="image/pack/";A.soundPath="audio/";A.lightShader="_pointlight";J.datebase=new ze("gamedb");J.mapData=new fc;Fa.background=0;Fa.uifloat=1;Fa.uipop=2;Sb.springUpTime=Math.sqrt(.3958518518518519);Sb.springJumpUpVelocity=(167+.5*Sb.springUpTime*
Sb.springUpTime*843.7499999999999)/Sb.springUpTime;na._inited=!1;Fb.b32=new ib;sb.pool=new M(function(){return new sb});sb._id=1;Xa._id=1;Xa.pool=new M(function(){return new Xa});v._destoryCount=0;ra._pools=[];H._pool=new ra(function(){return new H});H.instance=new H;h._pool=new ra(function(){return new h});h.instance=new h;Ya._v3=h.instance;Ya._v2=H.instance;xa.defaultRenderQueue=30010;sa._all=new L;$c.map=new X;pd.TYPE=1149700628;jb.instance=new jb;Dd.TYPE=-433249250;K.onLoadEvent=new I;K._list=
new S;K._fileMap=new L;K._version=new L;K._defaultRoot="";K._loading=!1;K._path=new ub;K.meta=new Dd;K.enableVersion=!0;m.bytes=new lf;m.texture=new nf;m.atlas=new gf;m.audio=new jf;m.version="";m._init=!1;jc.pool=new M(function(){return new jc});k._id=0;k._nameMap=new L;k.POSITION=k._new("POSITION",3,k._id++);k.UV=k._new("UV",2,k._id++);k.UV2=k._new("UV2",2,k._id++);k.NORMAL=k._new("NORMAL",3,k._id++);k.TANGENT=k._new("TANGENT",4,k._id++);k.COLOR=k._new("COLOR",4,k._id++);k.COLOR2=k._new("COLOR2",
4,k._id++);k.COLOR3=k._new("COLOR3",4,k._id++);k.COLOR4=k._new("COLOR4",4,k._id++);k.COLOR5=k._new("COLOR5",4,k._id++);k.COLOR6=k._new("COLOR6",4,k._id++);k.BONE_INDEX=k._new("BONE_INDEX",4,k._id++);k.BONE_WEIGHT=k._new("BONE_WEIGHT",4,k._id++);k.P=k._new("P",16);k.V=k._new("V",16);k.VP=k._new("VP",16);k.IV=k._new("IV",16);k.IVP=k._new("IVP",16);k.M=k._new("M",16);k.IM=k._new("IM",16);k.BASECOLORMAP=k._new("BASECOLORMAP");k.NORMALMAP=k._new("NORMALMAP");k._REGION=k._new("_REGION");k.EYE=k._new("EYE",
3);k.FOG=k._new("FOG",4);k.FOG_COLOR=k._new("FOG_COLOR",4);k.TIME=k._new("TIME",4);k.TIME_SIN=k._new("TIME_SIN",4);k.TIME_COS=k._new("TIME_COS",4);k.TIME_DELTA=k._new("TIME_DELTA",4);k.SCREEN_PARAMS=k._new("SCREEN_PARAMS",4);k.PROJECTION_PARAMS=k._new("PROJECTION_PARAMS",4);k.ORTHOGRAPHIC_PARAMS=k._new("ORTHOGRAPHIC_PARAMS",4);k.RENDER_BUFFER=k._new("renderBuffer");k.BONE=k._new("BONE");k.SKINNING=k._new("SKINNING");k.LIGHT=k._new("LIGHT");k.LIGHT_POSITION=k._new("LIGHT_POSITION");k.LIGHT_AMBIENT=
k._new("LIGHT_AMBIENT");k.LIGHT_SPECULAR=k._new("LIGHT_SPECULAR");kc.pool=new M(function(){return new kc});lc.pool=new M(function(){return new lc});mc.pool=new M(function(){return new mc});nc.pool=new M(function(){return new nc});oc.pool=new M(function(){return new oc});pc.pool=new M(function(){return new pc});za._pool=new ra(function(){return new za});qc._worldMat=new za;rc.pool=new M(function(){return new rc});sc.pool=new M(function(){return new sc});tc.pool=new M(function(){return new tc});uc.pool=
new M(function(){return new uc});vc.pool=new M(function(){return new vc});wc.pool=new M(function(){return new wc});xc.pool=new M(function(){return new xc});ad._worldMat=new za;Vb.__meta__={obj:{allowMulti:null}};Vb._worldMat=new za;yc.pool=new M(function(){return new yc});zc.pool=new M(function(){return new zc});Ac.pool=new M(function(){return new Ac});Bc.pool=new M(function(){return new Bc});ya.instance=new ya;bd.instance=new bd;Xb.tokenLeft="[";Xb.tokenRight="]";Gd._pool=new ra(function(){return new Xb});
Y.defaultSize=20;Y._parse=new Gd;Y._charpool=new ra(function(){return new uf});Y._linepool=new ra(function(){return new vf});Cc.pool=new M(function(){return new Cc});z._id=1;z._changed=new X;z._v20=new H;z._v21=new H;wb._id=1;wb.pool=new M(function(){return new wb});Dc.pool=new M(function(){return new Dc});Zb.pool=new M(function(){return new Zb});$b.pool=new M(function(){return new $b});Ec.pool=new M(function(){return new Ec});Mb.pool=new M(function(){return new Mb});Fc.pool=new M(function(){return new Fc});
Gc.pool=new M(function(){return new Gc});Hc.pool=new M(function(){return new Hc});Lb.pool=new M(function(){return new Lb});Jc.pool=new M(function(){return new Jc});Ic.pool=new M(function(){return new Ic});xb._helperVec2=new H;Kc.pool=new M(function(){return new Kc});Lc.pool=new M(function(){return new Lc});Mc.pool=new M(function(){return new Mc});Nc.pool=new M(function(){return new Nc});Ca._pool=new ra(function(){return new Ca});Ca.instance=new Ca;Oc.pool=new M(function(){return new Oc});Yb.pool=
new M(function(){return new Yb});Pc.pool=new M(function(){return new Pc});Qc.pool=new M(function(){return new Qc});Rc.pool=new M(function(){return new Rc});Sc.pool=new M(function(){return new Sc});D._history=[];pa.SCALE_PRESS=.95;pa.TIME_PRESS=.1;pa.TIME_RELEASE=.2;ed.success=!1;Tc.pool=new M(function(){return new Tc});bb.USE_CACHE=!1;bb.USE_ENUM_INDEX=!1;bb.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:";kb.DEFAULT_RESOLVER=new ke;kb.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:";
Eb.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Eb.BYTES=Ea.ofString(Eb.CHARS);ud.helper=new DataView(new ArrayBuffer(8));Ob.escapes=function(a){a=new L;null!=q.lt?a.setReserved("lt","<"):a.h.lt="<";null!=q.gt?a.setReserved("gt",">"):a.h.gt=">";null!=q.amp?a.setReserved("amp","&"):a.h.amp="&";null!=q.quot?a.setReserved("quot",'"'):a.h.quot='"';null!=q.apos?a.setReserved("apos","'"):a.h.apos="'";return a}(this);F.BLACK=new F(0,0,0,1);F.WHITE=(new F).setRGBA(-1);F.GRAY=(new F).setRGBA(2139062271);
F.BLUE=new F(0,0,1,1);F.GREEN=(new F).setRGBA(16711935);F.YELLOW=(new F).setRGBA(-65281);F.RED=(new F).setRGBA(-16776961);F.instance=new F;cb._id=0;cb._c=new F(1,0,0,1);Ld.instance=new Ld;Za._uv=new H;p.randomInstance=new fd;G._lines=new M(function(){return new cg});G._triangles=new M(function(){return new eg});G._planes=new M(function(){return new dg});G._circles=new M(function(){return new bg});G.editorMode=!1;G.isPlaying=!0;G.buffer=new fg;G._enabled=!1;G._list=new S;G._cleared=!0;Sa.systemDispatcher=
new I;Sa.focus=!0;oa._custom=oa.getnow;oa._offset=0;C.complete=new C("complete");C.init=new C("init");C.data=new C("data");C.update=new C("update");C.delete=new C("delete");C.focus=new C("focus");C.blur=new C("blur");Jb.onLoad=new Jb("onLoad");Da.onUpdate=new Da("onUpdate");Db.onUpdate=new Db("onUpdate");ac.onUpdate=new ac("onUpdate");ua.init=new ua("init");ua.update=new ua("update");ua.resize=new ua("resize");ua.fullScreen=new ua("fullScreen");db.holdTime=.7;db.onEvent=new I;db._id=1;bc.onUpdate=
new bc("touchUpdate");Ka.type_add=1;Ka.type_delete=2;Ka.type_update=3;Ka.type_get=4;Ka._id=0;Ka.pool=new M(function(){return new Ka});vd.TYPE=-1629174247;wd.TYPE_USER=1716666723;ob._pool=new M(function(){return new ob});la.buildVersion=(new Date(2019,9,22,15,40,17)).getTime()|0;la.version=(new Date(2019,9,22,15,40,17)).getTime()|0;Va.onEvent=new I;Va._id=1;r.touchCount=0;r.maxTouchId=-1;r._init=!1;r._touchBuffer=new S;r._touchsWithIndex=new S;r._touchsWithTouchId=new S;r._touchDown=new S;r._touchUp=
new S;r._touchPool=new M(function(){return new db});r._keyPool=new M(function(){return new Va});r._keyBuffer=new S;r._activeKeys=new X;r._keyDownList=new S;r._keyUpList=new S;E.fixedTime=.02;E.frame=0;E.time=0;E.deltaTime=0;E.smoothDeltaTime=E.fixedTime;E.fixedCount=0;E._offset=0;E._blurTime=0;E._focused=!0;E._time=0;E._fixedTime=0;Ma._bufferMap=new X;Ma._id=0;Md._pool=new ra(function(){return new Md});ea.width=1138;ea.height=640;Vc.__meta__={obj:{allowMulti:null}};Wb._id=0;Wb.temp=new M(function(){return new Wb});
La.__meta__={obj:{once:null}};Ta._dir=new h;Ta._temp=new h;Qa._list=V.fromArray([]);u.onUpdate=new u("onUpdate");u.onLateUpdate=new u("onLateUpdate");u.onFixedUpdate=new u("onFixedUpdate");u.onTransform=new u("onTransform");u.onRectTransform=new u("onRectTransform");u.onTransformComplete=new u("onTransformComplete");u.onEnable=new u("onEnable");u.onDisable=new u("onDisable");u.onAdded=new u("onAdded");u.onRemoved=new u("onRemoved");u.onCollectChildren=new u("onCollectChildren");u.onCollectChildrenComplete=
new u("onCollectChildrenComplete");u.onScreenResize=new u("onScreenResize");u.onCameraUpdate=new u("onCameraUpdate");u.onPreRender=new u("onPreRender");u.onPostRender=new u("onPostRender");u.onTouchBegin=new dd("onTouchBegin");u.onTouchEnd=new dd("onTouchEnd");Kb._id=0;ec.pressDelay=.04;Qd._id=0;Rd._id=0;Oa._fnv=jb.instance;Oa._programMap=new X;Oa.uniformPool=new M(function(){return new Rd});Oa.attributePool=new M(function(){return new Qd});U._map=new L;U._precision=new Dg;U._extension=new S;U._ifdef=
new S;$a.pool=new M(function(){return new $a});$a._id=0;$a._tempList=[];Aa._clearColor=new F(0,0,0,0);Z._pool=new ra(function(){return new Z});Z._clearRenderTarget=new ra(function(){return new Hg});Z._setViewport=new ra(function(){return new Ng});Z._pushRenderTarget=new ra(function(){return new Lg});Z._popRenderTarget=new ra(function(){return new Kg});Z._blit=new ra(function(){return new Aa});Z._callback=new ra(function(){return new Gg});Z._draw=new ra(function(){return new Jg});Z._setProperty=new ra(function(){return new Mg});
Z._copyProperty=new ra(function(){return new Ig});Z._buffers=V.fromArray([]);eb._pool=new ra(function(){return new eb});Ab._pool=new ra(function(){return new Ab});Ab._v30=new h;Bb._tempList=[];Bb._id=1;Xc._id=1;va._fnv=jb.instance;Wc._id=1;Wc._tempList=new L;Rb._map=new L;ic._fnv=new jb;ca._list=V.fromArray([]);ca._map=new X;Gb._infoMap=new td;ba._id=0;qa._addList=new S;qa._triggerList=new S;qa._endList=new S;Ua.onBegin=new I;Ua.focus=!1;Ua.onWheel=new I;zd.main()})("undefined"!=typeof exports?exports:
"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
